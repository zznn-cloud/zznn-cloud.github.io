<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/07/23/hello-world/"/>
      <url>/2024/07/23/hello-world/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>内网穿透工具NPS部署及使用</title>
      <link href="/2024/07/17/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7NPS%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
      <url>/2024/07/17/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7NPS%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="内网穿透工具NPS部署及使用"><a href="#内网穿透工具NPS部署及使用" class="headerlink" title="内网穿透工具NPS部署及使用"></a>内网穿透工具NPS部署及使用</h1><blockquote><p>先决条件：服务端 首页 &gt; 客户端 先创建好客户端</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_c57cc1faa2779e95b49cfb8865a31245.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_c57cc1faa2779e95b49cfb8865a31245.png"></p></blockquote><p>使用方法：</p><p>服务端部署完成后  下载客户端软件 在被控内网机器部署客户端 实现连接</p><p>被控客户端 客户端软件下载地址：<a href="https://github.com/ehang-io/nps/releases">Releases · ehang-io/nps (github.com)</a></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_2626f47e1e1f583f9ce57abd081b679a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_2626f47e1e1f583f9ce57abd081b679a.png"></p><h2 id="一-部署"><a href="#一-部署" class="headerlink" title="一. 部署"></a><strong>一. 部署</strong></h2><p>服务端部署</p><p>镜像可选</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffdfgdfg/nps</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:nps</span><br></pre></td></tr></table></figure><p>配置文件下载链接：</p><p><a href="https://img.zeruns.tech/down/conf.zip">https://img.zeruns.tech/down/conf.zip</a></p><p><a href="https://onenote.zznnwn.cloudns.biz/api/raw/?path=/public-tools/nps/conf.zip">https://onenote.zznnwn.cloudns.biz/api/raw/?path=/public-tools/nps/conf.zip</a></p><p><strong>①. 部署</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nps:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:nps</span> </span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nps</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf:/conf</span></span><br></pre></td></tr></table></figure><p><strong>二进制方式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装wget并且下载NPS服务端并重命名为 nps.tar.gz</span></span><br><span class="line">yum install -y wget &amp;&amp; wget --no-check-certificate -O nps.tar.gz https://img.zeruns.tech/down/linux_amd64_server.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个名为nps的目录并且解压NPS服务端文件到此目录下，并且进入到nps这个目录下</span></span><br><span class="line"><span class="built_in">mkdir</span> /opt/nps &amp;&amp; tar -zxvf nps.tar.gz -C /opt/nps &amp;&amp; <span class="built_in">cd</span> /opt/nps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装NPS并启动</span></span><br><span class="line">./nps install &amp;&amp; sudo nps start</span><br></pre></td></tr></table></figure><p><code>使用用户名和密码登陆（默认admin/123，正式使用一定要更改，修改/opt/nps/conf/nps.conf配置文件中的web_password）</code></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_5df879fc527e090f524f05a519d6e2af.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_5df879fc527e090f524f05a519d6e2af.png"></p><p>windows客户端 远程桌面</p><p><strong>② .nps服务端添加客户端(即公网机器)</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_ae0e3068fac6af72c06b7b0d75273f0e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_ae0e3068fac6af72c06b7b0d75273f0e.png"></p><h2 id="二-windows客户端部署及配置"><a href="#二-windows客户端部署及配置" class="headerlink" title="二. windows客户端部署及配置"></a>二. windows客户端部署及配置</h2><p><strong>1.windows部署客户端</strong></p><p>①. 下载windows客户端后解压 只需要npc.exe文件即可</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_d62ad08fa5766009969742debee80da7.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_d62ad08fa5766009969742debee80da7.png"></p><p>在windows C盘/目录下面新建nps文件夹 将windows客户端解压后将npc.exe文件移动到此目录  管理员cmd执行 <code>npc.exe install -server=66.21.23.155:8024 -vkey=gsdvhdfjv899 -type=tcp</code> npc.exe后面部分在服务端查看</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_a1afdda8cd7170abb50a4f3d4a0d251b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_a1afdda8cd7170abb50a4f3d4a0d251b.png"></p><p>②.windows服务配置如下</p><p>恢复 &gt; 第一二三配置为重启启动 确定后启动服务即可</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_84222ed2b1fb1401dacbb27047b7c134.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_84222ed2b1fb1401dacbb27047b7c134.png"></p><p><strong>执行成功后服务端 首页&gt;客户端&gt;会出现IP</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_41ba52dbcd70c30532ea5989baa4d7d7.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_41ba52dbcd70c30532ea5989baa4d7d7.png"></p><p><strong>③. 客户端 首页 &gt; TCP隧道 &gt; 添加上面客户端的TCP隧道 （ID对应客户端 客户端地址可填写为127.0.0.1或者实际内网IP 本次测试远程桌面 映射内网机器端口3389）</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_250ea9fa4e5f69920027160d625e0ec5.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_250ea9fa4e5f69920027160d625e0ec5.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_4adcda786d64aee4c051530f03065499.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_4adcda786d64aee4c051530f03065499.png"></p><p><strong>④. 验证（成功）</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_ff521fce395d32d506c7c6493866cc01.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_ff521fce395d32d506c7c6493866cc01.png"></p><h2 id="三-linux客户端部署及配置"><a href="#三-linux客户端部署及配置" class="headerlink" title="三. linux客户端部署及配置"></a><strong>三. linux客户端部署及配置</strong></h2><blockquote><p><strong>镜像可选移步本文首页</strong></p></blockquote><p><strong>1.docker方式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=npc --restart=always --net=host ffdfgdfg/npc -server=&lt;ip:port&gt; -vkey=&lt;web界面中显示的密钥&gt; &lt;以及一些其他参数&gt;</span><br></pre></td></tr></table></figure><p>实际</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_df8d7b820172e3d01209ea13eb218a43.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_df8d7b820172e3d01209ea13eb218a43.png"></p><p><strong>2. 二进制安装方式 客户端软件包 移步首页链接</strong></p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装wget并且下载NPC服务端并重命名为 npc.tar.gz ，可根据自己系统将yum替换为apt或其他</span></span><br><span class="line">yum install -y wget &amp;&amp; wget --no-check-certificate -O npc.tar.gz https://img.zeruns.tech/down/linux_amd64_client.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个名为npc的目录并且解压NPC服务端文件到此目录下，并且进入到npc这个目录下</span></span><br><span class="line"><span class="built_in">mkdir</span> /opt/npc &amp;&amp; tar -zxvf npc.tar.gz -C /opt/npc &amp;&amp; <span class="built_in">cd</span> /opt/npc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装NPC并启动，按提示改好命令，如下图所示</span></span><br><span class="line">./npc install -server=&lt;ip:port&gt; -vkey=&lt;web界面中显示的密钥&gt; &lt;以及一些其他参数&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动NPC</span></span><br><span class="line">sudo npc start</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_84b82cb2244e27d8995f465c7368eacd.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_84b82cb2244e27d8995f465c7368eacd.png"></p><p><strong>此时二进制安装方式完成</strong></p></blockquote><p><strong>3.建立内网穿透隧道</strong></p><p>按照上面的方法安装好客户端后就可以新建内网穿透隧道了，我这里以Windows的远程桌面服务为例，需要将TCP 3389端口映射出去，所以新建一个TCP隧道，你们根据自己实际需要选择TCP还是UDP linux ssh则为22端口映射。</p><h2 id="四-web服务端口映射"><a href="#四-web服务端口映射" class="headerlink" title="四. web服务端口映射"></a>四. web服务端口映射</h2><p>只需要建立TCP隧道转发到内网对应的端口即可 和上方3389端口远程桌面操作方式一样</p><p>效果：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_7d8aaef53299b11833fced7c5fac039c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_7d8aaef53299b11833fced7c5fac039c.png"></p><p><strong>本文参考</strong></p><p><a href="https://blog.zeruns.tech/archives/660.html">https://blog.zeruns.tech/archives/660.html</a></p><p>教程结束。</p>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu部署nvidia-container-toolkit</title>
      <link href="/2024/07/15/ubuntu%E9%83%A8%E7%BD%B2nvidia-container-toolkit/"/>
      <url>/2024/07/15/ubuntu%E9%83%A8%E7%BD%B2nvidia-container-toolkit/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="ubuntu部署nvidia-container-toolkit"><a href="#ubuntu部署nvidia-container-toolkit" class="headerlink" title="ubuntu部署nvidia-container-toolkit"></a>ubuntu部署nvidia-container-toolkit</h2><p>本教程前提条件是 宿主机需要安装完成GPU显卡的驱动 即使用 nvidia-smi 有正常回显</p><p>本教程环境：ubuntu22.04LTS</p><blockquote><p>NVIDIA container主要组件包括nvidia-container-runtime, nvidia-container-toolkit, libnvidia-container和CUDA驱动；<br>在3.6.0版本后，runtime包成为一个只依赖于toolkit包（指container-toolkit而不是nvidia CUDA toolkit）的包，在官网中也指出，对于一般的应用而言，nvidia-container-toolkit能够满足绝大多数需求。</p></blockquote><h3 id="1-官网安装方式-需要科学上网-："><a href="#1-官网安装方式-需要科学上网-：" class="headerlink" title="1.官网安装方式(需要科学上网)："></a>1.官网安装方式(需要科学上网)：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root@dlp:~<span class="comment"># curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | gpg --dearmor -o /usr/share/keyrings/nvidia-toolkit.gpg</span></span><br><span class="line">root@dlp:~<span class="comment"># curl -fsSL https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | tee /etc/apt/sources.list.d/nvidia-toolkit.list</span></span><br><span class="line">root@dlp:~<span class="comment"># sed -i -e &quot;s/^deb/deb \[signed-by=\/usr\/share\/keyrings\/nvidia-toolkit.gpg\]/g&quot; /etc/apt/sources.list.d/nvidia-toolkit.list</span></span><br><span class="line">root@dlp:~<span class="comment"># apt update</span></span><br><span class="line">root@dlp:~<span class="comment"># apt -y install nvidia-container-toolkit</span></span><br><span class="line">root@dlp:~<span class="comment"># systemctl restart docker</span></span><br></pre></td></tr></table></figure><h3 id="2-离线方式部署（低版本）"><a href="#2-离线方式部署（低版本）" class="headerlink" title="2.离线方式部署（低版本）"></a>2.离线方式部署（低版本）</h3><p>下载到本地后上传到服务器 执行部署</p><p>离线deb包下载地址：</p><p><a href="https://github.com/NVIDIA/libnvidia-container/blob/gh-pages/stable/ubuntu18.04">https://github.com/NVIDIA/libnvidia-container/blob/gh-pages/stable/ubuntu18.04</a></p><p>本地下载地址：</p><p><a href="https://onenote.zznnwn.cloudns.biz/zh-CN/public-tools/nvidia-deb/">https://onenote.zznnwn.cloudns.biz/zh-CN/public-tools/nvidia-deb/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i nvidia-container-toolkit_1.4.2-1_amd64.deb</span><br></pre></td></tr></table></figure><h3 id="3-其他-本教程成功部署方式"><a href="#3-其他-本教程成功部署方式" class="headerlink" title="3. 其他(本教程成功部署方式)"></a>3. 其他(本教程成功部署方式)</h3><p>下方deb包下载地址见onenote</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照顺序安装</span></span><br><span class="line">dpkg -i libnvidia-container1_1.9.0-1_amd64.deb</span><br><span class="line">dpkg -i libnvidia-container-tools_1.9.0-1_amd64.deb</span><br><span class="line">dpkg -i nvidia-container-toolkit_1.9.0-1_amd64.deb</span><br><span class="line">dpkg -i nvidia-container-runtime_3.9.0-1_all.deb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此种部署后需要在docker添加配置</span></span><br><span class="line">➜  ~ <span class="built_in">cat</span> /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;default-runtime&quot;</span>: <span class="string">&quot;nvidia&quot;</span>,</span><br><span class="line">    <span class="string">&quot;runtimes&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;nvidia&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/usr/bin/nvidia-container-runtime&quot;</span>,</span><br><span class="line">            <span class="string">&quot;runtimeArgs&quot;</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment"># 最后部署ollama本地大模型服务</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_61c36b996becd1e14b738fbb930de4ac.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_61c36b996becd1e14b738fbb930de4ac.png"></p><h3 id="3-验证-成功"><a href="#3-验证-成功" class="headerlink" title="3.验证(成功)"></a>3.验证(成功)</h3><p>备注：使用pve创建的虚拟机直通GPU 需要将cpu模式设置为host（默认为qemu模式） 否则会报错cpu不支持avx指令集导致GPU被禁用</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_20236426c0189f25768346fb91a15c8f.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_20236426c0189f25768346fb91a15c8f.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@AI:/etc/docker<span class="comment"># docker run -it --rm --gpus all registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:ubuntu  nvidia-smi</span></span><br><span class="line">Tue Jul 16 06:56:48 2024   </span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| NVIDIA-SMI 550.100                Driver Version: 550.100        CUDA Version: 12.4     |</span><br><span class="line">|-----------------------------------------+------------------------+----------------------+</span><br><span class="line">| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |</span><br><span class="line">| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |</span><br><span class="line">|                                         |                        |               MIG M. |</span><br><span class="line">|=========================================+========================+======================|</span><br><span class="line">|   0  NVIDIA GeForce RTX 4090 D      Off |   00000000:01:00.0 Off |                  Off |</span><br><span class="line">| 30%   37C    P0             N/A /  425W |       1MiB /  24564MiB |      0%      Default |</span><br><span class="line">|                                         |                        |                  N/A |</span><br><span class="line">+-----------------------------------------+------------------------+----------------------+</span><br><span class="line">                                                                         </span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br><span class="line">| Processes:                                                                              |</span><br><span class="line">|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |</span><br><span class="line">|        ID   ID                                                               Usage      |</span><br><span class="line">|=========================================================================================|</span><br><span class="line">|  No running processes found                                                             |</span><br><span class="line">+-----------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>参考：</p><p><a href="https://www.server-world.info/en/note?os=Ubuntu_24.04&p=nvidia&f=3">Ubuntu 24.04 : NVIDIA Container Toolkit : Install : Server World (server-world.info)</a></p><p><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html</a> （官网）</p><p><a href="https://blog.csdn.net/u010953692/article/details/114053593">https://blog.csdn.net/u010953692/article/details/114053593</a></p><p><a href="https://blog.csdn.net/NekoTom/article/details/127508810">Docker离线安装Nvidia-container-toolkit实现容器内GPU调用-CSDN博客</a></p><p><a href="https://www.holelin.cn/2022/03/31/devops/%E8%BF%90%E7%BB%B4-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85nvidia-docker2/index.html">https://www.holelin.cn/2022/03/31/devops/%E8%BF%90%E7%BB%B4-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85nvidia-docker2/index.html</a></p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TrueNAS教程</title>
      <link href="/2024/07/12/TrueNAS%E6%95%99%E7%A8%8B/"/>
      <url>/2024/07/12/TrueNAS%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="TrueNAS教程"><a href="#TrueNAS教程" class="headerlink" title="TrueNAS教程"></a>TrueNAS教程</h1><p>本文实现：</p><ul><li>可使用对象存储minio</li><li>云盘服务cloudreve</li></ul><p>镜像：基于debain系统的TrueNAS镜像: <a href="https://www.truenas.com/download-truenas-scale/">https://www.truenas.com/download-truenas-scale/</a></p><p>安装完成后后设置存储池</p><p>较为简单此处略：</p><p>备注：</p><ul><li><p>创建专门给虚拟机使用的存储池</p></li><li><p>创建专门给nas内文件存储NFS SMB等使用的池<br><del>也可以共用一个存储池！</del></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_eb5dbef3df98678d4924d47ec4fcadd4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_eb5dbef3df98678d4924d47ec4fcadd4.png"></p></li></ul><p>网络配置：</p><ul><li><p>配置静态IP地址</p></li><li><p>配置阿里云百度等DNS</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_4c5a790184f9654bf27a608eacfa6dc1.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_4c5a790184f9654bf27a608eacfa6dc1.png"></p></li></ul><p>安装虚拟机（安装完成后关闭 点击设备 删除光盘否则会重复进入安装页面）：</p><ul><li><p>虚拟机内安装docker用于部署minio, cloudreve及homepage 对外提供服务</p><p>等待安装完成，然后点击reboot，重启虚拟机后点击虚拟机的VNC进入后发现会重复进入安装centos界面，造成这个问题的原因是虚拟机设置的是UEFI启动，另外虚拟机的“设备”中也有设备启动顺序，目前lz试着修改虚拟机启动项和设备中iso的启动顺序都不好使，最简单的方法就是找到虚拟机，点开后面箭头&gt;</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_68dbe9db3d033b78ea5491141651373e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_68dbe9db3d033b78ea5491141651373e.png"></p></li><li><p>删除cdrom</p><p><strong>找到CDROM项点，开最后的三点查看详情，查看是否为当前系统的iso镜像文件，如果是的话删除重启虚拟机此时即可完全部署完成</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_2b198de5c11ec661e26dda80d8f7dc6d.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_2b198de5c11ec661e26dda80d8f7dc6d.png"></p></li></ul><p>备注：TrueNAS内应用是无法使用的原因需要配置科学上网才能正常使用 否则只是一连串的报错</p><h3 id="命令行配置IP"><a href="#命令行配置IP" class="headerlink" title="命令行配置IP"></a>命令行配置IP</h3><p><a href="https://www.ethanzhang.xyz/2023/05/14/TrueNAS%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">https://www.ethanzhang.xyz/2023/05/14/TrueNAS安装及使用教程/</a> (较为详细的完全教程)</p><p>系统完成后，首先会联想到登录到web页面进行管理，但问题正如开篇所说，有点小难点在于访问的管理IP的设定</p><blockquote><p>注意</p><p>TrueNAS默认是DHCP使能的，如果当前安装环境下有DHCP服务器，可以通过TrueNAS临时获取的IP地址直接进行Web UI管理，可以跳过当前步骤</p></blockquote><p>此时需要在TrueNAS的终端设置固定IP</p><p>选择<code>1</code>，查看并设置网络接口 将<code>ipv4_dhcp</code>选择否</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_21bef307d4ca1da94b6cb40263f68ba6.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_21bef307d4ca1da94b6cb40263f68ba6.png"></p><p>选择<code>6</code>，进入<code>Open TrueNAS CLI Shell</code></p><p>可以通过<code>netuork interface query</code>查询当前网络适配器的相关信息，主要是获取适配器<code>name</code>值用于后续配置静态IP</p><p>通过<code>network interface update ens160 aliases=&quot;172.18.3.20/24&quot;</code>及<code>netuork intertace commit</code>、<code>network intertace checkin</code>进行配置</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_b67f881228c4b541b897ce2b2d92fdc9.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_b67f881228c4b541b897ce2b2d92fdc9.png"></p><p>验证并配置网关及DNS</p><blockquote><p>必须先设置静态ip地址才能设置网关，否则提示网关不可达</p></blockquote><p>返回并选择<code>2 configure network settings</code>，然后配置网关及DNS信息</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_3ec55c9da582caec873b3c578e714f03.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_3ec55c9da582caec873b3c578e714f03.png"></p><p>此时，如果能够ping通管理IP地址，初始化工作就算完成</p><h3 id="TrueNAS-APP应用添加TrueCharts社区catalog目录"><a href="#TrueNAS-APP应用添加TrueCharts社区catalog目录" class="headerlink" title="TrueNAS APP应用添加TrueCharts社区catalog目录"></a>TrueNAS APP应用添加TrueCharts社区catalog目录</h3><p><strong>参考：</strong></p><ul><li><p><a href="https://gitee.com/truecharts/dh_catalog">https://gitee.com/truecharts/dh_catalog</a><br><a href="https://gitee.com/JerryFox/true-nas-catalog">https://gitee.com/JerryFox/true-nas-catalog</a><br><a href="https://www.cnblogs.com/Jerrycjc/p/17134915.html">https://www.cnblogs.com/Jerrycjc/p/17134915.html</a><br><a href="https://www.shiyunhao.cn/archives/truenasapp-ying-yong-tian-jia-truecharts-she-qu-catalog-mu-lu">https://www.shiyunhao.cn/archives/truenasapp-ying-yong-tian-jia-truecharts-she-qu-catalog-mu-lu</a></p></li><li><p>使用本地仓库</p><p><a href="https://gitee.com/apple-Teawine/true-nas-catalog.git">https://gitee.com/apple-Teawine/true-nas-catalog.git</a><br>main<br>stable,dependency,enterprise,incubator 分支</p></li></ul><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_58eba0a1e41467c84a152b151ce85a61.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_58eba0a1e41467c84a152b151ce85a61.png"></p><h3 id="什么是存储池"><a href="#什么是存储池" class="headerlink" title="什么是存储池"></a>什么是存储池</h3><p>存储池即为TrueNAS用于存放数据的地方，可以将多块硬盘组成不同的模式，用于实现数据存储的冗余和更快的读写行能</p><h3 id="关于raid"><a href="#关于raid" class="headerlink" title="关于raid:"></a>关于raid:</h3><p>与磁盘阵列卡的原理类似</p><ol><li><strong>条带模式</strong><br>每个磁盘用于存储数据。至少需要一个磁盘并且没有数据冗余。切勿使用条带模式存储关键数据！单个磁盘故障会导致 vdev 中的所有数据丢失。此模式下磁盘行能最佳，数据最不安全</li><li><strong>镜像</strong><br>每个磁盘中的数据都是相同的。至少需要两个磁盘，冗余最多，容量最少。</li><li><strong>Raid-z</strong><br>使用一个磁盘进行奇偶校验，而所有其他磁盘存储数据。至少需要三个磁盘。最多允许损坏1块硬盘数据仍能安全存储。</li><li><strong>Raid-z2</strong><br>使用两个磁盘进行奇偶校验，而所有其他磁盘都存储数据。至少需要四个磁盘。最多允许损坏2块硬盘数据仍能安全存储。</li><li><strong>Raid-z3</strong><br>使用三个磁盘进行奇偶校验，而所有其他磁盘都存储数据。至少需要五个磁盘。最多允许损坏3块硬盘数据仍能安全存储。</li></ol><h3 id="关于VDev类型"><a href="#关于VDev类型" class="headerlink" title="关于VDev类型"></a>关于VDev类型</h3><p>每个系统必须建立一个数据存储池，其余存储池可在数据存储池建立完成后添加或删除。</p><p><strong>1）数据</strong><br>用于主存储操作的标准 vdev。每个存储池至少需要一个数据vdev。</p><p><strong>2）缓存</strong><br>读取缓存与快速设备一起使用以加速读取操作。<br>TrueNAS存储顺序为内存-&gt;缓存存储池-&gt;数据存储池。<br>故使用大内存和大数据存储池可以有效提高数据存储行能</p><h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a><strong>日志</strong></h3><p>提高同步写入速度的设备</p><p><strong>4）热备份</strong><br>为在活动驱动器发生故障时插入数据vdev保留的驱动器。热备件临时用作故障驱动器的替代品，以防止出现更大的池和数据丢失情况。</p><p>当故障驱动器更换为新驱动器时，热备件将恢复为非活动状态并再次用作热备件。</p><p>当故障驱动器仅从池中分离时，临时热备用将提升为完整的数据vdev 成员，并且不再可用作热备用。</p><p><strong>5）元数据</strong><br>一个特殊的 vdev 可以存储元数据，例如文件位置和分配表。特殊类中的分配专用于特定的块类型。默认情况下，这包括所有元数据、用户数据的间接块和任何重复数据删除表。该类也可以配置为接受小文件块。对于高性能但较小尺寸的固态存储来说，这是一个很好的用例。使用特殊的 vdev 极大地加速了随机 I/O，并将查找和访问文件所需的平均旋转磁盘 I/O 减少了一半。</p><p><strong>6）去重</strong><br>池可以包含共存的重复数据删除数据和非重复数据删除数据的任意组合。如果在写入时启用了重复数据删除，则使用 DDT 写入数据，如果在写入时未启用重复数据删除，则以非重复数据的方式写入数据。随后，数据将保持写入时的状态，直到被删除。简而言之就是将存储数据切割对比相同的部分会仅存储一份，但是这样会大量消耗CPU资源。</p><h3 id="五、关于加密"><a href="#五、关于加密" class="headerlink" title="五、关于加密"></a>五、关于加密</h3><p>加密算法可作为最大化数据安全性的选项。这也使检索数据的方式变得复杂，并有永久数据丢失的风险！</p><p>加密数据缺点/注意事项：</p><p>丢失加密密钥和密码意味着丢失您的数据。<br>不相关的加密数据集不支持重复数据删除。<br>我们不建议将 GELI 或 ZFS 加密与重复数据删除一起使用，因为这会对性能产生相当大的影响。<br>同时使用多个加密和重复数据删除功能时要小心，因为它们都将竞争相同的 CPU 周期。</p><p>本文参考：</p><p><a href="https://blog.csdn.net/qq_42910468/article/details/122585133">https://blog.csdn.net/qq_42910468/article/details/122585133</a></p><p><a href="https://blog.tonnp.com/2022/truenas-data-protection-manager.html">https://blog.tonnp.com/2022/truenas-data-protection-manager.html</a></p>]]></content>
      
      
      <categories>
          
          <category> nas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Minio单机版部署</title>
      <link href="/2024/07/04/Minio%E5%8D%95%E6%9C%BA%E7%89%88%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/07/04/Minio%E5%8D%95%E6%9C%BA%E7%89%88%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Minio单机版部署"><a href="#Minio单机版部署" class="headerlink" title="Minio单机版部署"></a>Minio单机版部署</h1><p>集群版部署参考：<a href="https://wn.zznnwn.cloudns.biz/2023/09/19/minio%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8docker-compose%E9%83%A8%E7%BD%B2/?highlight=minio">gegewu_cloud</a></p><p>镜像可选</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">minio/minio</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:minio-latest</span><br></pre></td></tr></table></figure><h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p><code>MinIO</code> 是一个开源的<strong>对象存储服务器</strong>，它兼容<code>Amazon S3（Simple Storage Service）API</code>。它被设计用于构建分布式存储架构，提供高可用性、高性能和可扩展的对象存储解决方案。</p><p>下面是MinIO的一些主要特点和功能：</p><ul><li><strong>对象存储</strong>：MinIO以对象为基本存储单元，可以存储和管理任意大小的文件、数据对象。它提供了标准的对象存储操作，如上传、下载、删除和元数据管理。</li><li><strong>分布式架构</strong>：MinIO采用分布式架构，可以在多个节点上部署，并将数据分布和复制在不同的节点上。这提供了高可用性和数据冗余，确保数据的持久性和可靠性。</li><li><strong>高性能</strong>：MinIO通过并行处理和分布式架构实现高性能的数据存取。它利用现代硬件和网络技术，充分利用多核处理器和高带宽网络，以实现快速的数据传输和处理。</li><li><strong>水平扩展</strong>：MinIO可以水平扩展，通过添加更多的节点来增加存储容量和吞吐量。它支持自动数据分片和负载均衡，确保数据在各个节点上均匀分布和访问的负载均衡。</li><li><strong>数据保护</strong>：MinIO提供了多种数据保护机制，包括数据冗余、故障转移和数据校验。它可以在不同的节点之间复制数据，以应对节点故障和数据损坏的情况。</li><li><strong>安全性</strong>：MinIO支持数据加密和访问控制，保护存储在其中的数据的安全性和隐私性。它提供了传输层加密（TLS/SSL）和服务器端加密选项，以及身份验证和访问控制机制。</li></ul><p>总的来说，MinIO是一个开源的高性能对象存储服务器，适用于构建分布式存储系统。它具有高可用性、可扩展性和数据保护机制，兼容Amazon S3 API，使其与现有的S3生态系统和工具集成无缝。MinIO在大数据、云计算和容器化环境中广泛应用，为应用程序提供了可靠、高效的对象存储服务。</p><p>这里主要侧重使用docker快速部署环境，想了解更多，可以参考我以下几篇文章：</p><ul><li><a href="https://www.cnblogs.com/liugp/p/16558869.html">高性能分布式对象存储——MinIO（环境部署）</a></li><li><a href="https://www.cnblogs.com/liugp/p/16560313.html">高性能分布式对象存储——MinIO实战操作（MinIO扩容）</a></li><li><a href="https://www.cnblogs.com/liugp/p/16884294.html">【云原生】Minio on k8s 讲解与实战操作</a></li><li><a href="https://www.cnblogs.com/liugp/p/16632616.html">【云原生.大数据】镜像仓库Harbor对接MinIO对象存储</a></li></ul><p>官方文档：<a href="https://docs.min.io/">https://docs.min.io/</a><br>中文文档：<a href="http://docs.minio.org.cn/docs/">http://docs.minio.org.cn/docs/</a></p><h2 id="二、MinIO-与-Ceph-对比"><a href="#二、MinIO-与-Ceph-对比" class="headerlink" title="二、MinIO 与 Ceph 对比"></a>二、MinIO 与 Ceph 对比</h2><p>MinIO和Ceph都是流行的开源存储解决方案，它们在对象存储领域有不同的特点和适用场景。下面是MinIO和Ceph的对比：</p><h3 id="1）架构设计对比"><a href="#1）架构设计对比" class="headerlink" title="1）架构设计对比"></a>1）架构设计对比</h3><ul><li>**<code>MinIO</code>**：<code>MinIO</code>采用分布式架构，以水平扩展为基础。它通过多个独立的MinIO节点组成集群，每个节点都是独立的对象存储服务器。MinIO专注于提供简单、轻量级的对象存储服务，适用于小型到中等规模的部署。</li><li>**<code>Ceph</code>**：<code>Ceph</code>是一个分布式存储系统，由对象存储、块存储和文件系统组成。它使用<code>RADOS（Reliable Autonomic Distributed Object Store）</code>作为底层存储系统，提供高可用性和数据冗余。Ceph适用于大规模的企业级部署，具有复杂的架构和丰富的功能。</li></ul><h3 id="2）数据一致性对比"><a href="#2）数据一致性对比" class="headerlink" title="2）数据一致性对比"></a>2）数据一致性对比</h3><ul><li><code>MinIO</code>：<code>MinIO</code>在默认配置下提供最终一致性，即写入操作返回成功后，数据可能会有一定的时间窗口内的延迟才能完全一致。这适用于许多应用场景，如数据备份、存档等。</li><li><code>Ceph</code>：<code>Ceph</code>提供强一致性，即写入操作在返回成功后，数据即刻就达到一致性。这对于需要强一致性保证的应用场景非常重要，如数据库和事务处理。</li></ul><h3 id="3）部署和管理对比"><a href="#3）部署和管理对比" class="headerlink" title="3）部署和管理对比"></a>3）部署和管理对比</h3><ul><li><code>MinIO</code>：<code>MinIO</code> 的部署和管理相对简单，可以通过单个二进制文件或容器进行快速安装和配置。它提供了直观的管理界面和易于使用的API，使得管理和监控变得简单。</li><li><code>Ceph</code>：<code>Ceph</code> 的部署和管理相对复杂，涉及多个组件和配置。它需要更多的时间和专业知识来设置和维护，需要熟悉Ceph的架构和配置。</li></ul><h3 id="4）生态系统和兼容性对比"><a href="#4）生态系统和兼容性对比" class="headerlink" title="4）生态系统和兼容性对比"></a>4）生态系统和兼容性对比</h3><ul><li><code>MinIO</code>：MinIO与Amazon S3 API兼容，这意味着现有的S3工具和应用程序可以无缝地与MinIO集成。它还有一个活跃的社区，提供了各种客户端库和插件，扩展了其功能和兼容性。</li><li><code>Ceph</code>：<code>Ceph</code> 具有广泛的生态系统和丰富的功能集。它可以与多个协议和接口（如RADOS、RBD、CephFS）进行集成，提供块存储、文件系统和对象存储的全面解决方案。</li></ul><p>综上所述，<strong>MinIO适用于简单、轻量级的对象存储需求</strong>，注重高性能和易用性。它适合中小规模部署，并且与Amazon S3兼容，易于与现有的S3生态系统集成。</p><ul><li><strong><code>Ceph</code>则适用于大规模、复杂的企业级存储需求</strong>。它提供强一致性和丰富的功能集，适合需要高可用性、数据冗余和复杂数据操作的场景。Ceph的部署和管理相对复杂，需要更多的配置和管理工作。</li><li>选择<code>MinIO</code>还是Ceph取决于具体的需求和场景。如果你需要一个简单、易用、高性能的对象存储解决方案，并与S3兼容，那么MinIO是一个不错的选择。如果你需要一个功能强大、可扩展、支持块存储和文件系统的分布式存储系统，且具备强一致性的要求，那么Ceph是更适合的选择。</li></ul><p>无论选择MinIO还是Ceph，都需要仔细评估其与特定应用和环境的兼容性、性能需求、管理复杂性和可扩展性，以确保选择的解决方案能够满足实际需求并提供可靠的存储服务</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_b2fb09978ee530f5ab2104827399da13.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_b2fb09978ee530f5ab2104827399da13.png"></p><p>docker-compose部署</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">minio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:minio-latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">&quot;minio&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span><span class="string">:9000</span> <span class="comment"># api 端口</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9001</span><span class="string">:9001</span> <span class="comment"># 控制台端口</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MINIO_ACCESS_KEY:</span> <span class="string">admin</span>    <span class="comment">#管理后台用户名</span></span><br><span class="line">      <span class="attr">MINIO_SECRET_KEY:</span> <span class="string">admin123</span> <span class="comment">#管理后台密码，最小8个字符</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./minio/data:/data</span>               <span class="comment">#映射当前目录下的data目录至容器内/data目录</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./minio/config:/root/.minio/</span>     <span class="comment">#映射配置目录</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">server</span> <span class="string">--console-address</span> <span class="string">&#x27;:9001&#x27;</span> <span class="string">/data</span>  <span class="comment">#指定容器中的目录 /data</span></span><br></pre></td></tr></table></figure><p>备注：单机版没有数据冗余 数据只存放于挂载的唯一卷./minio/data中  文章首页教程 里面均为至少两磁盘冗余</p><p>本文参考：<a href="https://www.cnblogs.com/liugp/p/17504098.html">【大数据】通过 docker-compose 快速部署 MinIO 保姆级教程 - 大数据老司机 - 博客园 (cnblogs.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PVE虚拟机直通英伟达GPU显卡完全指南</title>
      <link href="/2024/07/02/PVE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9B%B4%E9%80%9A%E8%8B%B1%E4%BC%9F%E8%BE%BEGPU%E6%98%BE%E5%8D%A1%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2024/07/02/PVE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9B%B4%E9%80%9A%E8%8B%B1%E4%BC%9F%E8%BE%BEGPU%E6%98%BE%E5%8D%A1%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="PVE虚拟机直通英伟达GPU显卡完全指南"><a href="#PVE虚拟机直通英伟达GPU显卡完全指南" class="headerlink" title="PVE虚拟机直通英伟达GPU显卡完全指南"></a>PVE虚拟机直通英伟达GPU显卡完全指南</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><a href="http://sunlight.zznnwn.cloudns.biz/2024/07/01/Pve%E9%83%A8%E7%BD%B2%E6%8A%A5%E9%94%99Cannot%20run%20in%20framebuffer%20mode.%20Please%20specify%20busIos%20%E8%A7%A3%E5%86%B3/">部署pve报错解决</a></p><p>本教程在pve宿主机执行</p><h2 id="一-前提条件"><a href="#一-前提条件" class="headerlink" title="一. 前提条件"></a>一. 前提条件</h2><p>Bios开启VT-d HD-t</p><p><strong>1、确认CPU是否支持<code>VT-D</code></strong></p><ul><li><strong>Inter官网查询：</strong> <a href="https://www.intel.cn/">https://www.intel.cn</a></li><li><strong>AMD官方网站：</strong> <a href="https://www.amd.com/zh-hans">https://www.amd.com/zh-hans</a></li><li><ul><li><strong>例：</strong> <em><a href="https://ark.intel.com/content/www/cn/zh/ark/products/97122/intel-core-i77700t-processor-8m-cache-up-to-3-80-ghz.html#tab-blade-1-0-7">i7-7700 查询结果</a></em></li></ul></li></ul><p><strong>2、确保启动方式为<code>gurb</code>，非<code>systemd-boot</code></strong><br>如果启动方式为<code>systemd-boot</code>，在<strong>0x02</strong>步骤中需要参考 <a href="https://pve.proxmox.com/pve-docs/pve-admin-guide.html#sysboot_edit_kernel_cmdline">[3] Proxmox VE Administration Guide</a> 开启iommu功能 或参考本文末尾下方<a href="https://blog.dako.dev/proxmox-7-4-gpu-passthrough--e6-98-be-e5-8d-a1-e7-9b-b4-e9-80-9a/">第二链接</a> 即 <code>proxmox-boot-tool refresh</code></p><h2 id="二-开启IOMMU功能"><a href="#二-开启IOMMU功能" class="headerlink" title="二. 开启IOMMU功能"></a>二. 开启IOMMU功能</h2><p>编辑文件/etc/default/grub，修改<code>GRUB_CMDLINE_LINUX_DEFAULT</code>字段值</p><p>如果为Intel的CPU</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;quiet intel_iommu=on&quot;</span></span><br></pre></td></tr></table></figure><p>如果为AMD的CPU</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;quiet amd_iommu=on&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_3170d8505684902d0828f4adc8f464bb.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_3170d8505684902d0828f4adc8f464bb.png"></p><h2 id="三-添加VT-D功能的内核模块"><a href="#三-添加VT-D功能的内核模块" class="headerlink" title="三. 添加VT-D功能的内核模块"></a>三. 添加<code>VT-D</code>功能的内核模块</h2><p>打开文件<code>/etc/modules</code>，新增以下4行内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vfio</span><br><span class="line">vfio_iommu_type1</span><br><span class="line">vfio_pci</span><br><span class="line">vfio_virqfd</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_922e9e8bc8602c37be9a95b4b4cfbac7.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_922e9e8bc8602c37be9a95b4b4cfbac7.png"></p><h2 id="四-屏蔽宿主机显卡驱动"><a href="#四-屏蔽宿主机显卡驱动" class="headerlink" title="四. 屏蔽宿主机显卡驱动"></a>四. 屏蔽宿主机显卡驱动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 屏蔽镭龙显卡驱动</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;blacklist radeon&quot;</span> &gt;&gt; /etc/modprobe.d/pve-blacklist.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 屏蔽英伟达显卡的开源nouveau驱动</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;blacklist nouveau&quot;</span> &gt;&gt; /etc/modprobe.d/pve-blacklist.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 屏蔽英伟达显卡驱动</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;blacklist nvidia&quot;</span> &gt;&gt; /etc/modprobe.d/pve-blacklist.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_eaab6c3d231a8dae5e02514fd79eea14.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_eaab6c3d231a8dae5e02514fd79eea14.png"></p><h2 id="五-其它参数"><a href="#五-其它参数" class="headerlink" title="五. 其它参数"></a>五. 其它参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许不安全的中断</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options vfio_iommu_type1 allow_unsafe_interrupts=1&quot;</span> &gt; /etc/modprobe.d/iommu_unsafe_interrupts.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略异常，防止虚拟机异常导致宿主机崩溃</span></span><br><span class="line"><span class="comment">#   ignore_msrs             :   忽略异常</span></span><br><span class="line"><span class="comment">#   report_ignored_msrs     :   是否报告异常</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options kvm ignore_msrs=1 report_ignored_msrs=0&quot;</span> &gt; /etc/modprobe.d/kvm.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_8e63746854064a712ab3519c84a8afae.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_8e63746854064a712ab3519c84a8afae.png"></p><h2 id="六-配置VFIO"><a href="#六-配置VFIO" class="headerlink" title="六. 配置VFIO"></a>六. 配置VFIO</h2><p><em>ps：执行此操作后可能无法输出到外接显示器，若出现此情况，请撤回该步骤</em></p><p><strong>1、查看显卡ID</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~<span class="comment"># lspci -nn | grep VGA</span></span><br><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2685] (rev a1)</span><br></pre></td></tr></table></figure><p>N卡编号为01:00，搜索对应的设备ID和音频设备ID</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~<span class="comment"># lspci -n -s 01:00</span></span><br><span class="line">01:00.0 0300: 10de:2685 (rev a1)</span><br><span class="line">01:00.1 0403: 10de:22ba (rev a1)</span><br></pre></td></tr></table></figure><p><strong>或者直接以<code>NVIDIA</code>为关键词搜索相关的设备，其中一个是音频</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~<span class="comment"># lspci -nn | grep NVIDIA</span></span><br><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2685] (rev a1)</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation AD102 High Definition Audio Controller [10de:22ba] (rev a1)</span><br></pre></td></tr></table></figure><p><strong>得到显卡的设备ID和显卡内置音频设备ID为：</strong></p><ul><li><code>显卡ID</code>： <em>10de:2685</em></li><li><code>音频ID</code>： <em>10de:22ba</em></li></ul><p><strong>2、将设备ID添加到<code>vfio.conf</code></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options vfio-pci ids=10de:2685,10de:22ba disable_vga=1&quot;</span> &gt; /etc/modprobe.d/vfio.conf</span><br><span class="line"><span class="comment"># 如果无法输出到外接显示器，取消disable_vga=1参数试试</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options vfio-pci ids=10de:2685,10de:22ba&quot;</span> &gt; /etc/modprobe.d/vfio.conf</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_d97846f7bd4dc84cc26efca3ae8b9d1a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_d97846f7bd4dc84cc26efca3ae8b9d1a.png"></p><h2 id="七-应用更改"><a href="#七-应用更改" class="headerlink" title="七. 应用更改"></a>七. 应用更改</h2><ul><li><p><strong>1、刷新更改</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update-grub</span><br><span class="line">update-initramfs -u -k all</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_088397be69bb3731e3594f4f49245bd7.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_088397be69bb3731e3594f4f49245bd7.png"></p></li><li><p><strong>2、重启PVE</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure></li><li><p><strong>3、检查是否配置成功</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~<span class="comment"># lspci -nnk</span></span><br><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2685] (rev a1)</span><br><span class="line">        Subsystem: Shenzhen Colorful Yugong Technology and Development Co. Device [7377:1400]</span><br><span class="line">        Kernel driver <span class="keyword">in</span> use: vfio-pci</span><br><span class="line">        Kernel modules: nvidiafb, nouveau</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation AD102 High Definition Audio Controller [10de:22ba] (rev a1)</span><br><span class="line">        Subsystem: Shenzhen Colorful Yugong Technology and Development Co. AD102 High Definition Audio Controller [7377:1400]</span><br><span class="line">        Kernel driver <span class="keyword">in</span> use: vfio-pci</span><br><span class="line">        Kernel modules: snd_hda_intel</span><br></pre></td></tr></table></figure></li></ul><p>如果看到<code>Kernel driver in use: vfio-pci</code>，表示应用成功</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_2867de7d79e4bcc5b8934e10af67e9bb.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_2867de7d79e4bcc5b8934e10af67e9bb.png"></p><p>添加显卡到虚拟机中<br>完成上述步骤配置后，在PVE-web图形化端添加PCI-E设备到虚拟机中即可</p><p>创建虚拟机时需要选择：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_4d88c6e4aaae1b291fb1a0054b3e7011.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_4d88c6e4aaae1b291fb1a0054b3e7011.png"></p><p>ps:<br>1、我同时添加显卡和音频之后，开机遇报错：TASK ERROR: start failed: QEMU exited with code 1，如果遇到同样的报错，尝试把音频设备从硬件中移除</p><h2 id="八-扩展"><a href="#八-扩展" class="headerlink" title="八. 扩展"></a>八. 扩展</h2><p>虚拟机直通显卡后安装显卡驱动 使用下方脚本安装</p><p><a href="https://onenote.zznnwn.cloudns.biz/api/raw/?path=/%E8%84%9A%E6%9C%AC/ubuntu%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2NVIDIA%E9%A9%B1%E5%8A%A8/nvidia-gpu.sh">安装脚本 &gt; nvidia-gpu.sh</a></p><h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a href="https://blog.csdn.net/byb123/article/details/124549876">https://blog.csdn.net/byb123/article/details/124549876</a>   （主要参考）</p><p><a href="https://blog.dako.dev/proxmox-7-4-gpu-passthrough--e6-98-be-e5-8d-a1-e7-9b-b4-e9-80-9a/">https://blog.dako.dev/proxmox-7-4-gpu-passthrough--e6-98-be-e5-8d-a1-e7-9b-b4-e9-80-9a/</a></p>]]></content>
      
      
      <categories>
          
          <category> pve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pve </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pve部署报错Cannot run in framebuffer mode. Please specify busIos 解决</title>
      <link href="/2024/07/01/Pve%E9%83%A8%E7%BD%B2%E6%8A%A5%E9%94%99Cannot%20run%20in%20framebuffer%20mode.%20Please%20specify%20busIos%20%E8%A7%A3%E5%86%B3/"/>
      <url>/2024/07/01/Pve%E9%83%A8%E7%BD%B2%E6%8A%A5%E9%94%99Cannot%20run%20in%20framebuffer%20mode.%20Please%20specify%20busIos%20%E8%A7%A3%E5%86%B3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Pve部署报错Cannot-run-in-framebuffer-mode-Please-specify-busIos-解决"><a href="#Pve部署报错Cannot-run-in-framebuffer-mode-Please-specify-busIos-解决" class="headerlink" title="Pve部署报错Cannot run in framebuffer mode. Please specify busIos 解决"></a>Pve部署报错Cannot run in framebuffer mode. Please specify busIos 解决</h1><h2 id="一-现象（错误分析）"><a href="#一-现象（错误分析）" class="headerlink" title="一. 现象（错误分析）"></a>一. 现象（错误分析）</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_451e4c0eb25db4eb9d6f522ab61064ec.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_451e4c0eb25db4eb9d6f522ab61064ec.png"></p><p>按照提示输入CTRL+ALT+F2查看具体报错</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_ac23c01d0edb14915d6e0b7fe8506aa2.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_ac23c01d0edb14915d6e0b7fe8506aa2.png"></p><p>重启系统再次出现第一张图中报错时等待一段时间会自动进入命令行 进入命令行后查看日志。</p><p>问题：根据本文第一张图日志文件查看错误日志 <strong>cat /var/log/Xorg.0.log |grep EE</strong> 观察到设备 <strong>/dev/dri/card0</strong> 找不到且nv模块加载失败</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_d95c83302584efe1926a318c57dfa7f0.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_d95c83302584efe1926a318c57dfa7f0.png"></p><h2 id="二-解决"><a href="#二-解决" class="headerlink" title="二. 解决"></a>二. 解决</h2><p>编辑此文件：nano /usr/share/X11/xorg.conf.d/10-quirks.conf</p><p>文件顶部第二行新增如下内容(CTRL + X 输入 Y保存)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Section <span class="string">&quot;Device&quot;</span></span><br><span class="line">  Identifier <span class="string">&quot;Card0&quot;</span></span><br><span class="line">  Driver <span class="string">&quot;fbdev&quot;</span></span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_1b0a47b246d7f93aae3411d8be3a4f44.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_1b0a47b246d7f93aae3411d8be3a4f44.png"></p><p>接下来，默认会返回到命令界面， 输入【xinit – -dpi 96 &gt;/dev/tty2 2&gt;&amp;1】回车,即可进入安装界面</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_86db8ea42fe6d4ed0bc30c18947d3ea3.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_86db8ea42fe6d4ed0bc30c18947d3ea3.png"></p><p>本文参考：</p><p><a href="https://blog.csdn.net/linzhiji/article/details/117754330">https://blog.csdn.net/linzhiji/article/details/117754330</a><br><a href="https://blog.csdn.net/u012514495/article/details/129987207">https://blog.csdn.net/u012514495/article/details/129987207</a> （主要参考）</p>]]></content>
      
      
      <categories>
          
          <category> pve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pve </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>proxmox教程</title>
      <link href="/2024/06/22/proxmox%E6%95%99%E7%A8%8B/"/>
      <url>/2024/06/22/proxmox%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="proxmox教程"><a href="#proxmox教程" class="headerlink" title="proxmox教程"></a>proxmox教程</h1><p>iso镜像下载地址：</p><p><a href="https://pve.proxmox.com/wiki/Downloads">https://pve.proxmox.com/wiki/Downloads</a></p><p><a href="https://enterprise.proxmox.com/iso/">https://enterprise.proxmox.com/iso/</a></p><p>本教材使用镜像：proxmox-ve_8.1-2.iso</p><h2 id="一-proxmox的安装及配置"><a href="#一-proxmox的安装及配置" class="headerlink" title="一. proxmox的安装及配置"></a>一. proxmox的安装及配置</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_2f095d78b69671be4283fa3df4138a68.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_2f095d78b69671be4283fa3df4138a68.png"></p><p>1.硬件直通</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_926f9dc034ba9e58f4d865c5d48e2dd6.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_926f9dc034ba9e58f4d865c5d48e2dd6.png"></p><p>2.最终效果</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_e695c7631fab1a105f95568f6c4d2628.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_e695c7631fab1a105f95568f6c4d2628.png"></p><h2 id="二-pve节点加入集群"><a href="#二-pve节点加入集群" class="headerlink" title="二. pve节点加入集群"></a>二. pve节点加入集群</h2><p>需要两个pve节点主机名称不一样 如果主机名称一样会冲突导致无法加入节点 出现类似如下报错</p><p>修改pve节点名称参考：<a href="https://www.qkeke.com/archives/2136.html">https://www.qkeke.com/archives/2136.html</a></p><h3 id="1-修改节点名称"><a href="#1-修改节点名称" class="headerlink" title="1.修改节点名称"></a>1.修改节点名称</h3><p>在创建集群后，其他同名节点始终无法加入集群，于是需要修改节点主机名，步骤如下：</p><p>1、修改如下2个文件中的主机名为新的主机名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hostname</span><br><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure><p>2、如果我们已经创建虚拟机，需要修改nodes中节点配置文件名（新服务器忽略此步）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/pve/nodes/OldHostName     /etc/pve/nodes/NewHostName</span><br></pre></td></tr></table></figure><p>3、重启服务器</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_688957670a3886de26c6dc137530bf6e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_688957670a3886de26c6dc137530bf6e.png"></p><h2 id="三-pve重置密码"><a href="#三-pve重置密码" class="headerlink" title="三. pve重置密码"></a>三. pve重置密码</h2><p><a href="http://t.csdnimg.cn/prU1W">http://t.csdnimg.cn/prU1W</a>  （本文参考）<br><a href="https://pve.proxmox.com/wiki/Root_Password_Reset#Method_1">https://pve.proxmox.com/wiki/Root_Password_Reset#Method_1</a></p><p>初始图</p><p>到此页面时按e进入grub模式</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_b2331cc4270249582ef47242c1d19634.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_b2331cc4270249582ef47242c1d19634.png"></p><p>找到此行添加此配置</p><p>将光标移动到该行的末尾，紧随其后‘ro quiet’并附加参数init=/bin/bash。</p><p>下次点击ctrl + x以使其能够以装有只读(ro)访问权限的根文件系统在单用户模式下启动。</p><p>为您重置密码，您需要更改从访问权限只读到读写。因此，运行以下命令以重新安装具有rw属性的根文件系统。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_08023f86d72ff75b8173d99bbedeeee4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_08023f86d72ff75b8173d99bbedeeee4.png"></p><p>挂载Debian文件系统 及修改密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -n -o remount，rw /</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_824a050b4122d5f75b3d666d2e695bfc.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_824a050b4122d5f75b3d666d2e695bfc.png"></p><p>在Debian中重设根密码</p><p>提供新密码并重新输入以确认。如果一切顺利并且密码匹配，您将在控制台末尾收到“ 密码更新成功 ”通知</p><p>最后按Ctrl + Alt + Del退出并重新启动。现在，您可以使用刚刚定义的新创建的密码以root用户身份登录。</p><p>这就是您在Debian 10上重置忘记的root密码的方式。</p><h2 id="四-添加数据盘为存储"><a href="#四-添加数据盘为存储" class="headerlink" title="四. 添加数据盘为存储"></a>四. 添加数据盘为存储</h2><p>pve不像exsi那样自动添加好的 需要自己手动挂载到某个目录 添加此目录为本地存储</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_d23a49628b2f8a794ab27c1d9e2d209a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_d23a49628b2f8a794ab27c1d9e2d209a.png"></p><h2 id="五-修改pve-ip地址"><a href="#五-修改pve-ip地址" class="headerlink" title="五. 修改pve  ip地址"></a>五. 修改pve  ip地址</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改pve ip地址 </span></span><br><span class="line">vi /etc/network/interfaces</span><br><span class="line"><span class="comment"># 修改pve web页面登录地址</span></span><br><span class="line">vi /etc/issue</span><br><span class="line"><span class="comment"># 修改本地dns</span></span><br><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure><p>重启网络：systemctl restart networking</p><h2 id="创建windows虚拟机"><a href="#创建windows虚拟机" class="headerlink" title="创建windows虚拟机"></a>创建windows虚拟机</h2><p>• 常规：按需填写<br>• 操作系统<br>○ ISO 镜像：选择上传的镜像<br>○ 类别：Microsoft Windows<br>○ 版本：11/2022<br>• 系统：<br>○ TPM 存储：local-lvm<br>○ EFI 存储：local-lvm<br>○ 其他默认即可<br>• 磁盘<br>○ 总线 / 设备：SCSI<br>○ 磁盘大小：按需选择<br>○ 其他默认即可<br>• CPU：按需选择<br>• 内存：按需选择<br>网络：默认即可</p><p><strong>备注</strong>：安装时 启动过程中会报错 此时 按Esc进入bios设置启动项即可正常进入windows安装界面</p><p><strong>安装完成之后在挂载的virtio-win-0.1.229.iso镜像中 找到virtio-win-agent-x64.exe安装即可出现网络等</strong></p><p><strong>虚拟机添加声音</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_249974881cbc1cff13510daa7b6605a3.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_249974881cbc1cff13510daa7b6605a3.png"></p><h2 id="六-GPU直通"><a href="#六-GPU直通" class="headerlink" title="六. GPU直通"></a>六. GPU直通</h2><p><a href="http://sunlight.zznnwn.cloudns.biz/2024/07/02/PVE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9B%B4%E9%80%9A%E8%8B%B1%E4%BC%9F%E8%BE%BEGPU%E6%98%BE%E5%8D%A1%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/?highlight=gpu">http://sunlight.zznnwn.cloudns.biz/2024/07/02/PVE虚拟机直通英伟达GPU显卡完全指南/?highlight=gpu</a></p><p>本文参考链接等：</p><p><a href="https://v2rayssr.com/pve.html">https://v2rayssr.com/pve.html</a><br><a href="https://www.jianshu.com/p/d22a21c5ae81">https://www.jianshu.com/p/d22a21c5ae81</a><br><a href="https://blog.csdn.net/c13257595138/article/details/90385433">https://blog.csdn.net/c13257595138/article/details/90385433</a></p><p>管理多个集群<br><a href="https://pve-doc-cn.readthedocs.io/zh-cn/latest/">https://pve-doc-cn.readthedocs.io/zh-cn/latest/</a></p><p>显卡直通<br><a href="https://blog.csdn.net/yyhyoung/article/details/130708894">https://blog.csdn.net/yyhyoung/article/details/130708894</a><br><a href="https://blog.rayfalling.com/2023/01/pve-7-3-%E4%BC%98%E5%8C%96%E5%92%8C%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A.html">https://blog.rayfalling.com/2023/01/pve-7-3-优化和显卡直通.html</a></p><p>通过工具实现显卡直通<br><a href="https://github.com/ivanhao/pvetools/wiki/i-%E7%A1%AC%E4%BB%B6%E7%9B%B4%E9%80%9A%E5%8F%8A%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A%E9%85%8D%E7%BD%AE">https://github.com/ivanhao/pvetools/wiki/i-硬件直通及显卡直通配置</a></p>]]></content>
      
      
      <categories>
          
          <category> pve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pve </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关闭ubuntu  unattended-upgrades自动更新服务</title>
      <link href="/2024/06/15/%E5%85%B3%E9%97%ADubuntu%20%20unattended-upgrades%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E6%9C%8D%E5%8A%A1/"/>
      <url>/2024/06/15/%E5%85%B3%E9%97%ADubuntu%20%20unattended-upgrades%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="关闭ubuntu-unattended-upgrades自动更新服务"><a href="#关闭ubuntu-unattended-upgrades自动更新服务" class="headerlink" title="关闭ubuntu  unattended-upgrades自动更新服务"></a>关闭ubuntu  unattended-upgrades自动更新服务</h1><blockquote><p><code>unattended-upgrades</code>是一个自动升级服务，用于自动更新系统中的软件包和安全补丁。当系统配置了<code>unattended-upgrades</code>服务后，它会定期检查软件包管理器（如APT）的更新源，然后自动下载和安装可用的软件包更新。</p><p>这个服务的主要目的是确保系统中的软件包保持最新状态，包括安全更新和 bug 修复。通过自动化这个过程，可以减少管理员手动干预的需求，并提高系统的安全性和稳定性。</p><p>通常情况下，<code>unattended-upgrades</code>服务会在后台运行，并根据配置文件中的规则自动执行更新操作。它可以定期检查更新源，下载软件包更新，并在系统空闲时安装这些更新，以确保系统保持最新状态。</p><p>如果你遇到了无法执行<code>apt</code>命令的问题，可能是由于<code>unattended-upgrades</code>服务正在运行并占用了相关的锁定文件，导致其他<code>apt</code>进程无法操作。在这种情况下，你可以选择等待自动升级服务完成或者终止相关进程，然后再执行你需要的操作。</p></blockquote><p>要暂时关闭<code>unattended-upgrades</code>服务，你可以按照以下步骤操作：</p><ol><li><p><strong>停止<code>unattended-upgrades</code>服务</strong>：<br>运行以下命令停止<code>unattended-upgrades</code>服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop unattended-upgrades</span><br></pre></td></tr></table></figure></li><li><p><strong>禁用<code>unattended-upgrades</code>服务</strong>（可选）：<br>如果你想在系统重新启动后仍然保持<code>unattended-upgrades</code>服务关闭状态，可以禁用该服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">disable</span> unattended-upgrades</span><br></pre></td></tr></table></figure></li><li><p><strong>确认服务状态</strong>：<br>确保服务已经停止，可以运行以下命令检查服务状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status unattended-upgrades</span><br></pre></td></tr></table></figure></li></ol><p>这样，<code>unattended-upgrades</code>服务就会被暂时关闭。如果你想重新启用该服务，可以运行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start unattended-upgrades</span><br></pre></td></tr></table></figure><p>关闭后下方问题解决</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_aaf97a6eb50633cfdab0e71cfd1c69a0.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_aaf97a6eb50633cfdab0e71cfd1c69a0.png"></p><p>请注意，关闭自动升级服务可能会导致系统中的软件包和安全补丁不及时更新，这可能会影响系统的安全性。因此，在关闭服务之前，请确保了解风险并在合适的时机重新启用服务。</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu22.04LTS安装NVIDIA官方4090D驱动CUDA CUDNN Anaconda Pytorch2 等</title>
      <link href="/2024/06/13/ubuntu22.04LTS%E5%AE%89%E8%A3%85NVIDIA%E5%AE%98%E6%96%B94090D%E9%A9%B1%E5%8A%A8CUDA%20CUDNN%20Anaconda%20%20Pytorch2%20%E7%AD%89/"/>
      <url>/2024/06/13/ubuntu22.04LTS%E5%AE%89%E8%A3%85NVIDIA%E5%AE%98%E6%96%B94090D%E9%A9%B1%E5%8A%A8CUDA%20CUDNN%20Anaconda%20%20Pytorch2%20%E7%AD%89/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ubuntu22-04LTS安装NVIDIA官方4090D驱动CUDA-CUDNN-Anaconda-Pytorch2等"><a href="#ubuntu22-04LTS安装NVIDIA官方4090D驱动CUDA-CUDNN-Anaconda-Pytorch2等" class="headerlink" title="ubuntu22.04LTS安装NVIDIA官方4090D驱动CUDA CUDNN Anaconda Pytorch2等"></a>ubuntu22.04LTS安装NVIDIA官方4090D驱动CUDA CUDNN Anaconda Pytorch2等</h1><h3 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1. 安装依赖"></a>1. 安装依赖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update   <span class="comment">#更新软件列表</span></span><br><span class="line">sudo apt-get install g++</span><br><span class="line">sudo apt-get install gcc</span><br><span class="line">sudo apt-get install make</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential gcc-multilib dkms</span><br></pre></td></tr></table></figure><blockquote><p>如果遇到无法下载的情况，可能是因为安装完系统后源不可用，可以先更换国内镜像源后在进行本步骤（换源方法：<a href="https://zhuanlan.zhihu.com/p/139305626">写给工程师的 Ubuntu 20.04 最佳配置指南</a> 第<strong>2、3</strong>步）</p></blockquote><h3 id="2-卸载原有驱动"><a href="#2-卸载原有驱动" class="headerlink" title="2. 卸载原有驱动"></a>2. 卸载原有驱动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove --purge nvidia*   <span class="comment"># 或者nvidia-*</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-官网下载对应驱动"><a href="#3-官网下载对应驱动" class="headerlink" title="3. 官网下载对应驱动"></a>3. 官网下载对应驱动</h3><blockquote><p>下载好之后，注意把nvidia驱动放在英文名文件夹下，比如mkdir driver 新建文件夹“driver”<br>官网地址：<a href="https://www.nvidia.cn/Download/index.aspx?lang=cn">Nvidia驱动下载地址</a><br>我这里显卡是4090，官网推荐驱动版本为535.54.03</p></blockquote><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_a82106785b61bc2f12e3efa9b941936c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_a82106785b61bc2f12e3efa9b941936c.png"></p><h3 id="4-禁用nouveau"><a href="#4-禁用nouveau" class="headerlink" title="4. 禁用nouveau"></a>4. 禁用nouveau</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/modprobe.d/blacklist.conf 或者(blacklist-nouveau.conf)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>(如果没有gedit输入以上指令会报错，可以 sudo apt-get install gedit 安装 gedit 或使用 nano 代替 gedit )</p></blockquote><p>在打开的blacklist.conf末尾添加如下，保存文本关闭</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blacklist nouveau</span><br><span class="line">options nouveau modeset=0</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在终端输入如下命令，进行更新</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-initramfs -u</span><br></pre></td></tr></table></figure><p>更新结束后重启电脑</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>重启后在终端输入如下命令，如果没有输出则说明成功禁用nouveau</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep nouveau</span><br></pre></td></tr></table></figure><h3 id="5-停止当前的显示服务器"><a href="#5-停止当前的显示服务器" class="headerlink" title="5. 停止当前的显示服务器"></a>5. 停止当前的显示服务器</h3><p>最简单的方法是使用telinit命令更改为运行级别3。在终端输入以下linux命令后，显示服务器将停止。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo telinit 3</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>一般执行完上述命令后，系统自动进入文本界面tty；<br>如果进不去，就按Ctrl + Alt + F1～F6中的一个 (分别对应进入tty1~tty6)<br>然后输入用户名和密码</p></blockquote><h3 id="6-在文本界面中，禁用X-window服务"><a href="#6-在文本界面中，禁用X-window服务" class="headerlink" title="6. 在文本界面中，禁用X-window服务"></a>6. 在文本界面中，禁用X-window服务</h3><p>在终端输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/gdm3 stop或者（sudo service gdm3 stop）</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-安装驱动"><a href="#7-安装驱动" class="headerlink" title="7. 安装驱动"></a>7. 安装驱动</h3><p>cd命令进入到存放驱动的目录，输入命令（命令中的文件名以你下载的驱动为准）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 777 NVIDIA-Linux-x86_64-535.54.03.run   <span class="comment">#给你下载的驱动赋予可执行权限，才可以安装</span></span><br><span class="line">sudo ./NVIDIA-Linux-x86_64-535.54.03.run –no-opengl-files   <span class="comment">#安装</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_f8b9841992eaa256d8d224a8a53f064a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_f8b9841992eaa256d8d224a8a53f064a.png"></p><blockquote><p>以上问题并非按我写的顺序出现，但是当时没有截图所以忘记顺序了。<strong>表格中最后一个问题</strong>需要注意，在其它的教程中，这个问题选yes，但是在我安装系统的过程中，选yes会导致电脑重启后无法正常开机。<strong>所以这里我选了No</strong>，重启后能够正常开机。（Ubuntu20.04 、显卡4090）</p></blockquote><h3 id="8-重启图形界面"><a href="#8-重启图形界面" class="headerlink" title="8. 重启图形界面"></a>8. 重启图形界面</h3><p>安装完成后退回图形界面：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo init 5 </span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctrl + alt + f7 </span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service gdm3 restart</span><br></pre></td></tr></table></figure><p>或者终端输入 reboot 重启</p><h3 id="9-测试显卡驱动是否安装成功"><a href="#9-测试显卡驱动是否安装成功" class="headerlink" title="9. 测试显卡驱动是否安装成功"></a>9. 测试显卡驱动是否安装成功</h3><p>终端输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>出现类似下图的界面，说明成功安装驱动</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_faf7c52e1453ed6831feafd08733747a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_faf7c52e1453ed6831feafd08733747a.png"></p><h3 id="四-安装CUDA"><a href="#四-安装CUDA" class="headerlink" title="四. 安装CUDA"></a>四. 安装CUDA</h3><p>为了能够使用pytorch2，我在这里安装的CUDA11.8版本。<br>参考教程：<a href="https://zhuanlan.zhihu.com/p/612556391">CUDA_11.8安装-知乎</a></p><h4 id="1-官网下载CUDA"><a href="#1-官网下载CUDA" class="headerlink" title="1. 官网下载CUDA"></a>1. 官网下载CUDA</h4><p><a href="https://developer.nvidia.com/cuda-11-8-0-download-archive">CUDA Toolkit 11.8 Downloads</a></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_a3e710d1f0efc1cd8aa0c09ba852954c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_a3e710d1f0efc1cd8aa0c09ba852954c.png"></p><h3 id="2-下载CUDA"><a href="#2-下载CUDA" class="headerlink" title="2. 下载CUDA"></a>2. 下载CUDA</h3><p>终端输入上一步获得的命令，下载runfile文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://developer.download.nvidia.com/compute/cuda/11.8.0/local_installers/cuda_11.8.0_520.61.05_linux.run</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-安装"><a href="#3-安装" class="headerlink" title="3. 安装"></a>3. 安装</h3><p>执行上一条命令下载runfile文件后，cd到文件所在路径，执行下面的命令，安装cuda</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh cuda_11.8.0_520.61.05_linux.run</span><br></pre></td></tr></table></figure><p>执行后稍微等待，会出现如下画面</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_75d6fd3264f5a14aea3d46eb7188bfad.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_75d6fd3264f5a14aea3d46eb7188bfad.png"></p><blockquote><p>上下移动光标到Driver位置，按空格取消选择；用相同的操作取消另外三个选项，只安装CUDA Toolkit 11.8主体（如图）</p></blockquote><p>继续移动光标到Options，按回车，进入安装配置界面（如下）</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_137f5444520fc1ba1ec212be997df3a5.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_137f5444520fc1ba1ec212be997df3a5.png"></p><p>光标移动到Toolkit Options，按回车，进入CUDA安装配置界面\</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_0067f24a438738730d4d902abcec20ce.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_0067f24a438738730d4d902abcec20ce.png"></p><blockquote><p>如上图，去掉所有多选选项，特别是Create symbolic link from /usr/local/cuda选项，最好是去掉。这样安装完成后，是不会在/usr/local/下生成cuda软链接目录。这个软链接目录在安装过程中是不可修改的，当我们安装多版本CUDA时，会重复覆盖这个软链接目录，对我们使用CUDA会产生不必要的麻烦。</p></blockquote><blockquote><p>CUDA默认安装在/usr/local/目录下，一般Change Toolkit Install Path可以不做修改。但如果是普通用户安装，需设定安装路径为用户主目录下，光标移动到Change Toolkit Install Path按回车，手动修改安装路径后按回车退出路径配置界面<br>————————————————</p></blockquote><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_7384d8d55a365e5df7705a52eaba2a81.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_7384d8d55a365e5df7705a52eaba2a81.png"></p><p>如果想要修改路径，可以设置为自己想要放在的位置，如 /home/用户名/app/cuda-11.8/</p><h3 id="4-设置CUDA环境"><a href="#4-设置CUDA环境" class="headerlink" title="4. 设置CUDA环境"></a>4. 设置CUDA环境</h3><p>如果上一步选择用root用户安装在默认路径，则普通用户环境变量配置如下示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/local/cuda-11.8/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$LD_LIBRARY_PATH</span>:/usr/local/cuda-11.8/lib64</span><br></pre></td></tr></table></figure><p>如果是普通用户安装在自己的用户目录下，环境变量配置如下示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/home/duyong/apps/cuda-11.8/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$LD_LIBRARY_PATH</span>:/home/duyong/apps/cuda-11.8/lib64</span><br></pre></td></tr></table></figure><p>使用户配置文件即刻生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure><p>验证CUDA是否安装成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -V</span><br></pre></td></tr></table></figure><p>如果有类似如下输出说明安装成功</p><blockquote><p>nvcc: NVIDIA ® Cuda complier driver<br>Copyright © 2005-2022 NVIDIA Coropration<br>Bulit on Wed_Jun__8_16:49:14_PDT_2022<br>Cuda copiltation tools, release 11.7, V11.7.99<br>Build cuda_11.7.r11.7/compiler .31442593_0</p></blockquote><p>安装完成后重启</p><h2 id="五-安装CUDNN"><a href="#五-安装CUDNN" class="headerlink" title="五. 安装CUDNN"></a>五. 安装CUDNN</h2><p>官网下载地址：（需要注册）</p><p><a href="https://developer.nvidia.com/cudnn">https://developer.nvidia.com/cudnn</a></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_255bdd3027c994186d2ab7d232c048d6.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_255bdd3027c994186d2ab7d232c048d6.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_a00f30ce85ee7aea5ba4008845c2697a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_a00f30ce85ee7aea5ba4008845c2697a.png"></p><p>点击下载，下载完成后解压文件，在当前文件夹下打开终端，输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> cuda/include/cudnn.h /usr/local/cuda/include/</span><br><span class="line">sudo <span class="built_in">cp</span> cuda/lib64/libcudnn* /usr/local/cuda/lib64/</span><br><span class="line">sudo <span class="built_in">chmod</span> a+r /usr/local/cuda/include/cudnn.h</span><br><span class="line">sudo <span class="built_in">chmod</span> a+r /usr/local/cuda/lib64/libcudnn*</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此步操作为拷贝文件到指定位置，并赋予权限</p><p>验证是否安装成功，输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/local/cuda/include/cudnn_version.h | grep CUDNN_MAJOR -A 2</span><br></pre></td></tr></table></figure><p>安装成功会有类似下图的输出</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_2a150aaca0cc6b1bfd635806439e0210.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_2a150aaca0cc6b1bfd635806439e0210.png"></p><h3 id="六-安装Anaconda"><a href="#六-安装Anaconda" class="headerlink" title="六. 安装Anaconda"></a>六. 安装Anaconda</h3><p>参考：<a href="https://blog.csdn.net/m0_50117360/article/details/108403586">Ubuntu 20.04安装Anaconda3及简单使用</a></p><h3 id="七-安装Pytorch2"><a href="#七-安装Pytorch2" class="headerlink" title="七. 安装Pytorch2"></a>七. 安装Pytorch2</h3><p>参考：<a href="https://blog.csdn.net/KRISNAT/article/details/124068391">超详细 Ubuntu安装PyTorch步骤</a></p><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a href="https://zhuanlan.zhihu.com/p/590877041">https://zhuanlan.zhihu.com/p/590877041</a><br><a href="https://blog.csdn.net/hwh295/article/details/113409389">https://blog.csdn.net/hwh295/article/details/113409389</a><br><a href="https://blog.csdn.net/Perfect886/article/details/119109380">https://blog.csdn.net/Perfect886/article/details/119109380</a><br><a href="https://zhuanlan.zhihu.com/p/61255639">https://zhuanlan.zhihu.com/p/61255639</a><br><a href="https://blog.csdn.net/m0_50117360/article/details/108403586">https://blog.csdn.net/m0_50117360/article/details/108403586</a><br><a href="https://blog.csdn.net/KRISNAT/article/details/124068391">https://blog.csdn.net/KRISNAT/article/details/124068391</a><br>————————————————</p><h3 id="本文参考："><a href="#本文参考：" class="headerlink" title="本文参考："></a>本文参考：</h3><p><a href="https://blog.csdn.net/qq_43775794/article/details/131770933">https://blog.csdn.net/qq_43775794/article/details/131770933</a></p>]]></content>
      
      
      <categories>
          
          <category> gpu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gpu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu彻底删除mysql残留 安装新mysql</title>
      <link href="/2024/06/05/ubuntu%E5%BD%BB%E5%BA%95%E5%88%A0%E9%99%A4mysql%E6%AE%8B%E7%95%99%20%E5%AE%89%E8%A3%85%E6%96%B0mysql/"/>
      <url>/2024/06/05/ubuntu%E5%BD%BB%E5%BA%95%E5%88%A0%E9%99%A4mysql%E6%AE%8B%E7%95%99%20%E5%AE%89%E8%A3%85%E6%96%B0mysql/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ubuntu彻底删除mysql残留-安装新mysql"><a href="#ubuntu彻底删除mysql残留-安装新mysql" class="headerlink" title="ubuntu彻底删除mysql残留 安装新mysql"></a>ubuntu彻底删除mysql残留 安装新mysql</h1><p>1.删除mysql的数据文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> /var/lib/mysql/ -R</span><br></pre></td></tr></table></figure><p>2.删除mysql的配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">rm</span> /etc/mysql/ -R</span><br></pre></td></tr></table></figure><p>(这两步非常重要，好多文章都没写)</p><p>3 .dpkg –list|grep mysql查看mysql的依赖项</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_8a639ced957b5aa0db30b0b1aac12589.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_8a639ced957b5aa0db30b0b1aac12589.png"></p><p>4.开始删除依赖项</p><p>4.1 .卸载命令：sudo apt-get remove mysql-common</p><p>4.2. 卸载命令：sudo apt-get autoremove –purge mysql-server-8.0</p><p>备注此两部合为一步:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下方两命令皆可</span></span><br><span class="line">dpkg -l|grep mysql|awk <span class="string">&#x27;&#123;print$2&#125;&#x27;</span>|sudo xargs dpkg -P</span><br><span class="line">dpkg -l|grep mysql|awk <span class="string">&#x27;&#123;print$2&#125;&#x27;</span>|sudo xargs remove -y</span><br></pre></td></tr></table></figure><p>4.3 .清除残留数据，运行命令：dpkg -l|grep mysql|awk ‘{print$2}’|sudo xargs dpkg -P</p><p>再次查看MySQL的剩余依赖项，运行命令：dpkg –list|grep mysql</p><p>如果没有返回即删除完了（基本上就会删除完），如果没删除完则继续删除显示的依赖包</p><p>其他</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修复安装包</span></span><br><span class="line">sudo dpkg-reconfigure mysql-server-5.7</span><br><span class="line"><span class="comment"># 卸载安装包及配置文件</span></span><br><span class="line">sudo apt-get purge mysql-server-5.7</span><br></pre></td></tr></table></figure><p>完成 此时即可重新安装mysql！</p><p>原文链接：<a href="https://blog.csdn.net/qq_52135683/article/details/126857974">https://blog.csdn.net/qq_52135683/article/details/126857974</a></p>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>grafana 8以上版本配置邮件告警</title>
      <link href="/2024/06/04/grafana%208%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC%E9%85%8D%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%91%8A%E8%AD%A6/"/>
      <url>/2024/06/04/grafana%208%E4%BB%A5%E4%B8%8A%E7%89%88%E6%9C%AC%E9%85%8D%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%91%8A%E8%AD%A6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="grafana-8以上版本配置邮件告警"><a href="#grafana-8以上版本配置邮件告警" class="headerlink" title="grafana 8以上版本配置邮件告警"></a>grafana 8以上版本配置邮件告警</h1><blockquote><p>本次演示使用版本9.2.0</p><p>拓补图</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_edeee1c476fa329e2b3489f066df346c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_edeee1c476fa329e2b3489f066df346c.png"></p></blockquote><h2 id="1-首先配置后端邮件配置"><a href="#1-首先配置后端邮件配置" class="headerlink" title="1.首先配置后端邮件配置"></a>1.首先配置后端邮件配置</h2><p>建议配置为邮件组 组内成员都可收到邮件</p><p>此处见链接：<a href="https://wn-apple-teawine.fun/2023/05/26/grafana%E9%85%8D%E7%BD%AE%E9%82%AE%E4%BB%B6%E5%91%8A%E8%AD%A6">https://wn-apple-teawine.fun/2023/05/26/grafana配置邮件告警</a></p><h2 id="2-此时即可配置告警规则"><a href="#2-此时即可配置告警规则" class="headerlink" title="2.此时即可配置告警规则"></a>2.此时即可配置告警规则</h2><p>①.配置</p><p>后端配置见上方链接</p><p>前端配置见下方</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_77d36f135d1154ed015d21243fe9f8bc.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_77d36f135d1154ed015d21243fe9f8bc.png"></p><p>点击测试查看是否成功</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_4e8ed1f107e3602cfcf8edb7ff1872ca.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_4e8ed1f107e3602cfcf8edb7ff1872ca.png"></p><p>配置持续发送告警 配置 Notification policies 设置重复发送告警邮件的间隔时间</p><p>不设置此则默认四小时重复发送 相当糟糕💗</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_b76111cbaf1baced4e24119f9bb1c9a8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_b76111cbaf1baced4e24119f9bb1c9a8.png"></p><p><strong>此时便会两分钟发一封告警邮件</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_ba9125fba1e0c66be945b60a83f2b41e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_ba9125fba1e0c66be945b60a83f2b41e.png"></p><p>②.配置promsql语句设置报警</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_54e566d16a35915ac3f03f44a05c8ed5.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_54e566d16a35915ac3f03f44a05c8ed5.png"></p><p>报警条件选择 选择B语句 选择A会报错</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_e2cee9496752811ae27dba1c7b6c22bd.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_e2cee9496752811ae27dba1c7b6c22bd.png"></p><p>或拖动此线🍺</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_93c6bf297b5cff54231696e190e19874.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_93c6bf297b5cff54231696e190e19874.png"></p><p>选择报警表达式为 <strong>B</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_a62de892570cd8c66cc553250ed18d68.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_a62de892570cd8c66cc553250ed18d68.png"></p><p>设置报警周期</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_5a25154c8a7e1694b0e6237fd051f8b4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_5a25154c8a7e1694b0e6237fd051f8b4.png"></p><p>设置报警出现发送提示语句</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_776ebfdddab566d58c59c4685d439a9c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_776ebfdddab566d58c59c4685d439a9c.png"></p><p>自定义标签</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_1f801f865e968f8b9d0594ee1e9d84dd.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_1f801f865e968f8b9d0594ee1e9d84dd.png"></p><h2 id="2-效果"><a href="#2-效果" class="headerlink" title="2.效果"></a>2.效果</h2><p>报警页面</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_cec9e81d68127efb459ca97cb4f1d9e0.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_cec9e81d68127efb459ca97cb4f1d9e0.png"></p><p>报警恢复与发送报警<br><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_5f7a15945a38ac95755b68996feb913e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_5f7a15945a38ac95755b68996feb913e.png"></p><p>参考：</p><p><a href="https://blog.51cto.com/u_11529070/9174855">[转帖]Prometheus系列之Grafana 版本9.0.0 设置Email邮件报警实战_51CTO博客_prometheus邮件告警</a></p>]]></content>
      
      
      <categories>
          
          <category> grafana </category>
          
      </categories>
      
      
        <tags>
            
            <tag> grafana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>宝塔docker部署实现对某一个目录的编辑</title>
      <link href="/2024/06/03/%E5%AE%9D%E5%A1%94docker%E9%83%A8%E7%BD%B2%E5%AE%9E%E7%8E%B0%E5%AF%B9%E6%9F%90%E4%B8%80%E4%B8%AA%E7%9B%AE%E5%BD%95%E7%9A%84%E7%BC%96%E8%BE%91/"/>
      <url>/2024/06/03/%E5%AE%9D%E5%A1%94docker%E9%83%A8%E7%BD%B2%E5%AE%9E%E7%8E%B0%E5%AF%B9%E6%9F%90%E4%B8%80%E4%B8%AA%E7%9B%AE%E5%BD%95%E7%9A%84%E7%BC%96%E8%BE%91/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="宝塔docker部署实现对某一个目录的编辑"><a href="#宝塔docker部署实现对某一个目录的编辑" class="headerlink" title="宝塔docker部署实现对某一个目录的编辑"></a>宝塔docker部署实现对某一个目录的编辑</h1><blockquote><h2 id="版本命名说明-（镜像可选）"><a href="#版本命名说明-（镜像可选）" class="headerlink" title="版本命名说明 （镜像可选）"></a>版本命名说明 （镜像可选）</h2><p>pch18/baota或pch18/baota:latest等同pch18/baota:lnmp<br>pch18/baota:lnmp为最新版本的官方纯净安装的基础上安装nginx,mysql,php<br>pch18/baota:lnp 为官方版本纯净安装的基础上安装nginx,php(不内置mysql,用于外置数据库的环境)<br>pch18/baota:lamp 为官方版本纯净安装的基础上安装apache,php<br>pch18/baota:lap 为官方版本纯净安装的基础上安装apache,php(不内置mysql,用于外置数据库的环境)<br>pch18/baota:clear 为官方版本纯净安装, 不默认安装nginx,mysql,php等程序</p><p>项目地址：<a href="https://github.com/pch18-docker/baota">https://github.com/pch18-docker/baota</a></p></blockquote><h2 id="镜像可选"><a href="#镜像可选" class="headerlink" title="镜像可选"></a>镜像可选</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pch18/baota</span><br><span class="line">pch18/baota:clear</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:baota</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:pch18baota-clean</span><br></pre></td></tr></table></figure><h2 id="docker-compose部署"><a href="#docker-compose部署" class="headerlink" title="docker-compose部署"></a>docker-compose部署</h2><blockquote><p>只需要暴露 web访问端口 8888与80端口的映射即可</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">baota:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">pch18/baota:clear</span></span><br><span class="line">    <span class="comment"># registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:baota</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">baota</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data:/www/v10</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/wwwroot:/www/wwwroot</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8010:80&quot;</span></span><br><span class="line">      <span class="comment"># - &quot;4431:443&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8888:8888&quot;</span></span><br><span class="line">      <span class="comment"># - &quot;888:888&quot;</span></span><br><span class="line">    <span class="attr">shm_size:</span> <span class="string">&#x27;1g&#x27;</span></span><br></pre></td></tr></table></figure><p>关闭安装套件推荐：<code>sed -i &quot;s/self.CheckInstalled()/True/g&quot; /www/server/panel/class/system.py</code></p><p><strong>手动步骤</strong></p><ol><li>修改文件路径：<code>/www/server/panel/class/system.py</code></li><li>搜索代码：<code>networkInfo[&#39;installed&#39;] = self.CheckInstalled()</code></li><li>替换为：<code>networkInfo[&#39;installed&#39;] = True</code></li><li>重启面板，你会发现烦人的弹窗消失了。</li></ol><p><a href="https://qzone.work/technologys/604.html">宝塔面板禁用 套件推荐安装弹窗 - 莫名博客 (qzone.work)</a></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>登录方式<br>登陆地址 http://:8888<br>初始账号 username<br>初始密码 password</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_63177a79daa92e8f483ee31941b38457.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_63177a79daa92e8f483ee31941b38457.png"></p><p>若无法登录则需要重新修改密码 docker exec 进入容器 使用 bt 命令 输入5，6重置登录信息  登录成功后需要开启离线模式。</p>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ChatGPT对接微信公众号</title>
      <link href="/2024/05/30/ChatGPT%E5%AF%B9%E6%8E%A5%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/"/>
      <url>/2024/05/30/ChatGPT%E5%AF%B9%E6%8E%A5%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ChatGPT对接微信公众号"><a href="#ChatGPT对接微信公众号" class="headerlink" title="ChatGPT对接微信公众号"></a>ChatGPT对接微信公众号</h1><blockquote><p>使用vercel 项目地址: <a href="https://github.com/pwh-pwh/aiwechat-vercel">https://github.com/pwh-pwh/aiwechat-vercel</a></p><p>部署链接：<a href="https://vercel.com/">https://vercel.com/</a></p></blockquote><p>环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GPT_TOKEN: sk-utaX8XNb1Lq5m9DWQDqVT3BlbkFJNVgkLJshdsddsdsd</span><br><span class="line">WX_SUBSCRIBE_REPLY: 本公众号(简逸云.) 用于分享 云计算，人工智能，大模型集成，开源社区，云原生监控等知识 帮助您解决日常生活及工作中的难题 公众号已集成GPT感谢您的关注！</span><br><span class="line">maxOutput: 200</span><br><span class="line">WX_HELP_REPLY: 输入以下命令进行对话 \n/help：查看帮助 \n/gpt：与GPT对话 \n此GPT每次回答字数限制为200字左右，如需解除字数限制请联系作者(878891611@qq.com)获取帮助。</span><br><span class="line">accessCode: Jkl12sdsd!</span><br><span class="line">GPT_URL: https://api.openai.com/v1</span><br><span class="line">botType: gpt</span><br><span class="line">WX_TOKEN: 53acb98d1dac49969b45797129f504f8</span><br><span class="line">gptModel: gpt-3.5-turbo</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RustDesk全平台远程桌面连接软件自建服务</title>
      <link href="/2024/05/30/RustDesk%E5%85%A8%E5%B9%B3%E5%8F%B0%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5%E8%BD%AF%E4%BB%B6%E8%87%AA%E5%BB%BA%E6%9C%8D%E5%8A%A1/"/>
      <url>/2024/05/30/RustDesk%E5%85%A8%E5%B9%B3%E5%8F%B0%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5%E8%BD%AF%E4%BB%B6%E8%87%AA%E5%BB%BA%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="RustDesk全平台远程桌面连接软件自建服务"><a href="#RustDesk全平台远程桌面连接软件自建服务" class="headerlink" title="RustDesk全平台远程桌面连接软件自建服务"></a>RustDesk全平台远程桌面连接软件自建服务</h1><blockquote><p>RustDesk 是一款开源的全平台远程桌面软件，可以平替 TeamViewer、向日葵、ToDesk 等远程桌面软件。可使用官方提供的免费服务器（国内使用比较拉胯），也可自建服务器让数据掌握在自己手中，不用担心安全问题，以下列举几个特点：</p><p>全平台支持，如：Windows、macOS、Linux、iOS、Android、Web 等。<br>支持 VP8 / VP9 / AV1 软件编解码器和 H264 / H265 硬件编解码器。<br>完全掌控数据，轻松自建。<br>P2P 连接，端到端加密。<br>RustDesk 1.2 开始采用 Flutter 重写桌面版本，可以支持 Wayland 被控了。<br>国内的开发团队，知乎有账号（还比较活跃），有问题可以去提问。<br>RustDesk 官网： <a href="https://rustdesk.com/zh/">https://rustdesk.com/zh/</a></p><p>服务端 GitHub 地址： <a href="https://github.com/rustdesk/rustdesk-server">https://github.com/rustdesk/rustdesk-server</a></p><p>客户端下载地址： <a href="https://github.com/rustdesk/rustdesk/releases">https://github.com/rustdesk/rustdesk/releases</a></p><p>文档地址： <a href="https://rustdesk.com/docs/zh-cn">https://rustdesk.com/docs/zh-cn</a></p></blockquote><h2 id="一-部署"><a href="#一-部署" class="headerlink" title="一. 部署"></a>一. 部署</h2><p>docker-compose部署</p><p>镜像可选</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rustdesk/rustdesk-server-s6:latest</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:rustdesk-server-s6</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rustdesk-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rustdesk/rustdesk-server-s6:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rustdesk-server</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21115</span><span class="string">:21115</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21116</span><span class="string">:21116</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21116</span><span class="string">:21116/udp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">21117</span><span class="string">:21117</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;RELAY=192.168.30.69:21117&quot;</span>  <span class="comment"># 填入域名或者IP+hbbr的端口</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ENCRYPTED_ONLY=1&quot;</span></span><br></pre></td></tr></table></figure><h2 id="二-使用"><a href="#二-使用" class="headerlink" title="二. 使用"></a>二. 使用</h2><p>下载客户端打开填入 服务器外网IP  及生成的key文件（cat /opt/rustdesk/data/id_ed25519.pub）  自己的客户端和 被控方的客户端都需要填入ID服务器 和key 点击远程即可。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_e133e39869f85fb864d9a6bc05ba20e1.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_e133e39869f85fb864d9a6bc05ba20e1.png"></p><p>此时即可远程。</p><h2 id="三-本文参考"><a href="#三-本文参考" class="headerlink" title="三. 本文参考"></a>三. 本文参考</h2><p><a href="https://blog.vlinyu.com/archives/docker-compose-remotedesk-rustdesk-server">【Docker 项目】之–RustDesk全平台远程桌面连接软件自建服务器流程-v林羽 (vlinyu.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>部署类似知乎的问答社区Answer</title>
      <link href="/2024/05/30/%E9%83%A8%E7%BD%B2%E7%B1%BB%E4%BC%BC%E7%9F%A5%E4%B9%8E%E7%9A%84%E9%97%AE%E7%AD%94%E7%A4%BE%E5%8C%BAAnswer/"/>
      <url>/2024/05/30/%E9%83%A8%E7%BD%B2%E7%B1%BB%E4%BC%BC%E7%9F%A5%E4%B9%8E%E7%9A%84%E9%97%AE%E7%AD%94%E7%A4%BE%E5%8C%BAAnswer/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="部署类似知乎的问答社区Answer"><a href="#部署类似知乎的问答社区Answer" class="headerlink" title="部署类似知乎的问答社区Answer"></a>部署类似知乎的问答社区Answer</h1><h2 id="一-项目地址"><a href="#一-项目地址" class="headerlink" title="一. 项目地址"></a>一. 项目地址</h2><p>Answer 官方网址：<a href="https://answer.dev/">https://answer.dev/</a></p><p>Answer 官方 GitHub：<a href="https://github.com/answerdev/answer">https://github.com/answerdev/answer</a></p><p>Answer 官方文档：<a href="https://answer.dev/docs/installation/">https://answer.dev/docs/installation/</a></p><h2 id="二-Docker镜像"><a href="#二-Docker镜像" class="headerlink" title="二. Docker镜像"></a>二. Docker镜像</h2><p><a href="https://hub.docker.com/r/danielszabo99/microbin">https://hub.docker.com/r/danielszabo99/microbin</a></p><h2 id="三-项目介绍"><a href="#三-项目介绍" class="headerlink" title="三. 项目介绍"></a>三. 项目介绍</h2><blockquote><p>Answer是一个类似知乎的开源问答社区。支持Docker部署，目前GitHub拥有5.4K的star。</p></blockquote><h2 id="四-功能介绍"><a href="#四-功能介绍" class="headerlink" title="四. 功能介绍"></a>四. 功能介绍</h2><p>非常小巧<br>支持文件上传（例如：server.com/file/pig-dog-cat）<br>支持raw的文本服务（例如，server.com/raw/pig-dog-cat）<br>可以用来URL缩短和重定向<br>支持二维码<br>数据库非常简单（JSON+文件），可移植性强，易于备份和整合<br>支持列出使用过的列表<br>支持私有链接和公开链接，可编辑，可以设置链接的有效性<br>支持代码语法高亮<br>自动暗黑模式和自定义样式，只需很少的CSS和vanilla JS（见water.css）<br>默认以动物的名字作为结尾（可修改成随机字符）</p><h2 id="五-部署"><a href="#五-部署" class="headerlink" title="五. 部署"></a>五. 部署</h2><p>docker-copmpose 部署</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">answer:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">answerdev/answer</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;9008:80&#x27;</span>            <span class="comment"># 冒号左边可以改成自己服务器未被占用的端口</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./answer-data:/data</span>  <span class="comment"># 冒号左边可以改路径，现在是表示把数据存放在在当前文件夹下的 answer-data 文件夹中</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mariadb:10</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">answer</span>   <span class="comment"># 数据库用户root的密码，建议自行修改一个</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">answer</span>     </span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">answer</span>   <span class="comment"># 数据库用户answer的密码，建议自行修改一个</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">answer</span> </span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mariadb:/var/lib/mysql</span>  <span class="comment"># 冒号左边可以改路径，现在是表示把数据存放在在当前文件夹下的 mariadb 文件夹中</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--character-set-server=utf8mb4</span> <span class="string">--collation-server=utf8mb4_unicode_ci</span></span><br></pre></td></tr></table></figure><h2 id="六-效果"><a href="#六-效果" class="headerlink" title="六. 效果"></a>六. 效果</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_2f2f5fe7b710450a248e624a3299d855.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_2f2f5fe7b710450a248e624a3299d855.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_13c7b65b321acf267ffd7b70a31c1fad.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_13c7b65b321acf267ffd7b70a31c1fad.png"></p>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vmware esxi gpu直通</title>
      <link href="/2024/05/28/vmware%20esxi%20gpu%E7%9B%B4%E9%80%9A/"/>
      <url>/2024/05/28/vmware%20esxi%20gpu%E7%9B%B4%E9%80%9A/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="vmware-esxi-gpu直通"><a href="#vmware-esxi-gpu直通" class="headerlink" title="vmware esxi gpu直通"></a>vmware esxi gpu直通</h1><h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a href="https://www.dinghui.org/vmware-esxi-directpath-gpu.html">https://www.dinghui.org/vmware-esxi-directpath-gpu.html</a></p><p><a href="https://www.dinghui.org/vmware-esxi-nvidia-gpu.html">https://www.dinghui.org/vmware-esxi-nvidia-gpu.html</a></p><p><a href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.resmgmt.doc/GUID-9044A2BA-D4E5-4221-87F4-0B1C8612B748.html">https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.resmgmt.doc/GUID-9044A2BA-D4E5-4221-87F4-0B1C8612B748.html</a></p>]]></content>
      
      
      <categories>
          
          <category> gpu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gpu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cloudfaler部署github文件下载加速</title>
      <link href="/2024/05/28/cloudfaler%E9%83%A8%E7%BD%B2github%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%8A%A0%E9%80%9F/"/>
      <url>/2024/05/28/cloudfaler%E9%83%A8%E7%BD%B2github%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E5%8A%A0%E9%80%9F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="cloudfaler部署github文件下载加速"><a href="#cloudfaler部署github文件下载加速" class="headerlink" title="cloudfaler部署github文件下载加速"></a>cloudfaler部署github文件下载加速</h1><p>项目托管地址：<a href="https://github.com/hunshcn/gh-proxy">https://github.com/hunshcn/gh-proxy</a></p><p>构建: 只需要复制下方js代码到cloudflaer  workers中保存部署即可 建议绑定域名</p><p>cloudflaer workers地址：</p><p><a href="https://dash.cloudflare.com/65b0f21580ba74305f1bdcbc6d30210c/workers-and-pages">https://dash.cloudflare.com/65b0f21580ba74305f1bdcbc6d30210c/workers-and-pages</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * static files (404.html, sw.js, conf.js)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ASSET_URL</span> = <span class="string">&#x27;https://hunshcn.github.io/gh-proxy/&#x27;</span></span><br><span class="line"><span class="comment">// 前缀，如果自定义路由为example.com/gh/*，将PREFIX改为 &#x27;/gh/&#x27;，注意，少一个杠都会错！</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PREFIX</span> = <span class="string">&#x27;/&#x27;</span></span><br><span class="line"><span class="comment">// 分支文件使用jsDelivr镜像的开关，0为关闭，默认关闭</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Config</span> = &#123;</span><br><span class="line">    <span class="attr">jsdelivr</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> whiteList = [] <span class="comment">// 白名单，路径里面有包含字符的才会通过，e.g. [&#x27;/username/&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">ResponseInit</span>&#125; */</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PREFLIGHT_INIT</span> = &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">204</span>,</span><br><span class="line">    <span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">Headers</span>(&#123;</span><br><span class="line">        <span class="string">&#x27;access-control-allow-origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;access-control-allow-methods&#x27;</span>: <span class="string">&#x27;GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;access-control-max-age&#x27;</span>: <span class="string">&#x27;1728000&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> exp1 = <span class="regexp">/^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:releases|archive)\/.*$/i</span></span><br><span class="line"><span class="keyword">const</span> exp2 = <span class="regexp">/^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:blob|raw)\/.*$/i</span></span><br><span class="line"><span class="keyword">const</span> exp3 = <span class="regexp">/^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:info|git-).*$/i</span></span><br><span class="line"><span class="keyword">const</span> exp4 = <span class="regexp">/^(?:https?:\/\/)?raw\.(?:githubusercontent|github)\.com\/.+?\/.+?\/.+?\/.+$/i</span></span><br><span class="line"><span class="keyword">const</span> exp5 = <span class="regexp">/^(?:https?:\/\/)?gist\.(?:githubusercontent|github)\.com\/.+?\/.+?\/.+$/i</span></span><br><span class="line"><span class="keyword">const</span> exp6 = <span class="regexp">/^(?:https?:\/\/)?github\.com\/.+?\/.+?\/tags.*$/i</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; <span class="variable">body</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">status</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object&lt;string, string&gt;</span>&#125; <span class="variable">headers</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeRes</span>(<span class="params">body, status = <span class="number">200</span>, headers = &#123;&#125;</span>) &#123;</span><br><span class="line">    headers[<span class="string">&#x27;access-control-allow-origin&#x27;</span>] = <span class="string">&#x27;*&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(body, &#123;status, headers&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">urlStr</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">newUrl</span>(<span class="params">urlStr</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">URL</span>(urlStr)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">addEventListener</span>(<span class="string">&#x27;fetch&#x27;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ret = <span class="title function_">fetchHandler</span>(e)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="title function_">makeRes</span>(<span class="string">&#x27;cfworker error:\n&#x27;</span> + err.<span class="property">stack</span>, <span class="number">502</span>))</span><br><span class="line">    e.<span class="title function_">respondWith</span>(ret)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkUrl</span>(<span class="params">u</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> [exp1, exp2, exp3, exp4, exp5, exp6]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (u.<span class="title function_">search</span>(i) === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">FetchEvent</span>&#125; <span class="variable">e</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchHandler</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> req = e.<span class="property">request</span></span><br><span class="line">    <span class="keyword">const</span> urlStr = req.<span class="property">url</span></span><br><span class="line">    <span class="keyword">const</span> urlObj = <span class="keyword">new</span> <span class="title function_">URL</span>(urlStr)</span><br><span class="line">    <span class="keyword">let</span> path = urlObj.<span class="property">searchParams</span>.<span class="title function_">get</span>(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (path) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">redirect</span>(<span class="string">&#x27;https://&#x27;</span> + urlObj.<span class="property">host</span> + <span class="variable constant_">PREFIX</span> + path, <span class="number">301</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// cfworker 会把路径中的 `//` 合并成 `/`</span></span><br><span class="line">    path = urlObj.<span class="property">href</span>.<span class="title function_">substr</span>(urlObj.<span class="property">origin</span>.<span class="property">length</span> + <span class="variable constant_">PREFIX</span>.<span class="property">length</span>).<span class="title function_">replace</span>(<span class="regexp">/^https?:\/+/</span>, <span class="string">&#x27;https://&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (path.<span class="title function_">search</span>(exp1) === <span class="number">0</span> || path.<span class="title function_">search</span>(exp5) === <span class="number">0</span> || path.<span class="title function_">search</span>(exp6) === <span class="number">0</span> || path.<span class="title function_">search</span>(exp3) === <span class="number">0</span> || path.<span class="title function_">search</span>(exp4) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">httpHandler</span>(req, path)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.<span class="title function_">search</span>(exp2) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Config</span>.<span class="property">jsdelivr</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> newUrl = path.<span class="title function_">replace</span>(<span class="string">&#x27;/blob/&#x27;</span>, <span class="string">&#x27;@&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/^(?:https?:\/\/)?github\.com/</span>, <span class="string">&#x27;https://cdn.jsdelivr.net/gh&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">redirect</span>(newUrl, <span class="number">302</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            path = path.<span class="title function_">replace</span>(<span class="string">&#x27;/blob/&#x27;</span>, <span class="string">&#x27;/raw/&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">httpHandler</span>(req, path)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.<span class="title function_">search</span>(exp4) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> newUrl = path.<span class="title function_">replace</span>(<span class="regexp">/(?&lt;=com\/.+?\/.+?)\/(.+?\/)/</span>, <span class="string">&#x27;@$1&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/^(?:https?:\/\/)?raw\.(?:githubusercontent|github)\.com/</span>, <span class="string">&#x27;https://cdn.jsdelivr.net/gh&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Response</span>.<span class="title function_">redirect</span>(newUrl, <span class="number">302</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fetch</span>(<span class="variable constant_">ASSET_URL</span> + path)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Request</span>&#125; <span class="variable">req</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">pathname</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">httpHandler</span>(<span class="params">req, pathname</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> reqHdrRaw = req.<span class="property">headers</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// preflight</span></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&#x27;OPTIONS&#x27;</span> &amp;&amp;</span><br><span class="line">        reqHdrRaw.<span class="title function_">has</span>(<span class="string">&#x27;access-control-request-headers&#x27;</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="literal">null</span>, <span class="variable constant_">PREFLIGHT_INIT</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> reqHdrNew = <span class="keyword">new</span> <span class="title class_">Headers</span>(reqHdrRaw)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> urlStr = pathname</span><br><span class="line">    <span class="keyword">let</span> flag = !<span class="title class_">Boolean</span>(whiteList.<span class="property">length</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> whiteList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (urlStr.<span class="title function_">includes</span>(i)) &#123;</span><br><span class="line">            flag = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="string">&quot;blocked&quot;</span>, &#123;<span class="attr">status</span>: <span class="number">403</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (urlStr.<span class="title function_">search</span>(<span class="regexp">/^https?:\/\//</span>) !== <span class="number">0</span>) &#123;</span><br><span class="line">        urlStr = <span class="string">&#x27;https://&#x27;</span> + urlStr</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> urlObj = <span class="title function_">newUrl</span>(urlStr)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">RequestInit</span>&#125; */</span></span><br><span class="line">    <span class="keyword">const</span> reqInit = &#123;</span><br><span class="line">        <span class="attr">method</span>: req.<span class="property">method</span>,</span><br><span class="line">        <span class="attr">headers</span>: reqHdrNew,</span><br><span class="line">        <span class="attr">redirect</span>: <span class="string">&#x27;manual&#x27;</span>,</span><br><span class="line">        <span class="attr">body</span>: req.<span class="property">body</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">proxy</span>(urlObj, reqInit)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">URL</span>&#125; <span class="variable">urlObj</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">RequestInit</span>&#125; <span class="variable">reqInit</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">proxy</span>(<span class="params">urlObj, reqInit</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(urlObj.<span class="property">href</span>, reqInit)</span><br><span class="line">    <span class="keyword">const</span> resHdrOld = res.<span class="property">headers</span></span><br><span class="line">    <span class="keyword">const</span> resHdrNew = <span class="keyword">new</span> <span class="title class_">Headers</span>(resHdrOld)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> status = res.<span class="property">status</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (resHdrNew.<span class="title function_">has</span>(<span class="string">&#x27;location&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">let</span> _location = resHdrNew.<span class="title function_">get</span>(<span class="string">&#x27;location&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">checkUrl</span>(_location))</span><br><span class="line">            resHdrNew.<span class="title function_">set</span>(<span class="string">&#x27;location&#x27;</span>, <span class="variable constant_">PREFIX</span> + _location)</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            reqInit.<span class="property">redirect</span> = <span class="string">&#x27;follow&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">proxy</span>(<span class="title function_">newUrl</span>(_location), reqInit)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    resHdrNew.<span class="title function_">set</span>(<span class="string">&#x27;access-control-expose-headers&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">    resHdrNew.<span class="title function_">set</span>(<span class="string">&#x27;access-control-allow-origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    resHdrNew.<span class="title function_">delete</span>(<span class="string">&#x27;content-security-policy&#x27;</span>)</span><br><span class="line">    resHdrNew.<span class="title function_">delete</span>(<span class="string">&#x27;content-security-policy-report-only&#x27;</span>)</span><br><span class="line">    resHdrNew.<span class="title function_">delete</span>(<span class="string">&#x27;clear-site-data&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(res.<span class="property">body</span>, &#123;</span><br><span class="line">        status,</span><br><span class="line">        <span class="attr">headers</span>: resHdrNew,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spug自动化运维平台部署</title>
      <link href="/2024/05/24/spug%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/05/24/spug%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="spug自动化运维平台部署"><a href="#spug自动化运维平台部署" class="headerlink" title="spug自动化运维平台部署"></a>spug自动化运维平台部署</h2><blockquote><p>开源企业官网：<a href="https://www.spug.cc/">https://www.spug.cc</a></p></blockquote><p>docker-compose部署</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">spug-db</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--port</span> <span class="number">3306</span> <span class="string">--character-set-server=utf8mb4</span> <span class="string">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/spug/mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=spug</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=spug</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=spug.cc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=spug.cc</span></span><br><span class="line">  <span class="attr">spug:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:spug-service</span> </span><br><span class="line">    <span class="comment">#openspug/spug-service</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">spug</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/spug/service:/data/spug</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/spug/repos:/data/repos</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="comment"># 如果80端口被占用可替换为其他端口，例如: - &quot;8000:80&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=spug</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=spug</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=spug.cc</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_HOST=db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PORT=3306</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br></pre></td></tr></table></figure><p>初始化登录管理员用户,以下操作会创建一个用户名为 <code>admin</code> 密码为 <code>test123</code> 的管理员账户，可自行替换管理员账户/密码。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec spug init_spug admin test123</span><br></pre></td></tr></table></figure><p>登录：<a href="http://localhost/">http://localhost</a></p>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网页添加 Live2D 看板娘</title>
      <link href="/2024/05/21/%E7%BD%91%E9%A1%B5%E6%B7%BB%E5%8A%A0%20Live2D%20%E7%9C%8B%E6%9D%BF%E5%A8%98/"/>
      <url>/2024/05/21/%E7%BD%91%E9%A1%B5%E6%B7%BB%E5%8A%A0%20Live2D%20%E7%9C%8B%E6%9D%BF%E5%A8%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="网页添加-Live2D-看板娘"><a href="#网页添加-Live2D-看板娘" class="headerlink" title="网页添加 Live2D 看板娘"></a>网页添加 Live2D 看板娘</h1><p>参考/转载处：</p><p><a href="https://www.fghrsh.net/post/123.html">https://www.fghrsh.net/post/123.html</a><br><a href="https://github.com/fghrsh/live2d/_demo">https://github.com/fghrsh/live2d\_demo</a><br><a href="https://www.cnblogs.com/goodmemoryblog/p/14279625.html">https://www.cnblogs.com/goodmemoryblog/p/14279625.html</a><br><a href="https://www.cnblogs.com/yjlaugus/p/8724881.html#/c/subject/p/8724881.html">https://www.cnblogs.com/yjlaugus/p/8724881.html#/c/subject/p/8724881.html</a><br><a href="https://www.cnblogs.com/Lantxy/p/13112000.html">https://www.cnblogs.com/Lantxy/p/13112000.html</a></p><p>本文转载链接：<a href="https://www.cnblogs.com/eve-d/p/15683541.html">网页添加 Live2D 看板娘（菜鸟级详细教程） - 妖妖未初 - 博客园 (cnblogs.com)</a></p><p>Live2D开源项目地址：</p><p><a href="https://github.com/xiazeyu/live2d-widget-models">https://github.com/xiazeyu/live2d-widget-models</a><br><a href="https://github.com/GEGEWU-CLOUD/live2d-widget-models">https://github.com/GEGEWU-CLOUD/live2d-widget-models</a></p><p>L2Dwidget.min.js 存于:</p><p><a href="https://drive.wn-apple-teawine.fun/api/raw/?path=/public-tools/Live2D/%E9%80%9A%E7%94%A8js/L2Dwidget.min.js">https://drive.wn-apple-teawine.fun/api/raw/?path=/public-tools/Live2D/通用js/L2Dwidget.min.js</a></p><p>记录自己学习操作的过程：<br>看着别人博客主页的看板娘好萌好贴心，自己也想弄一个啊，怎么办，不会啊。。。。。。。。。。当、当、当，本菜鸟将亲自实践，弄一个，此处记录自己的学习实践过程，也供大家参考。</p><h2 id="一、基本工作"><a href="#一、基本工作" class="headerlink" title="一、基本工作"></a>一、基本工作</h2><h3 id="1、要自定义博客，首先登录自己的账号，在自己博客主页找到管理，点击设置"><a href="#1、要自定义博客，首先登录自己的账号，在自己博客主页找到管理，点击设置" class="headerlink" title="1、要自定义博客，首先登录自己的账号，在自己博客主页找到管理，点击设置"></a>1、要自定义博客，首先登录自己的账号，在自己博客主页找到管理，点击设置</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_e77040f256eadd57f3446ab8d6e60d16.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_e77040f256eadd57f3446ab8d6e60d16.png"></p><h3 id="2、点击设置后，进入到基本设置页面，看是否有js权限，如果没有就先申请"><a href="#2、点击设置后，进入到基本设置页面，看是否有js权限，如果没有就先申请" class="headerlink" title="2、点击设置后，进入到基本设置页面，看是否有js权限，如果没有就先申请"></a>2、点击设置后，进入到基本设置页面，看是否有js权限，如果没有就先申请</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_048d8db540e75eec0fd0bbf8e94904b3.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_048d8db540e75eec0fd0bbf8e94904b3.png">⚠️：已经有了js权限，下面的操作才有效</p><h2 id="二、添加看板娘操作"><a href="#二、添加看板娘操作" class="headerlink" title="二、添加看板娘操作"></a>二、添加看板娘操作</h2><h3 id="1、最最最精简版："><a href="#1、最最最精简版：" class="headerlink" title="1、最最最精简版："></a>1、最最最精简版：</h3><p>在博客侧边栏公告处添加如下代码</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_574d813c1585364829bf47ae76ffda46.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_574d813c1585364829bf47ae76ffda46.png"></p><p>代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 网页侧边添加猫咪 --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://files.cnblogs.com/files/liuzhou1/L2Dwidget.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  L2Dwidget.<span class="title function_">init</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;model&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">jsonPath</span>: <span class="string">&quot;https://unpkg.com/live2d-widget-model-tororo@1.0.5/assets/tororo.model.json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;scale&quot;</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;display&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;position&quot;</span>: <span class="string">&quot;right&quot;</span>, <span class="comment">//模型的表现位置</span></span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;width&quot;</span>: <span class="number">150</span>, <span class="comment">//模型的宽度</span></span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;height&quot;</span>: <span class="number">300</span>, <span class="comment">//模型的高度</span></span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;hOffset&quot;</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;vOffset&quot;</span>: -<span class="number">20</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;mobile&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;show&quot;</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;scale&quot;</span>: <span class="number">0.5</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;react&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;opacityDefault&quot;</span>: <span class="number">0.7</span>, <span class="comment">//模型默认透明度</span></span></span><br><span class="line"><span class="language-javascript">  <span class="string">&quot;opacityOnHover&quot;</span>: <span class="number">0.2</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 网页侧边添加猫咪 --&gt;</span></span><br></pre></td></tr></table></figure><p>最后保存，即可成功</p><p>一只可爱的小猫咪就有啦</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_5ec4c415016c2d8230473f35c8b9898e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_5ec4c415016c2d8230473f35c8b9898e.png"></p><p>如果想换其他模版，可以修改 <code>jsonPath</code> 的路径，可选的模型（从此处整理来：<a href="https://www.cnblogs.com/goodmemoryblog/p/14279625.html%EF%BC%89%E6%9C%89%EF%BC%9A">https://www.cnblogs.com/goodmemoryblog/p/14279625.html）有：</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//黑猫咪：https://unpkg.com/live2d-widget-model-hijiki@1.0.5/assets/hijiki.model.json</span><br><span class="line">//白猫咪：https://unpkg.com/live2d-widget-model-tororo@1.0.5/assets/tororo.model.json</span><br><span class="line">//萌娘：https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json</span><br><span class="line">//狗狗：https://unpkg.com/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json</span><br><span class="line">//萌妹1号：https://unpkg.com/live2d-widget-model-z16@1.0.5/assets/z16.model.json</span><br><span class="line">//萌妹2号：https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json</span><br><span class="line">//萌妹3号：https://unpkg.com/live2d-widget-model-hibiki@1.0.5/assets/hibiki.model.json</span><br><span class="line">//妹子4号：https://unpkg.com/live2d-widget-model-izumi@1.0.5/assets/izumi.model.json</span><br><span class="line">//妹子5号：https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json</span><br><span class="line">//6号：https://unpkg.com/live2d-widget-model-nico@1.0.5/assets/nico.model.json</span><br><span class="line">//7号：https://unpkg.com/live2d-widget-model-ni-j@1.0.5/assets/ni-j.model.json</span><br><span class="line">//8号：https://unpkg.com/live2d-widget-model-nipsilon@1.0.5/assets/nipsilon.model.json</span><br><span class="line">//9号：https://unpkg.com/live2d-widget-model-nito@1.0.5/assets/nito.model.json</span><br><span class="line">//10号：https://unpkg.com/live2d-widget-model-tsumiki@1.0.5/assets/tsumiki.model.json</span><br><span class="line">//11号：https://unpkg.com/live2d-widget-model-unitychan@1.0.5/assets/unitychan.model.json</span><br><span class="line">//帅哥1号：https://unpkg.com/live2d-widget-model-chitose@1.0.5/assets/chitose.model.json</span><br><span class="line">//帅哥2号：https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2、添加可以说话的看板娘，操作如下："><a href="#2、添加可以说话的看板娘，操作如下：" class="headerlink" title="2、添加可以说话的看板娘，操作如下："></a>2、添加可以说话的看板娘，操作如下：</h3><p>参考地址：<a href="https://www.cnblogs.com/Lantxy/p/13112000.html%E3%80%82">https://www.cnblogs.com/Lantxy/p/13112000.html。</a> 感谢🙏博主</p><p>成品：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8bdf0fcd97ff7dbc79a468a55689bbf5.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8bdf0fcd97ff7dbc79a468a55689bbf5.png"></p><p>1）在基本工作的基础上（在管理=》设置页面），找到页面定制CSS代码，将代码添加进去，不禁用模版默认CSS，不然页面的基础结构会乱，当然你可以自己去写/换样式。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_dff8d272ae66a655129e0cefc10d7c8a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_dff8d272ae66a655129e0cefc10d7c8a.png"></p><p>CSS代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">*&#123;</span><br><span class="line"><span class="attribute">transition</span>: all <span class="number">0.4s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#home</span> &#123;</span><br><span class="line"><span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">80%</span>;<span class="comment">/*原始65*/</span></span><br><span class="line"><span class="attribute">min-width</span>: <span class="number">980px</span>;<span class="comment">/*页面顶部的宽度*/</span></span><br><span class="line">&quot;&gt;rgba(<span class="number">245</span>, <span class="number">245</span>, <span class="number">245</span>, <span class="number">0.7</span>);</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">50px</span>;</span><br><span class="line"><span class="attribute">margin-bottom</span>: <span class="number">50px</span>;</span><br><span class="line"><span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;http://ww4.sinaimg.cn/large/637d0877gw1exlma5gj0wj21hc0u04p6.jpg&quot;</span>);</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">12</span>, <span class="number">100</span>, <span class="number">129</span>, <span class="number">1</span>) <span class="built_in">url</span>(<span class="string">&#x27;http://images.cnblogs.com/cnblogs_com/Penn000/1013849/o_123.jpg&#x27;</span>) fixed no-repeat;</span><br><span class="line"><span class="attribute">background-position</span>: <span class="number">50%</span> <span class="number">5%</span>;</span><br><span class="line"><span class="attribute">background-size</span>: cover;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#navList</span> <span class="selector-tag">li</span>&#123;</span><br><span class="line"><span class="attribute">cursor</span>: pointer;</span><br><span class="line"><span class="attribute">transition</span>: all <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#navList</span> <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line"><span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.5</span>) <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line"><span class="attribute">color</span>:<span class="number">#FF0</span>;</span><br><span class="line"><span class="attribute">opacity</span>:<span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#blogTitle</span> &#123;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">100px</span>; <span class="comment">/*高度*/</span></span><br><span class="line"><span class="attribute">clear</span>: both;</span><br><span class="line">&quot;&gt;rgba(<span class="number">245</span>, <span class="number">245</span>, <span class="number">245</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#blogTitle</span> <span class="selector-tag">h1</span> &#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">36px</span>;</span><br><span class="line"><span class="attribute">font-weight</span>: bold;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">1.8em</span>;<span class="comment">/*原始 1.6em*/</span></span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">10px</span>;<span class="comment">/*原始 15px */</span></span><br><span class="line"><span class="attribute">color</span>: <span class="number">#548B54</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#blogTitle</span> <span class="selector-tag">h2</span> &#123;</span><br><span class="line"><span class="attribute">font-weight</span>: normal;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">17px</span>;<span class="comment">/*原始 16px ；font-size: 1.0rem;*/</span></span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">1.8</span>;</span><br><span class="line"><span class="attribute">color</span>: <span class="number">#111</span>;</span><br><span class="line"><span class="attribute">font-weight</span>: bold;</span><br><span class="line"><span class="attribute">text-align</span>: right;</span><br><span class="line"><span class="attribute">float</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#navigator</span>&#123;</span><br><span class="line">&quot;&gt;rgba(<span class="number">33</span>, <span class="number">160</span>, <span class="number">139</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#navList</span> <span class="selector-tag">a</span><span class="selector-pseudo">:link</span>, <span class="selector-id">#navList</span> <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>, <span class="selector-id">#navList</span> <span class="selector-tag">a</span><span class="selector-pseudo">:active</span>&#123;</span><br><span class="line"><span class="attribute">color</span>: <span class="number">#eee</span>;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line"><span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.blogStats</span>&#123;</span><br><span class="line"><span class="attribute">color</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.postTitle</span> &#123;</span><br><span class="line"><span class="attribute">border-left</span>: <span class="number">8px</span> solid <span class="built_in">rgba</span>(<span class="number">33</span>, <span class="number">160</span>, <span class="number">139</span>, <span class="number">0.68</span>);</span><br><span class="line"><span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line"><span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line"><span class="attribute">float</span>: right;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.postTitle</span> <span class="selector-tag">a</span><span class="selector-pseudo">:link</span>, <span class="selector-class">.postTitle</span> <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>, <span class="selector-class">.postTitle</span> <span class="selector-tag">a</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line"><span class="attribute">color</span>: <span class="number">#21759b</span>;</span><br><span class="line"><span class="attribute">transition</span>: all <span class="number">0.4s</span> linear <span class="number">0s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.postTitle</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line"><span class="attribute">margin-left</span>: <span class="number">30px</span>;</span><br><span class="line"><span class="attribute">color</span>: <span class="number">#0f3647</span>;</span><br><span class="line"><span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.postCon</span> &#123;</span><br><span class="line"><span class="attribute">float</span>: right;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">1.5em</span>;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">clear</span>: both;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.day</span> <span class="selector-class">.postTitle</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line"><span class="attribute">padding-left</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.day</span> &#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*文章附加信息*/</span></span><br><span class="line"><span class="selector-class">.postDesc</span> &#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">images/posted_time.png</span>) no-repeat <span class="number">0</span> <span class="number">1px</span>;</span><br><span class="line"><span class="attribute">color</span>: <span class="number">#757575</span>;</span><br><span class="line"><span class="attribute">float</span>: left;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">clear</span>: both;</span><br><span class="line"><span class="attribute">text-align</span>: left;</span><br><span class="line"><span class="attribute">font-family</span>: <span class="string">&quot;微软雅黑&quot;</span> , <span class="string">&quot;宋体&quot;</span> , <span class="string">&quot;黑体&quot;</span> ,Arial;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">13px</span>;</span><br><span class="line"><span class="attribute">padding-right</span>: <span class="number">20px</span>;<span class="comment">/*5px padding-left: 90px;posted 发表时间左边距离*/</span></span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line"><span class="attribute">line-height</span>: <span class="number">1.8</span>;</span><br><span class="line"><span class="attribute">padding-bottom</span>: <span class="number">35px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.newsItem</span>, <span class="selector-class">.catListEssay</span>, <span class="selector-class">.catListLink</span>, <span class="selector-class">.catListNoteBook</span>, <span class="selector-class">.catListTag</span>, <span class="selector-class">.catListPostCategory</span>,</span><br><span class="line"><span class="selector-class">.catListPostArchive</span>, <span class="selector-class">.catListImageCategory</span>, <span class="selector-class">.catListArticleArchive</span>, <span class="selector-class">.catListView</span>,</span><br><span class="line"><span class="selector-class">.catListFeedback</span>, <span class="selector-class">.mySearch</span>, <span class="selector-class">.catListComment</span>, <span class="selector-class">.catListBlogRank</span>, <span class="selector-class">.catList</span>, <span class="selector-class">.catListArticleCategory</span> ,<span class="selector-id">#blog-calendar</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>);</span><br><span class="line"><span class="attribute">margin-bottom</span>: <span class="number">35px</span>;</span><br><span class="line"><span class="attribute">word-wrap</span>: break-word;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.CalTitle</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.catListTitle</span>&#123;</span><br><span class="line">&quot;&gt;rgba(<span class="number">33</span>, <span class="number">160</span>, <span class="number">139</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#topics</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.c_ad_block</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#tbCommentBody</span>&#123;</span><br><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#q</span>&#123;<span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.CalNextPrev</span>&#123;<span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>);&#125;</span><br></pre></td></tr></table></figure><p>2）在博客侧边栏加入，下面代码</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_1870159a9879f476f71cf451334326e8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_1870159a9879f476f71cf451334326e8.png"></p><p>⚠️：将代码中的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/waifu.css&quot;</span>/&gt;</span><br><span class="line">&lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/flat-ui.min.css&quot;</span>/&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/live2d.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/waifu-tips.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>换成自己的链接地址，步骤如下</p><p>i、参考下面地址下载需要上传的文件</p><p>⚠️：<a href="https://www.cnblogs.com/Lantxy/p/13112000.html%EF%BC%8C%E5%80%9F%E7%94%A8%E5%8D%9A%E4%B8%BB%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%84%9F%E8%B0%A2%F0%9F%99%8F">https://www.cnblogs.com/Lantxy/p/13112000.html，借用博主的下载地址，感谢🙏</a></p><p>ii、将4个文件下载好，在博客园的文件中上传，点击进去，复制上面地址替换相应位置</p><p>点击文件：</p><p>选择文件上传，成功后便有下面四个文件，点击上传后的文件</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_99426f652dfc59f2251960920fe4fa99.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_99426f652dfc59f2251960920fe4fa99.png"></p><p>在跳转的页面，拿到自己的链接地址，替换相应的地方，四个文件步骤一样</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_1fc3cac4eea4ea295052a0b2c54d42fa.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_1fc3cac4eea4ea295052a0b2c54d42fa.png"></p><p>添加代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Live2D 看板娘 v1.2 / Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/waifu.css&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/flat-ui.min.css&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;h2&gt;&lt;a href=&quot;https://www.fghrsh.net/post/123.html&quot; style=&quot;color: #38A3DB&quot;&gt;Live2D 看板娘 v1.2&lt;/a&gt; / Demo&lt;/h2&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;touxiangdiv&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;touxiang&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://pic.cnblogs.com/avatar/2063441/20200611132410.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;waifu&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;waifu-tips&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;live2d&quot;</span> <span class="attr">width</span>=<span class="string">&quot;280&quot;</span> <span class="attr">height</span>=<span class="string">&quot;250&quot;</span> <span class="attr">class</span>=<span class="string">&quot;live2d&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;waifu-tool&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fui-chat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fui-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fui-cross&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/live2d.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/waifu-tips.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"><span class="title function_">initModel</span>(<span class="string">&quot;assets/&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-id">#touxiang</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">width</span>:auto;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://blog-static.cnblogs.com/files/eve-d/flat-ui.min.css&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>先存问题，这个资源的链接地址出了的点问题导致，页面的看板娘没加载出来</p><p>3、高级版todo。。。</p><link rel="stylesheet" type="text/css" href="https://blog-static.cnblogs.com/files/eve-d/waifu.css"><link rel="stylesheet" type="text/css" href="https://blog-static.cnblogs.com/files/eve-d/flat-ui.min.css"><link rel="stylesheet" type="text/css" href="https://blog-static.cnblogs.com/files/eve-d/flat-ui.min.css"><link rel="stylesheet" type="text/css" href="https://blog-static.cnblogs.com/files/eve-d/waifu.css">]]></content>
      
      
      <categories>
          
          <category> Live2D </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Live2D </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux宿主机配置定时任务在docker容器中不执行问题</title>
      <link href="/2024/05/19/linux%E5%AE%BF%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%9C%A8docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E4%B8%8D%E6%89%A7%E8%A1%8C%E9%97%AE%E9%A2%98/"/>
      <url>/2024/05/19/linux%E5%AE%BF%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%9C%A8docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E4%B8%8D%E6%89%A7%E8%A1%8C%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="linux宿主机配置定时任务在docker容器中不执行问题"><a href="#linux宿主机配置定时任务在docker容器中不执行问题" class="headerlink" title="linux宿主机配置定时任务在docker容器中不执行问题"></a>linux宿主机配置定时任务在docker容器中不执行问题</h2><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>去掉交互式执行-it选择 可执行文件docker编写为路径即<code>/usr/bin/docker</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10 * * * * /opt/maxkb/cp_logo_create_app_maxkb.sh </span><br><span class="line">0 9 * * * /usr/bin/docker <span class="built_in">exec</span> webstack_mysql bash /home/mysqlbak/webstack-dbbak.sh</span><br><span class="line">0 10 * * * /usr/bin/docker <span class="built_in">exec</span> confluse_mysql bash /home/db_bak_sh/confluence_dbbak.sh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>confluence管理员密码失效重置密码</title>
      <link href="/2024/05/16/confluence%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E5%A4%B1%E6%95%88%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81/"/>
      <url>/2024/05/16/confluence%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E5%A4%B1%E6%95%88%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="confluence管理员密码失效重置密码"><a href="#confluence管理员密码失效重置密码" class="headerlink" title="confluence管理员密码失效重置密码"></a>confluence管理员密码失效重置密码</h1><p><strong>wiki 重置 admin 用户密码</strong></p><p>在 /var/atlassian/application-data/confluence/confluence.cfg.xml 文件中查看 mysql  root 用户的密码</p><p>重置 wiki admin 用户密码</p><p>mysql&gt; use confluence</p><p>获取 admin 用户 id：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> u.id, u.user_name, u.active <span class="keyword">from</span> cwd_user u</span><br><span class="line"><span class="keyword">join</span> cwd_membership m <span class="keyword">on</span> u.id<span class="operator">=</span>m.child_user_id <span class="keyword">join</span> cwd_group g <span class="keyword">on</span> m.parent_id<span class="operator">=</span>g.id <span class="keyword">join</span> cwd_directory d <span class="keyword">on</span> d.id<span class="operator">=</span>g.directory_id</span><br><span class="line"><span class="keyword">where</span> g.group_name <span class="operator">=</span> <span class="string">&#x27;confluence-administrators&#x27;</span> <span class="keyword">and</span> d.directory_name<span class="operator">=</span><span class="string">&#x27;Confluence Internal Directory&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将 admin 用户密码重置为 admin</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> cwd_user <span class="keyword">set</span> credential <span class="operator">=</span></span><br><span class="line"><span class="string">&#x27;x61Ey612Kl2gpFL56FT9weDnpSo4AV8j8+qx2AuTHdRyY036xxzTTrw10Wq3+4qQyB+XURPWx1ONxp3Y3pB37A==&#x27;</span></span><br><span class="line"><span class="keyword">where</span> id<span class="operator">=</span>xxxxxx;</span><br></pre></td></tr></table></figure><p>注意此处xxxxxx 为上一步的 id</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>部署ollama本地大模型并对接maxkb使用</title>
      <link href="/2024/05/15/%E9%83%A8%E7%BD%B2ollama%E6%9C%AC%E5%9C%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B9%B6%E5%AF%B9%E6%8E%A5maxkb%E4%BD%BF%E7%94%A8/"/>
      <url>/2024/05/15/%E9%83%A8%E7%BD%B2ollama%E6%9C%AC%E5%9C%B0%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B9%B6%E5%AF%B9%E6%8E%A5maxkb%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="部署ollama本地大模型并对接maxkb使用"><a href="#部署ollama本地大模型并对接maxkb使用" class="headerlink" title="部署ollama本地大模型并对接maxkb使用"></a>部署ollama本地大模型并对接maxkb使用</h1><blockquote><p>github托管地址：</p><p><a href="https://github.com/ollama/ollama">ollama/ollama: Get up and running with Llama 3, Mistral, Gemma, and other large language models. (github.com)</a></p><p>模型官网：</p><p><a href="https://ollama.com/library/llama3">https://ollama.com/library/llama3</a></p><p>qwen模型下载地址：</p><p><a href="https://huggingface.co/Qwen/Qwen1.5-0.5B-Chat-GGUF/tree/main">https://huggingface.co/Qwen/Qwen1.5-0.5B-Chat-GGUF/tree/main</a></p><p>liama2下载：<a href="https://llama-2.ai/download/">https://llama-2.ai/download/</a></p><p>liama3下载：<a href="https://llama.meta.com/llama-downloads/">Download Llama (meta.com)</a></p><p><strong>Llama3-8B-Instruct模型下载地址：</strong></p><p>魔搭社区（境内）：<a href="https://caovan.com/go?_=48ce46a27aaHR0cHM6Ly9tb2RlbHNjb3BlLmNuL21vZGVscy9MTE0tUmVzZWFyY2gvTWV0YS1MbGFtYS0zLThCLUluc3RydWN0L2ZpbGVz">https://modelscope.cn/models/LLM-Research/Meta-Llama-3-8B-Instruct/files</a></p><p>huggingface（境外）：<a href="https://caovan.com/go?_=72db84b679aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9tZXRhLWxsYW1hL01ldGEtTGxhbWEtMy04Qi1JbnN0cnVjdC90cmVlL21haW4=">https://huggingface.co/meta-llama/Meta-Llama-3-8B-Instruct/tree/main</a></p><p><a href="https://caovan.com/tag/603" title="LLaMA-Factory">LLaMA-Factory</a>项目地址：<a href="https://caovan.com/go?_=8c0f2d3483aHR0cHM6Ly9naXRodWIuY29tL2hpeW91Z2EvTExhTUEtRmFjdG9yeQ==">https://github.com/hiyouga/LLaMA-Factory</a></p><p>llama2中文模型参数详情：<a href="https://ollama.com/library/llama2-chinese:7b">llama2-chinese:7b (ollama.com)</a></p><p><strong>Llama3模型中文微调版下载地址（链接中有下载地址）</strong></p><p><a href="https://github.com/GEGEWU-CLOUD/Llama-Chinese">https://github.com/GEGEWU-CLOUD/Llama-Chinese</a></p><p>Llama 3的亮点和特性如下：</p><p>基于超过15T token训练，大小相当于Llama 2数据集的7倍还多；<br>训练效率比Llama 2高3倍；<br>支持8K长文本，改进的tokenizer具有128K token的词汇量，可实现更好的性能；<br>在大量重要基准测试中均具有最先进性能；<br>增强推理和代码能力；<br>安全性有重大突破，带有Llama Guard 2、Code Shield 和 CyberSec Eval 2的新版信任和安全工具，还能比Llama 2有更好“错误拒绝表现”。</p><p><strong>Ollama是什么?</strong><br>Olama是一个先进的AI工具，它允许用户在自己的电脑上(目前支持macOs和Linux，Windows即将推出)轻松设置和运行大型语言模型(LLMs)。这个工具的亮点在于，它不仅支持运行如Lama 2这样的强大语言模型，还允许用户自定义和创建自己的模型。</p><p>Meta发布了Llama 3模型可使用ollama部署，官方介绍文档<a href="https://link.zhihu.com/?target=https://ai.meta.com/blog/meta-llama-3/">在这</a>。总结一下重点内容：</p><ol><li><p>本次共发布了Llama 8B, 70B的模型，70B性能超越GPT3.5；</p></li><li><p>预告了正在训练中的400B+模型，性能追赶GPT4；</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_767b2d80d661dabc0a5cdffbfcceaf69.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_767b2d80d661dabc0a5cdffbfcceaf69.png"></p><p>参考文档：<a href="https://zhuanlan.zhihu.com/p/693709600">Llama 3 使用方法以及模型下载教程 - 知乎 (zhihu.com)</a></p></li></ol><p><strong>clone/下载github源码</strong></p><p>在meta公布的github网页(<a href="https://link.zhihu.com/?target=https://github.com/meta-llama/llama3">https://<strong>github.com/meta-llama/l</strong>lama3</a>)中，clone或者下载好源代码。</p><p><strong>关于域名无效的解决方案</strong></p><p><a href="https://bbs.fit2cloud.com/t/topic/4165/4">MaxKB 对接Ollama模型时，提示 API 域名不可用 - MaxKB - 社区论坛 - FIT2CLOUD 飞致云</a></p><p><strong>Ollama主要功能</strong></p><ul><li>本地语言模型执行:Ollama使用户能够在本地运行大型语言模型，提供更快、更高效的处理能力。</li><li>Llama 2模型:用户可以利用Lama 2语言模型，该模型提供先进的自然语言处理能力，适用于广泛的应用场景</li><li>模型定制:Ollama允许用户根据特定任务和需求定制和创建自己的语言型。</li><li>易于设置:该工具提供用户友好的界面，使用户能够快速启动并运行所选语言模型。</li><li>平台兼容性:目前Ollama支持macOS，确保与macOS系统的无缝集成。</li></ul><p><strong>支持的模型</strong></p><table><thead><tr><th>Model</th><th>Parameters</th><th>Size</th><th>Download</th></tr></thead><tbody><tr><td>Llama 3</td><td>8B</td><td>4.7GB</td><td><code>ollama run llama3</code></td></tr><tr><td>Llama 3</td><td>70B</td><td>40GB</td><td><code>ollama run llama3:70b</code></td></tr><tr><td>Phi-3</td><td>3.8B</td><td>2.3GB</td><td><code>ollama run phi3</code></td></tr><tr><td>Mistral</td><td>7B</td><td>4.1GB</td><td><code>ollama run mistral</code></td></tr><tr><td>Neural Chat</td><td>7B</td><td>4.1GB</td><td><code>ollama run neural-chat</code></td></tr><tr><td>Starling</td><td>7B</td><td>4.1GB</td><td><code>ollama run starling-lm</code></td></tr><tr><td>Code Llama</td><td>7B</td><td>3.8GB</td><td><code>ollama run codellama</code></td></tr><tr><td>Llama 2 Uncensored</td><td>7B</td><td>3.8GB</td><td><code>ollama run llama2-uncensored</code></td></tr><tr><td>LLaVA</td><td>7B</td><td>4.5GB</td><td><code>ollama run llava</code></td></tr><tr><td>Gemma</td><td>2B</td><td>1.4GB</td><td><code>ollama run gemma:2b</code></td></tr><tr><td>Gemma</td><td>7B</td><td>4.8GB</td><td><code>ollama run gemma:7b</code></td></tr><tr><td>Solar</td><td>10.7B</td><td>6.1GB</td><td><code>ollama run solar</code></td></tr></tbody></table></blockquote><h2 id="一-部署"><a href="#一-部署" class="headerlink" title="一. 部署"></a>一. 部署</h2><p>镜像可选</p><p>ollama/ollama</p><p>registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:ollama</p><p>registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:ollama0.2.5</p><h3 id="CPU版本部署"><a href="#CPU版本部署" class="headerlink" title="CPU版本部署"></a>CPU版本部署</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cpu模式</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">ollama:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:ollama</span></span><br><span class="line">    <span class="comment">#ollama/ollama</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ollama</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./ollama:/root/.ollama</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;11434:11434&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">open-webui:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:open-webui-main</span> </span><br><span class="line">    <span class="comment">#ghcr.io/open-webui/open-webui:main</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">open-webui</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:8080&quot;</span></span><br><span class="line">    <span class="attr">extra_hosts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;host.docker.internal:host-gateway&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">open-webui:/app/backend/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">open-webui:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="GPU版本部署"><a href="#GPU版本部署" class="headerlink" title="GPU版本部署"></a>GPU版本部署</h3><h3 id="GPU模式（需要有NVIDIA显卡支持）"><a href="#GPU模式（需要有NVIDIA显卡支持）" class="headerlink" title="GPU模式（需要有NVIDIA显卡支持）"></a>GPU模式（需要有NVIDIA显卡支持）</h3><h4 id="安装英伟达容器工具包（以Ubuntu22-04为例）"><a href="#安装英伟达容器工具包（以Ubuntu22-04为例）" class="headerlink" title="安装英伟达容器工具包（以Ubuntu22.04为例）"></a>安装<a href="https://so.csdn.net/so/search?q=%E8%8B%B1%E4%BC%9F%E8%BE%BE&spm=1001.2101.3001.7020">英伟达</a>容器工具包（以Ubuntu22.04为例）</h4><p>其他系统请参考：<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/arch-overview.html">英伟达官方文档</a></p><p>参考博主另一篇博客：<a href="http://sunlight.zznnwn.cloudns.biz/2024/07/15/ubuntu%E9%83%A8%E7%BD%B2nvidia-container-toolkit/">GPU模式先决条件</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.配置apt源</span></span><br><span class="line">curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \</span><br><span class="line">  &amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \</span><br><span class="line">    sed <span class="string">&#x27;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#x27;</span> | \</span><br><span class="line">    sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/nvidia-container-toolkit.list</span><br><span class="line"><span class="comment"># 2.更新源</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"><span class="comment"># 3.安装工具包</span></span><br><span class="line">sudo apt-get install -y nvidia-container-toolkit</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>部署</strong></p><p>参考：<a href="https://bian.blog/2024/06/4697.html">https://bian.blog/2024/06/4697.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --gpus all -d -v /opt/ai/ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">ollama:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:ollama0.2.5</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ollama</span></span><br><span class="line">    <span class="attr">runtime:</span> <span class="string">nvidia</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">devices:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">driver:</span> <span class="string">nvidia</span></span><br><span class="line">            <span class="attr">capabilities:</span> [<span class="string">&quot;gpu&quot;</span>]</span><br><span class="line">            <span class="attr">count:</span> <span class="string">all</span>  <span class="comment"># 根据需要调整 GPU 的数量  </span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./ollama:/root/.ollama</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;11434:11434&quot;</span></span><br></pre></td></tr></table></figure><p>理解配置</p><blockquote><p>现在，让我们探讨一下 docker-compose.yml 文件的关键组件，该文件可以使用 GPU 加速运行 Ollama：</p><p>Docker Compose 版本：<br>version 属性指定了使用的 Docker Compose 版本。虽然有些人可能会提到 3.9，但推荐使用官方文档中提到的版本，目前是 3.8。这样可以确保兼容性和稳定性。</p><p>Ollama 服务定义：<br>services 部分定义了 ollama 服务，它封装了 Ollama 容器。以下是其重要属性的分解：</p><p>image：指定 Ollama 的 Docker 镜像。默认是 ollama/ollama，但如果需要，可以使用特定版本（请参阅 Ollama 的文档以获取可用版本）。<br>deploy：该部分配置了 Ollama 容器的资源保留，这是利用 GPU 的关键。<br>resources：定义容器的资源需求。<br>reservations：该嵌套属性允许您为容器保留特定设备。<br>devices：定义设备保留。在此嵌套配置中，我们指定：<br>driver：将设备驱动程序设置为 nvidia，表示我们请求使用 Nvidia GPU。<br>capabilities：列出 Ollama 请求的功能。在本例中，我们指定 “gpu” 以表示我们希望利用 GPU 进行处理。<br>count：该值确定要为 Ollama 保留多少个 Nvidia GPU。使用 all 来利用所有可用的 GPU，或者如果有多个 GPU 并希望为 Ollama 专门分配一部分，可以指定一个具体的数量。<br>持久化卷定义：<br>volumes 部分定义了一个名为 ollama 的持久化卷。此卷确保 Ollama 生成的任何数据（如训练模型或配置）在容器重启后仍然存在。它被挂载在 Ollama 容器内的 /root/.ollama 目录。</p></blockquote><p><strong>部署完成后载入大模型(CPU GPU相同)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生效上传的模型文件</span></span><br><span class="line">docker-compose restart</span><br><span class="line"><span class="comment"># 启动qwen:4b模型</span></span><br><span class="line">docker <span class="built_in">exec</span> -it ollama ollama run qwen:4b-chat</span><br></pre></td></tr></table></figure><p>备注：开启代理在本机下载完成之后 会在当前目录ollama文件夹 生成一个models的文件夹模型文件就存于其中 只需要将此文件夹压缩上传到服务器后 再次执行此项命令服务器上模型即可部署完成 <strong>上传后需要重启容器docker-compose restart再执行run即可</strong>。</p><p>建议：最好将整个项目文件包含docker-compose文件上传到服务器执行相应操作UP ollama create等。</p><p>llama3:8b效果：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_a21d90e141ec4f1cce9354171386e840.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_a21d90e141ec4f1cce9354171386e840.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_d4f9773272728a7238a432b06356f0ce.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_d4f9773272728a7238a432b06356f0ce.png"></p><p>注意：使用pve创建的<strong>虚拟机直通GPU</strong> 需要将<strong>cpu模式设置为host</strong>（默认为qemu模式） <strong>否则会报错cpu不支持avx指令集导致GPU被禁用</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama  | time=2024-07-23T02:15:07.485Z level=WARN <span class="built_in">source</span>=gpu.go:225 msg=<span class="string">&quot;CPU does not have minimum vector extensions, GPU inference disabled&quot;</span> required=avx detected=<span class="string">&quot;no vector extensions&quot;</span></span><br></pre></td></tr></table></figure><p>解决：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_20236426c0189f25768346fb91a15c8f.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_20236426c0189f25768346fb91a15c8f.png"></p><p><strong>ollama 成功使用GPU截图</strong>：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_69b91f921449ffe234d7c952ae8412ec.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_69b91f921449ffe234d7c952ae8412ec.png"></p><h2 id="二-Ollama-中-离线部署-qwen-0-5b-模型为例。"><a href="#二-Ollama-中-离线部署-qwen-0-5b-模型为例。" class="headerlink" title="二. Ollama 中 离线部署 qwen:0.5b 模型为例。"></a>二. Ollama 中 <strong>离线部署</strong> qwen:0.5b 模型为例。</h2><p><strong>1. 下载模型</strong></p><p>访问 huggingface 下载 qwen1_5-0_5b-chat-q5_k_m.gguf 模型。</p><p><a href="https://huggingface.co/Qwen/Qwen1.5-0.5B-Chat-GGUF/tree/main">https://huggingface.co/Qwen/Qwen1.5-0.5B-Chat-GGUF/tree/main</a></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_f93341707d2e1b6931f22cad2d81db8a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_f93341707d2e1b6931f22cad2d81db8a.png"></p><p><strong>2. 上传 Qwen1.5-0.5B-Chat-GGUF 模型离线文件到 Ollama 所在服务器</strong></p><p><strong>3. 创建Ollama Modelfile</strong></p><p>创建一个名为 Modelfile 的文件，内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM ./qwen1_5-0_5b-chat-q5_k_m.gguf</span><br><span class="line"></span><br><span class="line">TEMPLATE &quot;&quot;&quot;&#123;&#123; if .System &#125;&#125;&lt;|im_start|&gt;system</span><br><span class="line">&#123;&#123; .System &#125;&#125;&lt;|im_end|&gt;&#123;&#123; end &#125;&#125;&lt;|im_start|&gt;user</span><br><span class="line">&#123;&#123; .Prompt &#125;&#125;&lt;|im_end|&gt;</span><br><span class="line">&lt;|im_start|&gt;assistant</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">PARAMETER stop &quot;&lt;|im_start|&gt;&quot;</span><br><span class="line">PARAMETER stop &quot;&lt;|im_end|&gt;&quot;</span><br></pre></td></tr></table></figure><p>说明：不同模型的 Modelfile 内容不同，可参考 Ollama 官网 <a href="https://ollama.com/library/qwen:0.5b">参数设置</a> 。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8bbd7faef16aaea28633b9c3ed3a9415.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8bbd7faef16aaea28633b9c3ed3a9415.png"></p><p><strong>4. 在Ollama中创建模型</strong></p><p>执行以下命令，创建模型：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama create qwen:0.5b -f Modelfile</span><br></pre></td></tr></table></figure><p>执行以下命令，确认模型存在：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama list</span><br></pre></td></tr></table></figure><p><strong>5. 在 MaxKB中 添加 Ollama 模型 对接上面创建的 qwen:0.5b 模型</strong></p><p><strong>效果</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_021ed55c6e8335c07278795effa9572b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_021ed55c6e8335c07278795effa9572b.png"></p><h2 id="三-对接官方web面板open-webui-main"><a href="#三-对接官方web面板open-webui-main" class="headerlink" title="三. 对接官方web面板open-webui-main"></a>三. 对接官方web面板open-webui-main</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_e98184a52ba387311de9a9d1f3759c29.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_e98184a52ba387311de9a9d1f3759c29.png"></p><h2 id="四-对接MaxKB"><a href="#四-对接MaxKB" class="headerlink" title="四. 对接MaxKB"></a>四. 对接MaxKB</h2><p>见链接：<a href="https://blog.fit2cloud.com/?p=3fc407b2-1962-4196-b5b8-c7d27684b446">https://blog.fit2cloud.com/?p=3fc407b2-1962-4196-b5b8-c7d27684b446</a></p><p>备注：api-key没有可随便输即可</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_9523bdac22c80d831c4daf934b10cdf3.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_9523bdac22c80d831c4daf934b10cdf3.png"></p><p>本文参考：</p><p><a href="https://blog.csdn.net/qq_38593436/article/details/136407171">https://blog.csdn.net/qq_38593436/article/details/136407171</a></p><p><a href="https://blog.csdn.net/weixin_43012017/article/details/138253446">https://blog.csdn.net/weixin_43012017/article/details/138253446</a></p><p><a href="https://blog.fit2cloud.com/?p=3fc407b2-1962-4196-b5b8-c7d27684b446">https://blog.fit2cloud.com/?p=3fc407b2-1962-4196-b5b8-c7d27684b446</a></p><p><a href="https://github.com/1Panel-dev/MaxKB/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Ollama%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2LLM%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B">如何使用Ollama离线部署LLM大语言模型 · 1Panel-dev/MaxKB Wiki (github.com)</a></p><p><a href="https://wiki.eryajf.net/pages/97047e/#%E6%A8%A1%E5%9E%8B%E7%AE%A1%E7%90%86">带你认识本地大语言模型框架Ollama(可直接上手) | 二丫讲梵 (eryajf.net)</a></p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos配置vlan</title>
      <link href="/2024/05/14/centos%E9%85%8D%E7%BD%AEvlan/"/>
      <url>/2024/05/14/centos%E9%85%8D%E7%BD%AEvlan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="centos配置vlan"><a href="#centos配置vlan" class="headerlink" title="centos配置vlan"></a>centos配置vlan</h1><h2 id="一-网上大佬方式（测试未通过）"><a href="#一-网上大佬方式（测试未通过）" class="headerlink" title="一. 网上大佬方式（测试未通过）"></a>一. 网上大佬方式（测试未通过）</h2><ol><li>安装依赖包</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install vconfig -y</span><br></pre></td></tr></table></figure><ol start="2"><li>查看核心是否提供VLAN 功能</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep -i 802</span><br><span class="line"> </span><br><span class="line">[root@c159 network-scripts]<span class="comment"># dmesg |grep -i 802</span></span><br><span class="line">[    0.318021] pci 0000:00:16.5: [15ad:07a0] <span class="built_in">type</span> 01 class 0x060400</span><br><span class="line">[    0.398023] pci 0000:00:16.2:   bridge window [mem 0xeb100000-0xeb1fffff 64bit pref]</span><br><span class="line">[    1.120802] Key <span class="built_in">type</span> trusted registered</span><br><span class="line">[12888.091996] 8021q: 802.1Q VLAN Support v1.8</span><br><span class="line">[12888.092019] 8021q: adding VLAN 0 to HW filter on device ens192</span><br><span class="line">[12888.092511] 8021q: adding VLAN 0 to HW filter on device ens224</span><br></pre></td></tr></table></figure><ol start="3"><li>查看<code>/proc/net/vlan</code>目录是否存在，如果不存在，使用<code>modprobe</code>模命令进入<code>802.1q.o</code>，且使用<code>lsmod</code>命令模是否已入核心</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">modprobe 8021q</span><br><span class="line"> </span><br><span class="line">[root@c159 network-scripts]<span class="comment"># lsmod |grep 802</span></span><br><span class="line">8021q                  33159  0</span><br><span class="line">garp                   14384  1 8021q</span><br><span class="line">mrp                    18542  1 8021q</span><br></pre></td></tr></table></figure><ol start="4"><li>使用vconfig命令增加子接口:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vconfig add ens224 60</span><br></pre></td></tr></table></figure><ol start="5"><li>利用<code>ls /proc/net/vlan</code>查看</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@c159 network-scripts]<span class="comment"># ls /proc/net/vlan/</span></span><br><span class="line">config  ens224.60  ens224.20  ens224.30</span><br></pre></td></tr></table></figure><p><strong>如没有vconfig包则修改配置文件即可（见六以下步骤）</strong></p><ol start="6"><li>修改网卡配置：</li></ol><p>ifcfg-ens224配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts/</span><br><span class="line"><span class="built_in">cp</span> ifcfg-ens224 ifcfg-ens224.60</span><br><span class="line"> </span><br><span class="line">vim ifcfg-ens224</span><br><span class="line"> </span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none  //此项dhcp对vlan端口无影响，如不放心，可改成static</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens224</span><br><span class="line">DEVICE=ens224</span><br><span class="line">ONBOOT=no  //此项<span class="built_in">yes</span>或no，对vlan端口无影响</span><br></pre></td></tr></table></figure><p>对应vlan的配置文件中UUID一定要删掉，不然会出现不可知的问题</p><p>ifcfg-ens224.60配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vim ifcfg-ens224.60</span><br><span class="line">TYPE=vlan        //TYPE类型</span><br><span class="line">PHYSDEV=ens224      //vlan端口对应物理硬件名称</span><br><span class="line">VLAN_ID=60     //VLAN ID</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens224.60</span><br><span class="line">DEVICE=ens224.60</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">VLAN=<span class="built_in">yes</span>              //设置允许vlan</span><br><span class="line">IPADDR=10.0.0.80</span><br><span class="line">NETMASK=255.255.255.0</span><br></pre></td></tr></table></figure><h2 id="二-直接在主网卡修改配置文件方式（推荐）"><a href="#二-直接在主网卡修改配置文件方式（推荐）" class="headerlink" title="二. 直接在主网卡修改配置文件方式（推荐）"></a>二. 直接在主网卡修改配置文件方式（推荐）</h2><table><thead><tr><th>vlan内网10.0.1.段地址vlan id</th><th>vlan60</th><th>vlan60</th></tr></thead><tbody><tr><td><strong>机器名称</strong></td><td>centos1</td><td>centos2</td></tr><tr><td><strong>vlan内网地址</strong><br><br></td><td>10.0.1.60</td><td>10.0.1.61</td></tr><tr><td><strong>外网地址</strong></td><td>10.0.0.10</td><td>10.0.0.128<br></td></tr></tbody></table><blockquote><p>本次环境使用 vmware 模拟</p><p>一台centos7 一台centos8</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_d1ed2ec5c1b9dfd1d195e5b96d71c0f3.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_d1ed2ec5c1b9dfd1d195e5b96d71c0f3.png"></p><p><code>GATEWAY</code> 此参数根据情况考虑是否添加</p><p>如：双网卡不同IP情况 只允许有一个默认网关 如果另一张网卡需要配置外网IP 那么只允许规定外网IP的网卡配置外网网关</p><p><code>VLAN_NAME_TYPE=VLAN_PLUS_VID_NO_PAD</code> 是网络配置文件中的一个选项，它指定了 VLAN 标签的格式。</p><ul><li><code>VLAN_PLUS_VID_NO_PAD</code> 表示 VLAN 标签以 “VLAN” 开头，后跟 VLAN ID，例如 “VLAN80”。</li><li><code>NO_PAD</code> 表示 VLAN ID 不会在前面填充零。例如，VLAN ID 80 表示为 “VLAN80” 而不是 “VLAN080”。</li></ul><p>因此，<code>VLAN_NAME_TYPE=VLAN_PLUS_VID_NO_PAD</code> 的意思是，使用 “VLAN” 加上 VLAN ID 的格式，并且不在 VLAN ID 前面填充零。</p></blockquote><p><strong>网卡配置其实只需要在下方添加此配置即可</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">IPADDR=10.0.1.61</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=10.0.1.220</span><br><span class="line">DNS1=114.114.114.114</span><br><span class="line">DNS2=8.8.8.8</span><br><span class="line">DNS3=223.5.5.5</span><br><span class="line">VLAN=<span class="built_in">yes</span></span><br><span class="line">VLAN_NAME_TYPE=VLAN_PLUS_VID_NO_PAD</span><br><span class="line">VLAN_ID=80</span><br></pre></td></tr></table></figure><p><strong>centos8修改网卡配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=eui64</span><br><span class="line">NAME=ens224</span><br><span class="line">DEVICE=ens224</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">IPADDR=10.0.1.61</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=10.0.1.220</span><br><span class="line">DNS1=114.114.114.114</span><br><span class="line">DNS2=8.8.8.8</span><br><span class="line">DNS3=223.5.5.5</span><br><span class="line">VLAN=<span class="built_in">yes</span></span><br><span class="line">VLAN_NAME_TYPE=VLAN_PLUS_VID_NO_PAD</span><br><span class="line">VLAN_ID=60</span><br></pre></td></tr></table></figure><p><strong>centos7配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">TYPE=<span class="string">&quot;Ethernet&quot;</span></span><br><span class="line">PROXY_METHOD=<span class="string">&quot;none&quot;</span></span><br><span class="line">BROWSER_ONLY=<span class="string">&quot;no&quot;</span></span><br><span class="line">BOOTPROTO=<span class="string">&quot;static&quot;</span></span><br><span class="line">DEFROUTE=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV4_FAILURE_FATAL=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6INIT=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_AUTOCONF=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_DEFROUTE=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_FAILURE_FATAL=<span class="string">&quot;no&quot;</span></span><br><span class="line">IPV6_ADDR_GEN_MODE=<span class="string">&quot;stable-privacy&quot;</span></span><br><span class="line">IPV6_PRIVACY=<span class="string">&quot;no&quot;</span></span><br><span class="line">NAME=<span class="string">&quot;ens35&quot;</span></span><br><span class="line">DEVICE=<span class="string">&quot;ens35&quot;</span></span><br><span class="line">ONBOOT=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPADDR=<span class="string">&quot;10.0.1.60&quot;</span></span><br><span class="line">PREFIX=<span class="string">&quot;24&quot;</span></span><br><span class="line">GATEWAY=<span class="string">&quot;10.0.1.220&quot;</span></span><br><span class="line">DNS1=<span class="string">&quot;114.114.114.114&quot;</span></span><br><span class="line">DNS2=<span class="string">&quot;8.8.8.8&quot;</span></span><br><span class="line">DNS3=<span class="string">&quot;223.5.5.5&quot;</span></span><br><span class="line">VLAN=<span class="built_in">yes</span></span><br><span class="line">VLAN_NAME_TYPE=VLAN_PLUS_VID_NO_PAD</span><br><span class="line">VLAN_ID=60</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>验证：</p><p>相互ping看内网是否互通</p><ul><li><p>物理服务器验证<br>网卡变为绿色</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_2bfbac8a58848ceb401fa888e341bd45.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_2bfbac8a58848ceb401fa888e341bd45.png"></p><p>交换机对应服务器的端口灯亮</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_f5809244b4f7e86f58c42d319e515b3e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/6/image_f5809244b4f7e86f58c42d319e515b3e.png"></p></li><li><p>down掉centos7 ens33网卡 在vmware控制台ping centos8 vlan60网卡ens35 ping 10.0.1.61  (成功)</p></li><li><p>并且此时ping不通centos7 10.0.0.10 说明内外网隔离环境测试成功</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_46d9d81ccd08ad64cb09535dc5f30812.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_46d9d81ccd08ad64cb09535dc5f30812.png"></p></li><li><p>将centos2机器vlan修改为其他段如vlan80后使用此机器 ping centos1 vlan60 10.0.1.60看能否ping通</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_1367c682fbe66fce000e3afced063d48.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_1367c682fbe66fce000e3afced063d48.png"></p><p>此时两台机器互相无法ping通 <img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_f9f2dc184abb2dd3b0f6ede28a0e7830.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_f9f2dc184abb2dd3b0f6ede28a0e7830.png"></p></li></ul><p>成功！</p><p>本文参考：</p><p><a href="https://blog.csdn.net/zhongbeida_xue/article/details/95355111">https://blog.csdn.net/zhongbeida_xue/article/details/95355111</a></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos8使用network管理网络</title>
      <link href="/2024/05/14/Centos8%E4%BD%BF%E7%94%A8network%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C/"/>
      <url>/2024/05/14/Centos8%E4%BD%BF%E7%94%A8network%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Centos8使用network管理网络"><a href="#Centos8使用network管理网络" class="headerlink" title="Centos8使用network管理网络"></a>Centos8使用network管理网络</h1><p>前言：</p><p>在CentOS8中，我们常用的network.service服务就被NetworkManager.service服务代替了，同样的，IP的配置方法也发生了改变，那么如果想使用network.service服务去管理/配置系统网络怎么办呢？下面带你梦回network.service</p><h3 id="一、安装network-scripts"><a href="#一、安装network-scripts" class="headerlink" title="一、安装network-scripts"></a>一、安装network-scripts</h3><p>静默安装(-q)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install -y  network-scripts</span><br></pre></td></tr></table></figure><p>安装过程:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># dnf install -y -q network-scripts</span></span><br><span class="line">警告：/var/cache/dnf/BaseOS-929b586ef1f72f69/packages/network-scripts-10.00.6-1.el8_2.1.x86_64.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID 8483c65d: NOKEY</span><br><span class="line">导入 GPG 公钥 0x8483C65D:</span><br><span class="line">Userid: <span class="string">&quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</span></span><br><span class="line">指纹: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line">来自: /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>此时，服务安装完成了，接下来开始启用该服务</p><h3 id="二、启用network"><a href="#二、启用network" class="headerlink" title="二、启用network"></a>二、启用network</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start network</span><br><span class="line">systemctl <span class="built_in">enable</span> network</span><br><span class="line">systemctl status network</span><br></pre></td></tr></table></figure><h3 id="三-禁用NetworkManager-service"><a href="#三-禁用NetworkManager-service" class="headerlink" title="三. 禁用NetworkManager.service"></a>三. 禁用NetworkManager.service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop NetworkManager</span><br><span class="line">systemctl <span class="built_in">disable</span> NetworkManager</span><br><span class="line">执行结果：</span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl stop NetworkManager</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl disable NetworkManager</span></span><br><span class="line">Removed /etc/systemd/system/multi-user.target.wants/NetworkManager.service.</span><br><span class="line">Removed /etc/systemd/system/dbus-org.freedesktop.nm-dispatcher.service.</span><br><span class="line">Removed /etc/systemd/system/network-online.target.wants/NetworkManager-wait-online.service.</span><br></pre></td></tr></table></figure><p>到这里，NetworkManager服务就停止工作了，这时候可以先安装network-scripts（也就是network.service)了</p><h3 id="四、卸载NetworkManager（可选-建议保留）"><a href="#四、卸载NetworkManager（可选-建议保留）" class="headerlink" title="四、卸载NetworkManager（可选 建议保留）"></a>四、卸载<code>NetworkManager</code>（可选 建议保留）</h3><p>执行卸载命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf remove -y NetworkManager</span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_a6a352e2ac83bc5373276f96402b5ff4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_a6a352e2ac83bc5373276f96402b5ff4.png"></p><p>本文参考</p><p><a href="https://blog.csdn.net/qq_36154886/article/details/109839926">https://blog.csdn.net/qq_36154886/article/details/109839926</a></p>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> default </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos8使用nmcli配置bond1与vlan组合</title>
      <link href="/2024/05/13/centos8%E4%BD%BF%E7%94%A8nmcli%E9%85%8D%E7%BD%AEbond1%E4%B8%8Evlan%E7%BB%84%E5%90%88/"/>
      <url>/2024/05/13/centos8%E4%BD%BF%E7%94%A8nmcli%E9%85%8D%E7%BD%AEbond1%E4%B8%8Evlan%E7%BB%84%E5%90%88/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="centos8使用nmcli配置bond1与vlan组合-测试未通过"><a href="#centos8使用nmcli配置bond1与vlan组合-测试未通过" class="headerlink" title="centos8使用nmcli配置bond1与vlan组合(测试未通过)"></a>centos8使用nmcli配置bond1与vlan组合(测试未通过)</h2><blockquote><p>本次实验环境使用<strong>workstdtion</strong> 虚拟机交换机 模拟物理设备划分vlan</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_bba0d14b526d9a8ddba1b176cfdfaeb8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_bba0d14b526d9a8ddba1b176cfdfaeb8.png"></p><p>NetworkManager和network.service都是用来管理网络的工具。在CentOS 7版本中，NetworkManager和network.service默认安装时是共存的，但习惯使然我们一般都是禁用掉NetworkManager而仍然使用配置文件+network.service的方式来配置和管理主机上的网络。</p><p>RHEL 8/CentOS 8版本开始network.service默认没有安装，默认只使用NetworkManager作为网络管理工具。而且RedHat官方指出在后续的版本中会彻底不支持network.service，这样一来除了NetworkManager我们也没有选择余地。既然无力反抗，那么就要学会享受。</p><p>其实NetworkManager也有优点，比如使用方式多样化：命令行、文本界面、图形界面、web portal均可支持。nmcli命令行支持tab补齐，使用感受类似配置交换机；nmtui工具可以在shell终端开启文本图形界面。而且Linux主流知发行版，RedHat系、Suse系、Debian/Ubuntu系均支持NetworkManager。</p><p>在nmcli中有2个命令最为常用：</p><p>nmcli connection</p><p>译作连接，可理解为配置文件，相当于ifcfg-ethX。可以简写为nmcli c</p><p>nmcli device</p><p>译作设备，可理解为实际存在的网卡(包括物理网卡和虚拟网卡)。可以简写为nmcli d</p><p>NetworkManager有2个基本的概念：连接(Connection)和设备(Device)。</p><p>Device是操作系统层面能够识别到的网卡设备，如本地回环lo、本地网卡eth0（nmcli d命令可以查看到）。</p><p>Connection可以认为是Device对应的配置文件，也就是说一个Device可以对应多个Connection。同一时间只有一个Connection是处于激活状态的（nmcli c命令输出结果中绿色的行）。</p></blockquote><h3 id="一-配置bond与vlan组合（重启系统便会失效）"><a href="#一-配置bond与vlan组合（重启系统便会失效）" class="headerlink" title="一. 配置bond与vlan组合（重启系统便会失效）"></a>一. 配置bond与vlan组合（重启系统便会失效）</h3><p><strong>拓补图</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_715204becfedcdac807aa604cbd4594e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_715204becfedcdac807aa604cbd4594e.png"></p><p><strong>先决条件</strong></p><p>查看/proc/net/vlan 目录是否存在，如果不存在，使用modprobe模命令进入802.1q.o，且使用lsmod命令模是否已入核心</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载模块</span></span><br><span class="line">modprobe 8021q</span><br><span class="line"> </span><br><span class="line">[root@c159 network-scripts]<span class="comment"># lsmod |grep 802</span></span><br><span class="line">8021q                  33159  0</span><br><span class="line">garp                   14384  1 8021q</span><br><span class="line">mrp                    18542  1 8021q</span><br></pre></td></tr></table></figure><p>很简单只需要几行命令</p><p>参数可选</p><ul><li><code>ipv4.method disabled</code>：这个选项禁用了IPv4地址的自动获取，意味着系统不会尝试获取IPv4地址。</li><li><code>ipv6.method ignore</code>：这个选项告诉系统忽略IPv6地址的配置，系统不会为该接口分配IPv6地址。</li><li>mode 1 即为 mode active-backup</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用NetworkManager配置vlan</span></span><br><span class="line">nmcli con add <span class="built_in">type</span> bond con-name bond0 ifname bond0  mode 1 ipv4.method disabled ipv6.method ignore</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname ens224 master bond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname ens256 master bond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> vlan con-name bond0.80 ifname bond0.80 dev bond0 <span class="built_in">id</span> 80 ipv4.addresses 10.0.0.100/24 ipv4.gateway 10.0.0.220 ipv4.dns 114.114.114.114 </span><br></pre></td></tr></table></figure><p>查看命令生成ifcfg-bond0.80详情 并新增此行（SLAVE=yes）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]<span class="comment"># cat ifcfg-bond0.80</span></span><br><span class="line">VLAN=<span class="built_in">yes</span></span><br><span class="line">TYPE=Vlan</span><br><span class="line">PHYSDEV=bond0</span><br><span class="line">VLAN_ID=80</span><br><span class="line">REORDER_HDR=<span class="built_in">yes</span></span><br><span class="line">GVRP=no</span><br><span class="line">MVRP=no</span><br><span class="line">HWADDR=</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=dhcp</span><br><span class="line">IPADDR=10.0.0.100</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=10.0.0.220</span><br><span class="line">DNS1=114.114.114.114</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=default</span><br><span class="line">NAME=bond0.80</span><br><span class="line">UUID=b96b405e-6a6d-4000-bca3-2fc060c945c2</span><br><span class="line">DEVICE=bond0.80</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">SLAVE=<span class="built_in">yes</span>   <span class="comment">#新增</span></span><br></pre></td></tr></table></figure><h3 id="二-验证"><a href="#二-验证" class="headerlink" title="二. 验证"></a>二. 验证</h3><p>查看bond: <code>cat /proc/net/bonding/bond0</code></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_b43f2d08cd6c439a2de7279ac31d2178.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_b43f2d08cd6c439a2de7279ac31d2178.png"></p><p>本文参考：</p><p><a href="https://www.cnblogs.com/5201351/p/4990187.html">linux-Centos 7下bond与vlan技术的结合 - 520_1351 - 博客园 (cnblogs.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用NetworkManager配置bond 0</span></span><br><span class="line"><span class="comment"># nmcli con add type bond ifname bond0 con-name bond0 mode active-backup</span></span><br><span class="line"><span class="comment"># nmcli con add type bond-slave ifname ens224 master bond0</span></span><br><span class="line"><span class="comment"># nmcli con add type bond-slave ifname ens256 master bond0</span></span><br><span class="line"><span class="comment"># nmcli con modify bond0 ipv4.address 10.0.0.100/24 ipv4.gateway 10.0.0.254 ipv4.dns 114.114.114.114 ipv4.method manual ipv6.method ignore</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用NetworkManager配置vlan</span></span><br><span class="line">nmcli con add <span class="built_in">type</span> bond ifname bond0 con-name bond0 mode active-backup ipv4.method disabled ipv6.method ignore</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname ens224 master bond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname ens256 master bond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> vlan con-name bond0.80 ifname bond0.80 dev bond0 <span class="built_in">id</span> 101 ipv4.addresses 10.0.0.100/24 ipv4.gateway 10.0.0.254 ipv4.dns 114.114.114.114 ipv4.method disabled ipv6.method ignore</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos8使用nmcli配置bond(active-backup)及network管理下配置</title>
      <link href="/2024/05/07/centos8%E4%BD%BF%E7%94%A8nmcli%E9%85%8D%E7%BD%AEbond(active-backup)%E5%8F%8Anetwork%E7%AE%A1%E7%90%86%E4%B8%8B%E9%85%8D%E7%BD%AE/"/>
      <url>/2024/05/07/centos8%E4%BD%BF%E7%94%A8nmcli%E9%85%8D%E7%BD%AEbond(active-backup)%E5%8F%8Anetwork%E7%AE%A1%E7%90%86%E4%B8%8B%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="centos8使用nmcli配置bond-active-backup-及network管理下配置"><a href="#centos8使用nmcli配置bond-active-backup-及network管理下配置" class="headerlink" title="centos8使用nmcli配置bond(active-backup)及network管理下配置"></a>centos8使用nmcli配置bond(active-backup)及network管理下配置</h1><blockquote><p>需要：至少 3 张网卡 （ <strong>一张网卡配置IP用于远程连接 剩余两张网卡 配置bond</strong> ）</p><p>两张网卡是无法实现的</p></blockquote><h2 id="Bonding-聚合链路工作模式"><a href="#Bonding-聚合链路工作模式" class="headerlink" title="Bonding 聚合链路工作模式"></a>Bonding 聚合链路工作模式</h2><p>bond聚合链路模式共有7种模式：0-6 Mode</p><ul><li>mod=0 ，即：(balance-rr) Round-robin policy（轮询）聚合口数据报文按包轮询从物理接口转发。<br>负载均衡—所有链路处于负载均衡状态，轮询方式往每条链路发送报文这模式的特点增加了带宽，同时支持容错能力，当有链路出问题，会把流量切换到正常的链路上。<br>性能问题—一个连接或者会话的数据包如果从不同的接口发出的话，中途再经过不同的链路，在客户端很有可能会出现数据包无序到达的问题，而无序到达的数据包需要重新要求被发送，这样网络的吞吐量就会下降。Bond0在大压力的网络传输下，性能增长的并不是很理想。<br>需要交换机进行端口绑定</li><li>mod=1，即： (active-backup) Active-backup policy（主-备份策略）只有Active状态的物理接口才转发数据报文。<br>容错能力—只有一个slave是激活的(active)。也就是说同一时刻只有一个网卡处于工作状态，其他的slave都处于备份状态，只有在当前激活的slave故障后才有可能会变为激活的(active)。<br>无负载均衡—此算法的优点是可以提供高网络连接的可用性，但是它的资源利用率较低，只有一个接口处于工作状态，在有 N 个网络接口的情况下，资源利用率为1/N。</li><li>mod=2，即：(balance-xor) XOR policy（平衡策略）聚合口数据报文按源目MAC、源目IP、源目端口进行异或HASH运算得到一个值，根据该值查找接口转发数据报文<br>负载均衡—基于指定的传输HASH策略传输数据包。<br>容错能力—这模式的特点增加了带宽，同时支持容错能力，当有链路出问题，会把流量切换到正常的链路上。<br>性能问题—该模式将限定流量，以保证到达特定对端的流量总是从同一个接口上发出。既然目的地是通过MAC地址来决定的，因此该模式在“本地”网络配置下可以工作得很好。如果所有流量是通过单个路由器，由于只有一个网关，源和目标mac都固定了，那么这个算法算出的线路就一直是同一条，那么这种模式就没有多少意义了。<br>需要交换机配置为port channel</li><li>mod=3，即：broadcast（广播策略）这种模式的特点是一个报文会复制两份往bond下的两个接口分别发送出去，<br>当有对端交换机失效，感觉不到任何downtime，但此法过于浪费资源；不过这种模式有很好的容错机制。此模式适用于金融行业，因为他们需要高可靠性的网络，不允许出现任何问题。</li><li>mod=4，即：(802.3ad) IEEE 802.3ad Dynamic link aggregation（IEEE 802.3ad 动态链接聚合）<br>在动态聚合模式下，聚合组内的成员端口上均启用LACP（链路汇聚控制协议）协议，其端口状态通过该协议自动进行维护。<br>负载均衡—基于指定的传输HASH策略传输数据包。默认算法与blance-xor一样。<br>容错能力—这模式的特点增加了带宽，同时支持容错能力，当有链路出问题，会把流量切换到正常的链路上。对比blance-xor，这种模式定期发送LACPDU报文维护链路聚合状态，保证链路质量。需要交换机支持LACP协议</li><li>mod=5，即：(balance-tlb) Adaptive transmit load balancing（适配器传输负载均衡）<br>在每个物理接口上根据当前的负载（根据速度计算）分配外出流量。如果正在接收数据的物理接口口出故障了，另一个物理接口接管该故障物理口的MAC地址。<br>需要ethtool支持获取每个slave的速率</li><li>mod=6，即：(balance-alb) Adaptive load balancing（适配器适应性负载均衡）<br>该模式包含了balance-tlb模式，同时加上针对IPV4流量的接收负载均衡，而且不需要任何switch(交换机)的支持。接收负载均衡是通过ARP协商实现的。bonding驱动截获本机发送的ARP应答，并把源硬件地址改写为bond中某个物理接口的唯一硬件地址，从而使得不同的对端使用不同的硬件地址进行通信。<br>mod=6与mod=0的区别：mod=6，先把eth0流量占满，再占eth1，….ethX；而mod=0的话，会发现2个口的流量都很稳定，基本一样的带宽。而mod=6，会发现第一个口流量很高，第2个口只占了小部分流量</li></ul><h2 id="首先"><a href="#首先" class="headerlink" title="首先"></a>首先</h2><p>链接：</p><p><a href="https://developer.aliyun.com/article/503848">https://developer.aliyun.com/article/503848</a></p><p><a href="https://www.cnblogs.com/5201351/p/4990187.html">https://www.cnblogs.com/5201351/p/4990187.html</a></p><p>先查看一下内核是否已经支持bonding</p><p>1）如果内核已经把bonding编译进内核，那么要做的就是加载该模块到当前内核；其次查看ifenslave该工具是否也已经编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">modprobe  -l   bond\*  或者 modinfo   bonding</span><br><span class="line"><span class="comment"># 加载</span></span><br><span class="line">modprobe --first-time bonding</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">modprobe   bonding </span><br><span class="line">lsmod | grep <span class="string">&#x27;bonding&#x27;</span></span><br><span class="line"><span class="comment"># 设置开机加载</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&#x27;modprobe bonding &amp;&gt; /dev/null&#x27;</span>  &gt;&gt;  /etc/rc.local </span><br><span class="line"><span class="built_in">which</span>  ifenslave</span><br></pre></td></tr></table></figure><p>注意：默认内核安装完后就已经支持bonding模块了，无需要自己手动编译</p><h2 id="概览（需要至少-3-张网卡）"><a href="#概览（需要至少-3-张网卡）" class="headerlink" title="概览（需要至少 3 张网卡）"></a>概览（需要至少 3 张网卡）</h2><blockquote><p>示例命令：</p><p>nmcli connection add type bond ifname bond0 con-name bond0 miimon 100 mode active-backup primary ens33 ipv4.method manual ipv4.addresses 192.168.221.232/24 ipv4.gateway 192.168.221.25</p><p>参数（若没有指定 则需要手动更改配置 bond 网卡文件 ifcfg-bond0 ）：</p><ul><li>ipv4.gateway 192.168.221.25 ： 为可选参数即配置bond的网关</li><li>/24 ：即bond的子网掩码</li><li>ipv4.dns 8.8.8.8：配置bond的dns（可选参数）</li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加bonding接口</span></span><br><span class="line">nmcli con add <span class="built_in">type</span> bond con-name bond0 ifname bond0 mode 1 miimon 100  ipv4.method manual ipv4.addresses 10.0.0.100/24 ipv4.gateway 10.0.0.220 ipv4.dns 223.5.5.5</span><br><span class="line"><span class="comment"># 添加从属接口</span></span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname ens224 master bond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname ens256 master bond0</span><br><span class="line"><span class="comment"># 注：如无为从属接口提供连接名，则该名称是接口名称加类型构成</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 要启动绑定，则必须首先启动从属接口</span></span><br><span class="line">nmcli con up bond-slave-ens224</span><br><span class="line">nmcli con up bond-slave-ens256</span><br><span class="line"><span class="comment"># 启动绑定</span></span><br><span class="line">nmcli con up bond0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除bond</span></span><br><span class="line">nmcli con del bond0</span><br><span class="line"><span class="comment"># 删除绑定的网卡</span></span><br><span class="line">nmcli con del bond-slave-ens160</span><br><span class="line">nmcli con del bond-slave-ens224</span><br></pre></td></tr></table></figure><h2 id="说明-本次使用vmware实验-："><a href="#说明-本次使用vmware实验-：" class="headerlink" title="说明(本次使用vmware实验 )："></a>说明(本次使用vmware实验 )：</h2><blockquote><p>下方保留ens160与ens224 实际为 ens224 与 ens256</p></blockquote><p>常用的模式为 0,1,3,6<br>mode 1、5、6       不需要交换机设置<br>mode 0、2、3、4  需要交换机设置<br>active-backup、balance-tlb 和 balance-alb 模式不需要交换机的任何特殊配置。其他绑定模式需要配置交换机以便整合链接。如：Cisco 交换机需要在模式 0、2 和 3 中使用 EtherChannel，但在模式4中需要 LACP和EtherChannel</p><h2 id="一-nmcli实现Bonding（需要至少-3-张网卡）"><a href="#一-nmcli实现Bonding（需要至少-3-张网卡）" class="headerlink" title="一. nmcli实现Bonding（需要至少 3 张网卡）"></a>一. nmcli实现Bonding（需要至少 3 张网卡）</h2><h3 id="1-两块网卡都设置为-Nat-模式"><a href="#1-两块网卡都设置为-Nat-模式" class="headerlink" title="1. 两块网卡都设置为 Nat 模式"></a>1. 两块网卡都设置为 Nat 模式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:f2:66:78 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    inet 10.0.0.10/27 brd 10.0.0.31 scope global noprefixroute ens160</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::20c:29ff:fef2:6678/64 scope <span class="built_in">link</span> noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: ens224: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master bond0 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:f2:66:82 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp19s0</span><br><span class="line">4: ens256: &lt;BROADCAST,MULTICAST,SLAVE&gt; mtu 1500 qdisc fq_codel master bond0 state DOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:f2:66:82 brd ff:ff:ff:ff:ff:ff permaddr 00:0c:29:f2:66:8c</span><br><span class="line">    altname enp27s0</span><br><span class="line">5: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 52:54:00:d4:a9:b3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><h3 id="2-创建bond0（需要至少-3-张网卡）"><a href="#2-创建bond0（需要至少-3-张网卡）" class="headerlink" title="2. 创建bond0（需要至少 3 张网卡）"></a>2. 创建bond0（需要至少 3 张网卡）</h3><p>参数说明：</p><ul><li>bond0 为bond0的名称</li><li>ifname 指定DEVICE名称</li><li>type 指定bond类型</li><li>mode 指定bond模式</li><li>ipv4.addresses 指定bond0地址</li></ul><p>添加链路聚合 bond 模式，定义 bond0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加链路聚合 bond 模式，定义 bond0</span></span><br><span class="line">nmcli connection add con-name bond0 ifname bond0 <span class="built_in">type</span> bond miimon 100 mode active-backup ipv4.method manual ipv4.addresses 10.0.0.100/24</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_368aa9c5e4593d8aa1812c310f7d5e12.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_368aa9c5e4593d8aa1812c310f7d5e12.png"></p><p>这里演示模式采用 active-backup ，对应主备模式，即 mode=1 如需要的是其他模式只需要更改：active-backup 改为其他比如改为： balance-rr</p><p>修改网口配置文件（自动生成的网卡配置文件中已包含下述部分配置，请仔细核对，确<br>保下述配置内容无遗漏且正确）<br>vim ifcfg-bond0<br>在 /etc/sysconfig/network-scripts/ 目录下，编写 ifcfg-bond0<br>DEVICE=bond0<br>ONBOOT=yes<br>BOOTPROTO=none<br>IPADDR=10.0.0.12<br>NETMASK=24<br>TYPE=Bond<br>BONDING_OPTS=mode=active-backup<br>GATEWAY=10.0.0.220<br>DNS1=223.5.5.5</p><p><strong>查看添加详情</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看添加详情</span></span><br><span class="line">nmcli connection</span><br><span class="line"></span><br><span class="line">// 返回</span><br><span class="line">NAME    UUID                                  TYPE      DEVICE </span><br><span class="line">ens160  ff7bd1f0-e937-42c0-bba2-1b069e9477c7  ethernet  ens160 </span><br><span class="line">bond0   2a465bf9-89ea-4a3b-b6ae-a94dde548b77  bond      bond0  </span><br><span class="line">virbr0  f51041d3-c680-4162-90d8-0da1c1a32fcd  bridge    virbr0 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看生成的网卡配置文件</span></span><br><span class="line"><span class="built_in">ls</span> /etc/sysconfig/network-scripts/</span><br><span class="line"></span><br><span class="line">// 返回</span><br><span class="line">ifcfg-bond0  ifcfg-ens160</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时生成配置文件ifcfg-bond0 查看文件详情</span></span><br><span class="line">[root@localhost network-scripts]<span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-bond0</span></span><br><span class="line">BONDING_OPTS=mode=active-backup</span><br><span class="line">TYPE=Bond</span><br><span class="line">BONDING_MASTER=<span class="built_in">yes</span></span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=10.0.0.10</span><br><span class="line">PREFIX=24</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=default</span><br><span class="line">NAME=bond0</span><br><span class="line">UUID=2a465bf9-89ea-4a3b-b6ae-a94dde548b77</span><br><span class="line">DEVICE=bond0</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">GATEWAY=10.0.0.220  <span class="comment"># 新加</span></span><br><span class="line">DNS1=223.5.5.5      <span class="comment"># 新加</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-添加端口至bond0中"><a href="#3-添加端口至bond0中" class="headerlink" title="3. 添加端口至bond0中"></a>3. 添加端口至bond0中</h2><p>将网卡ens160  和ens224 添加至 bond0 中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add <span class="built_in">type</span> bond-slave ifname ens160 master bond0</span><br><span class="line">nmcli connection add <span class="built_in">type</span> bond-slave ifname ens224 master bond0</span><br><span class="line"><span class="comment"># 注意顺序</span></span><br></pre></td></tr></table></figure><p><strong>查看详情</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看添加详情</span></span><br><span class="line">nmcli con</span><br><span class="line"></span><br><span class="line">// 返回</span><br><span class="line">NAME               UUID                                  TYPE      DEVICE </span><br><span class="line">ens160             ff7bd1f0-e937-42c0-bba2-1b069e9477c7  ethernet  ens160 </span><br><span class="line">bond0              3a11f05c-c92f-4804-be4f-c04506e819d2  bond      bond0  </span><br><span class="line">virbr0             ba243c12-4f52-4b97-bfbd-c1d57dde75a9  bridge    virbr0 </span><br><span class="line">bond-slave-ens224  6ffdb9e4-6e02-4c53-a266-64702b3c5e40  ethernet  ens224 </span><br><span class="line">bond-slave-ens160  034ea11e-1f8c-43e0-b062-90559525284f  ethernet  --  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看生成的网卡配置文件</span></span><br><span class="line"><span class="built_in">ls</span> /etc/sysconfig/network-scripts/</span><br><span class="line"></span><br><span class="line">// 返回</span><br><span class="line">ifcfg-bond0  ifcfg-bond-slave-ens160  ifcfg-bond-slave-ens224  ifcfg-ens160</span><br></pre></td></tr></table></figure><p><strong>启用bond0</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 要启动绑定，则必须首先启动从属接口 </span></span><br><span class="line">nmcli con up bond-slave-ens160</span><br><span class="line">nmcli con up bond-slave-ens224</span><br><span class="line"><span class="comment"># 启动绑定</span></span><br><span class="line">nmcli con up bond0</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_e2c2c083a0072a5bc7dcabf6335b41d1.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_e2c2c083a0072a5bc7dcabf6335b41d1.png"></p><h3 id="4-效果"><a href="#4-效果" class="headerlink" title="4. 效果"></a>4. 效果</h3><p>查看IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master bond0 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2d:25:64 brd ff:ff:ff:ff:ff:ff permaddr 00:0c:29:2d:25:5a</span><br><span class="line">    altname enp3s0</span><br><span class="line">3: ens224: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master bond0 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2d:25:64 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp19s0</span><br><span class="line">4: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 52:54:00:d9:ea:56 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2d:25:64 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.10/24 brd 10.0.0.255 scope global noprefixroute bond0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::e3a9:7228:e43a:9138/64 scope <span class="built_in">link</span> noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p><strong>查看bond状态</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Every 1.0s: <span class="built_in">cat</span> /proc/net/bonding/bond0                                                                                   localhost.localdomain: Tue May  7 11:33:36 2024</span><br><span class="line"></span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: fault-tolerance (active-backup)</span><br><span class="line">Primary Slave: None</span><br><span class="line">Currently Active Slave: ens224  <span class="comment"># ens224 是主</span></span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line">Peer Notification Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: ens224</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 10000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:2d:25:64</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">Slave Interface: ens160</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 10000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:2d:25:5a</span><br><span class="line">Slave queue ID: 0</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_f3cfde6318f3ab37148e4d6822104dba.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_f3cfde6318f3ab37148e4d6822104dba.png"></p><h3 id="5-扩展-删除bond"><a href="#5-扩展-删除bond" class="headerlink" title="5. 扩展 删除bond"></a>5. 扩展 删除bond</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除bond</span></span><br><span class="line">nmcli con del mybond0</span><br><span class="line"><span class="comment"># 查看详情</span></span><br><span class="line">nmcli con</span><br><span class="line"><span class="comment"># 删除从属</span></span><br><span class="line">nmcli con del bond-slave-ens33</span><br><span class="line">nmcli con del bond-slave-ens36</span><br></pre></td></tr></table></figure><h1 id="二-直接修改配置文件方式配置bond-此种适用于适用network管理"><a href="#二-直接修改配置文件方式配置bond-此种适用于适用network管理" class="headerlink" title="二. 直接修改配置文件方式配置bond(此种适用于适用network管理)"></a>二. 直接修改配置文件方式配置bond(此种适用于适用network管理)</h1><p><strong>概览(命令方式三行命令即可推荐使用此种)：</strong></p><p>可以<strong>先打开NetworkManager</strong>服务执行完成下方命令后<strong>再将其关闭</strong> 最后<strong>重启network</strong>服务</p><p>参数：mode active-backup miimon 100 可写为 mode 1 miimon 100</p><p>使用mode 1 miimon 100时</p><p>BONDING_OPTS=mode=active-backup 变为 BONDING_OPTS=”mode=active-backup miimon=100”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add con-name bond0 ifname bond0 <span class="built_in">type</span> bond mode active-backup miimon 100 ipv4.addresses 10.0.0.60/24 ipv4.gateway 10.0.0.220 ipv4.dns 223.5.5.5</span><br><span class="line"></span><br><span class="line">nmcli connection add con-name ens224 ifname ens224 <span class="built_in">type</span> bond-slave master bond0</span><br><span class="line">nmcli connection add con-name ens256 ifname ens256 <span class="built_in">type</span> bond-slave master bond0</span><br></pre></td></tr></table></figure><h2 id="1-NAT网络配置（所有服务器）："><a href="#1-NAT网络配置（所有服务器）：" class="headerlink" title="1.NAT网络配置（所有服务器）："></a>1.NAT网络配置（所有服务器）：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install bash-completion</span><br><span class="line"><span class="built_in">cd</span> /etc/sysconfig/network-scripts/</span><br></pre></td></tr></table></figure><h3 id="bond0配置-实际中记得将dhcp改为static"><a href="#bond0配置-实际中记得将dhcp改为static" class="headerlink" title="bond0配置(实际中记得将dhcp改为static)"></a>bond0配置(实际中记得将dhcp改为static)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s1 network-scripts]<span class="comment"># cat ifcfg-bond0 </span></span><br><span class="line">BONDING_OPTS=mode=active-backup</span><br><span class="line">TYPE=Bond</span><br><span class="line">BONDING_MASTER=<span class="built_in">yes</span></span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=10.0.0.60</span><br><span class="line">PREFIX=24</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=default</span><br><span class="line">NAME=bond0</span><br><span class="line">UUID=a0a8a96c-ec86-4cbe-8b36-849bb4aa20a6</span><br><span class="line">DEVICE=bond0</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p>ens224配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s1 network-scripts]<span class="comment"># cat ifcfg-ens224 </span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOND_PORT_QUEUE_ID=0</span><br><span class="line">BOND_PORT_PRIO=0</span><br><span class="line">NAME=ens224</span><br><span class="line">UUID=8855f02c-a2e6-48e7-86ad-0320382a445a</span><br><span class="line">DEVICE=ens224</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p>ens256配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s1 network-scripts]<span class="comment"># cat ifcfg-ens224 </span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOND_PORT_QUEUE_ID=0</span><br><span class="line">BOND_PORT_PRIO=0</span><br><span class="line">NAME=ens224</span><br><span class="line">UUID=8855f02c-a2e6-48e7-86ad-0320382a445a</span><br><span class="line">DEVICE=ens224</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=<span class="built_in">yes</span></span><br><span class="line">[root@k8s1 network-scripts]<span class="comment"># cat ifcfg-ens256</span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOND_PORT_QUEUE_ID=0</span><br><span class="line">BOND_PORT_PRIO=0</span><br><span class="line">NAME=ens256</span><br><span class="line">UUID=c3358675-54e0-43f0-afc9-e8a3a13ad9ed</span><br><span class="line">DEVICE=ens256</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>重启网卡生效：systemctl restart network</strong></p><p><strong>验证</strong></p><ul><li>重启系统看能否正常启动bond0    （正常启动）</li><li>手动down掉网卡看能否正常切换（查看bond命令 <code>cat /proc/net/bonding/bond0</code>）(正常切换)</li><li>查看网卡状态：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s1 network-scripts]<span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2d:25:5a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    inet 10.0.0.10/24 brd 10.0.0.255 scope global noprefixroute ens160</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 10.0.0.187/24 brd 10.0.0.255 scope global secondary dynamic noprefixroute ens160</span><br><span class="line">       valid_lft 1174sec preferred_lft 1174sec</span><br><span class="line">    inet6 fe80::20c:29ff:fe2d:255a/64 scope <span class="built_in">link</span> noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: ens224: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master bond0 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2d:25:64 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp19s0</span><br><span class="line">4: ens256: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc mq master bond0 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2d:25:64 brd ff:ff:ff:ff:ff:ff permaddr 00:0c:29:2d:25:6e</span><br><span class="line">    altname enp27s0</span><br><span class="line">5: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 52:54:00:d9:ea:56 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">6: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:2d:25:64 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.60/24 brd 10.0.0.255 scope global noprefixroute bond0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::95d7:d04b:3ab3:49f1/64 scope <span class="built_in">link</span> noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure></li></ul><p>4.内外网通信：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ping www.baidu.com</span></span><br><span class="line"><span class="comment"># ping 192.168.20.2</span></span><br></pre></td></tr></table></figure><p>参考：</p><p><a href="https://blog.csdn.net/qq_43652666/article/details/119175635">https://blog.csdn.net/qq_43652666/article/details/119175635</a></p><p><a href="https://blog.csdn.net/m0_59586152/article/details/125503956">https://blog.csdn.net/m0_59586152/article/details/125503956</a></p><p><a href="https://www.cnblogs.com/waacode/p/17539417.html">https://www.cnblogs.com/waacode/p/17539417.html</a></p><p><a href="https://www.modb.pro/db/128078">第25篇 centos 8 双网卡绑定（bond链路聚合） - 墨天轮 (modb.pro)</a></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lvm更换磁盘（存在vg卷组的磁盘损坏）</title>
      <link href="/2024/05/05/lvm%E6%9B%B4%E6%8D%A2%E7%A3%81%E7%9B%98%EF%BC%88%E5%AD%98%E5%9C%A8vg%E5%8D%B7%E7%BB%84%E7%9A%84%E7%A3%81%E7%9B%98%E6%8D%9F%E5%9D%8F%EF%BC%89/"/>
      <url>/2024/05/05/lvm%E6%9B%B4%E6%8D%A2%E7%A3%81%E7%9B%98%EF%BC%88%E5%AD%98%E5%9C%A8vg%E5%8D%B7%E7%BB%84%E7%9A%84%E7%A3%81%E7%9B%98%E6%8D%9F%E5%9D%8F%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="lvm更换磁盘（存在vg卷组的磁盘损坏）"><a href="#lvm更换磁盘（存在vg卷组的磁盘损坏）" class="headerlink" title="lvm更换磁盘（存在vg卷组的磁盘损坏）"></a>lvm更换磁盘（存在vg卷组的磁盘损坏）</h1><blockquote><p>只含有pv的磁盘损坏更换 | <a href="http://sunlight.zznnwn.cloudns.biz/2024/04/24/%E5%A4%9A%E5%9D%97%E7%A3%81%E7%9B%98%E9%85%8D%E7%BD%AElvm%E5%8D%B7%20%E4%B8%8D%E5%90%ABvg%E5%8D%B7%E7%9A%84%E6%9F%90%E5%9D%97%E7%A3%81%E7%9B%98%E6%8D%9F%E5%9D%8F%E8%A7%A3%E5%86%B3/">传送门&gt;&gt;</a></p><p>对于机械硬盘而言，经常会出现坏道，影响整体的磁盘读写速度，此时我们需要更换故障的硬盘，接下来模拟操作整个更换过程。</p></blockquote><h2 id="一-测试环境配置-创建lvm卷挂载并上传文件"><a href="#一-测试环境配置-创建lvm卷挂载并上传文件" class="headerlink" title="一. 测试环境配置 创建lvm卷挂载并上传文件"></a>一. 测试环境配置 创建lvm卷挂载并上传文件</h2><h3 id="1-测试环境"><a href="#1-测试环境" class="headerlink" title="1.测试环境"></a>1.测试环境</h3><p>操作系统：ubuntu20.04</p><p>硬盘：准备3块5GB的硬盘用于测试</p><h3 id="2-前提条件创建lvm卷"><a href="#2-前提条件创建lvm卷" class="headerlink" title="2.前提条件创建lvm卷"></a>2.前提条件创建lvm卷</h3><p>使用sdb、sdc加入LVM并配置lv，创建过程如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建PV</span></span><br><span class="line">pvcreate /dev/sd&#123;b..c&#125;   </span><br><span class="line"><span class="comment"># 创建VG</span></span><br><span class="line">vgcreate vg00 /dev/sdb /dev/sdc  </span><br><span class="line"><span class="comment"># 创建一个8GB的LV</span></span><br><span class="line">lvcreate -n lv00 -L 8G vg00  </span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8827a051a031111cb47e8e85d0f319fe.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8827a051a031111cb47e8e85d0f319fe.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_fb1428a67eb75bf19a574c17ca127574.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_fb1428a67eb75bf19a574c17ca127574.png"></p><h3 id="3-格式化LV并挂载"><a href="#3-格式化LV并挂载" class="headerlink" title="3. 格式化LV并挂载"></a>3. 格式化LV并挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式化为ext4格式</span></span><br><span class="line">mkfs.ext4 /dev/vg00/lv00  </span><br><span class="line"><span class="comment"># 创建挂载目录</span></span><br><span class="line"><span class="built_in">mkdir</span> /lv00_datadir   </span><br><span class="line"><span class="comment"># 挂载</span></span><br><span class="line">mount /dev/vg00/lv00 /lv00_datadir  </span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_1827ebb3ba929ebaa9a949fca6455667.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_1827ebb3ba929ebaa9a949fca6455667.png"></p><p>上传测试文件，我在这里上传一个镜像文件，约为15M左右；</p><p>使用md5sum命令来验证硬盘更换后数据的完整性：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看文件md5</span></span><br><span class="line"><span class="built_in">md5sum</span> /lv00_datadir/cirros-0.4.0-x86_64-disk.img</span><br><span class="line">// 返回</span><br><span class="line">443b7623e27ecf03dc9e01ee93f67afe  /lv00_datadir/cirros-0.4.0-x86_64-disk.img</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8449f31b43f6f17a71494598fc1e2ec4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8449f31b43f6f17a71494598fc1e2ec4.png"></p><h2 id="二-更换磁盘-迁移坏道磁盘数据"><a href="#二-更换磁盘-迁移坏道磁盘数据" class="headerlink" title="二. 更换磁盘 迁移坏道磁盘数据"></a>二. 更换磁盘 迁移坏道磁盘数据</h2><p>假设 sdb 目前存在一些问题，需要使用 sdd 来替换：</p><h3 id="1-配置sdd"><a href="#1-配置sdd" class="headerlink" title="1.配置sdd"></a>1.配置sdd</h3><p>将 sdd 分区后加入到 VG 中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将sdd创建pv卷</span></span><br><span class="line">pvcreate /dev/sdd</span><br><span class="line"><span class="comment"># 将sdd加入vg卷</span></span><br><span class="line">vgextend vg00 /dev/sdd</span><br></pre></td></tr></table></figure><h3 id="2-迁移数据"><a href="#2-迁移数据" class="headerlink" title="2. 迁移数据"></a>2. 迁移数据</h3><h4 id="2-1-通过pvdisplay命令来查看磁盘sdb上是否存有数据："><a href="#2-1-通过pvdisplay命令来查看磁盘sdb上是否存有数据：" class="headerlink" title="2.1 通过pvdisplay命令来查看磁盘sdb上是否存有数据："></a>2.1 通过pvdisplay命令来查看磁盘sdb上是否存有数据：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看pv卷详情</span><br><span class="line">pvdisplay /dev/sdb</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_817b1d5249e0b48e8d3076f68c3ba559.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_817b1d5249e0b48e8d3076f68c3ba559.png"></p><p>可以看到，此时的sdb基本被用满了，相应地sdd还没有开始使用：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_4089272617ed1608011e87085bb86d9b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_4089272617ed1608011e87085bb86d9b.png"></p><h4 id="2-2-迁移数据，将sdb中的数据迁移到sdd中："><a href="#2-2-迁移数据，将sdb中的数据迁移到sdd中：" class="headerlink" title="2.2 迁移数据，将sdb中的数据迁移到sdd中："></a>2.2 迁移数据，将sdb中的数据迁移到sdd中：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 迁移sdb pv卷中的数据到 sdd</span><br><span class="line">pvmove /dev/sdb /dev/sdd</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8ca50c610533e1eded58b727b1b8c044.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_8ca50c610533e1eded58b727b1b8c044.png"></p><p>再次查看磁盘sdb上是否存有数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvdisplay /dev/sdb</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_980104501d271293dbf431880b22eca2.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_980104501d271293dbf431880b22eca2.png"></p><p>或者使用pvscan查看：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_2caa41a0e2c1b5e0807bdc99e46b3054.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_2caa41a0e2c1b5e0807bdc99e46b3054.png"></p><h4 id="2-3-移出sdb"><a href="#2-3-移出sdb" class="headerlink" title="2.3 移出sdb"></a>2.3 移出sdb</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将sdb从VG中移出</span></span><br><span class="line">vgreduce vg00 /dev/sdb  </span><br><span class="line"><span class="comment"># 删除PV</span></span><br><span class="line">pvremove /dev/sdb  </span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_93fa85b202ffddcbdada05ec2e6aa091.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_93fa85b202ffddcbdada05ec2e6aa091.png"></p><h4 id="2-4-检查数据完整性"><a href="#2-4-检查数据完整性" class="headerlink" title="2.4 检查数据完整性"></a>2.4 检查数据完整性</h4><p>还是使用md5sum命令来检查数据完整性：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5sum /lv00_datadir/cirros-0.4.0-x86_64-disk.img</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_51b7a5f9066d34eac92af24ffd2babeb.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_51b7a5f9066d34eac92af24ffd2babeb.png"></p><p>更换前与更换后计算出来的值都是一样，说明数据完整，测试成功。</p><p>本文参考：<a href="https://mp.weixin.qq.com/s?__biz=MzkwOTY0NTYzOA==&mid=2247485700&idx=1&sn=35450d4ddf918e6478a1e0af1eaff545&chksm=c136cb2df641423bf4b25c3918b69898582ed4263b0cc2bd633534de05e1b4bc7c7a95ba671d&mpshare=1&scene=24&srcid=0502Gk8XleBsbnh0t6JiGCo9&sharer_shareinfo=84be6c1a5a08f273b8d004edbbc0418a&sharer_shareinfo_first=84be6c1a5a08f273b8d004edbbc0418a#rd">会成长的小学生</a></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker设置iptables=false后无法解析DNS的解决方法</title>
      <link href="/2024/04/29/docker%E8%AE%BE%E7%BD%AEiptables=false%E5%90%8E%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90DNS%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
      <url>/2024/04/29/docker%E8%AE%BE%E7%BD%AEiptables=false%E5%90%8E%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90DNS%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="docker设置iptables-false后无法解析DNS的解决方法"><a href="#docker设置iptables-false后无法解析DNS的解决方法" class="headerlink" title="docker设置iptables=false后无法解析DNS的解决方法"></a>docker设置iptables=false后无法解析DNS的解决方法</h1><blockquote><p>本文参考：<a href="https://blog.csdn.net/wang805447391/article/details/120719570">docker设置iptables=false后无法解析DNS的解决方法_docker iptables false</a></p><p>docker默认使用iptables进行网络配置，与ufw有点不兼容，ufw无法管控docker暴露出来的端口，可能会造成一定的安全问题，所以某些情况下需要将docker的iptables设置为false。<br>设置之后进入docker容器内部发现无法访问网络，只能与172.17.0.1网段通信。</p></blockquote><h2 id="解决方案如下："><a href="#解决方案如下：" class="headerlink" title="解决方案如下："></a>解决方案如下：</h2><p>sudo systemctl edit docker.service</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">ExecStartPre=/usr/sbin/iptables -t nat -A POSTROUTING -s 172.0.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">ExecStopPost=/usr/sbin/iptables -t nat -D POSTROUTING -s 172.0.0.0/16 ! -o docker0 -j MASQUERADE</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_411fbc44b1e7914f452aa767b676f8ce.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_411fbc44b1e7914f452aa767b676f8ce.png"></p><p>配置解释：</p><p>这段配置的作用是为Docker容器设置网络地址转换（NAT），使得从172.17.0.0/16子网发出的流量经过docker0接口时进行MASQUERADE（伪装）处理，以实现网络地址的转换和隐藏。</p><p>在这段配置中：</p><ul><li><code>ExecStartPre</code> 行指定了在启动服务之前执行的操作，即向iptables中添加一个POSTROUTING规则，对从172.17.0.0/16子网发出的流量进行MASQUERADE处理，但排除了流量经过docker0接口的情况。</li><li><code>ExecStopPost</code> 行指定了在停止服务之后执行的操作，即从iptables中删除之前添加的相同规则。</li></ul><p>这种配置通常用于在Docker环境中管理网络流量，确保容器内部的流量能够正常地与外部通信，并且对外部网络隐藏了容器内部的真实IP地址。</p><h2 id="生效配置"><a href="#生效配置" class="headerlink" title="生效配置"></a>生效配置</h2><p>sudo systemctl daemon-reload  即可</p><p>systemctl restart docker  测试docker能否正常启动</p><p>参考资料：<br><a href="https://gist.github.com/circa10a/e6cfc673af9282d17dfb958ef6adabeb">https://gist.github.com/circa10a/e6cfc673af9282d17dfb958ef6adabeb</a><br><a href="https://github.com/moby/moby/issues/26776">https://github.com/moby/moby/issues/26776</a></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多块磁盘配置lvm卷 不含vg卷的某块磁盘损坏解决</title>
      <link href="/2024/04/24/%E5%A4%9A%E5%9D%97%E7%A3%81%E7%9B%98%E9%85%8D%E7%BD%AElvm%E5%8D%B7%20%E4%B8%8D%E5%90%ABvg%E5%8D%B7%E7%9A%84%E6%9F%90%E5%9D%97%E7%A3%81%E7%9B%98%E6%8D%9F%E5%9D%8F%E8%A7%A3%E5%86%B3/"/>
      <url>/2024/04/24/%E5%A4%9A%E5%9D%97%E7%A3%81%E7%9B%98%E9%85%8D%E7%BD%AElvm%E5%8D%B7%20%E4%B8%8D%E5%90%ABvg%E5%8D%B7%E7%9A%84%E6%9F%90%E5%9D%97%E7%A3%81%E7%9B%98%E6%8D%9F%E5%9D%8F%E8%A7%A3%E5%86%B3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="多块磁盘配置lvm卷-不含vg卷的某块磁盘损坏解决"><a href="#多块磁盘配置lvm卷-不含vg卷的某块磁盘损坏解决" class="headerlink" title="多块磁盘配置lvm卷 不含vg卷的某块磁盘损坏解决"></a>多块磁盘配置lvm卷 不含vg卷的某块磁盘损坏解决</h1><p><strong>解析</strong></p><p>Linux 的 LVM 会默认存储用户对 PV/VG/LV 的每一步操作，并自动把当前的 VG 的信息备份到一个文件里面，位置是 /etc/lvm/backup/VG 名或者 /etc/lvm/archive/VG 名。这个文件里面记录的东西大概跟 vgdisplay/pvdisplay/lvdisplay 输出的信息一致，里面也包括了对于恢复 VG 信息至关重要的 PV UUID。</p><p><strong>适用场景：</strong></p><p>误操作、磁盘异常掉电等原因可能会造成硬盘的逻辑损坏，当LVM中某块硬盘出现异常时，会导致部分逻辑卷或整个卷组无法访问的情况。我们查看pv时会发现提示unknow device,并提示“Couldn’t find device with uuid xxx”。问题如图，本文介绍了LVM中某块硬盘损坏的灾难修复，来尽可能恢复灾难所造成的数据损失。</p><h2 id="一-具体现象"><a href="#一-具体现象" class="headerlink" title="一. 具体现象"></a><strong>一. 具体现象</strong></h2><p><strong>模拟坏境：两块磁盘配置 lvm</strong> 挂载于<strong>home</strong>目录，模拟其中一块磁盘损坏（手动卸载其中一块磁盘）</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_01d0781150239f60d611e745039163f0.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_01d0781150239f60d611e745039163f0.png"></p><p>挂载目录写入文件测试恢复 能否恢复数据</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d66d4886fa622e78c8eb0e4a953bc95a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d66d4886fa622e78c8eb0e4a953bc95a.png"></p><p><strong>现象</strong>：<strong>此时有一块pv处于unknow状态 重启系统后现象如下</strong></p><ul><li>lsblk 查看没有看到  /dev/mapper 开头的lvm卷</li><li>pvs 查看有一块磁盘 pv 处于 unknow 状态 并且显示：WARNING: Couldn’t find device with uuid FCda1V-EwWN-qtfc-6SZ4-Vu1e-v8FG-XUCr5H 找不到这个uuid的设备</li><li>mount 挂载显示找不到设备</li></ul><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_2f4b8b5f102e1cf6be27e0f7225fc7a8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_2f4b8b5f102e1cf6be27e0f7225fc7a8.png"></p><h2 id="二-解决"><a href="#二-解决" class="headerlink" title="二. 解决"></a><strong>二. 解决</strong></h2><ol><li><p>服务器新添加一块磁盘 磁盘的大小和 损坏磁盘的大小一致 此次新添加磁盘为 /dev/sdd</p></li><li><p>使用pvs定位损坏磁盘uuid: 8Acrc0-21LJ-yWfm-f7gb-2uvf-ogLu-cG6OIT</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_7ad156f3d7d7bb8786b4b9794428c366.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_7ad156f3d7d7bb8786b4b9794428c366.png"></p></li><li><p>使用原来的PV UUID来创建PV，并使用lvm配置备份文件来恢复信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看pv返回损坏磁盘uuid: 8Acrc0-21LJ-yWfm-f7gb-2uvf-ogLu-cG6OIT</span></span><br><span class="line">pvs</span><br><span class="line"><span class="comment"># 使用原来的PV UUID来创建PV，并使用lvm配置备份文件来恢复信息（本文使用）</span></span><br><span class="line">pvcreate --uuid  8Acrc0-21LJ-yWfm-f7gb-2uvf-ogLu-cG6OIT --restorefile /etc/lvm/backup/vg_mf  /dev/sdd</span><br><span class="line"><span class="comment"># 或使用类似如下命令</span></span><br><span class="line">pvcreate /dev/vdc -u qaTzJn-Hdgc-aeC5-EUT0-H1l1-tPiA-rYXnDx --restorefile /etc/lvm/archive/vgtest_00002-645033136.vg</span><br></pre></td></tr></table></figure></li><li><p>我们可以看到sdc已经成功替换为了sdd</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_9029ced509c4251026a34bf3d3959213.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_9029ced509c4251026a34bf3d3959213.png"></p></li><li><p>如果替换后的/dev/sdd 的attr为a-m 表示/dev/sdd为missing状态 则需要执行下方命令恢复</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 替换后的/dev/sdd 的attr为a-m 表示/dev/sdd为missing状态 则需要执行下方命令恢复（本文使用）</span></span><br><span class="line">vgextend --restoremissing vg_mf /dev/sdd</span><br><span class="line"><span class="comment"># 或使用类似如下命令方式</span></span><br><span class="line">vgcfgrestore -f archive/vgtest_00002-645033136.vg vgtest</span><br></pre></td></tr></table></figure></li><li><p>确认硬盘<strong>没有在</strong> missing 状态后，对卷组进行恢复，提示恢复vg，没有报错，使用lvscan发现当前lv状态为inactive。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 刷新</span></span><br><span class="line">lvscan</span><br><span class="line"><span class="comment"># 恢复卷组信息</span></span><br><span class="line">vgcfgrestore -f  /etc/lvm/backup/vg_mf   vg_mf</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_dec1593e4a081755a2714700aa9fc7f9.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_dec1593e4a081755a2714700aa9fc7f9.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_f5fbb85873ba0a7afb2d618093af9743.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_f5fbb85873ba0a7afb2d618093af9743.png"></p></li><li><p>激活vg，再次查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 刷新</span></span><br><span class="line">lvscan</span><br><span class="line"><span class="comment"># 激活vg</span></span><br><span class="line">vgchange -ay vg_mf</span><br></pre></td></tr></table></figure><p>此时再次使用 lvscan 查看 lvm 卷状态变为 active</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_92c783e15b2248b4ca139d58f27f9000.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_92c783e15b2248b4ca139d58f27f9000.png"></p></li><li><p>最后重新挂载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看磁盘uuid</span></span><br><span class="line">blkid</span><br><span class="line"><span class="comment"># 挂载lvm卷</span></span><br><span class="line">mount /dev/mapper/vg_mf-lv_mf  /home</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_11474a9f9fdc89f0de5d179adac186d2.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_11474a9f9fdc89f0de5d179adac186d2.png"></p><p>验证数据是否恢复</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_e38c176548f7b5581090fcad7b034dfe.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_e38c176548f7b5581090fcad7b034dfe.png"></p><p>但是这种方式存在一个bug 有时候重启lsblk 看不到lvm卷信息 需要重新激活vg卷 挂载.。</p></li></ol><p>此时恢复成功。</p><p><strong>本文参考</strong></p><ul><li><a href="https://developer.aliyun.com/article/766142">https://developer.aliyun.com/article/766142</a></li><li><a href="https://blog.csdn.net/m0_64339281/article/details/134873834">https://blog.csdn.net/m0_64339281/article/details/134873834</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开源聊天系统fiora与Vocechat部署</title>
      <link href="/2024/04/22/%E5%BC%80%E6%BA%90%E8%81%8A%E5%A4%A9%E7%B3%BB%E7%BB%9Ffiora%E4%B8%8EVocechat%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/04/22/%E5%BC%80%E6%BA%90%E8%81%8A%E5%A4%A9%E7%B3%BB%E7%BB%9Ffiora%E4%B8%8EVocechat%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="开源聊天系统fiora与Vocechat部署"><a href="#开源聊天系统fiora与Vocechat部署" class="headerlink" title="开源聊天系统fiora与Vocechat部署"></a>开源聊天系统fiora与Vocechat部署</h1><h2 id="一-Vocechat部署"><a href="#一-Vocechat部署" class="headerlink" title="一. Vocechat部署"></a>一. Vocechat部署</h2><blockquote><p>官网：<a href="https://doc.voce.chat/zh-cn/install/install-by-docker">Docker 安装 | VoceChat</a></p><p>github仓库：<a href="https://github.com/privoce">https://github.com/privoce</a></p><p>ios 安卓 app下载：<a href="https://voce.chat/zh-CN#download">VoceChat Website</a></p><p>缺点：使用firebase通知推送 对国内不友好 基本无法使用</p><p>管理员需在 Firebase Cloud Console 中配置 <strong>FCM</strong>。</p><p>⚠️ 请注意：如果使用自定义的推送配置，则移动端（iOS 及 Android）的推送服务将会不可用，这与 iOS 和 Android 的应用签名相关。因此只有网页端可以收到推送消息。目前在最新的网页端中提供了一套默认配置，详情可以访问设置 -&gt; Firebase。远期规划会提供移动端 SDK，到时可以由用户用自己的项目签名。</p><p>⚠️ 如果您的 VoceChat 后端部署在中国大陆，则推送可能因网络管制而不可用，因为目前的推送服务依赖 Google Firebase。我们计划逐步将推送替换成直接支持 APNs 及其他国内安卓手机厂商支持的平台。</p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Vocechat是一套支持独立部署的个人云社交媒体聊天服务，具有轻量级、开源和可自托管等特点。它博采众长，从Slack、Discord、RocketChat、Solid、Matrix等产品和规范中汲取优点，适用于团队内部交流、个人聊天服务搭建、网站客服以及网站内嵌社区等场景。</p><p>Vocechat能轻易部署在私有云上，用户可以轻松将其部署到自己的服务器上，用户数据完全由用户自己掌握，传输过程加密，保证了数据的安全性。此外，Vocechat的体积仅为15MB，几乎可以塞进任何服务器里，同时拥有正常聊天所需要的所有必备功能，如回复、转发、点赞、钉选消息等。其界面简洁，能够快速上手，支持在线上传文件、图片、视频，并且支持在线播放视频。</p><p>在团队内部交流方面，Vocechat可以作为一个高效的沟通工具，支持成员间的实时聊天、文件共享和协作。对于个人聊天服务搭建，Vocechat提供了丰富的自定义选项，用户可以根据自己的需求进行个性化设置。同时，它也可以作为网站客服工具，提供与访客的实时交流功能，提升客户服务质量。此外，Vocechat还可以以插件的形式插入到网页中，提供网页聊天等各种丰富的功能。</p><h4 id="项目组成"><a href="#项目组成" class="headerlink" title="项目组成"></a>项目组成</h4><table><thead><tr><th><strong><strong>名称</strong></strong></th><th><strong><strong>技术</strong></strong></th><th><strong><strong>项目</strong></strong></th><th><strong><strong>License</strong></strong></th><th><strong><strong>说明</strong></strong></th></tr></thead><tbody><tr><td>服务端:</td><td>Rust</td><td>vocechat-server(暂未开源)</td><td>待定</td><td>聊天服务端，支持主流平台: Linux x86_64, Windows 32/64, Arm32, Arch64</td></tr><tr><td>客户端:</td><td>Flutter</td><td><a href="https://github.com/privoce/vocechat-client" title="vocechat-client">vocechat-client</a></td><td>Apache-2.0</td><td>聊天客户端，支持 Android, iOS 平台的客户端</td></tr><tr><td>Web:</td><td>React</td><td><a href="https://github.com/privoce/vocechat-web" title="vocechat-web">vocechat-web</a></td><td>GPL-3.0</td><td>聊天功能的浏览器版本，整合了管理</td></tr><tr><td>Web-SDK:</td><td>React</td><td>vocechat-web-sdk(暂未开源)</td><td>GPL-3.0</td><td>可以整合到其他 Web 产品中，使其赋能聊天功能</td></tr></tbody></table></blockquote><p><strong>功能介绍</strong></p><ul><li>支持中英文</li><li>支持Android、iOS端</li><li>支持Docker安装，部署极其简单</li><li>备份简单</li><li>支持对接自有账号系统</li><li>支持第三方登录（比如GitHub、MetaMask、Google等）</li><li>支持访问控制 &amp; 访客模式</li><li>API文档详细</li><li>支持自建频道</li></ul><p><strong>功能列表 &amp; 计划</strong></p><ul><li>群聊、私聊 / 2021-Q4</li><li>引用, at / 2021-Q4</li><li>图片、大文件传输 / 2021-Q4</li><li>置顶 / 2022-Q1</li><li>转发 / 2022-Q1</li><li>收藏 / 2022-Q1</li><li>阅后即焚（高级功能） / 2022-Q1</li><li>语音（高级功能）/ 2022-Q4</li><li>视频（高级功能）/ 2022-Q4</li></ul><h2 id="docker-compose部署"><a href="#docker-compose部署" class="headerlink" title="docker-compose部署"></a>docker-compose部署</h2><p>镜像可选</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">privoce/vocechat-server:latest</span></span><br><span class="line"><span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:vocechat-server</span></span><br></pre></td></tr></table></figure><p>部署</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">vocechat:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:vocechat-server</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;8000:3000&#x27;</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">vocechat-server</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;./data:/home/vocechat-server/data&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="机器人使用"><a href="#机器人使用" class="headerlink" title="机器人使用"></a>机器人使用</h2><p>API地址：<a href="http://10.0.0.10:8000/api/swagger">http://10.0.0.10:8000/api/swagger</a></p><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_5fb9785cb7a0243bc3a8210f6267e92a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_5fb9785cb7a0243bc3a8210f6267e92a.png"></p><h2 id="二-fiora部署"><a href="#二-fiora部署" class="headerlink" title="二. fiora部署"></a>二. fiora部署</h2><blockquote><p>github仓库：<a href="https://github.com/yinxin630/fiora">https://github.com/yinxin630/fiora</a></p><p>中文教程：<a href="https://yinxin630.github.io/fiora/zh-Hans/docs/faq">https://yinxin630.github.io/fiora/zh-Hans/docs/faq</a></p><p><strong>修改客户端配置需要重新构建客户端</strong></p><table><thead><tr><th>Key</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>Server</td><td>string</td><td>/</td><td>客户端要连接的服务端地址</td></tr><tr><td>MaxImageSize</td><td>number</td><td>3145728 (3MB)</td><td>客户端可以上传的最大图片大小</td></tr><tr><td>MaxBackgroundImageSize</td><td>number</td><td>5242880 (5MB)</td><td>客户端可以上传的最大背景图大小</td></tr><tr><td>MaxAvatarSize</td><td>number</td><td>1572864 (1.5MB)</td><td>客户端可以上传的最大头像图片大小</td></tr><tr><td>MaxFileSize</td><td>number</td><td>10485760 (10MB)</td><td>客户端可以上传的最大文件大小</td></tr><tr><td>DefaultTheme</td><td>string</td><td>cool</td><td>默认主题</td></tr><tr><td>Sound</td><td>string</td><td>default</td><td>默认通知音</td></tr><tr><td>TagColorMode</td><td>string</td><td>fixedColor</td><td>默认标签颜色模式</td></tr><tr><td>FrontendMonitorAppId</td><td>string</td><td>fixedColor</td><td>岳鹰监控 appId<a href="https://yueying.effirst.com/index">https://yueying.effirst.com/index</a></td></tr><tr><td>DisableDeleteMessage</td><td>boolean</td><td>false</td><td>禁止用户撤回消息</td></tr></tbody></table><h3 id="服务端变量配置"><a href="#服务端变量配置" class="headerlink" title="服务端变量配置#"></a>服务端变量配置<a href="https://yinxin630.github.io/fiora/zh-Hans/docs/config#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE" title="标题的直接链接">#</a></h3><p><strong>修改服务端配置需要重启应用</strong></p><table><thead><tr><th>Key</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>Host</td><td>string</td><td>your ip</td><td>服务端 host</td></tr><tr><td>Port</td><td>number</td><td>9200</td><td>服务端端口号</td></tr><tr><td>Database</td><td>string</td><td>mongodb://localhost:27017/fiora</td><td>mongoDB 数据库地址</td></tr><tr><td>RedisHost</td><td>string</td><td>localhost</td><td>redis 地址主机名</td></tr><tr><td>RedisPort</td><td>number</td><td>6379</td><td>redis 端口</td></tr><tr><td>JwtSecret</td><td>string</td><td>jwtSecret (推荐修改它来保证安全性)</td><td>jwt token 加密 secret</td></tr><tr><td>MaxGroupCount</td><td>number</td><td>3</td><td>用户最大可以创建的群组个数</td></tr><tr><td>AllowOrigin</td><td>string</td><td>null</td><td>允许的客户端 origin 列表, null 时允许所有 origin 连接, 多个值逗号分割</td></tr><tr><td>tokenExpiresTime</td><td>number</td><td>2592000000 (30 天)</td><td>登陆 token 过期时间</td></tr><tr><td>Administrator</td><td>string</td><td>‘’</td><td>管理员用户 id 列表, 多个值逗号分割</td></tr><tr><td>DisableRegister</td><td>boolean</td><td>false</td><td>禁止注册账号</td></tr><tr><td>DisableCreateGroup</td><td>boolean</td><td>false</td><td>禁止创建群组</td></tr><tr><td>ALIYUN_OSS</td><td>boolean</td><td>false</td><td>启用阿里云 OSS</td></tr><tr><td>ACCESS_KEY_ID</td><td>string</td><td>‘’</td><td>阿里云 OSS access key id. 参考:<a href="https://help.aliyun.com/document_detail/48699.html">https://help.aliyun.com/document_detail/48699.html</a></td></tr><tr><td>ACCESS_KEY_SECRET</td><td>string</td><td>‘’</td><td>阿里云 OSS access key secret. 参考和 ACCESS_KEY_ID 相同</td></tr><tr><td>ROLE_ARN</td><td>string</td><td>‘’</td><td>阿里云 OSS RoleARN. 参考:<a href="https://help.aliyun.com/document_detail/28649.html">https://help.aliyun.com/document_detail/28649.html</a></td></tr><tr><td>REGION</td><td>string</td><td>‘’</td><td>阿里云 OSS 地域. 例如:<code>oss-cn-zhangjiakou</code></td></tr><tr><td>BUCKET</td><td>string</td><td>‘’</td><td>阿里云 OSS bucket 名称</td></tr><tr><td>ENDPOINT</td><td>string</td><td>‘’</td><td>阿里云 OSS 域名. 例如:<code>cdn</code></td></tr></tbody></table></blockquote><p><strong>镜像可选</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 官方镜像</span></span><br><span class="line">redis</span><br><span class="line">mongo</span><br><span class="line">suisuijiang/fiora</span><br><span class="line"><span class="comment"># zznn阿里云镜像</span></span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:redis4</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:mongo5.0.18</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:fiora</span><br></pre></td></tr></table></figure><h3 id="docker-compose部署-1"><a href="#docker-compose部署-1" class="headerlink" title="docker-compose部署"></a><code>docker-compose</code>部署</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">fiora_redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:redis4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">fiora_redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fiora-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">fiora_db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:mongo5.0.18</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">fiora_db</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;27017:27017&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fiora-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">fiora:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:fiora</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">fiora</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Database=mongodb://fiora_db:27017/fiora</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">RedisHost=fiora_redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DisableRegister=true</span>  <span class="comment"># 设置不允许注册用户</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fiora-network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">fiora-network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure><p>目录说明</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">|-- [.githubb]                // github actions</span><br><span class="line">|-- [.vscode]                 // vscode 工作区配置</span><br><span class="line">|-- [bin]                     // 服务端脚本</span><br><span class="line">|-- [build]                   // webpack 配置</span><br><span class="line">|-- [client]                  // web 客户端</span><br><span class="line">|-- [config]                  // 应用配置</span><br><span class="line">|-- [dist]                    // 构建客户端输出目录</span><br><span class="line">|-- [docs]                    // 文档</span><br><span class="line">|-- [public]                  // 服务端静态资源</span><br><span class="line">|-- [server]                  // 服务端</span><br><span class="line">|-- [<span class="built_in">test</span>]                    // 单元测试</span><br><span class="line">|-- [types]                   // typescript 类型</span><br><span class="line">|-- [utils]                   // 工具方法</span><br><span class="line">|-- .babelrc                  // babel 配置</span><br><span class="line">|-- .eslintignore             // eslint 忽略</span><br><span class="line">|-- .eslintrc                 // eslint 配置</span><br><span class="line">|-- .gitignore                // git 忽略</span><br><span class="line">|-- .nodemonrc                // nodemon 配置</span><br><span class="line">|-- .prettierrc               // prettier 配置</span><br><span class="line">|-- Dockerfile                // docker 文件</span><br><span class="line">|-- LICENSE                   // fiora 许可</span><br><span class="line">|-- docker-compose.yaml       // docker compose 配置</span><br><span class="line">|-- jest.*.sj                 // jest 配置</span><br><span class="line">|-- package.json              // npm</span><br><span class="line">|-- tsconfig.json             // typescript 配置</span><br><span class="line">|-- yarn.lock                 // yarn</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>此安装就完成了，修改文件，fiora页面修改路径</strong></p><ul><li>以下logo：<br>/opt/fiora/public/favicon-96.png<br>/opt/fiora/public/favicon-192.png<br>/opt/fiora/public/favicon-512.png<br>以下主页修改路径<br>/opt/fiora/client/templates/index.html<br>以下侧边栏修改路径<br>/opt/fiora/client/modules/Sidebar/</li></ul><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>不允许注册时打开（需要注册时取消注释即可）：</p><ul><li>DisableRegister=true  # 设置不允许注册用户</li></ul><p>其他配置参考：<a href="https://blog.csdn.net/weixin_63660670/article/details/130824723">https://blog.csdn.net/weixin_63660670/article/details/130824723</a></p>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开源模型接入平台MaxKB部署</title>
      <link href="/2024/04/21/%E5%BC%80%E6%BA%90%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5%E5%B9%B3%E5%8F%B0MaxKB%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%AF%B9%E6%8E%A5OneApi/"/>
      <url>/2024/04/21/%E5%BC%80%E6%BA%90%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5%E5%B9%B3%E5%8F%B0MaxKB%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%AF%B9%E6%8E%A5OneApi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="开源模型接入平台MaxKB部署及对接OneApi"><a href="#开源模型接入平台MaxKB部署及对接OneApi" class="headerlink" title="开源模型接入平台MaxKB部署及对接OneApi"></a>开源模型接入平台MaxKB部署及对接OneApi</h1><blockquote><p>本平台由国内值得尊敬的强大公司飞致云开源的支持多用户隔离的模型接入平台</p><p>MaxKB 是一款基于 LLM 大语言模型的知识库问答系统。</p><ul><li><p>多模型支持：支持对接主流的大模型，包括本地私有大模型（如 Llama 2）、OpenAI、通义千问、Kimi、Azure OpenAI 和百度千帆大模型等；</p></li><li><p>开箱即用：支持直接上传文档、自动爬取在线文档，支持文本自动拆分、向量化，智能问答交互体验好；</p></li><li><p>无缝嵌入：支持零编码快速嵌入到第三方业务系统。</p></li><li><p>默认用户密码 用户名: admin  密码: MaxKB@123..</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ab8425771622018b1cac85a6fcd23de4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ab8425771622018b1cac85a6fcd23de4.png"></p></li></ul></blockquote><h2 id="一-部署"><a href="#一-部署" class="headerlink" title="一. 部署"></a>一. 部署</h2><p>镜像可选</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1panel/maxkb</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:zznnwn-maxkb</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:maxkb-zd</span><br></pre></td></tr></table></figure><p>docker命令方式部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=maxkb -p 8080:8080 -v ~/.maxkb:/var/lib/postgresql/data 1panel/maxkb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户名: admin</span></span><br><span class="line"><span class="comment"># 密码: MaxKB@123..</span></span><br></pre></td></tr></table></figure><p>docker-compose方式部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  maxkb:</span><br><span class="line">    <span class="comment">#image: registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:zznnwn-maxkb</span></span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:maxkb-zd</span><br><span class="line">    <span class="comment"># 1panel/maxkb</span></span><br><span class="line">    container_name: maxkb</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ~/.maxkb:/var/lib/postgresql/data</span><br></pre></td></tr></table></figure><h2 id="二-使用"><a href="#二-使用" class="headerlink" title="二. 使用"></a>二. 使用</h2><ul><li>系统设置——模型——添加模型</li><li>知识库——创建知识库</li><li>应用——创建特定功能应用</li></ul><h2 id="三-对接oneapi"><a href="#三-对接oneapi" class="headerlink" title="三. 对接oneapi"></a>三. 对接oneapi</h2><ul><li>API域名：<a href="http://192.168.30.69:3000/v1">http://192.168.30.69:3000/v1</a></li><li>API KEY:  使用oneapi生成的key</li></ul><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/706aff61c16b2461c19832f3ff3478e_6235ec82459de423aa720924cc3adec8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/706aff61c16b2461c19832f3ff3478e_6235ec82459de423aa720924cc3adec8.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_dee2044e670622e3092cfed2755c916e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_dee2044e670622e3092cfed2755c916e.png"></p><h2 id="四-效果"><a href="#四-效果" class="headerlink" title="四. 效果"></a>四. 效果</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c968720d48c42e71925c7c325bf39e88.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c968720d48c42e71925c7c325bf39e88.png"></p><p>本文参考：</p><p><a href="https://github.com/1panel-dev/MaxKB">https://github.com/1panel-dev/MaxKB</a></p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kvm教程</title>
      <link href="/2024/04/20/kvm%E6%95%99%E7%A8%8B/"/>
      <url>/2024/04/20/kvm%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="kvm教程"><a href="#kvm教程" class="headerlink" title="kvm教程"></a>kvm教程</h1><h3 id="虚拟化的定义"><a href="#虚拟化的定义" class="headerlink" title="虚拟化的定义"></a>虚拟化的定义</h3><p>虚拟化技术最早出现在60年代的IBM大型机系统，这些机器通过Hypervisor(又称虚拟机监控器)的程序在一台物理的服务器上可以跑多台虚拟机(VirtualMachine，VM)，虚拟机共享物理机的CPU、内存、10 等硬件资源，但逻辑上虚拟机之间是相互隔离的。</p><h3 id="常见的Hypervisor类型"><a href="#常见的Hypervisor类型" class="headerlink" title="常见的Hypervisor类型"></a>常见的Hypervisor类型</h3><p><strong>类型1-裸机型</strong>:  直接运行在硬件设备上的，这种架构搭建的虚拟化环境称为裸机虚拟化环境，例如:VMware ESXl<br><strong>类型I1-主机托管型</strong>:  运行在具有虚拟化功能的操作系统上的，这种架构构建的是主机虚拟化环境，例<br><strong>如</strong>: VMware Workstation.VirtualBox、KVM、xen等。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_2121384e9f54523bd1280ade709ccda4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_2121384e9f54523bd1280ade709ccda4.png"></p><h3 id="虚拟化的类型"><a href="#虚拟化的类型" class="headerlink" title="虚拟化的类型"></a>虚拟化的类型</h3><p><strong>服务器虚拟化</strong>: 可在一台物理机上运行多个虚拟机，各虚拟机之间相互隔离互不影响，虚拟机的完整状态保存到文件中，移动和复制虚拟机就像移动和复制文件一样轻松，可将任意虚拟机调配或迁移到其他理服务器上。</p><p><strong><strong>容器虚技术</strong>: 典型的就是docker、Linux Container(LXC)等</strong></p><p><strong>网络虚拟化</strong>: 通过软件定义网络，即网络的创建不再依赖于物理设备，如公有云厂商允许用户自己创建新的网络，在kubernetes、openstack中都会使用到网络虚拟化。</p><h3 id="虚拟化技术分类"><a href="#虚拟化技术分类" class="headerlink" title="虚拟化技术分类"></a>虚拟化技术分类</h3><p><strong>全虚拟化</strong>: Hypervisor 直接安装在物理机上，多个虚拟机在 Hypervisor 上运行，Hypervisor 实现方式一般是一个特殊定制的 Linux 系统，<strong>例如</strong>: Xen和VMWare ESXi 都属于这个类型。（适用于企业私有）**</p><p><strong>硬件辅助虚拟化</strong>: KVM是硬件辅助的虚拟化技术，主要负责比较繁琐的<strong>CPU</strong>和<strong>内存虚拟化</strong>，而<strong>Qemu</strong>则负责<strong>I/0</strong>虚拟化。（适用于公有云）</p><p><strong>虚拟化模拟器</strong>: Qemu 模拟器在生产环境中，大多数的做法都是配合KVM来完成虚拟化工作，KVM完成复杂及要求比较高的CPU和内存的虚拟化，而Qemu完成像硬盘、鼠标、键盘等设备的虚拟化。（适用于公有云）</p><h3 id="KVM虚拟化介绍"><a href="#KVM虚拟化介绍" class="headerlink" title="KVM虚拟化介绍"></a>KVM虚拟化介绍</h3><p><strong>KVM</strong> 是Kernel-based Virtual Machine(基于内核的虚拟机)的简称，是一个开源的Linux系统内核虚拟化模块，自Linux2.6之后集成在Linux的各个主要发行版本中，KVM目前已成为学术界主流的hypervisor。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ab78ebf3ee7974ceac39b802b6d3b861.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ab78ebf3ee7974ceac39b802b6d3b861.png"></p><h3 id="虚拟机常用的管理工具"><a href="#虚拟机常用的管理工具" class="headerlink" title="虚拟机常用的管理工具"></a>虚拟机常用的管理工具</h3><p><strong>libvirt:</strong> 是调用KVM创建虚拟机的工具，其不但能管理KVM，还能管理VMware、Xen、Hyper-V、virtualBox等虚拟化方案。</p><p><strong>virsh</strong>: 是一个常用的管理KVM虚拟化的命令行工具。</p><p><strong>virt-manager</strong>:  virt-manager是一个虚拟化管理图形软件，包括虚拟机的创建、删除、启动、停止以及一些简单的监控功能等。（很少使用不安装）</p><p><strong>openstack</strong>:  openstack是一个开源的虚拟化集群统一管理的平台，常用于构建大规模的虚拟化环境，用于管理成千上万虚拟机的创建、启动、删除等整个生命周期</p><blockquote><p>生产环境中 创建虚拟机一律使用此命令（下方两参数根据宿主机cpu mem实际合理范围更改）</p><ul><li><strong>maxmemory</strong>=2048   最大支持的内存核心数</li><li><strong>maxvcpus</strong>=4             最大支持的CPU核心数</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建虚拟机</span></span><br><span class="line">virt-install --virt-type kvm \</span><br><span class="line">--os-type=linux \</span><br><span class="line">--os-variant rhel7 \</span><br><span class="line">--name web04 \</span><br><span class="line">--memory 1024,maxmemory=2048 \</span><br><span class="line">--vcpus 1,maxvcpus=4 --disk /kvm/web04-vda.qcow2,format=qcow2,size=10 \</span><br><span class="line">--cdrom /opt/CentOS-7-x86_64-Minimal-2009.iso --network bridge=br0 --graphics vnc,listen=0.0.0.0 --noautoconsole </span><br></pre></td></tr></table></figure></blockquote><h2 id="二-安装kvm虚拟化管理工具（本教程环境workstdtion）"><a href="#二-安装kvm虚拟化管理工具（本教程环境workstdtion）" class="headerlink" title="二. 安装kvm虚拟化管理工具（本教程环境workstdtion）"></a>二. 安装kvm虚拟化管理工具（本教程环境workstdtion）</h2><table><thead><tr><th><strong>主机名称</strong></th><th><strong>IP地址</strong></th><th><strong>系统环境</strong></th><th><strong>硬件环境</strong></th></tr></thead><tbody><tr><td><strong>kvm01</strong></td><td><strong>10.0.0.10</strong></td><td><strong>centos7.9</strong></td><td><strong>4C8G50G</strong></td></tr></tbody></table><h3 id="虚拟机CPU开启虚拟化功能"><a href="#虚拟机CPU开启虚拟化功能" class="headerlink" title="虚拟机CPU开启虚拟化功能"></a>虚拟机CPU开启虚拟化功能</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_17270590f1aeca75a8028b0714cd4f21.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_17270590f1aeca75a8028b0714cd4f21.png"></p><p><strong>开机后检测CPU是否支持嵌套虚拟化</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# egrep -o &#x27;vmx|svm&#x27; /proc/cpuinfo</span><br><span class="line">vmx</span><br><span class="line">vmx  显示已载入的系统模块</span><br></pre></td></tr></table></figure><h3 id="安装KVM相关软件包"><a href="#安装KVM相关软件包" class="headerlink" title="安装KVM相关软件包"></a>安装KVM相关软件包</h3><p><strong>准备工作 本文执行初始化脚本本项目不执行</strong>（可选）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm /etc/yum.repos.d</span><br><span class="line">mount /dev/cdrom /mnt</span><br><span class="line">vim /etc/fstab </span><br><span class="line">/dev/cdrom  /mnt  iso9660  default 0  0 </span><br><span class="line">vim  /etc/yum.repos.d/local.repo</span><br><span class="line">[local]</span><br><span class="line">name=local</span><br><span class="line">baseurl=file:///mnt</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure><p><strong>libvirt</strong>:  用于创建虚拟机</p><p><strong>virt-install</strong>：虚拟机的安装工具和克隆工具(非常重要的功能)</p><p><strong>qemu-kvm</strong>:  管理虚拟机的磁盘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 检测源</span><br><span class="line">yum repolist</span><br><span class="line"># 安装软件</span><br><span class="line">yum insta1l libvirt virt-install qemu-kvm -y</span><br><span class="line"># 启动服务</span><br><span class="line">systemctl start libvirtd &amp;&amp; systemctl enable libvirtd &amp;&amp; systemctl status libvirtd</span><br></pre></td></tr></table></figure><h3 id="创建KVM虚拟机（选择轻量镜像方便实验上传下载）"><a href="#创建KVM虚拟机（选择轻量镜像方便实验上传下载）" class="headerlink" title="创建KVM虚拟机（选择轻量镜像方便实验上传下载）"></a>创建KVM虚拟机（选择轻量镜像方便实验上传下载）</h3><p><strong>提前将centos镜像上传到系统内用于给kvm虚拟机安装系统</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提前将centos7镜像传到系统内用于给KVM虚拟机安装系统</span></span><br><span class="line"><span class="built_in">mv</span> CentOS-7-x86_64-Minimal-2009.iso /opt</span><br><span class="line"><span class="comment"># 创建KVM虛拟机</span></span><br><span class="line">virt-install --virt-type kvm \</span><br><span class="line">--os-type=linux \</span><br><span class="line">--os-variant rhel7 \</span><br><span class="line">--name web01 \</span><br><span class="line">--memory 1024 \</span><br><span class="line">--vcpus 1 --disk /opt/web01-vda.raw,format=raw,size=10 --cdrom /opt/CentOS-7-x86_64-Minimal-2009.iso \</span><br><span class="line">--network network=default --graphics vnc,listen=0.0.0.0 --noautoconsole </span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数解释:</span></span><br><span class="line">--virt-type kvm  <span class="comment"># 虚拟化的类型</span></span><br><span class="line">--os-type=linux  <span class="comment"># 系统类型</span></span><br><span class="line">--os-variant     <span class="comment"># rhel7系统版本</span></span><br><span class="line">--name webO1     <span class="comment"># 虚拟机的名字</span></span><br><span class="line">--memory 1024    <span class="comment"># 虚拟机的内存</span></span><br><span class="line">--vcpus 1        <span class="comment"># 虚拟cpu的核数</span></span><br><span class="line">--disk /opt/web0l-vda.raw,format=raw,size=10  <span class="comment"># 磁盘位置及名称,磁盘格式,空间大小(G)</span></span><br><span class="line">--cdrom /opt/CentOS-7-x86_64-Minimal-2009.iso <span class="comment"># 系统镜像位置及名称</span></span><br><span class="line">--network network=default     <span class="comment"># 使用默认网络(默认NAT)</span></span><br><span class="line">--graphics vnc,listen=0.0.0.0 <span class="comment"># 开启VNC</span></span><br><span class="line">--noautoconsole               <span class="comment"># 服务器端支持console登录 </span></span><br></pre></td></tr></table></figure><p><strong>翻译</strong>：安装完成后需要去控制台完成安装 电脑安装一个或者使用mobaxterm连接完成安装</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_94db20daccc7489e24ae4fbc9e524935.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_94db20daccc7489e24ae4fbc9e524935.png"></p><p>虚拟机vnc暴露端口<strong>5900</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm opt]<span class="comment"># ss -ntulp</span></span><br><span class="line">Netid State      Recv-Q Send-Q   Local Address:Port      Peer Address:Port              </span><br><span class="line">tcp   LISTEN     0      1     *:5900    <span class="built_in">users</span>:((&quot;qemu-kvm&quot;,pid=<span class="number">3551</span>,fd=<span class="number">19</span>))</span><br></pre></td></tr></table></figure><p><strong>连接过来之后便在此安装页面</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d271ac8899700a02171525adff77649f.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d271ac8899700a02171525adff77649f.png"></p><p>此时按照正常安装流程即可 安装完成后点击重启此时不会重启 需要我们手动打开（通过 <strong>ss -ntulp</strong> 查看 <strong>qemo-kvm</strong> 端口 通过 <strong>vnc</strong> 连接虚拟机查看虚拟机 <strong>IP</strong> 地址）其实此时我们 可以通过宿主机 使用此虚拟机 <strong>IP：192.168.122.39</strong> 连上虚拟机  并且由于此此虚拟机网络是 <strong>NAT</strong> 模式 是可以借助宿主机去访问 <strong>外网</strong> 的。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_5387c7f9aad4ae74127c22f44a330630.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_5387c7f9aad4ae74127c22f44a330630.png"></p><h2 id="三-kvm常用命令使用"><a href="#三-kvm常用命令使用" class="headerlink" title="三. kvm常用命令使用"></a>三. kvm常用命令使用</h2><blockquote><p><a href="https://zznn-cloud.github.io/2024/02/19/openstack%E4%B8%8A%E4%BD%BF%E7%94%A8windows%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/?highlight=%E5%88%9B%E5%BB%BA">此前创建windows类型虚拟机见链接</a></p><h3 id="一-virsh常用命令概览"><a href="#一-virsh常用命令概览" class="headerlink" title="一. virsh常用命令概览"></a>一. virsh常用命令概览</h3><p>练习命令之前安装 <code>yum install -y bash-*</code>用于命令补全</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># 查看刚通过镜像启动的虚拟机虚拟机 / 查看--os-variant支持的类型</span><br><span class="line">virsh list             # 列出正在运行的虚拟机</span><br><span class="line">osinfo-query os        # 查看支持的类型</span><br><span class="line"># virt-install常用命令</span><br><span class="line">virsh list --all       # 列出所有虚机</span><br><span class="line">virsh start  web01     # 启动指定虚机</span><br><span class="line">virsh reboot web01     # 重启指定虚机（关闭状态无法重启）</span><br><span class="line">virsh console name     # 连接虚拟机</span><br><span class="line">virsh destroy name     # 拔掉电源（很少用）</span><br><span class="line"></span><br><span class="line">virsh undefine web01   # 删除虚机文件即删除虚拟机（不会删除磁盘文件）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">virsh domblklist web01             # 查看虚拟机磁盘信息</span><br><span class="line">virsh dominfo    web01             # 查看虚拟机配置信息</span><br><span class="line">virsh domiflist  web01             # 查看虚拟网卡信息</span><br><span class="line">virsh dumpxml    web01             # 以 xml格式查看虚拟机</span><br><span class="line">virsh define     file-name        # 导入虚拟机</span><br><span class="line">virsh edit       name             # 编辑虚拟机配置（一般是在刚定义完虚拟机之后）自带语法检测</span><br><span class="line">virsh domrename  old-name  new-name   # 虚拟机重命名</span><br><span class="line">virsh vncdisplay web01                # 查看vnc端口</span><br><span class="line">virsh autostart  name                 # 虚拟机随机重启</span><br><span class="line">virsh autostart --disable name        # 取消虚拟机随机重启</span><br><span class="line"></span><br><span class="line"># 图形界面：</span><br><span class="line">通过执行名virt-manager，启动libvirt的图形界面，在图形界面下可以一步一步的创建虚拟机，管理虚拟机，还可以直接控制虚拟机的桌面。</span><br><span class="line"># 命令行：</span><br><span class="line">virsh list                              # 显示本地活动虚拟机</span><br><span class="line">virsh list –all                         # 显示本地所有的虚拟机（活动的+不活动的）</span><br><span class="line">virsh define ubuntu.xml                 # 通过配置文件定义一个虚拟机（这个虚拟机还不是活动的）</span><br><span class="line">virsh start ubuntu                      # 启动名字为ubuntu的非活动虚拟机</span><br><span class="line">virsh create ubuntu.xml                 # 创建虚拟机（创建后，虚拟机立即执行，成为活动主机）</span><br><span class="line">virsh suspend ubuntu                    # 暂停虚拟机</span><br><span class="line">virsh resume ubuntu                     # 启动暂停的虚拟机</span><br><span class="line">virsh shutdown web01          # 正常关闭虚拟机</span><br><span class="line">virsh destroy ubuntu          # 强制拔掉电源关闭虚拟机（很少使用）</span><br><span class="line"></span><br><span class="line">virsh domname 2                         # 显示id号为2的虚拟机名                                </span><br><span class="line">virsh domid ubuntu                      # 显示虚拟机id号                               </span><br><span class="line">virsh domuuid ubuntu                    # 显示虚拟机的uuid           </span><br><span class="line">virsh domstate ubuntu                   # 显示虚拟机的当前状态          </span><br><span class="line">virsh dumpxml ubuntu                    # 显示虚拟机的当前配置文件（可能和定义虚拟机时的配置不同，因为当虚拟机启动时，需要给# 虚拟机分配id号、uuid、vnc端口号等等）          </span><br><span class="line">virsh setmem ubuntu 512000               # 给不活动虚拟机设置内存大小  </span><br><span class="line">virsh setvcpus ubuntu 4                  # 给不活动虚拟机设置cpu个数          </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="二-备份恢复虚拟机"><a href="#二-备份恢复虚拟机" class="headerlink" title="二. 备份恢复虚拟机"></a>二. 备份恢复虚拟机</h3><p><strong>备份虚拟机</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导出虚拟机配置文件</span></span><br><span class="line">virsh dumpxml web01 &gt; web01_bak.xml</span><br><span class="line"><span class="comment"># 此时我们模拟一下恢复虚拟机先删除虚拟机</span></span><br></pre></td></tr></table></figure><p><strong>删除虚拟机（先关机再删除） 此时磁盘文件仍然是被保留的</strong></p><p><strong>备注</strong>：此步骤为模拟恢复虚拟机执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virsh shutdown web01</span><br><span class="line">virsh undefine web01 </span><br><span class="line">virsh list --all</span><br></pre></td></tr></table></figure><p><strong>恢复虚拟机（以刚才的备份文件导入虚拟机）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从备份文件导入虚拟机</span></span><br><span class="line">virsh define web01_bak.xml</span><br><span class="line"><span class="comment"># 此时再看刚才的虚拟机又回来了</span></span><br><span class="line">virsh list --all</span><br><span class="line"></span><br><span class="line">Id    Name                           State</span><br><span class="line">-----------------------------------------</span><br><span class="line"> -    web01                          shut off</span><br></pre></td></tr></table></figure><p><strong>为什么又回来了呢 因为我们使用virsh undefine  删除的是 /etc/libvirt/qemu 路径下对应的虚拟机配置文件</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_cbceb58948ef431e9a1f63b2c22da55b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_cbceb58948ef431e9a1f63b2c22da55b.png"></p><h3 id="三-虚拟机磁盘文件迁移"><a href="#三-虚拟机磁盘文件迁移" class="headerlink" title="三. 虚拟机磁盘文件迁移"></a>三. 虚拟机磁盘文件迁移</h3><p>备注：我们创建虚拟机时会 生成了一个raw格式的磁盘文件 web01-vda.raw</p><p><strong>创建kvm路径，将虚拟机磁盘文件移动到该目录</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建kvm路径，将虚拟机磁盘文件移动到该目录</span></span><br><span class="line"><span class="built_in">mkdir</span> /kvm &amp;&amp; <span class="built_in">mv</span> /opt/web01-vda.raw /kvm &amp;&amp; <span class="built_in">cd</span> /kvm &amp;&amp; <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><p><strong>编辑虚拟机配置（自带语法检测）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份虚拟机配置（编辑前先备份）</span></span><br><span class="line">virsh dumpxml web01 &gt; web01_bak.xml</span><br><span class="line"><span class="comment"># 编辑虚拟机配置</span></span><br><span class="line">virsh edit web01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改路径 /opt/web01-vda.raw &gt;&gt; /kvm/web01-vda.raw（修改前）</span></span><br><span class="line">  &lt;devices&gt;</span><br><span class="line">    &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;</span><br><span class="line">    &lt;disk <span class="built_in">type</span>=<span class="string">&#x27;file&#x27;</span> device=<span class="string">&#x27;disk&#x27;</span>&gt;</span><br><span class="line">      &lt;driver name=<span class="string">&#x27;qemu&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;raw&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">source</span> file=<span class="string">&#x27;/opt/web01-vda.raw&#x27;</span>/&gt;   <span class="comment"># 此路径</span></span><br><span class="line">      &lt;target dev=<span class="string">&#x27;vda&#x27;</span> bus=<span class="string">&#x27;virtio&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x06&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/disk&gt;</span><br><span class="line">    &lt;disk <span class="built_in">type</span>=<span class="string">&#x27;file&#x27;</span> device=<span class="string">&#x27;cdrom&#x27;</span>&gt;</span><br><span class="line">      &lt;driver name=<span class="string">&#x27;qemu&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;raw&#x27;</span>/&gt;</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 修改后</span></span><br><span class="line">   &lt;devices&gt;</span><br><span class="line">    &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;</span><br><span class="line">    &lt;disk <span class="built_in">type</span>=<span class="string">&#x27;file&#x27;</span> device=<span class="string">&#x27;disk&#x27;</span>&gt;</span><br><span class="line">      &lt;driver name=<span class="string">&#x27;qemu&#x27;</span> <span class="built_in">type</span>=<span class="string">&#x27;raw&#x27;</span>/&gt;</span><br><span class="line">      &lt;<span class="built_in">source</span> file=<span class="string">&#x27;/kvm/web01-vda.raw&#x27;</span>/&gt;    <span class="comment"># 此路径</span></span><br><span class="line">      &lt;target dev=<span class="string">&#x27;vda&#x27;</span> bus=<span class="string">&#x27;virtio&#x27;</span>/&gt;</span><br><span class="line">      &lt;address <span class="built_in">type</span>=<span class="string">&#x27;pci&#x27;</span> domain=<span class="string">&#x27;0x0000&#x27;</span> bus=<span class="string">&#x27;0x00&#x27;</span> slot=<span class="string">&#x27;0x06&#x27;</span> <span class="keyword">function</span>=<span class="string">&#x27;0x0&#x27;</span>/&gt;</span><br><span class="line">    &lt;/disk&gt;</span><br><span class="line"><span class="comment"># 此时启动虚拟机</span></span><br><span class="line">virsh start web01</span><br><span class="line"></span><br><span class="line">[root@kvm kvm]<span class="comment"># virsh start web01</span></span><br><span class="line">Domain web01 started</span><br><span class="line"></span><br><span class="line">[root@kvm kvm]<span class="comment"># virsh list --all</span></span><br><span class="line"> Id    Name                           State</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 5     web01                          running</span><br></pre></td></tr></table></figure><h3 id="四-虚拟机重命名（只能在关机状态改名）"><a href="#四-虚拟机重命名（只能在关机状态改名）" class="headerlink" title="四. 虚拟机重命名（只能在关机状态改名）"></a>四. 虚拟机重命名（只能在关机状态改名）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关机</span></span><br><span class="line">virsh shutdown web01</span><br><span class="line"><span class="comment"># 改名</span></span><br><span class="line">virsh domrename web01 centos-web01</span><br></pre></td></tr></table></figure><h3 id="五-查看虚拟机-vnc-端口（虚拟机太多之后-VNC-端口就会不一样）只有启动状态才会有-VNC-端口"><a href="#五-查看虚拟机-vnc-端口（虚拟机太多之后-VNC-端口就会不一样）只有启动状态才会有-VNC-端口" class="headerlink" title="五. 查看虚拟机 vnc 端口（虚拟机太多之后 VNC 端口就会不一样）只有启动状态才会有 VNC 端口"></a>五. 查看虚拟机 vnc 端口（虚拟机太多之后 VNC 端口就会不一样）只有启动状态才会有 VNC 端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">virsh start web01</span><br><span class="line"><span class="comment"># 查看vnc端口</span></span><br><span class="line">virsh vncdisplay web01</span><br><span class="line">// 返回</span><br><span class="line">:0</span><br></pre></td></tr></table></figure><p>**备注：单台虚拟机时返回 其实此 **<strong>0</strong> 代表默认端口 <strong>5900</strong> 多台时便会网上增加 如两台时 显示 <strong>1</strong> 即 从 <strong>5900</strong> 往上加 <strong>1</strong> 即 <strong>5901</strong></p><h3 id="六-虚拟机随机自启（-为了宿主机重启后虚拟机也会重启-）否则宿主机重启-虚拟机不会自启动"><a href="#六-虚拟机随机自启（-为了宿主机重启后虚拟机也会重启-）否则宿主机重启-虚拟机不会自启动" class="headerlink" title="六.  虚拟机随机自启（ 为了宿主机重启后虚拟机也会重启 ）否则宿主机重启 虚拟机不会自启动"></a>六.  虚拟机随机自启（ 为了宿主机重启后虚拟机也会重启 ）否则宿主机重启 虚拟机不会自启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置与宿主机一起随机自启</span></span><br><span class="line">virsh autostart web01</span><br><span class="line"><span class="comment"># 查看那些虚拟机设置了随机自启（一个都没有设置的话此目录不会生成与虚拟机相同名字的文件）</span></span><br><span class="line"><span class="built_in">cd</span> /etc/libvirt/qemu/autostart &amp;&amp; <span class="built_in">ls</span></span><br><span class="line">web01.xml</span><br><span class="line"><span class="comment"># 取消随机自启（此时此/etc/libvirt/qemu/autostart目录对应文件已消失）</span></span><br><span class="line">virsh autostart web01 --<span class="built_in">disable</span></span><br></pre></td></tr></table></figure><h3 id="七-通过console登录kvm"><a href="#七-通过console登录kvm" class="headerlink" title="七. 通过console登录kvm"></a>七. 通过<code>console</code>登录<code>kvm</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过console登录虚拟机控制台</span></span><br><span class="line">virsh console web01</span><br><span class="line">// 返回</span><br><span class="line">Connected to domain web01</span><br><span class="line">Escape character is ^]  <span class="comment"># ctrl + ] 退出，默认无法登录</span></span><br></pre></td></tr></table></figure><p><strong>虚拟机配置允许<code>console</code>登录</strong></p><p>进入 <strong>KVM</strong> 虚拟机修改内核参数允许 <strong>console</strong> 登录，先通过 <strong>VNC</strong> 查看虚拟机 <strong>IP</strong> 地址，在通过宿主机 <strong>ssh</strong> 方式登录到 <strong>KVM</strong> 内部增加该配置项: grubby-update-kernel=ALL-args=”console=ttyS0,115200n8”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入kvm虚拟机</span></span><br><span class="line">ssh -p22 root@192.168.122.39</span><br><span class="line"><span class="comment"># 修改内核参数</span></span><br><span class="line">grubby --update-kernel=ALL --args=<span class="string">&quot;console=ttyS0,115200n8&quot;</span></span><br><span class="line"><span class="comment"># 重启虚拟机生效</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p><strong>验证 console 登录</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># console 登录虚拟机</span></span><br><span class="line">virsh console web01</span><br><span class="line">// 返回</span><br><span class="line">Connected to domain web01</span><br><span class="line">Escape character is ^]   <span class="comment"># 回车</span></span><br><span class="line"></span><br><span class="line">CentOS Linux 7 (Core)</span><br><span class="line">Kernel 3.10.0-1160.el7.x86_64 on an x86_64</span><br><span class="line"></span><br><span class="line">localhost login:         <span class="comment"># 此时出现登录选项</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ee9df9423348cd4db4a62b05f970e4a5.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ee9df9423348cd4db4a62b05f970e4a5.png"></p></blockquote><h2 id="四-KVM磁盘管理"><a href="#四-KVM磁盘管理" class="headerlink" title="四. KVM磁盘管理"></a>四. <code>KVM</code>磁盘管理</h2><p><strong>kvm磁盘格式介绍</strong></p><p><strong>raw</strong>: 老牌格式，用一个字来说就是裸，也就是赤裸裸，指定多大空间就创建多大空间，直接占用指定大小的空间分 <strong>50G</strong> 占用 <strong>50G</strong> ，性能上来说的话还是不错的，不支持快照功能。</p><p><strong><strong>cow</strong>: 曾经 qemu 的写时拷贝的镜像格式（用户在修改数据时，系统会拷贝一份源文件副本到内存中让其修改，等到数据真正被修改时才分配空间）目前由于历史遗留原因不支持窗口模式。从某种意义上来说是个弃婴，还没等它成熟就死在腹中，后来被 qcow 格式所取代。</strong> <strong><strong>qcow</strong>: 一代的 qemu 的 cow 格式，刚刚出现的时候有比较好的特性，但其性能和 raw 格式对比还是有很大的差距，目前已经被新版本的qcow2 取代。</strong></p><p><strong>qcow2</strong>: 是 openstack 默认也是比较推荐的格式，文件比较小而且做快照也比较小，空间是动态增长（用多少占多少 但不会超过定义的容量），是目前比较主流的一种虚拟化镜像格式，经过一代的优化，目前 qcow2 的性能上接近 raw 裸格式的性能。</p><p><strong>我们创建时就是使用 raw 格式创建的</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_6aadb90398f3b87f7888616461239e9d.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_6aadb90398f3b87f7888616461239e9d.png"></p><p><strong>查看虚拟机磁盘</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看虚拟机磁盘</span></span><br><span class="line">virsh domblklist web01</span><br><span class="line">// 返回</span><br><span class="line">Target     Source</span><br><span class="line">------------------------------------------------</span><br><span class="line">vda         /kvm/web01-vda.raw</span><br><span class="line">hda         -</span><br></pre></td></tr></table></figure><p><strong>查看磁盘详细信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看磁盘详细信息</span></span><br><span class="line">qemu-img info /kvm/web01-vda.raw</span><br><span class="line">// 返回</span><br><span class="line">image: /kvm/web01-vda.raw</span><br><span class="line">file format: raw</span><br><span class="line">virtual size: 10G (10737418240 bytes)</span><br><span class="line">disk size: 1.7G</span><br></pre></td></tr></table></figure><h3 id="1-创建-qcow2-格式磁盘的虚拟机"><a href="#1-创建-qcow2-格式磁盘的虚拟机" class="headerlink" title="1. 创建 qcow2 格式磁盘的虚拟机"></a><code>1.</code> 创建 qcow2 格式磁盘的虚拟机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 qcow2 格式磁盘的虚拟机</span></span><br><span class="line">virt-install --virt-type kvm \</span><br><span class="line">--os-type=linux \</span><br><span class="line">--os-variant rhel7 \</span><br><span class="line">--name web02 \</span><br><span class="line">--memory 1024 \</span><br><span class="line">--vcpus 1 --disk /kvm/web02-vda.qcow2,format=qcow2,size=10 --cdrom /opt/CentOS-7-x86_64-Minimal-2009.iso \</span><br><span class="line">--network network=default --graphics vnc,listen=0.0.0.0 --noautoconsole </span><br></pre></td></tr></table></figure><p><strong>查看 VNC 端口 可见端口是 5901</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm kvm]<span class="comment"># virsh vncdisplay web02</span></span><br><span class="line">:1</span><br></pre></td></tr></table></figure><p><strong>VNC 连接</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_7185c32c48a56a379db496bfe893fee4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_7185c32c48a56a379db496bfe893fee4.png"></p><h3 id="2-qcow2格式磁盘虚拟机使用"><a href="#2-qcow2格式磁盘虚拟机使用" class="headerlink" title="2. qcow2格式磁盘虚拟机使用"></a><code>2. qcow2</code>格式磁盘虚拟机使用</h3><p><strong>查看磁盘格式</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看磁盘格式</span></span><br><span class="line">qemu-img info web02-vda.qcow2</span><br><span class="line">//返回</span><br><span class="line">image: web02-vda.qcow2</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 10G (10737418240 bytes)</span><br><span class="line">disk size: 1.5G         <span class="comment"># 用多少占多少</span></span><br><span class="line">cluster_size: 65536</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    lazy refcounts: <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>操作</strong>：</p><ul><li><strong>开机虚拟机宿主机重启虚拟机自启动</strong><code>virsh autostart web01</code></li><li><strong>登录：</strong><code>ssh -p22 root@192.168.122.46</code></li><li><strong>虚拟机配置允许 console 登录：</strong><code>grubby --update-kernel=ALL --args=&quot;console=ttyS0,115200n8&quot;</code></li><li><strong>生效（</strong><code>virsh shutdown web02 &amp;&amp; virsh start web02</code>）</li><li><strong>通过console登录：</strong><code>virsh console web02</code></li></ul><h2 id="五-kvm磁盘虚拟机快照管理"><a href="#五-kvm磁盘虚拟机快照管理" class="headerlink" title="五. kvm磁盘虚拟机快照管理"></a>五. <code>kvm</code>磁盘虚拟机快照管理</h2><p><strong>raw 磁盘格式虚拟机****不支持做快照</strong>，qcow2 <strong>支持快照</strong>，并且快照就保存在 qcow2 的磁盘文件中。</p><h3 id="1-创建快照"><a href="#1-创建快照" class="headerlink" title="1.创建快照"></a><code>1.</code>创建快照</h3><p><strong>格式: virsh snapshot-create-as   –name  快照名称   虚拟机名称</strong></p><blockquote><p><strong>解释：</strong></p><p><strong>virsh snapshot-create-as 创建快照</strong> <strong>–name                   快照名称</strong> <strong>web02                    虚拟机名称</strong></p></blockquote><p>为 <strong>web02</strong> 虚拟机创建快照（开关机都可以做快照）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为 web02 虚拟机创建快照</span></span><br><span class="line">virsh snapshot-create-as --name  kuaizhao_web2_env_ok  web2</span><br><span class="line">//返回</span><br><span class="line">Domain snapshot kuaizhao_web2_env_ok created</span><br><span class="line"><span class="comment"># 创建成功后查看快照</span></span><br><span class="line">virsh snapshot-list web02</span><br><span class="line">//返回</span><br><span class="line"> Name                 Creation Time             State</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"> kuaizhao_web2_env_ok 2024-04-21 16:30:45 +0800 running</span><br></pre></td></tr></table></figure><p><strong>验证快照</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录虚拟机</span></span><br><span class="line">virsh console web02</span><br><span class="line"><span class="comment"># 创建快照测试文件</span></span><br><span class="line"><span class="built_in">touch</span> kuaizhao-test.txt</span><br></pre></td></tr></table></figure><h3 id="2-还原快照"><a href="#2-还原快照" class="headerlink" title="2. 还原快照"></a><code>2.</code> 还原快照</h3><p><strong>格式:  virsh snapshot-revert  虚拟机名称  –snapshotname  快照名称</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行恢复快照</span></span><br><span class="line">virsh snapshot-revert web02 --snapshotname kuaizhao_web2_env_ok</span><br></pre></td></tr></table></figure><p><strong>备注：查看创建的文件还存在不 （不存在 此时验证成功）</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d7d30c0888f72a011b3c3eafe594c960.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d7d30c0888f72a011b3c3eafe594c960.png"></p><blockquote><p><strong>提示：别删除虚拟机，删除虚拟机后没有虚拟机配置文件无法还原</strong></p></blockquote><h3 id="3-删除快照"><a href="#3-删除快照" class="headerlink" title="3. 删除快照"></a><code>3.</code> 删除快照</h3><p><strong>格式:  virsh  snapshot-delete 虚拟机名称  –snapshotname  快照名称</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除快照</span></span><br><span class="line">virsh snapshot-delete web02 --snapshotname kuaizhao_web2_env_ok </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看是否删除成功</span></span><br><span class="line">virsh snapshot-list web02</span><br><span class="line">//返回</span><br><span class="line"> Name                 Creation Time             State</span><br><span class="line">------------------------------------------------------------</span><br></pre></td></tr></table></figure><h2 id="六-kvm虚拟机克隆"><a href="#六-kvm虚拟机克隆" class="headerlink" title="六. kvm虚拟机克隆"></a>六. <code>kvm</code>虚拟机克隆</h2><p><strong>虚拟机的克隆方式分为完整克隆与链接克隆，下图是VMware虚拟机对完整克隆与链接克隆的解释</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_197336118a437919c95a1c428c7843e3.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_197336118a437919c95a1c428c7843e3.png"></p><h3 id="1-KVM完整克隆（虚拟机必须为关闭状态）"><a href="#1-KVM完整克隆（虚拟机必须为关闭状态）" class="headerlink" title="1. KVM完整克隆（虚拟机必须为关闭状态）"></a><code>1.</code> KVM完整克隆（虚拟机必须为关闭状态）</h3><p><strong>格式:  virt-clone –auto-c1one -o  虚拟机名称 -n  克隆名称</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virt-clone --auto-clone -o  web01 -n  web01-clone</span><br><span class="line">virsh list --all</span><br></pre></td></tr></table></figure><p><strong>virt-clone 这个命令是基于全克隆的，也就是拷贝虚拟磁盘文件和虚拟配置文件来实现的完整克隆，速度慢，占用空间多，克隆后磁盘文件位于虚拟机磁盘文件存放处 克隆后虚拟机配置文件位于 /etc/libvirt/qemu 。</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_fba87f13fbf52ded0499e19cf7ba2d85.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_fba87f13fbf52ded0499e19cf7ba2d85.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ff39c0b60324fd6b2061dee1d709a4fc.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ff39c0b60324fd6b2061dee1d709a4fc.png"></p><p><strong>验证克隆后的虚拟机 (成功)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动克隆后的虚拟机 </span></span><br><span class="line">virsh start web01-clone</span><br><span class="line"><span class="comment"># 克隆后的虚拟机和虚拟机是一样的所以可以通过console登录</span></span><br><span class="line">virsh console web01-clone</span><br></pre></td></tr></table></figure><p><strong>此时可以看到IP地址是不一样的 克隆以后我们不需要去手动更改别的例如IP等配置</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d5eebd88967b1ae72a00a4a5dc1dbf82.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d5eebd88967b1ae72a00a4a5dc1dbf82.png"></p><h3 id="1-KVM链接克隆（虚拟机必须为关闭状态）"><a href="#1-KVM链接克隆（虚拟机必须为关闭状态）" class="headerlink" title="1. KVM链接克隆（虚拟机必须为关闭状态）"></a><code>1.</code> KVM链接克隆（虚拟机必须为关闭状态）</h3><p>kvm并没有提供链接克隆的命令或工具，只能手动实现，实现方式是通过创建一个磁盘链接文件来实现的链接克隆。<strong>格式:  qemu-img create -f qcow2 -b 源磁盘文件  链接磁盘文件 （磁盘格式需要保持一致）</strong></p><ul><li><strong>-f 指定磁盘文件格式</strong></li><li><strong>-b 指定基于源磁盘文件创建一个链接磁盘文件</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建链接克隆（此时光有磁盘文件我们无法基于这个磁盘文件去创建虚拟机 还得修改磁盘文件配置）</span></span><br><span class="line">qemu-img create -f qcow2 -b /kvm/web02-vda.qcow2 /kvm/web02-1ink-clone-1.qcow2</span><br><span class="line"><span class="comment"># 查看链接磁盘文件信息</span></span><br><span class="line">qemu-img info /kvm/web02-1ink-clone-1.qcow2</span><br></pre></td></tr></table></figure><p>backing file: /kvm/web02-vda.qcow2 （源磁盘文件）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导出原始机的配置文件，并修改磁盘文件路径</span></span><br><span class="line">virsh dumpxml web02 &gt; web02-link-clone-1.xml</span><br><span class="line"><span class="comment"># 需要修改的内容如下</span></span><br><span class="line">vim web02-link-clone-1.xml</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 修改虚拟机名称(修改为克隆后的机器的名称)</span></span><br><span class="line">由 &lt;name&gt;web02&lt;/name&gt; 改 &lt;name&gt;web02-link-clone&lt;/name&gt;</span><br><span class="line"><span class="comment"># 删除uuid（删掉以后启动是会自动生成的）</span></span><br><span class="line">&lt;uuid&gt;0fb934c1-5232-410f-b290-97604f22307e&lt;/uuid&gt;</span><br><span class="line"><span class="comment"># 修改磁盘文件路径及名称</span></span><br><span class="line">由 &lt;<span class="built_in">source</span> file=<span class="string">&#x27;/kvm/web02-vda.qcow2&#x27;</span>/&gt; 改 &lt;<span class="built_in">source</span> file=<span class="string">&#x27;/kvm/web02-1ink-clone-1.qcow2&#x27;</span>/&gt;</span><br><span class="line"><span class="comment"># 删除mac地址（删掉以后启动是会自动生成的）</span></span><br><span class="line">&lt;mac address=<span class="string">&#x27;52:54:00:fb:cb:a4&#x27;</span>/&gt;</span><br><span class="line">...</span><br><span class="line">保存！</span><br><span class="line"><span class="comment"># 导入虚拟机</span></span><br><span class="line">virsh define web02-link-clone-1.xml</span><br><span class="line">virsh list</span><br><span class="line"><span class="comment"># 开启虚拟机</span></span><br><span class="line">virsh start web02-link-clone</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_523d5dd801e9c7ce92e49bc0d6fb1264.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_523d5dd801e9c7ce92e49bc0d6fb1264.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_906abec6cee86807f80f23a43c6ad276.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_906abec6cee86807f80f23a43c6ad276.png"></p><h2 id="七-KVM虚拟机网络配置"><a href="#七-KVM虚拟机网络配置" class="headerlink" title="七. KVM虚拟机网络配置"></a>七. KVM虚拟机网络配置</h2><p><strong>kvm虚拟机网络介绍</strong></p><p><strong>libvirt</strong> 服务安装后，默认会安装一块 <strong>virbr0</strong> 的虚拟网卡，libvirt 在创建 KVM 虚拟机后，默认使用了一个名为default的nat网络，地址段为 192.168.122.0/24，这个网络默认使用virbr0(虚拟交换机)作为桥接接口，为虚拟机提供网络转发服务，默认网段 192.168.122.0/24，使用dnsmasq 来为使用 nat 网络的虚拟机提供 dns 及 dhcp 服务。</p><p><strong>virbr0网卡 默认占用.1这个地址虚拟机地址从 .2 开始配置</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">virbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 52:54:00:28:9c:13 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p><strong>dhcp分配到虚拟机的ip列表在以下文件查看: /var/lib/libvirt/dnsmasq/default.conf （IP地址段可以使用，默认的也可以自行修改）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dhcp分配到虚拟机的ip列表</span></span><br><span class="line"><span class="built_in">cat</span>  /var/lib/libvirt/dnsmasq/default.conf</span><br><span class="line">...</span><br><span class="line"><span class="comment">##WARNING:  THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE</span></span><br><span class="line"><span class="comment">##OVERWRITTEN AND LOST.  Changes to this configuration should be made using:</span></span><br><span class="line"><span class="comment">##    virsh net-edit default</span></span><br><span class="line"><span class="comment">## or other application using the libvirt API.</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## dnsmasq conf file created by libvirt</span></span><br><span class="line">strict-order</span><br><span class="line">pid-file=/var/run/libvirt/network/default.pid</span><br><span class="line">except-interface=lo</span><br><span class="line">bind-dynamic</span><br><span class="line">interface=virbr0                          <span class="comment"># kvm虚拟机使用的网卡</span></span><br><span class="line">dhcp-range=192.168.122.2,192.168.122.254  <span class="comment"># dhcp分配的地址段</span></span><br><span class="line">dhcp-no-override</span><br><span class="line">dhcp-authoritative</span><br><span class="line">dhcp-lease-max=253</span><br><span class="line">dhcp-hostsfile=/var/lib/libvirt/dnsmasq/default.hostsfile</span><br><span class="line">addn-hosts=/var/lib/libvirt/dnsmasq/default.addnhosts</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="1-kvm虚拟机nat网络配置"><a href="#1-kvm虚拟机nat网络配置" class="headerlink" title="1.kvm虚拟机nat网络配置"></a><code>1.</code>kvm虚拟机nat网络配置</h3><p><strong>修改virbr0地址段</strong></p><p><strong>可以修改网段，也可以用默认网段，如需修改通过如下方式:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改地址段 (mac地址不更改 修改如下两段即可)</span></span><br><span class="line">virsh net-edit default</span><br><span class="line">原</span><br><span class="line">...</span><br><span class="line">  &lt;ip address=<span class="string">&#x27;192.168.122.1&#x27;</span> netmask=<span class="string">&#x27;255.255.255.0&#x27;</span>&gt;</span><br><span class="line">    &lt;dhcp&gt;</span><br><span class="line">      &lt;range start=<span class="string">&#x27;192.168.122.2&#x27;</span> end=<span class="string">&#x27;192.168.122.254&#x27;</span>/&gt;</span><br><span class="line">...</span><br><span class="line">修改为10地址段</span><br><span class="line">...</span><br><span class="line">  &lt;ip address=<span class="string">&#x27;192.168.10.1&#x27;</span> netmask=<span class="string">&#x27;255.255.255.0&#x27;</span>&gt;</span><br><span class="line">    &lt;dhcp&gt;</span><br><span class="line">      &lt;range start=<span class="string">&#x27;192.168.10.2&#x27;</span> end=<span class="string">&#x27;192.168.10.254&#x27;</span>/&gt;</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 保存</span></span><br></pre></td></tr></table></figure><p><strong>重新定义网络，default网络的配置文件: /etc/libvirt/qemu/networks/default.xml</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用此命令重新定义配置文件 (刷新)</span></span><br><span class="line">virsh net-define /etc/libvirt/qemu/networks/default.xml</span><br><span class="line">//返回</span><br><span class="line">Network default defined from /etc/libvirt/qemu/networks/default.xml</span><br><span class="line"><span class="comment"># 查看是否生效</span></span><br><span class="line"><span class="built_in">cat</span> /etc/libvirt/qemu/networks/default.xml</span><br><span class="line">...</span><br><span class="line">  &lt;ip address=<span class="string">&#x27;192.168.10.1&#x27;</span> netmask=<span class="string">&#x27;255.255.255.0&#x27;</span>&gt;</span><br><span class="line">    &lt;dhcp&gt;</span><br><span class="line">      &lt;range start=<span class="string">&#x27;192.168.10.2&#x27;</span> end=<span class="string">&#x27;192.168.10.254&#x27;</span>/&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>删除网络（关闭运行的虚拟机）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止网卡（关闭运行的虚拟机）</span></span><br><span class="line">virsh net-destroy default</span><br><span class="line"><span class="comment"># 关闭正在运行的虚拟机（可不关）</span></span><br><span class="line">virsh shutdown web02</span><br></pre></td></tr></table></figure><p><strong>启动网卡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动网卡</span></span><br><span class="line">virsh net-start default</span><br></pre></td></tr></table></figure><p><strong>重启libvirtd</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启libvirtd</span></span><br><span class="line">systemctl restart libvirtd</span><br></pre></td></tr></table></figure><p><strong>验证</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 宿主机执行</span></span><br><span class="line">ip a s</span><br><span class="line"><span class="comment"># 验证虚拟机网络 此时虚拟机网络已变成了10段</span></span><br><span class="line">virsh console web01</span><br><span class="line"><span class="comment"># 获取IP</span></span><br><span class="line">dhclient</span><br><span class="line">// 返回</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 52:54:00:00:75:bf brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.10.39/24 brd 192.168.10.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 3599sec preferred_lft 3599sec</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_257b8884805c43a286817995dfdf648e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_257b8884805c43a286817995dfdf648e.png"></p><p>从现在开始使用的 <strong>default</strong> 网络就是 <strong>10</strong> 段了</p><h3 id="2-kvm-虚拟机配置固定-IP"><a href="#2-kvm-虚拟机配置固定-IP" class="headerlink" title="2.kvm 虚拟机配置固定 IP"></a><code>2.</code>kvm 虚拟机配置固定 IP</h3><p><strong>启动一个KVM并登录并配置固定IP地址</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virsh start web02</span><br><span class="line">virsh console web02</span><br><span class="line">ip a s</span><br></pre></td></tr></table></figure><p><strong>kvm 配置固定 IP 地址（与传统物理机一样修改网卡配置文件就可以了）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none    <span class="comment"># 将默认的dhcp修改为none</span></span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=eth0</span><br><span class="line">UUID=0d71e612-7fca-4663-914e-9c9f356d0d82</span><br><span class="line">DEVICE=eth0</span><br><span class="line">ONBOOT=<span class="built_in">yes</span>       <span class="comment"># 修改为yes</span></span><br><span class="line"><span class="comment"># 新增</span></span><br><span class="line">IPADDR=<span class="string">&quot;192.168.10.10&quot;</span>                                               </span><br><span class="line">GATEWAY=<span class="string">&quot;192.168.10.1&quot;</span>                                        </span><br><span class="line">NETMASK=<span class="string">&quot;255.255.255.0&quot;</span>                                   </span><br><span class="line">DNS1=<span class="string">&quot;223.5.5.5&quot;</span></span><br></pre></td></tr></table></figure><p>修改后重启网卡生效：<strong>systemctl restart network</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_8ff6fe32b5abd9443531f7335d7b120f.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_8ff6fe32b5abd9443531f7335d7b120f.png"></p><p>**提示:  **<strong>KVM</strong> 虚拟机访问外部网络记住 <a href="https://wn-apple-teawine.fun/2023/06/02/%E9%85%8D%E7%BD%AEsnat%E4%BD%BF%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AEinternet%E7%9A%84%E5%86%85%E7%BD%91%E6%9C%BA%E5%99%A8%E9%80%9A%E8%BF%87%E5%85%B6%E4%BB%96%E6%9C%BA%E5%99%A8%E5%87%BA%E5%A4%96%E7%BD%91/?highlight=snat">iptables SNAT</a> 模式进行了源地址转换，如果外部网络需要访问到 <strong>KVM</strong> 虚拟机中，需要在宿主机通过 <strong>iptables</strong> 添加端口映射来实现，如果不希望通过端口映射来实现，可以使用 <strong>KVM的桥接网络</strong> 更加方便。</p><h2 id="九-kvm-创建桥接网络"><a href="#九-kvm-创建桥接网络" class="headerlink" title="九. kvm 创建桥接网络"></a>九. kvm 创建桥接网络</h2><p><strong>在KVM虚拟机中，Bridge(桥接)模式可以让 KVM 虚拟机和宿主机共享一个物理网络设备来连接网络，这样 KVM 虚拟机可以访问外部网络，而外部网络也可以直接访问 KVM 虚拟机，Bridge桥接模式使用非常方便，应用也非常广泛。</strong></p><p><strong>创建桥接网卡（执行创建后需要重启系统才能看到）</strong> 将宿主机工作的网卡绑定到 br0 桥接网卡上 (br0现在不存在)</p><ul><li><strong>格式: virsh iface-bridge ens32 br0</strong></li><li><strong>ens33 为宿主机网卡</strong></li><li><strong>br0 为桥接网卡</strong></li></ul><h3 id="1-创建桥接网卡"><a href="#1-创建桥接网卡" class="headerlink" title="1.创建桥接网卡"></a><code>1.</code>创建桥接网卡</h3><blockquote><p><a href="http://sunlight.zznnwn.cloudns.biz/2024/02/19/openstack%E4%B8%8A%E4%BD%BF%E7%94%A8windows%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/?highlight=%E9%95%9C%E5%83%8F">实现形式其实在博主另一篇文章中已有提及 | &gt; 链接</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将宿主机工作的网卡绑定到 br0 桥接网卡</span></span><br><span class="line">virsh iface-bridge ens33 br0</span><br><span class="line">//返回</span><br><span class="line">使用附加设备 br0 生成桥接 ens32 失败</span><br><span class="line"><span class="comment"># 重启系统后登录查看网卡</span></span><br><span class="line">ip a s </span><br><span class="line">...</span><br><span class="line">ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:23:67:1e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:23:67:1e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.10/8 brd 10.255.255.255 scope global br0</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 此时ping不通百度</span></span><br><span class="line">ping www.baidu.com</span><br><span class="line"><span class="comment"># 解决网卡添加DNS即可</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-br0</span><br><span class="line">...</span><br><span class="line">DEVICE=<span class="string">&quot;br0&quot;</span></span><br><span class="line">ONBOOT=<span class="string">&quot;yes&quot;</span></span><br><span class="line">TYPE=<span class="string">&quot;Bridge&quot;</span></span><br><span class="line">BOOTPROTO=<span class="string">&quot;none&quot;</span></span><br><span class="line">IPADDR=<span class="string">&quot;10.0.0.10&quot;</span></span><br><span class="line">GATEWAY=<span class="string">&quot;10.0.0.220&quot;</span></span><br><span class="line">IPV6INIT=<span class="string">&quot;yes&quot;</span></span><br><span class="line">IPV6_AUTOCONF=<span class="string">&quot;yes&quot;</span></span><br><span class="line">DHCPV6C=<span class="string">&quot;no&quot;</span></span><br><span class="line">STP=<span class="string">&quot;on&quot;</span></span><br><span class="line">DELAY=<span class="string">&quot;0&quot;</span></span><br><span class="line">DNS1=<span class="string">&quot;223.5.5.5&quot;</span>  <span class="comment"># 添加此</span></span><br><span class="line">....</span><br><span class="line"><span class="comment"># 生效</span></span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure><p><strong>备注：此时宿主机 ens33 网卡没有自己的 IP 地址，网卡寄生在它身上，网桥与物理网口 MAC 地址相同</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_9376b88c60933a7b09a87ec71a768aff.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_9376b88c60933a7b09a87ec71a768aff.png"></p><h2 id="十-创建-kvm-虚拟机使用桥接网络"><a href="#十-创建-kvm-虚拟机使用桥接网络" class="headerlink" title="十. 创建 kvm 虚拟机使用桥接网络"></a>十. 创建 <code>kvm</code> 虚拟机使用桥接网络</h2><p><strong>创建 kvm 虚拟机使用桥接网卡（安装完成系统）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 kvm 虚拟机使用桥接网卡</span></span><br><span class="line">virt-install --virt-type kvm \</span><br><span class="line">--os-type=linux \</span><br><span class="line">--os-variant rhel7 \</span><br><span class="line">--name web03 \</span><br><span class="line">--memory 1024 \</span><br><span class="line">--vcpus 1 --disk /kvm/web03-vda.qcow2,format=qcow2,size=10 --cdrom /opt/CentOS-7-x86_64-Minimal-2009.iso \</span><br><span class="line">--network bridge=br0 --graphics vnc,listen=0.0.0.0 --noautoconsole </span><br><span class="line"><span class="comment"># 查看列表</span></span><br><span class="line">virsh list</span><br><span class="line"><span class="comment"># 查看vnc端口（5902）</span></span><br><span class="line">virsh vncdisplay web03</span><br><span class="line">:2</span><br></pre></td></tr></table></figure><p><strong>配置静态地址 地址为与宿主机同一个网段 且没有被占用的网段</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_288e666dc41e472b5b532cc4fd38d635.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_288e666dc41e472b5b532cc4fd38d635.png"></p><p><strong>验证</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 等待相当一段时间</span></span><br><span class="line">virsh start web03</span><br><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">virsh list</span><br><span class="line"><span class="comment"># 远程连接测试（可连通外网正常ping通百度）</span></span><br><span class="line">ssh -p22 root@10.0.0.185</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ccce45df3c03202f8b55bc31adb1b817.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ccce45df3c03202f8b55bc31adb1b817.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_52de4dfd8d24e6c18177342d745e60f6.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_52de4dfd8d24e6c18177342d745e60f6.png"></p><h2 id="十一-修改kvm虚拟机使用桥接模式"><a href="#十一-修改kvm虚拟机使用桥接模式" class="headerlink" title="十一. 修改kvm虚拟机使用桥接模式"></a>十一. 修改<code>kvm</code>虚拟机使用桥接模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">virsh list</span><br></pre></td></tr></table></figure><p><strong>查看虚拟机网卡信息</strong> <strong>格式: virsh  domiflist 虚拟机名称</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看虚拟机web03网卡</span></span><br><span class="line">virsh domiflist web03</span><br><span class="line">//返回</span><br><span class="line">Interface  Type       Source     Model       MAC</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">vnet0      bridge     br0        virtio      52:54:00:68:3e:8d</span><br></pre></td></tr></table></figure><p><strong>关机状态下</strong> 修改网络模式为 <strong>bridge</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改虚拟机配置</span></span><br><span class="line">virsh edit web02</span><br><span class="line"></span><br><span class="line">原 &lt;interface <span class="built_in">type</span>=<span class="string">&#x27;network&#x27;</span>&gt;  改 &lt;interface <span class="built_in">type</span>=<span class="string">&#x27;bridge&#x27;</span>&gt;  <span class="comment"># 修改类型</span></span><br><span class="line">原 &lt;<span class="built_in">source</span> network=<span class="string">&#x27;default&#x27;</span>/&gt; 改 &lt;<span class="built_in">source</span> bridge=<span class="string">&#x27;br0&#x27;</span>/&gt;     <span class="comment"># 网卡名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动虚拟机验证</span></span><br><span class="line">virsh start web02</span><br><span class="line"><span class="comment"># 通过vnc/console登录配置静态IP</span></span><br><span class="line">virsh vncdisplay web02 或 virsh console web02</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_4f21ccb77b8d5dd6719b7488e808320c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_4f21ccb77b8d5dd6719b7488e808320c.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_0e88cdc4e62769bb5458975545f4269e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_0e88cdc4e62769bb5458975545f4269e.png"></p><p>配置完成后 <strong>ssh</strong> 远程连接测试 &gt;&gt; 成功。</p><h2 id="十二-kvm网络原理"><a href="#十二-kvm网络原理" class="headerlink" title="十二. kvm网络原理"></a>十二. <code>kvm</code>网络原理</h2><p>每台 <strong>KVM</strong> 启动后，都会在 <strong>宿主机</strong> 创建一个以 <strong>vnet</strong> 开头的网卡(从 <strong>vnet0</strong> 开始)，用于打通 <strong>虚拟机</strong> 与 <strong>宿主机</strong> 之间的网络。</p><h3 id="0-网络模式拖布图"><a href="#0-网络模式拖布图" class="headerlink" title="0.网络模式拖布图"></a><code>0.</code>网络模式拖布图</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_502c79bc51c37605ad93625e7c73b987.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_502c79bc51c37605ad93625e7c73b987.png"></p><h3 id="1-宿主机网卡配置"><a href="#1-宿主机网卡配置" class="headerlink" title="1.宿主机网卡配置"></a><code>1.</code>宿主机网卡配置</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_7e62f395165b9a771a1f429a170a2cc0.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_7e62f395165b9a771a1f429a170a2cc0.png"></p><p>通过 <strong>brctl show</strong> 可以看到 <strong>vnet</strong> 网卡使用的宿主机网卡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@kvm ~]# brctl show</span><br><span class="line">bridge name     bridge id               STP enabled     interfaces</span><br><span class="line">br0             8000.000c2923671e       yes             ens33</span><br><span class="line">                                                        vnet0</span><br><span class="line">virbr0          8000.525400289c13       yes             virbr0-nic</span><br></pre></td></tr></table></figure><h2 id="十三-kvm虚拟机硬件热添加技术"><a href="#十三-kvm虚拟机硬件热添加技术" class="headerlink" title="十三.  kvm虚拟机硬件热添加技术"></a>十三.  kvm虚拟机硬件热添加技术</h2><h3 id="1-热添加磁盘"><a href="#1-热添加磁盘" class="headerlink" title="1.热添加磁盘"></a><code>1.</code>热添加磁盘</h3><p><strong>案例: 为 web03 虚拟机添加一块新 qcow2 硬盘，并对硬盘空间进行扩容 (KVM虚拟机默认磁盘名称: vda、vdb、vdc依次类推，可进入KVM内部查看)</strong></p><p><strong>添加之前 (只有一块10G的硬盘)</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@web03 ~]# lsblk</span><br><span class="line">NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sr0                    11:0    1 1024M  0 rom  </span><br><span class="line">vda                   252:0    0   10G  0 disk </span><br><span class="line">├─vda1                252:1    0    1G  0 part /boot</span><br><span class="line">└─vda2                252:2    0    9G  0 part </span><br><span class="line">  ├─centos_web03-root 253:0    0    8G  0 lvm  /</span><br><span class="line">  └─centos_web03-swap 253:1    0    1G  0 lvm  [SWAP]</span><br></pre></td></tr></table></figure><p><strong>在 kvm 目录创建一块 qcow2 格式的虚拟硬盘，容量为 10G</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一块qcow2格式的虚拟硬盘，容量为10G</span></span><br><span class="line">cd /kvm</span><br><span class="line">qemu-img create -f qcow2 /kvm/web03-vdb.qcow2 10G</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看磁盘详情</span></span><br><span class="line">qemu-img info /kvm/web03-vdb.qcow2</span><br><span class="line">//返回</span><br><span class="line">image: /kvm/web03-vdb.qcow2</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 10G (10737418240 bytes)</span><br></pre></td></tr></table></figure><p><strong>永久添加磁盘</strong></p><ul><li><strong>–live            在线添加</strong></li><li><strong>–config        永久保存配置 （不加临时生效 虚拟机一重启就没了）</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 永久添加磁盘（给web03 添加10G磁盘 指定添加后虚拟机磁盘名称为 vdb 格式为 qcow2 格式）</span></span><br><span class="line">virsh attach-disk web03 /kvm/web03-vdb.qcow2 vdb --subdriver qcow2 --live --config</span><br><span class="line">//返回</span><br><span class="line">Disk attached successfully</span><br></pre></td></tr></table></figure><p><strong>web03虚拟机验证</strong>（成功添加一块10G vdb磁盘）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录虚拟机</span></span><br><span class="line">virsh console web03</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看磁盘详情</span></span><br><span class="line">lsblk</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式化挂载验证使用(正常使用)</span></span><br><span class="line">mkfs.xfs /dev/vdb /mnt</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_df1d528276047646321dc497bb964d7c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_df1d528276047646321dc497bb964d7c.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_98ea2a719d22c44088b0687abc0ff47e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_98ea2a719d22c44088b0687abc0ff47e.png"></p><p><strong>永久剥离 (需要提前卸载)</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">虚拟机先卸载磁盘</span></span><br><span class="line">umonut /dev/vdb</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 宿主机执行操作 永久剥离虚拟机磁盘</span></span><br><span class="line">virsh detach-disk web03 vdb --live --config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">虚拟机查看（成功）</span></span><br><span class="line">lsblk</span><br><span class="line">//返回</span><br><span class="line">NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sr0                    11:0    1 1024M  0 rom  </span><br><span class="line">vda                   252:0    0   10G  0 disk </span><br><span class="line">├─vda1                252:1    0    1G  0 part /boot</span><br><span class="line">└─vda2                252:2    0    9G  0 part </span><br><span class="line">  ├─centos_web03-root 253:0    0    8G  0 lvm  /</span><br><span class="line">  └─centos_web03-swap 253:1    0    1G  0 lvm  [SWAP]</span><br></pre></td></tr></table></figure><h3 id="2-对刚才剥离的qcow2磁盘空间扩容-无法在线扩容，必须先剥离"><a href="#2-对刚才剥离的qcow2磁盘空间扩容-无法在线扩容，必须先剥离" class="headerlink" title="2. 对刚才剥离的qcow2磁盘空间扩容 (无法在线扩容，必须先剥离)"></a><code>2.</code> 对刚才剥离的qcow2磁盘空间扩容 (无法在线扩容，必须先剥离)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给创建的磁盘扩容5G</span></span><br><span class="line">qemu-img resize /kvm/web03-vdb.qcow2 +5G</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看扩容详情</span></span><br><span class="line">qemu-img info /kvm/web03-vdb.qcow2</span><br><span class="line">//返回</span><br><span class="line">image: /kvm/web03-vdb.qcow2</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 15G (16106127360 bytes)</span><br></pre></td></tr></table></figure><p><strong>添加磁盘到虚拟机（宿主机执行）</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">永久添加磁盘（给web03 添加10G磁盘 指定添加后虚拟机磁盘名称为 vdb 格式为 qcow2 格式）</span></span><br><span class="line">virsh attach-disk web03 /kvm/web03-vdb.qcow2 vdb --subdriver qcow2 --live --config</span><br><span class="line">//返回</span><br><span class="line">Disk attached successfully</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载验证（先前已经格式化过磁盘 此时切记不能再格式化 否则会导致数据丢失）</span> </span><br><span class="line">[root@web03 ~]# mount /dev/vdb /mnt</span><br><span class="line">[root@web03 ~]# cd /mnt</span><br><span class="line">[root@web03 mnt]# ls</span><br><span class="line">1.ttx</span><br><span class="line">[root@web03 mnt]# </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">刷新到<span class="built_in">df</span> -Th</span></span><br><span class="line">xfs_growfs /mnt</span><br><span class="line">//返回</span><br><span class="line">meta-data=/dev/vdb               isize=512    agcount=4, agsize=655360 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=2621440, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal               bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure><p><strong>先前已经格式化过磁盘 此时切记不能再格式化 否则会导致数据丢失。</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_05199bb86394af821c0bc709165683a0.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_05199bb86394af821c0bc709165683a0.png"></p><h2 id="十四-热添加网卡"><a href="#十四-热添加网卡" class="headerlink" title="十四. 热添加网卡"></a>十四. 热添加网卡</h2><h3 id="1-热添加网卡"><a href="#1-热添加网卡" class="headerlink" title="1.热添加网卡"></a><code>1.</code>热添加网卡</h3><p><strong>案例: 为KVM虚拟机 web03 添加一块网卡</strong></p><p><strong>格式:  virsh attach-interface   虚拟机名称  –type bridge–source  网桥名  –model  virtio</strong></p><ul><li><strong>–type              用于指定网卡类型</strong></li><li><strong>–source          宿主机网桥名</strong></li><li><strong>–model virtio   驱动模式(用于指定网卡类型以eth开头)</strong></li><li><strong>–live              在线添加</strong></li><li><strong>–config          永久保存配置(不加临时生效)</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给 web03 热添加一块bridge类型网卡</span></span><br><span class="line">virsh attach-interface web03 --type bridge  --source br0 --model virtio --live --config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给 web03 热添加一块nat类型网卡 (只有一块网卡模式时 --<span class="built_in">source</span>需要是ens33)</span></span><br><span class="line">virsh attach-interface web03 --type default --source br0 --model virtio --live --config</span><br></pre></td></tr></table></figure><p><strong>虚拟机验证：</strong> <code>ip a s</code> 成功添加了一块 <strong>eth1</strong> 网卡 并且网卡自动获取为10.0.0.186</p><p>若要 配置成固定地址时需要新建一个网卡配置文件 配置 IP  或者使用 nmtui 设置网卡</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d11dedc5313b8c669b47717ebb3752a8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_d11dedc5313b8c669b47717ebb3752a8.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_bb39dccafdd291a95d611dfe61554255.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_bb39dccafdd291a95d611dfe61554255.png"></p><p><strong>网卡不想要了怎么办呢 热删除即可。</strong></p><h3 id="2-热删除虚拟机网卡（宿主机执行）"><a href="#2-热删除虚拟机网卡（宿主机执行）" class="headerlink" title="2.热删除虚拟机网卡（宿主机执行）"></a><code>2.</code>热删除虚拟机网卡（宿主机执行）</h3><ul><li><strong>–mac +通过mac地址删除 （指定网卡mac地址删除）</strong></li><li><strong>虚拟机使用 ip a / ifconfig 查看，mac地址</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">热删除虚拟机 web03 网卡 (成功剥离)</span></span><br><span class="line">virsh detach-interface web03 --type bridge --mac 52:54:00:c8:3e:2a --live --config</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_1e84857802829a410b17411183904d57.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_1e84857802829a410b17411183904d57.png"></p><h3 id="十五-热添加内存"><a href="#十五-热添加内存" class="headerlink" title="十五. 热添加内存"></a>十五. 热添加内存</h3><h3 id="1-创建时指定cpu-内存最大数量"><a href="#1-创建时指定cpu-内存最大数量" class="headerlink" title="1.创建时指定cpu 内存最大数量"></a><code>1.</code>创建时指定cpu 内存最大数量</h3><p><strong>热添加内存与CPU  前提是创建KVM虚拟机时设置maxmemory与maxvcpus参数 也可创建完成后通过命令定义</strong></p><ul><li><strong>maxmemory    定义虚机最大可以分配内存的大小</strong></li><li><strong>maxvcpus        定义虚拟机最大可以使用的CPU核数</strong></li></ul><p><strong>创建KVM虚拟机，并设置maxmemory与maxvcpus的值</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建虚拟机</span></span><br><span class="line">virt-install --virt-type kvm \</span><br><span class="line">--os-type=linux \</span><br><span class="line">--os-variant rhel7 \</span><br><span class="line">--name web04 \</span><br><span class="line">--memory 1024,maxmemory=2048 \</span><br><span class="line">--vcpus 1,maxvcpus=4 --disk /kvm/web04-vda.qcow2,format=qcow2,size=10 \</span><br><span class="line">--cdrom /opt/CentOS-7-x86_64-Minimal-2009.iso --network bridge=br0 --graphics vnc,listen=0.0.0.0 --noautoconsole </span><br></pre></td></tr></table></figure><h3 id="2-创建后通过命令指定-cpu-内存最大数量"><a href="#2-创建后通过命令指定-cpu-内存最大数量" class="headerlink" title="2.创建后通过命令指定 cpu 内存最大数量"></a><code>2.</code>创建后通过命令指定 cpu 内存最大数量</h3><blockquote><p><strong>命令创建时没有指定最大内存 则需要先设置一下最大内存 否则无法添加</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置最大内存，需要关机</span></span><br><span class="line">virsh shutdown  web03</span><br><span class="line">virsh setmaxmem web03 6144M --config  </span><br><span class="line">// 默认无回显</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时添加内存，缩减内存同样，需要注意的是不要缩减内存 会导致机器出现问题</span></span><br><span class="line">virsh setmem web03 4096M </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">永久添加内存</span></span><br><span class="line">virsh setmem web03 4096M --config  </span><br></pre></td></tr></table></figure><p><strong>验证</strong>（添加成功）</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_e5eb9315664b827df6013961c3b6b4d2.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_e5eb9315664b827df6013961c3b6b4d2.png"></p><h2 id="十六-热添加cpu"><a href="#十六-热添加cpu" class="headerlink" title="十六. 热添加cpu"></a>十六. 热添加<code>cpu</code></h2><h3 id="1-创建虚拟机时指定-CPU-最大数时-热添加CPU"><a href="#1-创建虚拟机时指定-CPU-最大数时-热添加CPU" class="headerlink" title="1. 创建虚拟机时指定 CPU 最大数时 热添加CPU"></a><code>1.</code> 创建虚拟机时指定 <strong>CPU</strong> 最大数时 热添加<code>CPU</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时热添加cpu核数</span></span><br><span class="line">virsh setvcpus web03 4 --live</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">永久添加cpu核数</span></span><br><span class="line">virsh setvcpus web03 4 --config</span><br></pre></td></tr></table></figure><h3 id="2-创建完成后热添加虚拟机CPU（需要关机-且设置的-CPU-最大数不能超过宿主机-CPU-数）"><a href="#2-创建完成后热添加虚拟机CPU（需要关机-且设置的-CPU-最大数不能超过宿主机-CPU-数）" class="headerlink" title="2. 创建完成后热添加虚拟机CPU（需要关机 且设置的 CPU 最大数不能超过宿主机  CPU  数）"></a><code>2.</code> 创建完成后热添加虚拟机CPU（需要关机 且设置的 CPU 最大数不能超过宿主机  CPU  数）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看虚拟机当前最大支持的核心数</span></span><br><span class="line">virsh edit web03</span><br><span class="line">...</span><br><span class="line">//返回</span><br><span class="line">  &lt;memory unit=&#x27;KiB&#x27;&gt;2097152&lt;/memory&gt;</span><br><span class="line">  &lt;currentMemory unit=&#x27;KiB&#x27;&gt;2097152&lt;/currentMemory&gt;</span><br><span class="line">  &lt;vcpu placement=&#x27;static&#x27;&gt;1&lt;/vcpu&gt;   # 1cpu</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调整虚拟机支持CPU的最大值</span></span><br><span class="line">virsh setvcpus web03 --maximum 6 --config </span><br><span class="line">...</span><br><span class="line">否则会报错</span><br><span class="line">virsh setvcpus web03  4 --config</span><br><span class="line">error: invalid argument: requested vcpus is greater than max allowable vcpus for the persistent domain: 4 &gt; 1</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用命令调整后 查看文件是否改变 (文件成功改变)</span></span><br><span class="line">virsh edit web03</span><br><span class="line">...</span><br><span class="line">  &lt;currentMemory unit=&#x27;KiB&#x27;&gt;2097152&lt;/currentMemory&gt;</span><br><span class="line">  &lt;vcpu placement=&#x27;static&#x27; current=&#x27;1&#x27;&gt;6&lt;/vcpu&gt;  # 6cpu</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动虚拟机查看配置</span></span><br><span class="line">virsh start web03</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">临时热添加CPU核心数量</span></span><br><span class="line">virsh setvcpus web03 4</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">永久添加CPU核心数量</span></span><br><span class="line">virsh setvcpus web03 4 --config</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_229143f829ebe75863789362572c1acf.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_229143f829ebe75863789362572c1acf.png"></p><p><strong>本文热添加内存及cpu部分参考如下链接</strong></p><p><a href="https://www.cnblogs.com/yinzhengjie/p/18127842">https://www.cnblogs.com/yinzhengjie/p/18127842</a> <a href="https://blog.csdn.net/m0_46180357/article/details/108935979">https://blog.csdn.net/m0_46180357/article/details/108935979</a></p>]]></content>
      
      
      <categories>
          
          <category> kvm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows11安装docker-desktop,docker-compose</title>
      <link href="/2024/04/20/windows11%E5%AE%89%E8%A3%85docker-desktop,docker-compose/"/>
      <url>/2024/04/20/windows11%E5%AE%89%E8%A3%85docker-desktop,docker-compose/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="windows11安装docker-desktop-docker-compose"><a href="#windows11安装docker-desktop-docker-compose" class="headerlink" title="windows11安装docker-desktop,docker-compose"></a>windows11安装docker-desktop,docker-compose</h1><blockquote><p>备注：docker-desktop 无法与 vmware 的虚拟化 Inter-VT-x/EPT或AMD-V/RVI(V) 共存 使用此功能时需要先短暂关闭 Hyper-V 服务并重启电脑 CMD 命令如下 需要使用docker-desktop 时再开启并重启电脑即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">bcdedit /set hypervisorlaunchtype off </span><br><span class="line"><span class="comment"># 启动 </span></span><br><span class="line">bcdedit /set hypervisorlaunchtype auto</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_118aa809b6e7db0a2c34c57eb7d08ecf.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_118aa809b6e7db0a2c34c57eb7d08ecf.png"></p><p>参考：<a href="https://blog.csdn.net/CNjcdyl/article/details/124802614">解决虚拟机VM-开启 虚拟化 Intel-VT-x/EPT 或 AMD-V/RVI（V） 后 电脑蓝屏重启 或显示此平台不支持虚拟化的问题 （Win10）_虚拟化inteltv-xept或amd-vrvi-</a></p></blockquote><h1 id="一、安装顺序"><a href="#一、安装顺序" class="headerlink" title="一、安装顺序"></a>一、安装顺序</h1><p><a href="https://blog.csdn.net/qq_41644183/article/details/132305487#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85Hyper-V">安装Hyper-V</a></p><p><a href="https://blog.csdn.net/qq_41644183/article/details/132305487#%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85WSL">安装WSL</a></p><p><a href="https://blog.csdn.net/qq_41644183/article/details/132305487#%E5%9B%9B%E3%80%81%E5%AE%89%E8%A3%85Docker%20Desktop">安装Docker Desktop</a></p><p><a href="https://link.zhihu.com/?target=https://desktop.docker.com/win/main/amd64/Docker%2520Desktop%2520Installer.exe">Docker-windows-app下载链接</a></p><h1 id="二、安装Hyper-V"><a href="#二、安装Hyper-V" class="headerlink" title="二、安装Hyper-V"></a>二、安装Hyper-V</h1><p>1、Windows11是找不到<a href="https://so.csdn.net/so/search?q=Hyper-V&spm=1001.2101.3001.7020">Hyper-V</a>的，需要自行安装</p><p>2、创建一个hyper.bat文件，编辑，复制以下代码到文件中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pushd</span> <span class="string">&quot;%~dp0&quot;</span></span><br><span class="line"><span class="built_in">dir</span> /b %SystemRoot%\servicing\Packages\*Hyper-V*.mum &gt;hyper-v.txt</span><br><span class="line"><span class="keyword">for</span> /f %%i <span class="keyword">in</span> (<span class="string">&#x27;findstr /i . hyper-v.txt 2^&gt;nul&#x27;</span>) <span class="keyword">do</span> dism /online /norestart /add-package:<span class="string">&quot;%SystemRoot%\servicing\Packages\%%i&quot;</span></span><br><span class="line">del hyper-v.txt</span><br><span class="line">Dism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL</span><br></pre></td></tr></table></figure><p>3、以管理员身份运行hyper.bat，运行了之后需要按Ctrl+C停下来，否则会一直重复执行，最后输入Y，确认完成Hyper-V的安装<br>4、打开控制面板-&gt;程序-&gt;启用或关闭Windows功能勾选Hyper-V，同时勾选适用于Linux的Windows子系统以及虚拟机平台，重启电脑（可以等安装WSL的时候再重启）<br><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c56711b4323471003c3a8ea0d960d131.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c56711b4323471003c3a8ea0d960d131.png"></p><h1 id="三、安装WSL"><a href="#三、安装WSL" class="headerlink" title="三、安装WSL"></a>三、安装WSL</h1><p>1、以管理员身份打开PowerShell，输入命令安装WSL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All</span><br></pre></td></tr></table></figure><p>2、完成，重启电脑，完成安装</p><p>3、如果WSL版本太低，升级WSL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl.exe --update</span><br></pre></td></tr></table></figure><h1 id="四、安装Docker-Desktop"><a href="#四、安装Docker-Desktop" class="headerlink" title="四、安装Docker Desktop"></a>四、安装Docker Desktop</h1><p>1、<a href="https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe">下载Docker Desktop</a></p><p>效果</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_0c8aeee17bdfc44342ee2537961ade9c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_0c8aeee17bdfc44342ee2537961ade9c.png"></p><h1 id="五-安装docker-compose"><a href="#五-安装docker-compose" class="headerlink" title="五. 安装docker-compose"></a>五. 安装docker-compose</h1><p>下载地址：<a href="https://github.com/docker/compose/releases/">https://github.com/docker/compose</a></p><p>参考：</p><p><a href="https://blog.csdn.net/qq_41644183/article/details/132305487">Docker安装教程——以Windows11家庭中文版为例_win11家庭版安装docker</a></p><p><a href="https://zhuanlan.zhihu.com/p/552307629">Win11安装Docker及简单使用 - 知乎 (zhihu.com)</a></p><p><a href="https://blog.csdn.net/qq_38215042/article/details/108647680">Windows安装使用docker与docker-compose_windows下安装compose-CSDN博客</a></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>confluence部署</title>
      <link href="/2024/04/17/confluence%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/04/17/confluence%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="confluence部署"><a href="#confluence部署" class="headerlink" title="confluence部署"></a>confluence部署</h1><h1 id="一-安装java-1-8"><a href="#一-安装java-1-8" class="headerlink" title="一. 安装java 1.8"></a>一. 安装java 1.8</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install software-properties-common</span><br><span class="line">apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure><h1 id="二-部署mysql5-7本次我们使用docker部署"><a href="#二-部署mysql5-7本次我们使用docker部署" class="headerlink" title="二. 部署mysql5.7本次我们使用docker部署"></a>二. 部署mysql5.7本次我们使用docker部署</h1><blockquote><p>特别说明（本文已写入docker-compose文件中）</p><p>一定要设置数据库隔离级别 <code>SET GLOBAL tx_isolation=&#39;READ-COMMITTED&#39;; </code>否则会导致confluence连不上数据库</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.0&quot;</span>                                                                                                                                                 </span><br><span class="line">services:                                                                                                                                                      </span><br><span class="line">  db:                                                                                                                                                          </span><br><span class="line">    image: mysql:5.7                                                                                                                                           </span><br><span class="line">    container_name: confluse_mysql                                                                                                                             </span><br><span class="line">    hostname: db                                                                                                                                               </span><br><span class="line">    restart: always                                                                                                                                            </span><br><span class="line">    ports:                                                                                                                                                     </span><br><span class="line">      - <span class="string">&quot;3307:3306&quot;</span>                                                                                                                                            </span><br><span class="line">    <span class="built_in">command</span>:                                                                                                                                                   </span><br><span class="line">      - mysqld                                                                                                                                                 </span><br><span class="line">      - --symbolic-links=0                                                                                                                                     </span><br><span class="line">      - --transaction-isolation=READ-COMMITTED                                                                                                                 </span><br><span class="line">      - --collation_server=utf8_bin                                                                                                                            </span><br><span class="line">      - --character-set-server=utf8                                                                                                                            </span><br><span class="line">      - --innodb_file_per_table=1                                                                                                                              </span><br><span class="line">      - --innodb_buffer_pool_size=2G                                                                                                                           </span><br><span class="line">      - --max_connections=1000                                                                                                                                 </span><br><span class="line">      - --innodb_flush_log_at_trx_commit=2                                                                                                                     </span><br><span class="line">      - --innodb_read_io_threads=32                                                                                                                            </span><br><span class="line">      - --innodb_write_io_threads=16                                                                                                                           </span><br><span class="line">      - --max_allowed_packet=32M                                                                                                                               </span><br><span class="line">      - --max_heap_table_size=512M                                                                                                                             </span><br><span class="line">      - --bulk_insert_buffer_size=64M                                                                                                                          </span><br><span class="line">      - --tmp_table_size=64M                                                                                                                                   </span><br><span class="line">      - --join_buffer_size=64M                                                                                                                                 </span><br><span class="line">      - --max_allowed_packet=34M                                                                                                                               </span><br><span class="line">      - --innodb_log_file_size=256M                                                                                                                            </span><br><span class="line">    environment:                                                                                                                                               </span><br><span class="line">      - MYSQL_ROOT_PASSWORD=<span class="built_in">test</span>                                                                                                                     </span><br><span class="line">      - MYSQL_DATABASE=confluence_test                                                                                                                         </span><br><span class="line">      - MYSQL_DATABASE=confluence                                                                                                                              </span><br><span class="line">      - MYSQL_USER=confluence                                                                                                                                  </span><br><span class="line">      - MYSQL_PASSWORD=<span class="built_in">test</span>                                                                                                                                  </span><br><span class="line">      - TZ=Asia/Shanghai                                                                                                                                       </span><br><span class="line">    volumes:                                                                                                                                                   </span><br><span class="line">      - confluse-db:/var/lib/mysql                                                                                                                             </span><br><span class="line">      - ./db_bak_sh:/home/db_bak_sh:rw                                                                                                                         </span><br><span class="line">      - ./bak:/opt/confluence_mysql/bak:rw                                                                                                                     </span><br><span class="line">volumes:                                                                                                                                                       </span><br><span class="line">  confluse-db:</span><br></pre></td></tr></table></figure><p>mysql备份脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash                                                                                                                                                          </span></span><br><span class="line"><span class="comment">#mysqlbak_version:1.3                                                                                                                                                </span></span><br><span class="line"><span class="comment">#标准换数据库备份脚本                                                                                                                                                </span></span><br><span class="line"><span class="built_in">set</span> -e                                                                                                                                                               </span><br><span class="line"><span class="function"><span class="title">bak_mysql</span></span>()&#123;                                                                                                                                                         </span><br><span class="line">   bak_name=<span class="string">&quot;confluence&quot;</span>                                                                                                                                             </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;\033[33m 开始备份数据库:<span class="variable">$&#123;bak_name&#125;</span> \033[0m&quot;</span>                                                                                                                </span><br><span class="line">   bak_dir=<span class="string">&quot;/opt/confluence_mysql/bak&quot;</span>                                                                                                                               </span><br><span class="line">   time=`<span class="built_in">date</span> +%F_%H_%M`                                                                                                                                             </span><br><span class="line">   port_bak=3306                                                                                                                                                     </span><br><span class="line">   user_bak=<span class="string">&quot;root&quot;</span>                                                                                                                                                   </span><br><span class="line">   passwd_bak=<span class="string">&quot;test&quot;</span>                                                                                                                                       </span><br><span class="line">   ip_bak=localhost                                                                                                                                                  </span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$&#123;bak_dir&#125;</span> ];                                                                                                                                              </span><br><span class="line">   <span class="keyword">then</span>                                                                                                                                                              </span><br><span class="line">       <span class="built_in">echo</span> <span class="string">&quot;\033[33m 开始创建目录:<span class="variable">$&#123;bak_dir&#125;</span> \033[0m&quot;</span>                                                                                                               </span><br><span class="line">       <span class="built_in">mkdir</span> -p  <span class="variable">$&#123;bak_dir&#125;</span> &amp;&amp; <span class="built_in">chmod</span> 755 <span class="variable">$&#123;bak_dir&#125;</span>                                                                                                                  </span><br><span class="line">   <span class="keyword">else</span>                                                                                                                                                              </span><br><span class="line">       <span class="built_in">echo</span> <span class="string">&quot;\033[36m <span class="variable">$&#123;bak_dir&#125;</span>目录已存在  \033[0m&quot;</span>                                                                                                                 </span><br><span class="line"><span class="keyword">fi</span>                                                                                                                                                                   </span><br><span class="line">mysqldump -P<span class="variable">$&#123;port_bak&#125;</span> -p<span class="variable">$&#123;passwd_bak&#125;</span> -u<span class="variable">$&#123;user_bak&#125;</span> -h<span class="variable">$&#123;ip_bak&#125;</span> --single-transaction -R -E -B <span class="variable">$&#123;bak_name&#125;</span> |gzip &gt;<span class="variable">$&#123;bak_dir&#125;</span>/<span class="variable">$&#123;bak_name&#125;</span>_<span class="variable">$&#123;ip_bak&#125;</span>_<span class="variable">$&#123;time&#125;</span>.sql.gz   </span><br><span class="line">bak_file=<span class="string">&quot;/opt/confluence_mysql/bak/*.sql.gz&quot;</span>                                                                                                                        </span><br><span class="line"><span class="keyword">if</span> [ $? = 0 ];                                                                                                                                                       </span><br><span class="line">   <span class="keyword">then</span>                                                                                                                                                              </span><br><span class="line">       <span class="built_in">echo</span> <span class="string">&quot;\033[36m  <span class="variable">$&#123;time&#125;</span>数据库:<span class="variable">$&#123;bak_name&#125;</span>备份成功,                                                                                                            </span></span><br><span class="line"><span class="string">                备份位置:<span class="variable">$&#123;bak_dir&#125;</span>/<span class="variable">$&#123;bak_name&#125;</span>_<span class="variable">$&#123;ip_bak&#125;</span>_<span class="variable">$&#123;time&#125;</span>.sql.gz  \033[0m&quot;</span> &gt;&gt; /opt/confluence_mysql/bak/confluence_bak.log                                   </span><br><span class="line">       <span class="built_in">echo</span> <span class="string">&quot;\033[36m <span class="variable">$&#123;time&#125;</span>数据库:<span class="variable">$&#123;bak_name&#125;</span>备份成功,                                                                                                             </span></span><br><span class="line"><span class="string">                备份位置:<span class="variable">$&#123;bak_dir&#125;</span>/<span class="variable">$&#123;bak_name&#125;</span>_<span class="variable">$&#123;ip_bak&#125;</span>_<span class="variable">$&#123;time&#125;</span>.sql.gz                                                                                             </span></span><br><span class="line"><span class="string">                <span class="variable">$&#123;bak_dir&#125;</span>目录正在删除五天前的备份。 \033[0m&quot;</span>                                                                                                        </span><br><span class="line">       find <span class="variable">$&#123;bak_file&#125;</span> -<span class="built_in">type</span> f -mtime +5 |xargs <span class="built_in">rm</span> -f                                                                                                               </span><br><span class="line">   <span class="keyword">else</span>                                                                                                                                                              </span><br><span class="line">       <span class="built_in">echo</span> <span class="string">&quot;\033[31m <span class="variable">$&#123;time&#125;</span>数据库:<span class="variable">$&#123;bak_name&#125;</span>备份失败，请检查。 \033[0m&quot;</span>                                                                                           </span><br><span class="line"><span class="keyword">fi</span>                                                                                                                                                                   </span><br><span class="line">&#125;                                                                                                                                                                                                                                                                                                                                           </span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;                                                                                                                                                                                                                                                                                                                       </span><br><span class="line">    bak_mysql                                                                                                                                                                                                                                                                                                   </span><br><span class="line">&#125;                                                                                                                                                                    </span><br><span class="line">main      </span><br></pre></td></tr></table></figure><p>登录mysql设置策略</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it confluse_mysql bash</span><br><span class="line">mysql -uroot -p</span><br><span class="line">SET GLOBAL tx_isolation=<span class="string">&#x27;READ-COMMITTED&#x27;</span>;</span><br></pre></td></tr></table></figure><p><a href="https://wn-apple-teawine.fun/2023/05/15/mysql%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/?highlight=mysql%E5%A4%87%E4%BB%BD">mysql备份脚本</a></p><p>定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 9 * * * /usr/bin/docker <span class="built_in">exec</span> webstack_mysql bash /home/mysqlbak/webstack-dbbak.sh</span><br><span class="line">0 10 * * * /usr/bin/docker <span class="built_in">exec</span> confluse_mysql bash /home/db_bak_sh/confluence_dbbak.sh</span><br></pre></td></tr></table></figure><h1 id="三-安装confluse"><a href="#三-安装confluse" class="headerlink" title="三. 安装confluse"></a>三. 安装confluse</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 confluence</span></span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">wget https://product-downloads.atlassian.com/software/confluence/downloads/atlassian-confluence-6.12.0-x64.bin</span><br><span class="line"><span class="comment"># 赋予执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x atlassian-confluence-6.12.0-x64.bin</span><br><span class="line"><span class="comment"># 执行安装</span></span><br><span class="line">./atlassian-confluence-6.12.0-x64.bin</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_79ea426efd840b65466f2b7ada4cc900.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_79ea426efd840b65466f2b7ada4cc900.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ebffd9d0bc193d12ca2d33caf5fba471.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ebffd9d0bc193d12ca2d33caf5fba471.png"></p><h1 id="四-其他"><a href="#四-其他" class="headerlink" title="四. 其他"></a>四. 其他</h1><blockquote><p>破解 confluence</p><p>破解文件下载</p><p><a href="https://drive.wn-apple-teawine.fun/api/raw/?path=/public-tools/confluence/confluence%E7%A0%B4%E8%A7%A3%E5%B7%A5%E5%85%B7.zip">confluence破解工具.rar</a></p><h1 id="破解步骤"><a href="#破解步骤" class="headerlink" title="破解步骤"></a>破解步骤</h1><p>windows java下载地址:</p><p><a href="https://www.oracle.com/java/technologies/javase/javase8u211-later-archive-downloads.html">Java Archive Downloads - Java SE 8u211 and later (oracle.com)</a></p><p>windows部署java参考：</p><p><a href="https://blog.csdn.net/weixin_45710060/article/details/123315280">Java详细安装配置教程(Windows)，从下载到配置——Java-1.8(jdk)安装_jre1.8-CSDN博客</a></p><ul><li><p>拷贝 <strong>/opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar</strong> 文件到 本地本地并重命名为 <strong>atlassian-extras-2.4.jar</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将此文件拷贝到当前目录</span></span><br><span class="line"><span class="built_in">cp</span>  /opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar .</span><br><span class="line"><span class="comment"># 重命名为 atlassian-extras-2.4.jar 再将重命名后的文件下载到windows电脑本地 用于存储破解文件的文件夹</span></span><br><span class="line"><span class="built_in">mv</span>  atlassian-extras-decoder-v2-3.4.1.jar  atlassian-extras-2.4.jar</span><br></pre></td></tr></table></figure></li><li><p>打开破解工具 <strong>confluence_keygen.jar</strong>（本地需先安装 <strong>java</strong> ）<strong>windows</strong> 命令行 <strong>cmd</strong> 执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar confluence_keygen.jar</span><br></pre></td></tr></table></figure></li><li><p>执行完成后 后台会自动启动一个程序 &gt;&gt; 此时点击已启动的程序的 <strong>.patch!</strong> 选项 找到 <strong>atlassian-extras-2.4.jar</strong> 打开</p></li><li><p>可以看到 <strong>atlassian-extras-2.4.jar</strong> 和 <strong>atlassian-extras-2.4.bak</strong> 两个文件，这里 <strong>atlassian-extras-2.4.jar</strong> 已经是破解好的了，将 <strong>atlassian-extras-2.4.jar</strong> 名字改回 <strong>atlassian-extras-decoder-v2-3.4.1.jar</strong> 将 <strong>atlassian-extras-decoder-v2-3.4.1.jar</strong> 上传到服务器原目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将文件上传到服务器</span></span><br><span class="line">rz</span><br><span class="line"><span class="comment"># 重命名为之前的文件名</span></span><br><span class="line"><span class="built_in">mv</span> atlassian-extras-2.4.jar  atlassian-extras-decoder-v2-3.4.1.jar</span><br><span class="line"><span class="comment"># 复制到原目录</span></span><br><span class="line"><span class="built_in">cp</span> atlassian-extras-decoder-v2-3.4.1.jar  /opt/atlassian/confluence/confluence/WEB-INF/lib/</span><br></pre></td></tr></table></figure></li><li><p>将破解包中的 mysql 驱动 mysql-connector-java-5.1.44-bin.jar 拷贝到 /opt/atlassian/confluence/confluence/WEB-INF/lib</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将mysql驱动拷贝到服务器目录</span></span><br><span class="line"><span class="built_in">cp</span> mysql-connector-java-5.1.44-bin.jar  /opt/atlassian/confluence/confluence/WEB-INF/lib</span><br></pre></td></tr></table></figure></li><li><p>重启 confluence</p></li></ul><h2 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止程序</span></span><br><span class="line"><span class="built_in">cd</span> /opt/atlassian/confluence/bin/</span><br><span class="line">./stop-confluence.sh</span><br></pre></td></tr></table></figure><h2 id="修改-confluence-监听地址，确定-8090-没有监听在-127-0-0-1-上"><a href="#修改-confluence-监听地址，确定-8090-没有监听在-127-0-0-1-上" class="headerlink" title="修改 confluence 监听地址，确定 8090 没有监听在 127.0.0.1 上"></a>修改 confluence 监听地址，确定 8090 没有监听在 127.0.0.1 上</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/atlassian/confluence/conf/server.xml</span><br></pre></td></tr></table></figure><h2 id="修改-confluence-使用的目录的权限"><a href="#修改-confluence-使用的目录的权限" class="headerlink" title="修改 confluence 使用的目录的权限"></a>修改 confluence 使用的目录的权限</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件夹其所有内容递归地修改为confluence用户和组的所有权</span></span><br><span class="line"><span class="built_in">chown</span> -R confluence:confluence /opt/atlassian</span><br><span class="line"><span class="built_in">chown</span> -R confluence:confluence /var/atlassian</span><br></pre></td></tr></table></figure><h2 id="启动，启动比较慢，需要等个两三分钟"><a href="#启动，启动比较慢，需要等个两三分钟" class="headerlink" title="启动，启动比较慢，需要等个两三分钟"></a>启动，启动比较慢，需要等个两三分钟</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动程序</span></span><br><span class="line">./start-confluence.sh</span><br></pre></td></tr></table></figure><p>关于服务监听IP的区别，参考</p><p><a href="https://segmentfault.com/a/1190000018629247">https://segmentfault.com/a/1190000018629247</a></p><p>访问confluence</p><p><a href="http://ip:8090/">http://ip:8090</a></p><p>开机自启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置为systemd托管</span></span><br><span class="line">vim /lib/systemd/system/confluence.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=confluence service</span><br><span class="line">After=network.target</span><br><span class="line">StartLimitIntervalSec=60</span><br><span class="line">StartLimitBurst=5</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">User=confluence</span><br><span class="line">Group=confluence</span><br><span class="line">ExecStart=/opt/atlassian/confluence/bin/start-confluence.sh</span><br><span class="line">ExecStop=/opt/atlassian/confluence/bin/stop-confluence.sh</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=1</span><br><span class="line">SuccessExitStatus=3 4</span><br><span class="line">RestartForceExitStatus=3 4</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"></span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl start/stop/restart/status confluence</span><br><span class="line">systemctl <span class="built_in">enable</span> confluence</span><br></pre></td></tr></table></figure><p>报错</p><p>若部署过程中出现报错，可以先停止 confluence，然后删除数据库，并重建数据库，然后删除 /var/atlassian/application-data/confluence/confluence.cfg.xml 文件</p><p>再启动 confluence，就又到了 confluence 的 setup 页面</p><h1 id="卸载wiki"><a href="#卸载wiki" class="headerlink" title="卸载wiki"></a>卸载wiki</h1><p><a href="https://blog.csdn.net/qq_43693598/article/details/111265298">linux 卸载confluence，只需三步_confluence卸载-CSDN博客</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 删除主目录</span><br><span class="line"><span class="built_in">rm</span> -rf /opt/atlassian/</span><br><span class="line"></span><br><span class="line">2. 删除数据目录</span><br><span class="line"><span class="built_in">rm</span> -rf /var/atlassian/</span><br><span class="line"></span><br><span class="line">3. 删除用户</span><br><span class="line">userdel -r confluence</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.cnblogs.com/ios9/p/14473523.html">https://www.cnblogs.com/ios9/p/14473523.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 常用软件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>homepage与sun-panel轻量级导航部署</title>
      <link href="/2024/04/16/homepage%E4%B8%8Esun-panel%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AF%BC%E8%88%AA%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/04/16/homepage%E4%B8%8Esun-panel%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AF%BC%E8%88%AA%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="homepage与sun-panel轻量级导航部署"><a href="#homepage与sun-panel轻量级导航部署" class="headerlink" title="homepage与sun-panel轻量级导航部署"></a>homepage与sun-panel轻量级导航部署</h1><blockquote><p>镜像可选</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ghcr.io/gethomepage/homepage:latest</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:homepage</span><br></pre></td></tr></table></figure><p>其他各种导航</p><p><a href="https://wn-apple-teawine.fun/2023/11/23/web-start%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AF%BC%E8%88%AA%E6%A0%8F%E9%83%A8%E7%BD%B2">https://wn-apple-teawine.fun/2023/11/23/web-start轻量级导航栏部署</a></p><p><a href="https://wn-apple-teawine.fun/2023/08/11/webstack%E9%83%A8%E7%BD%B2">https://wn-apple-teawine.fun/2023/08/11/webstack部署</a></p></blockquote><h2 id="一-部署"><a href="#一-部署" class="headerlink" title="一. 部署"></a>一. 部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.8&quot;</span></span><br><span class="line">services:</span><br><span class="line">  homepage:</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:homepage</span><br><span class="line">    container_name: homepage</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    ports:</span><br><span class="line">      - 3123:3000</span><br><span class="line">    environment:</span><br><span class="line">      - PUID=1000</span><br><span class="line">      - PGID=100</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">    volumes:</span><br><span class="line">      - ./config:/app/config</span><br><span class="line">      <span class="comment"># - /var/run/docker.sock:/var/run/docker.sock (可选)</span></span><br><span class="line">      - ./logs:/logs</span><br><span class="line">      - ./icons:/app/public/icons</span><br><span class="line">      - ./images:/app/public/images</span><br><span class="line">      - /volume2:/volume2:ro   <span class="comment">#本机磁盘</span></span><br><span class="line">      <span class="comment">#- /volume3:/volume3:ro</span></span><br><span class="line">    network_mode: bridge                                                                           </span><br></pre></td></tr></table></figure><h2 id="二-配置（文件路径启动路径文件夹config）"><a href="#二-配置（文件路径启动路径文件夹config）" class="headerlink" title="二. 配置（文件路径启动路径文件夹config）"></a>二. 配置（文件路径启动路径文件夹config）</h2><p><strong>service.yml</strong>本文配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@web:/opt/homepage/config<span class="comment"># cat services.yaml </span></span><br><span class="line">---</span><br><span class="line"><span class="comment"># For configuration options and examples, please see:</span></span><br><span class="line"><span class="comment"># https://gethomepage.dev/latest/configs/services</span></span><br><span class="line"></span><br><span class="line">- 运维与开发工具:</span><br><span class="line">    - Gitlab:</span><br><span class="line">        href: http://10.0.0.10:8929</span><br><span class="line">        description: 代码托管平台</span><br><span class="line">    - 密码管理平台:</span><br><span class="line">        href: https://10.0.0.10</span><br><span class="line">        description: 密码管理平台</span><br><span class="line"></span><br><span class="line">- AI助手:</span><br><span class="line">    - one-api:</span><br><span class="line">        href: http://10.0.0.10:3000</span><br><span class="line">        description: api-key分发平台</span><br><span class="line">    - Fastgpt:</span><br><span class="line">        href: http://10.0.0.10:30001</span><br><span class="line">        description: Fastgpt</span><br><span class="line"></span><br><span class="line">- 官网:</span><br><span class="line">    - 官网1:</span><br><span class="line">        href: http://10.0.0.10/wp-login.php</span><br><span class="line">        description: 官网1</span><br><span class="line">    - 官网2:</span><br><span class="line">        href: http://10.0.0.10:4007/wp-login.php</span><br><span class="line">        description: 官网2</span><br></pre></td></tr></table></figure><p><strong>settings.yaml</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="comment"># For configuration options and examples, please see:</span></span><br><span class="line"><span class="comment"># https://gethomepage.dev/latest/configs/settings</span></span><br><span class="line"></span><br><span class="line">providers:</span><br><span class="line">  openweathermap: openweathermapapikey</span><br><span class="line">  weatherapi: weatherapiapikey</span><br><span class="line"></span><br><span class="line"><span class="comment"># 语言en-AU、en-GB</span></span><br><span class="line">language: zh-CN</span><br><span class="line"></span><br><span class="line"><span class="comment"># 背景图</span></span><br><span class="line">background:</span><br><span class="line">  image: https://images.unsplash.com/photo-1502790671504-542ad42d5189?auto=format&amp;fit=crop&amp;w=2560&amp;q=80</span><br><span class="line">  blur: sm <span class="comment">#模糊程度，范围 sm, &quot;&quot;, md, xl... 参考 https://tailwindcss.com/docs/backdrop-blur</span></span><br><span class="line">  saturate: 50 <span class="comment">#饱和度，范围 0, 50, 100... 参考 https://tailwindcss.com/docs/backdrop-saturate</span></span><br><span class="line">  brightness: 50 <span class="comment">#亮度，范围 0, 50, 75... 参考 https://tailwindcss.com/docs/backdrop-brightness</span></span><br><span class="line">  opacity: 50 <span class="comment">#不透明度，范围 0-100</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 标题</span></span><br><span class="line">title: CKY-导航</span><br><span class="line"></span><br><span class="line"><span class="comment"># 隐藏发布版本</span></span><br><span class="line"><span class="comment">#hideVersion: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导航横屏需要与service.yml文件同步</span></span><br><span class="line">layout:</span><br><span class="line">  运维与开发工具:</span><br><span class="line">    icon: /images/1.png</span><br><span class="line">    style: row</span><br><span class="line">    columns: 6</span><br><span class="line">  AI助手:</span><br><span class="line">    icon: jellyfin.png</span><br><span class="line">    style: row</span><br><span class="line">    columns: 6</span><br><span class="line">  官网:</span><br><span class="line">    icon: jellyfin.png</span><br><span class="line">    style: row</span><br><span class="line">    columns: 6</span><br></pre></td></tr></table></figure><h4 id="背景图"><a href="#背景图" class="headerlink" title="背景图"></a>背景图</h4><p>可以使用图片链接自定义 Home­page 的背景：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">background:</span><br><span class="line">  image: https://images.unsplash.com/photo-1502790671504-542ad42d5189?auto=format&amp;fit=crop&amp;w=2560&amp;q=80</span><br></pre></td></tr></table></figure><p>或者使用本地图片，新建一个文件夹，比如 <code>images</code> ，在 com­pose 配置里映射到 <code>/app/public/images</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  - ./homepage/images:/app/public/images</span><br></pre></td></tr></table></figure><p>之后就可以这样引用本地的图片：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">background:</span><br><span class="line">  image: https://images.unsplash.com/photo-1502790671504-542ad42d5189?auto=format&amp;fit=crop&amp;w=2560&amp;q=80</span><br><span class="line">  blur: sm <span class="comment">#模糊程度，范围 sm, &quot;&quot;, md, xl... 参考 https://tailwindcss.com/docs/backdrop-blur</span></span><br><span class="line">  saturate: 50 <span class="comment">#饱和度，范围 0, 50, 100... 参考 https://tailwindcss.com/docs/backdrop-saturate</span></span><br><span class="line">  brightness: 50 <span class="comment">#亮度，范围 0, 50, 75... 参考 https://tailwindcss.com/docs/backdrop-brightness</span></span><br><span class="line">  opacity: 50 <span class="comment">#不透明度，范围 0-100</span></span><br></pre></td></tr></table></figure><p><strong>特别注意：不要偷懒直接映射 <code>/app/public</code> 目录，会报错。</strong></p><p><strong>widgets.yaml</strong></p><p>home­page 中 <code>widgets.yaml</code> 主要是用来修改<strong>页面顶部</strong>的一些小部件，比如系统状况、搜索框、天气、时间、欢迎词等等。</p><p>自己只用到了系统状况、搜索框和时间，所以只说说这仨的用法。</p><p>系统状况中内存只有一个好办，但硬盘有很多个的话，就需要有几个盘就映射几个文件夹进去。例如群晖 NAS 中，有 <code>volume1</code> 、 <code>volume2</code> 、 <code>volume3</code> 三个硬盘，映射的时候就要都映射进去；怕容器写坏文件，就加上 <code>:ro</code> 只读。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  - /volume2:/volume2:ro</span><br><span class="line">  - /volume3:/volume3:ro</span><br></pre></td></tr></table></figure><p>但配置文件是在 <code>volume1</code> 中，所以不用映射 <code>volume1</code> 。</p><p>时间、搜索完全是官方文档的教程，我就不复制粘贴过来了。最后的配置如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- resources:</span><br><span class="line">    label: System</span><br><span class="line">    cpu: <span class="literal">true</span></span><br><span class="line">    memory: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">- resources:</span><br><span class="line">    label: Storage</span><br><span class="line">    expanded: <span class="literal">true</span></span><br><span class="line">    disk:</span><br><span class="line">      - /</span><br><span class="line">      - /volume2</span><br><span class="line">      - /volume3</span><br><span class="line"></span><br><span class="line">- search:</span><br><span class="line">    provider: [google, baidu]</span><br><span class="line">    target: _blank</span><br><span class="line"></span><br><span class="line">- datetime:</span><br><span class="line">    text_size: xl</span><br><span class="line">    format:</span><br><span class="line">      timeStyle: short</span><br><span class="line">      hour12: <span class="literal">false</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_61f83a276d633a416fff126c70fe1b2b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/7/image_61f83a276d633a416fff126c70fe1b2b.png"></p><h2 id="三-sun-panel导航部署-不建议使用-存在bug-无法修改密码"><a href="#三-sun-panel导航部署-不建议使用-存在bug-无法修改密码" class="headerlink" title="三. sun-panel导航部署(不建议使用 存在bug 无法修改密码)"></a>三. sun-panel导航部署(不建议使用 存在bug 无法修改密码)</h2><blockquote><p>参考：<a href="https://mp.weixin.qq.com/s/WbwTVuCcoqHZkXJsBPIGFA">https://mp.weixin.qq.com/s/WbwTVuCcoqHZkXJsBPIGFA</a></p><ul><li><code>/app/conf</code>：用来存放配置文件。</li><li><code>/app/uploads</code>：存放上传的文件。</li><li><code>/app/database</code>：存放数据库文件。</li><li><code>/app/runtime</code>：存放运行日志（不建议挂载）。</li></ul><p>默认密码</p><ul><li>账户：<a href="mailto:&#97;&#x64;&#x6d;&#105;&#x6e;&#x40;&#115;&#117;&#x6e;&#46;&#99;&#99;">&#97;&#x64;&#x6d;&#105;&#x6e;&#x40;&#115;&#117;&#x6e;&#46;&#99;&#99;</a></li><li>密码：12345678</li></ul></blockquote><p>镜像可选</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hslr/sun-panel</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:sun-panel</span><br></pre></td></tr></table></figure><p>docker-compose方式部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  sun-panel:</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:sun-panel</span><br><span class="line">    container_name: sun-panel</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;3002:3002&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ./conf:/app/conf</span><br><span class="line">      - ./uploads:/app/uploads</span><br><span class="line">      - ./database:/app/database</span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c0077360c400276d07c17648c643fa87.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c0077360c400276d07c17648c643fa87.png"></p><p>本文参考：</p><p><a href="https://github.com/gethomepage/homepage">https://github.com/gethomepage/homepage</a></p><p><a href="https://www.himiku.com/archives/homepage.html">https://www.himiku.com/archives/homepage.html</a></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu20.04部署ftp服务</title>
      <link href="/2024/04/11/ubuntu20.04%E9%83%A8%E7%BD%B2ftp%E6%9C%8D%E5%8A%A1/"/>
      <url>/2024/04/11/ubuntu20.04%E9%83%A8%E7%BD%B2ftp%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ubuntu20-04部署ftp服务"><a href="#ubuntu20-04部署ftp服务" class="headerlink" title="ubuntu20.04部署ftp服务"></a>ubuntu20.04部署ftp服务</h1><h2 id="一-安装ftp服务并创建登录用户"><a href="#一-安装ftp服务并创建登录用户" class="headerlink" title="一. 安装ftp服务并创建登录用户"></a>一. 安装ftp服务并创建登录用户</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install vsftpd</span><br></pre></td></tr></table></figure><p>添加ftp用户</p><p>创建用户(用户名为myftp，与后面vsftpd配置文件对应)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -m myftp -d /home/myftp</span><br><span class="line"><span class="comment"># 若不想让该用户登录系统</span></span><br><span class="line">sudo useradd -m myftp -d /home/myftp -s /bin/bash/nologin</span><br><span class="line"><span class="comment"># 设置用户密码</span></span><br><span class="line">sudo passwd myftp</span><br></pre></td></tr></table></figure><p>创建用户目录,并赋予权限(<code>此步骤必须在创建用户之后</code>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /home/myftp</span><br><span class="line">sudo <span class="built_in">chmod</span> 755 /home/myftp -R</span><br></pre></td></tr></table></figure><h2 id="二-修改服务配置"><a href="#二-修改服务配置" class="headerlink" title="二. 修改服务配置"></a>二. 修改服务配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/vsftpd.conf</span><br></pre></td></tr></table></figure><p>配置如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">listen=YES</span><br><span class="line"><span class="comment">#listen_ipv6=YES      #使用IPV6</span></span><br><span class="line">anonymous_enable=NO   <span class="comment">#不允许匿名访问</span></span><br><span class="line">local_enable=YES      <span class="comment">#允许本地用户登录</span></span><br><span class="line">write_enable=YES      <span class="comment">#允许FTP写入</span></span><br><span class="line">local_umask=022      <span class="comment">#新建文件夹或文件的权限默认为077，大多数ftp服务器设置为022</span></span><br><span class="line"><span class="comment">#anon_upload_enable=YES  #不允许匿名用户上传文件</span></span><br><span class="line"><span class="comment">#anon_mkdir_write_enable=YES #不允许匿名用户新建目录</span></span><br><span class="line">dirmessage_enable=YES        <span class="comment">#进入目录时向远程用户发送消息</span></span><br><span class="line">use_localtime=YES            <span class="comment">#显示带有时间的目录列表</span></span><br><span class="line">xferlog_enable=YES           <span class="comment">#激活上传/下载的日志记录</span></span><br><span class="line">connect_from_port_20=YES     <span class="comment">#确保ftp传输端口号为20</span></span><br><span class="line"><span class="comment">#chown_uploads=YES           #可将上传的匿名文件由指定用户拥有</span></span><br><span class="line"><span class="comment">#chown_username=whoever</span></span><br><span class="line">xferlog_file=/var/log/vsftpd.log  <span class="comment">#日志文件路径，也可以直接使用默认路径</span></span><br><span class="line">xferlog_std_format=YES           <span class="comment">#使用标准化格式的日志文件</span></span><br><span class="line"><span class="comment">#idle_session_timeout=600         #空闲会话超时的默认值</span></span><br><span class="line"><span class="comment">#data_connection_timeout=120     #数据连接超时的默认值</span></span><br><span class="line"><span class="comment">#Nopriv_user= ftpsecure         #创建唯一的用户，将该用户用作完全隔离且无特权的用户</span></span><br><span class="line"><span class="comment">#async_abor_enable=YES        #识别异步abor请求，可能会拒绝一些老的FTP客户端的连接</span></span><br><span class="line"><span class="comment">#ascii_upload_enable=YES      #设置ASCII上传下载</span></span><br><span class="line"><span class="comment">#ascii_download_enable=YES </span></span><br><span class="line">ftpd_banner=Welcome to blah FTP service. <span class="comment">#登录欢迎语</span></span><br><span class="line"><span class="comment">#deny_email_enable=YES          #拒绝匿名email地址的文件，防止攻击</span></span><br><span class="line"><span class="comment">#banned_email_file=/etc/vsftpd.banned_emails</span></span><br><span class="line"><span class="comment">#chroot_local_user=YES           #将本地用户限制在主目录中</span></span><br><span class="line">local_root=/home/myftp             <span class="comment">#设置主目录</span></span><br><span class="line">chroot_local_user=YES            <span class="comment">#限制用户权限</span></span><br><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vsftpd.chroot_list  <span class="comment">#允许访问的用户列表文件</span></span><br><span class="line"><span class="comment">#ls_recurse_enable=YES              #激活ls -r选项</span></span><br><span class="line">secure_chroot_dir=/var/run/vsftpd/empty   <span class="comment">#空目录名称</span></span><br><span class="line">pam_service_name=myftp                   <span class="comment">#创建的ftp用户名</span></span><br><span class="line"><span class="comment">#rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem  #ssl的RSA证书位置</span></span><br><span class="line"><span class="comment">#rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key #ssl的RSA秘钥位置</span></span><br><span class="line"><span class="comment">#ssl_enable=NO                          #开启ssl加密</span></span><br><span class="line"><span class="comment">#utf8_filesystem=YES                    #使用utf8文件系统</span></span><br></pre></td></tr></table></figure><p>如下为配置后的vsftpd.conf文件内容，#为注释内容，已删除。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">listen=YES</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">use_localtime=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_file=/var/log/vsftpd.log</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">ftpd_banner=Welcome to blah FTP service.</span><br><span class="line">local_root=/home/myftp</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vsftpd.chroot_list</span><br><span class="line">secure_chroot_dir=/var/run/vsftpd/empty</span><br><span class="line">pam_service_name=myftp</span><br><span class="line">rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</span><br><span class="line">rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</span><br></pre></td></tr></table></figure><p>其中：</p><ul><li>local_root=/home/myftp     //该目录为之前创建的用户目录</li><li>pam_service_name=myftp   //默认为vsftpd，需要更改为创建的ftp用户名</li><li>创建文件vsftpd.chroot_list</li><li>sudo vi /etc/vsftpd.chroot_list   并将之前创建的用户名(myftp)添加到该文件中。</li></ul><p>重新启动服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart vsftpd</span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_5fd0c9223e7d46a74c05bea17f930c28.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_5fd0c9223e7d46a74c05bea17f930c28.png"></p><p>本文参考：</p><p><a href="https://blog.csdn.net/fangye945a/article/details/85109404">https://blog.csdn.net/fangye945a/article/details/85109404</a></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux部署hexo</title>
      <link href="/2024/04/11/linux%E9%83%A8%E7%BD%B2hexo/"/>
      <url>/2024/04/11/linux%E9%83%A8%E7%BD%B2hexo/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="linux部署hexo"><a href="#linux部署hexo" class="headerlink" title="linux部署hexo"></a>linux部署hexo</h1><h2 id="一-安装node-js"><a href="#一-安装node-js" class="headerlink" title="一. 安装node.js"></a>一. 安装node.js</h2><h3 id="node-js下载链接"><a href="#node-js下载链接" class="headerlink" title="node.js下载链接"></a>node.js下载链接</h3><blockquote><p><a href="https://nodejs.org/dist/v16.13.1/node-v16.13.1-linux-x64.tar.xz">资源下载链接 | &gt;</a></p></blockquote><h2 id="二-配置node-js"><a href="#二-配置node-js" class="headerlink" title="二. 配置node.js"></a>二. 配置node.js</h2><p>node.js下载完成后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /usr/local/node/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/node/</span><br><span class="line">此时将安装包上传到此目录后解压</span><br><span class="line">rz </span><br><span class="line">tar -xvf node-v16.13.1-linux-x64.tar.xz</span><br></pre></td></tr></table></figure><p>配置环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置环境变量 </span></span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="comment"># 添加如下</span></span><br><span class="line"><span class="comment"># Nodejs</span></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/local/node/node-v16.13.1-linux-x64/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># 生效</span></span><br><span class="line"><span class="built_in">source</span>  /etc/profile</span><br></pre></td></tr></table></figure><p>此时nodejs安装完成。</p><h2 id="三-安装cnpm"><a href="#三-安装cnpm" class="headerlink" title="三. 安装cnpm"></a>三. 安装cnpm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入以下内容，验证是否安装成功</span></span><br><span class="line"><span class="comment"># 安装一个npm的加强版</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"><span class="comment"># 设置仓库为npm仓库</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmjs.org</span><br><span class="line"><span class="comment"># 续安装可能会出现问题，因为cpnm版本太高的原因如果出现问题的可以卸载这个最新版本安装一个指定版本</span></span><br><span class="line">的(npm是从国外拉包 cnpm国内)</span><br><span class="line">npm uninstall -g cnpm</span><br><span class="line"><span class="comment"># 安装指定版本：7.1.0</span></span><br><span class="line">npm install cnpm@7.1.0 -g</span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">[root@localhost ~]<span class="comment"># npm -version</span></span><br><span class="line">8.1.2</span><br><span class="line">[root@localhost ~]<span class="comment"># npx -v</span></span><br><span class="line">8.1.2</span><br><span class="line">[root@localhost bin]<span class="comment"># npm version</span></span><br></pre></td></tr></table></figure><h2 id="四-安装hexo"><a href="#四-安装hexo" class="headerlink" title="四. 安装hexo"></a>四. 安装hexo</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此时再使用cnpm安装nodejs即可</span></span><br><span class="line"><span class="comment"># 安装hexo</span></span><br><span class="line">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>备注：将事先在windows准备好的安装博客压缩包上传到服务器解压再 hexo clean &amp;&amp; hexo g &amp;&amp; hexo s即可。</p><h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a href="https://blog.csdn.net/weixin_45561352/article/details/122109731">linux搭建hexo个人博客_linux hexo博客-CSDN博客</a></p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fastgpt对接one-api部署</title>
      <link href="/2024/04/09/fastgpt%E5%AF%B9%E6%8E%A5one-api%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/04/09/fastgpt%E5%AF%B9%E6%8E%A5one-api%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="fastgpt对接one-api部署"><a href="#fastgpt对接one-api部署" class="headerlink" title="fastgpt对接one-api部署"></a>fastgpt对接one-api部署</h1><blockquote><p>默认密钥：<strong>root/1234</strong></p></blockquote><h2 id="one-api部署"><a href="#one-api部署" class="headerlink" title="one-api部署"></a>one-api部署</h2><blockquote><p><a href="http://sunlight.zznnwn.cloudns.biz/2024/04/09/one-api%E9%83%A8%E7%BD%B2/">部署链接 | &gt;</a></p></blockquote><h2 id="一-fastgpt使用docker-compose方式部署"><a href="#一-fastgpt使用docker-compose方式部署" class="headerlink" title="一 fastgpt使用docker-compose方式部署"></a>一 fastgpt使用docker-compose方式部署</h2><h3 id="镜像可选"><a href="#镜像可选" class="headerlink" title="镜像可选"></a>镜像可选</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:pgvector-v0.5.0</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:mongo5.0.18</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:fastgptv4.7</span><br></pre></td></tr></table></figure><h3 id="官网部署方式："><a href="#官网部署方式：" class="headerlink" title="官网部署方式："></a>官网部署方式：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> fastgpt</span><br><span class="line"><span class="built_in">cd</span> fastgpt</span><br><span class="line">curl -O https://raw.githubusercontent.com/labring/FastGPT/main/files/deploy/fastgpt/docker-compose.yml</span><br><span class="line">curl -O https://raw.githubusercontent.com/labring/FastGPT/main/projects/app/data/config.json</span><br></pre></td></tr></table></figure><h2 id="二-本文部署"><a href="#二-本文部署" class="headerlink" title="二 本文部署"></a>二 本文部署</h2><blockquote><p>one-api与fastgpt分开部署 先部署one api再部署fastgpt即如下</p></blockquote><h3 id="docker-compose-yml文件"><a href="#docker-compose-yml文件" class="headerlink" title="docker-compose.yml文件"></a>docker-compose.yml文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据库的默认账号和密码仅首次运行时设置有效</span></span><br><span class="line"><span class="comment"># 如果修改了账号密码，记得改数据库和项目连接参数，别只改一处~</span></span><br><span class="line"><span class="comment"># 该配置文件只是给快速启动，测试使用。正式使用，记得务必修改账号密码，以及调整合适的知识库参数，共享内存等。</span></span><br><span class="line"></span><br><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  pg:</span><br><span class="line">    image: ankane/pgvector:v0.5.0 <span class="comment"># git</span></span><br><span class="line">    <span class="comment"># image: registry.cn-hangzhou.aliyuncs.com/fastgpt/pgvector:v0.5.0 # 阿里云</span></span><br><span class="line">    container_name: pg</span><br><span class="line">    restart: always</span><br><span class="line">    ports: <span class="comment"># 生产环境建议不要暴露</span></span><br><span class="line">      - 5432:5432</span><br><span class="line">    networks:</span><br><span class="line">      - fastgpt</span><br><span class="line">    environment:</span><br><span class="line">      <span class="comment"># 这里的配置只有首次运行生效。修改后，重启镜像是不会生效的。需要把持久化数据删除再重启，才有效果</span></span><br><span class="line">      - POSTGRES_USER=username</span><br><span class="line">      - POSTGRES_PASSWORD=password</span><br><span class="line">      - POSTGRES_DB=postgres</span><br><span class="line">    volumes:</span><br><span class="line">      - ./pg/data:/var/lib/postgresql/data</span><br><span class="line">  mongo:</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/mongo:5.0.18</span><br><span class="line">    container_name: mongo</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - 27017:27017</span><br><span class="line">    networks:</span><br><span class="line">      - fastgpt</span><br><span class="line">    <span class="built_in">command</span>: mongod --keyFile /data/mongodb.key --replSet rs0</span><br><span class="line">    environment:</span><br><span class="line">      - MONGO_INITDB_ROOT_USERNAME=myusername</span><br><span class="line">      - MONGO_INITDB_ROOT_PASSWORD=mypassword</span><br><span class="line">    volumes:</span><br><span class="line">      - ./mongo/data:/data/db</span><br><span class="line">    entrypoint:</span><br><span class="line">      - bash</span><br><span class="line">      - -c</span><br><span class="line">      - |</span><br><span class="line">        openssl rand -<span class="built_in">base64</span> 128 &gt; /data/mongodb.key</span><br><span class="line">        <span class="built_in">chmod</span> 400 /data/mongodb.key</span><br><span class="line">        <span class="built_in">chown</span> 999:999 /data/mongodb.key</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;const isInited = rs.status().ok === 1</span></span><br><span class="line"><span class="string">        if(!isInited)&#123;</span></span><br><span class="line"><span class="string">          rs.initiate(&#123;</span></span><br><span class="line"><span class="string">              _id: &quot;rs0&quot;,</span></span><br><span class="line"><span class="string">              members: [</span></span><br><span class="line"><span class="string">                  &#123; _id: 0, host: &quot;mongo:27017&quot; &#125;</span></span><br><span class="line"><span class="string">              ]</span></span><br><span class="line"><span class="string">          &#125;)</span></span><br><span class="line"><span class="string">        &#125;&#x27;</span> &gt; /data/initReplicaSet.js</span><br><span class="line">        <span class="comment"># 启动MongoDB服务</span></span><br><span class="line">        <span class="built_in">exec</span> docker-entrypoint.sh <span class="string">&quot;$<span class="variable">$@</span>&quot;</span> &amp;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 等待MongoDB服务启动</span></span><br><span class="line">        <span class="keyword">until</span> mongo -u myusername -p mypassword --authenticationDatabase admin --<span class="built_in">eval</span> <span class="string">&quot;print(&#x27;waited for connection&#x27;)&quot;</span> &gt; /dev/null 2&gt;&amp;1; <span class="keyword">do</span></span><br><span class="line">          <span class="built_in">echo</span> <span class="string">&quot;Waiting for MongoDB to start...&quot;</span></span><br><span class="line">          <span class="built_in">sleep</span> 2</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 执行初始化副本集的脚本</span></span><br><span class="line">        mongo -u myusername -p mypassword --authenticationDatabase admin /data/initReplicaSet.js</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 等待docker-entrypoint.sh脚本执行的MongoDB服务进程</span></span><br><span class="line">        <span class="built_in">wait</span> $$!</span><br><span class="line">  fastgpt:</span><br><span class="line">    container_name: fastgpt</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.7 <span class="comment"># git</span></span><br><span class="line">    <span class="comment"># image: registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.7 # 阿里云</span></span><br><span class="line">    ports:</span><br><span class="line">      - 30001:3000</span><br><span class="line">    networks:</span><br><span class="line">      - fastgpt</span><br><span class="line">    depends_on:</span><br><span class="line">      - mongo</span><br><span class="line">      - pg</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      <span class="comment"># root 密码，用户名为: root。如果需要修改 root 密码，直接修改这个环境变量，并重启即可。</span></span><br><span class="line">      - DEFAULT_ROOT_PSW=1234</span><br><span class="line">      <span class="comment"># AI模型的API地址哦。务必加 /v1。这里默认填写了OneApi的访问地址。</span></span><br><span class="line">      - OPENAI_BASE_URL=http://10.0.0.10:3000/v1                     <span class="comment">#(此地址为oneapi地址+/v1)</span></span><br><span class="line">      <span class="comment"># AI模型的API Key。（这里默认填写了OneAPI的快速默认key，测试通后，务必及时修改）</span></span><br><span class="line">      - CHAT_API_KEY=sk-z02Gt0o6cWhTS6cbFfbgbggb9d42cF622Bc5e5c471a  <span class="comment">#(此key为one-api生成的令牌)</span></span><br><span class="line">      <span class="comment"># 数据库最大连接数</span></span><br><span class="line">      - DB_MAX_LINK=30</span><br><span class="line">      <span class="comment"># 登录凭证密钥</span></span><br><span class="line">      - TOKEN_KEY=any</span><br><span class="line">      <span class="comment"># root的密钥，常用于升级时候的初始化请求</span></span><br><span class="line">      - ROOT_KEY=root_key</span><br><span class="line">      <span class="comment"># 文件阅读加密</span></span><br><span class="line">      - FILE_TOKEN_KEY=filetoken</span><br><span class="line">      <span class="comment"># MongoDB 连接参数. 用户名myusername,密码mypassword。</span></span><br><span class="line">      - MONGODB_URI=mongodb://myusername:mypassword@mongo:27017/fastgpt?authSource=admin</span><br><span class="line">      <span class="comment"># pg 连接参数</span></span><br><span class="line">      - PG_URL=postgresql://username:password@pg:5432/postgres</span><br><span class="line">    volumes:</span><br><span class="line">      - ./config.json:/app/data/config.json</span><br><span class="line">      - ./fastgpt/tmp:/app/tmp</span><br><span class="line">  <span class="comment"># mysql:</span></span><br><span class="line">  <span class="comment">#   image: mysql:8.0.36</span></span><br><span class="line">  <span class="comment">#   container_name: mysql</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#   ports:</span></span><br><span class="line">  <span class="comment">#     - 3306:3306</span></span><br><span class="line">  <span class="comment">#   networks:</span></span><br><span class="line">  <span class="comment">#     - fastgpt</span></span><br><span class="line">  <span class="comment">#   command: --default-authentication-plugin=mysql_native_password</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     # 默认root密码，仅首次运行有效</span></span><br><span class="line">  <span class="comment">#     MYSQL_ROOT_PASSWORD: oneapimmysql</span></span><br><span class="line">  <span class="comment">#     MYSQL_DATABASE: oneapi</span></span><br><span class="line">  <span class="comment">#   volumes:</span></span><br><span class="line">  <span class="comment">#     - ./mysql:/var/lib/mysql</span></span><br><span class="line">  <span class="comment"># oneapi:</span></span><br><span class="line">  <span class="comment">#   container_name: oneapi</span></span><br><span class="line">  <span class="comment">#   image: ghcr.io/songquanpeng/one-api:latest</span></span><br><span class="line">  <span class="comment">#   ports:</span></span><br><span class="line">  <span class="comment">#     - 3001:3000</span></span><br><span class="line">  <span class="comment">#   depends_on:</span></span><br><span class="line">  <span class="comment">#     - mysql</span></span><br><span class="line">  <span class="comment">#   networks:</span></span><br><span class="line">  <span class="comment">#     - fastgpt</span></span><br><span class="line">  <span class="comment">#   restart: always</span></span><br><span class="line">  <span class="comment">#   environment:</span></span><br><span class="line">  <span class="comment">#     # mysql 连接参数</span></span><br><span class="line">  <span class="comment">#     - SQL_DSN=root:oneapimmysql@tcp(mysql:3306)/oneapi</span></span><br><span class="line">  <span class="comment">#     # 登录凭证加密密钥</span></span><br><span class="line">  <span class="comment">#     - SESSION_SECRET=oneapikey</span></span><br><span class="line">  <span class="comment">#     # 内存缓存</span></span><br><span class="line">  <span class="comment">#     - MEMORY_CACHE_ENABLED=true</span></span><br><span class="line">  <span class="comment">#     # 启动聚合更新，减少数据交互频率</span></span><br><span class="line">  <span class="comment">#     - BATCH_UPDATE_ENABLED=true</span></span><br><span class="line">  <span class="comment">#     # 聚合更新时长</span></span><br><span class="line">  <span class="comment">#     - BATCH_UPDATE_INTERVAL=10</span></span><br><span class="line">  <span class="comment">#     # 初始化的 root 密钥（建议部署完后更改，否则容易泄露）</span></span><br><span class="line">  <span class="comment">#     - INITIAL_ROOT_TOKEN=fastgpt</span></span><br><span class="line">  <span class="comment">#   volumes:</span></span><br><span class="line">  <span class="comment">#     - ./oneapi:/data</span></span><br><span class="line">networks:</span><br><span class="line">  fastgpt:</span><br></pre></td></tr></table></figure><h4 id="通义千文版config-json配置"><a href="#通义千文版config-json配置" class="headerlink" title="通义千文版config.json配置"></a>通义千文版config.json配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;feConfigs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lafEnv&quot;</span>: <span class="string">&quot;https://laf.dev&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;systemEnv&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;openapiPrefix&quot;</span>: <span class="string">&quot;fastgpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vectorMaxProcess&quot;</span>: 15,</span><br><span class="line">    <span class="string">&quot;qaMaxProcess&quot;</span>: 15,</span><br><span class="line">    <span class="string">&quot;pgHNSWEfSearch&quot;</span>: 100</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;llmModels&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-turbo&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;通义千问&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maxContext&quot;</span>: 16000,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;/imgs/model/openai.svg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maxResponse&quot;</span>: 4000,</span><br><span class="line">      <span class="string">&quot;quoteMaxToken&quot;</span>: 13000,</span><br><span class="line">      <span class="string">&quot;maxTemperature&quot;</span>: 1.2,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;censor&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;vision&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;datasetProcess&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInClassify&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInExtractFields&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInToolCall&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInQueryExtension&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;toolChoice&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;functionCall&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;customCQPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;customExtractPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultSystemChatPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultConfig&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-plus&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;qwen-plus&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;/imgs/model/openai.svg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maxContext&quot;</span>: 125000,</span><br><span class="line">      <span class="string">&quot;maxResponse&quot;</span>: 4000,</span><br><span class="line">      <span class="string">&quot;quoteMaxToken&quot;</span>: 100000,</span><br><span class="line">      <span class="string">&quot;maxTemperature&quot;</span>: 1.2,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;censor&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;vision&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;datasetProcess&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInClassify&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInExtractFields&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInToolCall&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInQueryExtension&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;toolChoice&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;functionCall&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;customCQPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;customExtractPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultSystemChatPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultConfig&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-max&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;qwen-max&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;/imgs/model/openai.svg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maxContext&quot;</span>: 128000,</span><br><span class="line">      <span class="string">&quot;maxResponse&quot;</span>: 4000,</span><br><span class="line">      <span class="string">&quot;quoteMaxToken&quot;</span>: 100000,</span><br><span class="line">      <span class="string">&quot;maxTemperature&quot;</span>: 1.2,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;censor&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;vision&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;datasetProcess&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInClassify&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInExtractFields&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInToolCall&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInQueryExtension&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;toolChoice&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;functionCall&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;customCQPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;customExtractPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultSystemChatPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultConfig&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;vectorModels&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-max-longcontext&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;qwen-max-longcontext&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;/imgs/model/openai.svg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;defaultToken&quot;</span>: 512,</span><br><span class="line">      <span class="string">&quot;maxToken&quot;</span>: 3000,</span><br><span class="line">      <span class="string">&quot;weight&quot;</span>: 100,</span><br><span class="line">      <span class="string">&quot;dbConfig&quot;</span>: &#123;&#125;,</span><br><span class="line">      <span class="string">&quot;queryConfig&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;reRankModels&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;audioSpeechModels&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-1.8b-chat&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;qwen-1.8b-chat&quot;</span>,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;voices&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Alloy&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;alloy&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Alloy&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Echo&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;echo&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Echo&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Fable&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;fable&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Fable&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Onyx&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;onyx&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Onyx&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Nova&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;nova&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Nova&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Shimmer&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;shimmer&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Shimmer&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;whisperModel&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;whisper-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Whisper1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;charsPointsPrice&quot;</span>: 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="chatgpt版config配置"><a href="#chatgpt版config配置" class="headerlink" title="chatgpt版config配置"></a>chatgpt版config配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;feConfigs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lafEnv&quot;</span>: <span class="string">&quot;https://laf.dev&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;systemEnv&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;openapiPrefix&quot;</span>: <span class="string">&quot;fastgpt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vectorMaxProcess&quot;</span>: 15,</span><br><span class="line">    <span class="string">&quot;qaMaxProcess&quot;</span>: 15,</span><br><span class="line">    <span class="string">&quot;pgHNSWEfSearch&quot;</span>: 100</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;llmModels&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;gpt-3.5-turbo&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;gpt-3.5-turbo&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maxContext&quot;</span>: 16000,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;/imgs/model/openai.svg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maxResponse&quot;</span>: 4000,</span><br><span class="line">      <span class="string">&quot;quoteMaxToken&quot;</span>: 13000,</span><br><span class="line">      <span class="string">&quot;maxTemperature&quot;</span>: 1.2,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;censor&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;vision&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;datasetProcess&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInClassify&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInExtractFields&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInToolCall&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInQueryExtension&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;toolChoice&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;functionCall&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;customCQPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;customExtractPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultSystemChatPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultConfig&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;gpt-4-0125-preview&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;gpt-4-turbo&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;/imgs/model/openai.svg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maxContext&quot;</span>: 125000,</span><br><span class="line">      <span class="string">&quot;maxResponse&quot;</span>: 4000,</span><br><span class="line">      <span class="string">&quot;quoteMaxToken&quot;</span>: 100000,</span><br><span class="line">      <span class="string">&quot;maxTemperature&quot;</span>: 1.2,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;censor&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;vision&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;datasetProcess&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInClassify&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInExtractFields&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInToolCall&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;usedInQueryExtension&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;toolChoice&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;functionCall&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;customCQPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;customExtractPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultSystemChatPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultConfig&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;gpt-4-vision-preview&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;gpt-4-vision&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;/imgs/model/openai.svg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;maxContext&quot;</span>: 128000,</span><br><span class="line">      <span class="string">&quot;maxResponse&quot;</span>: 4000,</span><br><span class="line">      <span class="string">&quot;quoteMaxToken&quot;</span>: 100000,</span><br><span class="line">      <span class="string">&quot;maxTemperature&quot;</span>: 1.2,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;censor&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;vision&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;datasetProcess&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInClassify&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInExtractFields&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInToolCall&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;usedInQueryExtension&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;toolChoice&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;functionCall&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;customCQPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;customExtractPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultSystemChatPrompt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;defaultConfig&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;vectorModels&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;text-embedding-ada-002&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Embedding-2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;avatar&quot;</span>: <span class="string">&quot;/imgs/model/openai.svg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;defaultToken&quot;</span>: 512,</span><br><span class="line">      <span class="string">&quot;maxToken&quot;</span>: 3000,</span><br><span class="line">      <span class="string">&quot;weight&quot;</span>: 100,</span><br><span class="line">      <span class="string">&quot;dbConfig&quot;</span>: &#123;&#125;,</span><br><span class="line">      <span class="string">&quot;queryConfig&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;reRankModels&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;audioSpeechModels&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;model&quot;</span>: <span class="string">&quot;tts-1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;OpenAI TTS1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;charsPointsPrice&quot;</span>: 0,</span><br><span class="line">      <span class="string">&quot;voices&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Alloy&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;alloy&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Alloy&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Echo&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;echo&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Echo&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Fable&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;fable&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Fable&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Onyx&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;onyx&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Onyx&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Nova&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;nova&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Nova&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">&quot;label&quot;</span>: <span class="string">&quot;Shimmer&quot;</span>,</span><br><span class="line">          <span class="string">&quot;value&quot;</span>: <span class="string">&quot;shimmer&quot;</span>,</span><br><span class="line">          <span class="string">&quot;bufferId&quot;</span>: <span class="string">&quot;openai-Shimmer&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;whisperModel&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;whisper-1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Whisper1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;charsPointsPrice&quot;</span>: 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="fastgpt启动"><a href="#fastgpt启动" class="headerlink" title="fastgpt启动"></a>fastgpt启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><h3 id="三-扩展"><a href="#三-扩展" class="headerlink" title="三 扩展"></a>三 扩展</h3><h4 id="one-api与fastgpt在一个部署文件中集成（推荐使用此种）"><a href="#one-api与fastgpt在一个部署文件中集成（推荐使用此种）" class="headerlink" title="one-api与fastgpt在一个部署文件中集成（推荐使用此种）"></a>one-api与fastgpt在一个部署文件中集成（推荐使用此种）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">pg:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ankane/pgvector:v0.5.0</span> <span class="comment"># git</span></span><br><span class="line">    <span class="comment"># image: registry.cn-hangzhou.aliyuncs.com/fastgpt/pgvector:v0.5.0 # 阿里云</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">pg</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span> <span class="comment"># 生产环境建议不要暴露</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5432</span><span class="string">:5432</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fastgpt</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 这里的配置只有首次运行生效。修改后，重启镜像是不会生效的。需要把持久化数据删除再重启，才有效果</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">POSTGRES_USER=username</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">POSTGRES_PASSWORD=password</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">POSTGRES_DB=postgres</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./pg/data:/var/lib/postgresql/data</span></span><br><span class="line">  <span class="attr">mongo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/fastgpt/mongo:5.0.18</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mongo</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">27017</span><span class="string">:27017</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fastgpt</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">mongod</span> <span class="string">--keyFile</span> <span class="string">/data/mongodb.key</span> <span class="string">--replSet</span> <span class="string">rs0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MONGO_INITDB_ROOT_USERNAME=myusername</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MONGO_INITDB_ROOT_PASSWORD=mypassword</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mongo/data:/data/db</span></span><br><span class="line">    <span class="attr">entrypoint:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bash</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        openssl rand -base64 128 &gt; /data/mongodb.key</span></span><br><span class="line"><span class="string">        chmod 400 /data/mongodb.key</span></span><br><span class="line"><span class="string">        chown 999:999 /data/mongodb.key</span></span><br><span class="line"><span class="string">        echo &#x27;const isInited = rs.status().ok === 1</span></span><br><span class="line"><span class="string">        if(!isInited)&#123;</span></span><br><span class="line"><span class="string">          rs.initiate(&#123;</span></span><br><span class="line"><span class="string">              _id: &quot;rs0&quot;,</span></span><br><span class="line"><span class="string">              members: [</span></span><br><span class="line"><span class="string">                  &#123; _id: 0, host: &quot;mongo:27017&quot; &#125;</span></span><br><span class="line"><span class="string">              ]</span></span><br><span class="line"><span class="string">          &#125;)</span></span><br><span class="line"><span class="string">        &#125;&#x27; &gt; /data/initReplicaSet.js</span></span><br><span class="line"><span class="string">        # 启动MongoDB服务</span></span><br><span class="line"><span class="string">        exec docker-entrypoint.sh &quot;$$@&quot; &amp;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">        <span class="comment"># 等待MongoDB服务启动</span></span><br><span class="line">        <span class="string">until</span> <span class="string">mongo</span> <span class="string">-u</span> <span class="string">myusername</span> <span class="string">-p</span> <span class="string">mypassword</span> <span class="string">--authenticationDatabase</span> <span class="string">admin</span> <span class="string">--eval</span> <span class="string">&quot;print(&#x27;waited for connection&#x27;)&quot;</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> <span class="number">2</span><span class="string">&gt;&amp;1;</span> <span class="string">do</span></span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;Waiting for MongoDB to start...&quot;</span></span><br><span class="line">          <span class="string">sleep</span> <span class="number">2</span></span><br><span class="line">        <span class="string">done</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 执行初始化副本集的脚本</span></span><br><span class="line">        <span class="string">mongo</span> <span class="string">-u</span> <span class="string">myusername</span> <span class="string">-p</span> <span class="string">mypassword</span> <span class="string">--authenticationDatabase</span> <span class="string">admin</span> <span class="string">/data/initReplicaSet.js</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 等待docker-entrypoint.sh脚本执行的MongoDB服务进程</span></span><br><span class="line">        <span class="string">wait</span> <span class="string">$$!</span></span><br><span class="line">  <span class="attr">fastgpt:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">fastgpt</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.7</span> <span class="comment"># git</span></span><br><span class="line">    <span class="comment"># image: registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.7 # 阿里云</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">30001</span><span class="string">:3000</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fastgpt</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mongo</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pg</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># root 密码，用户名为: root。如果需要修改 root 密码，直接修改这个环境变量，并重启即可。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DEFAULT_ROOT_PSW=1234</span></span><br><span class="line">      <span class="comment"># AI模型的API地址哦。务必加 /v1。这里默认填写了OneApi的访问地址。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">OPENAI_BASE_URL=http://one-api:3000/v1</span>                     <span class="comment">#(此地址为oneapi地址+/v1)</span></span><br><span class="line">      <span class="comment"># AI模型的API Key。（这里默认填写了OneAPI的快速默认key，测试通后，务必及时修改）</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CHAT_API_KEY=sk-74E561</span>  <span class="comment">#(此key为one-api生成的令牌)</span></span><br><span class="line">      <span class="comment"># 数据库最大连接数</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_MAX_LINK=30</span></span><br><span class="line">      <span class="comment"># 登录凭证密钥</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TOKEN_KEY=any</span></span><br><span class="line">      <span class="comment"># root的密钥，常用于升级时候的初始化请求</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROOT_KEY=root_key</span></span><br><span class="line">      <span class="comment"># 文件阅读加密</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FILE_TOKEN_KEY=filetoken</span></span><br><span class="line">      <span class="comment"># MongoDB 连接参数. 用户名myusername,密码mypassword。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MONGODB_URI=mongodb://myusername:mypassword@mongo:27017/fastgpt?authSource=admin</span></span><br><span class="line">      <span class="comment"># pg 连接参数</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PG_URL=postgresql://username:password@pg:5432/postgres</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config.json:/app/data/config.json</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./fastgpt/tmp:/app/tmp</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">one-api:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:one-api-latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">one-api</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./one-api:/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">fastgpt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">fastgpt:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="fastgpt更换logo"><a href="#fastgpt更换logo" class="headerlink" title="fastgpt更换logo"></a>fastgpt更换logo</h4><p>[其他logo更换参考 | &gt; (<a href="https://doc.fastai.site/docs/development/configuration/">配置文件介绍 | FastGPT (fastai.site)</a>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> ./logo.svg fastgpt:/app/projects/app/public/icon</span><br><span class="line">docker <span class="built_in">cp</span> ./favicon.ico fastgpt:/app/projects/app/public/</span><br></pre></td></tr></table></figure><h2 id="四-效果"><a href="#四-效果" class="headerlink" title="四 效果"></a>四 效果</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_3390fff9c5b4e790c31ef176e89a5c27.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_3390fff9c5b4e790c31ef176e89a5c27.png"></p><h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a href="https://doc.fastai.site/docs/development/docker/">官网</a></p><p><a href="https://blog.csdn.net/m0_62536353/article/details/135733446">保姆级教程：FastGPT构建个人本地知识库(Docker compose快速部署)_fastgpt本地部署-CSDN博客</a></p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>one-api部署</title>
      <link href="/2024/04/09/one-api%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/04/09/one-api%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="one-api部署"><a href="#one-api部署" class="headerlink" title="one-api部署"></a>one-api部署</h1><blockquote><p>调用的接口是国外的例如chatgpt时需要配置代理或者使用国外服务器</p><p>初始密码：root/123456</p></blockquote><h2 id="使用docker-compose部署"><a href="#使用docker-compose部署" class="headerlink" title="使用docker-compose部署"></a>使用docker-compose部署</h2><h3 id="镜像可选"><a href="#镜像可选" class="headerlink" title="镜像可选"></a>镜像可选</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">justsong/one-api:latest </span><br><span class="line">image: registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:one-api-latest</span><br></pre></td></tr></table></figure><h3 id="docker方式"><a href="#docker方式" class="headerlink" title="docker方式"></a>docker方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 SQLite 的部署命令：</span></span><br><span class="line">docker run --name one-api -d --restart always -p 3000:3000 -e TZ=Asia/Shanghai -v /home/ubuntu/data/one-api:/data justsong/one-api</span><br><span class="line"><span class="comment"># 使用 MySQL 的部署命令，在上面的基础上添加 `-e SQL_DSN=&quot;root:123456@tcp(localhost:3306)/oneapi&quot;`，请自行修改数据库连接参数，不清楚如何修改请参见下面环境变量一节。</span></span><br><span class="line"><span class="comment"># 例如：</span></span><br><span class="line">docker run --name one-api -d --restart always -p 3000:3000 -e SQL_DSN=<span class="string">&quot;root:123456@tcp(localhost:3306)/oneapi&quot;</span> -e TZ=Asia/Shanghai -v /home/ubuntu/data/one-api:/data justsong/one-api</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="docker-compose方式"><a href="#docker-compose方式" class="headerlink" title="docker-compose方式"></a>docker-compose方式</h2><p>使用mysql作为数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  one-api:</span><br><span class="line">    container_name: one-api</span><br><span class="line">    image: justsong/one-api</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      - SQL_DSN=root:123456@tcp(localhost:3306)/oneapi</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">    volumes:</span><br><span class="line">      - ./one-api:/data</span><br></pre></td></tr></table></figure><p>使用SQlite作为数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  one-api:</span><br><span class="line">    image: registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:one-api-latest</span><br><span class="line">    container_name: one-api</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    environment:</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">    volumes:</span><br><span class="line">      - ./one-api:/data</span><br></pre></td></tr></table></figure><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_a09a324c0e01b3dc1c96ba17b2b32f1b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_a09a324c0e01b3dc1c96ba17b2b32f1b.png"></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote><p><a href="%5Bhttps://doc.fastai.site/docs/development/one-api/%5D(https://doc.fastai.site/docs/development/one-api/)">见链接 | &gt;&gt;</a></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_f34a8621031f3fc757073165acc4903d.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_f34a8621031f3fc757073165acc4903d.png"></p><p><strong>对接chat-next-web只需要填写如下即可</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_41dd190facdda36a483473f4b9721848.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_41dd190facdda36a483473f4b9721848.png"></p></blockquote><h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a href="https://cloud.sealos.io/">使用sealos一键部署和使用oneapi（相对简单略）</a></p><p><a href="%5Bhttps://github.com/GEGEWU-CLOUD/one-api%5D(https://github.com/GEGEWU-CLOUD/one-api)">使用docker部署</a></p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu配置网卡bond版 openstack部署</title>
      <link href="/2024/04/02/ubuntu%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1bond%E7%89%88%20openstack%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/04/02/ubuntu%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1bond%E7%89%88%20openstack%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ubuntu配置网卡bond版-openstack部署"><a href="#ubuntu配置网卡bond版-openstack部署" class="headerlink" title="ubuntu配置网卡bond版 openstack部署"></a>ubuntu配置网卡bond版 openstack部署</h1><blockquote><p>环境：8C24G windows10家庭版 workstdtion17 pro ubuntu20.04</p><p><del>由于电脑性能原因此次使用单节点测试</del></p></blockquote><h2 id="一-ubuntu网卡bond配置"><a href="#一-ubuntu网卡bond配置" class="headerlink" title="一. ubuntu网卡bond配置"></a>一. ubuntu网卡bond配置</h2><p>见链接 | ：<a href="http://sunlight.zznnwn.cloudns.biz/2024/04/02/workstdtion%E6%A8%A1%E6%8B%9F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%88%92%E5%88%86vlan%E5%8F%8A%E7%BD%91%E5%8D%A1bond%E8%AE%BE%E7%BD%AE">workstdtion模拟交换机划分vlan及网卡bond设置</a></p><h2 id="二-两或单副本ceph部署"><a href="#二-两或单副本ceph部署" class="headerlink" title="二. 两或单副本ceph部署"></a>二. 两或单副本ceph部署</h2><p>脚本部署方式见链接 | ：<a href="https://gegewu-cloud.github.io/2023/09/24/ceph%E9%9B%86%E7%BE%A4%E4%B9%8Bcephadm%E6%B8%85%E7%90%86ceph%E9%9B%86%E7%BE%A4/">ceph一键部署</a></p><p>备注<strong>ceph</strong>网络选择： –mon-ip  <del>10.56.60.11</del>  –cluster-network <del>10.56.50.0/24</del>  –allow-overwrite</p><h2 id="三-两或单副本openstack部署"><a href="#三-两或单副本openstack部署" class="headerlink" title="三. 两或单副本openstack部署"></a>三. 两或单副本openstack部署</h2><h3 id="1-global-yml文件配置-网络与一中保持一致"><a href="#1-global-yml文件配置-网络与一中保持一致" class="headerlink" title="1. global.yml文件配置 网络与一中保持一致"></a>1. global.yml文件配置 网络与一中保持一致</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -------------------&lt;&lt;分割线&gt;&gt;------------------------</span></span><br><span class="line"><span class="comment"># kolla-ansible global.yml配置</span></span><br><span class="line">kolla_base_distro: <span class="string">&quot;ubuntu&quot;</span></span><br><span class="line">kolla_install_type: <span class="string">&quot;source&quot;</span></span><br><span class="line">openstack_release: <span class="string">&quot;zznnyoga&quot;</span></span><br><span class="line">nova_compute_virt_type: <span class="string">&quot;qemu&quot;</span></span><br><span class="line">node_custom_config: <span class="string">&quot;/etc/kolla/config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置私有阿里云仓库</span></span><br><span class="line">docker_registry: <span class="string">&quot;registry.cn-hangzhou.aliyuncs.com&quot;</span>     <span class="comment"># 拉取 docker 镜像的源</span></span><br><span class="line">docker_namespace: <span class="string">&quot;zznn&quot;</span>                                 <span class="comment"># docker registry 项目名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 外部ceph配置 （ workstdtion ens33 nat模式 ）</span></span><br><span class="line">swift_storage_interface: <span class="string">&quot;vlan60&quot;</span>             <span class="comment"># ceph 存储网络的接口 (ceph public network 所在接口)</span></span><br><span class="line"><span class="comment"># external_ceph_pool_pgs: 16                  # (hdd osd 个数) * 3 的值最接近 2^n 的数, 例如 hdd osd 个数为 12, 则 external_ceph_pool_pgs 取 32</span></span><br><span class="line"><span class="comment"># external_ceph_ssd_pool_pgs: 32              # (ssd osd 个数) * 3 的值最接近 2^n 的数, 如果没有 ssd, 则可忽略该配置</span></span><br><span class="line">failed_swap_on: <span class="string">&quot;yes&quot;</span>                        <span class="comment"># 默认禁止开启 swap</span></span><br><span class="line">enable_external_ceph: <span class="string">&quot;yes&quot;</span>                  <span class="comment"># 开启外部ceph</span></span><br><span class="line">external_ceph_admin_permission: <span class="string">&quot;yes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># openstack内部接口配置 （ens33 nat模式 ens37 主机模式（ 其实此处ens37应该使用外部IP即使用 桥接模式的ens38 但vmware环境这样也行 因为windows端可以ping通主机模式生成的IP ））</span></span><br><span class="line">keepalived_virtual_router_id: <span class="string">&quot;99&quot;</span>           <span class="comment"># keepalived 唯一的 ID，需要和局域网内其他  keepalived ID 不一致, 取值范围 0~255</span></span><br><span class="line">kolla_internal_vip_address: <span class="string">&quot;10.56.70.100&quot;</span>   <span class="comment"># 内部 vip ，需要和 /etc/hosts 中的 IP 网段一致 （workstdtion实验环境划分lan区段20只能内部通信 ）</span></span><br><span class="line">network_interface: <span class="string">&quot;vlan70&quot;</span>                   <span class="comment"># 内部 vip 接口，服务器内部通讯地址</span></span><br><span class="line">kolla_external_vip_address: <span class="string">&quot;192.168.1.99&quot;</span>   <span class="comment"># 外部 vip，用于 horizon dashboard 界面操作等(若开启高可用：enable_haproxy: &quot;yes&quot;需要配置为没有占用的ip)</span></span><br><span class="line">horizon_port: <span class="string">&quot;10000&quot;</span>                    <span class="comment"># dashboard 的端口</span></span><br><span class="line">kolla_external_vip_interface: <span class="string">&quot;bond3&quot;</span>    <span class="comment"># 外部 vip 接口, 若该网卡划分了 vlan，则需要填写配置外网的子接口workstdtion模拟ens38桥接模式网卡为192.168.31段</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他配置</span></span><br><span class="line"><span class="comment"># kolla_external_vip_interface: &quot;&#123;&#123; network_interface &#125;&#125;&quot;</span></span><br><span class="line">api_interface: <span class="string">&quot;&#123;&#123; network_interface &#125;&#125;&quot;</span></span><br><span class="line">storage_interface: <span class="string">&quot;&#123;&#123; network_interface &#125;&#125;&quot;</span></span><br><span class="line">cluster_interface: <span class="string">&quot;&#123;&#123; network_interface &#125;&#125;&quot;</span></span><br><span class="line">tunnel_interface: <span class="string">&quot;&#123;&#123; network_interface &#125;&#125;&quot;</span></span><br><span class="line">dns_interface: <span class="string">&quot;&#123;&#123; network_interface &#125;&#125;&quot;</span></span><br><span class="line"><span class="comment"># neutron_external_interface: &quot;ens38&quot; # 访问openstack的物理网卡不需要配置IP，业务口</span></span><br><span class="line">neutron_plugin_agent: <span class="string">&quot;openvswitch&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 外网设置（ ens38 nat模式 此处ens38为业务口不配置IP 采用办公网192.168.31段作为外网 接线接办公网的光纤或网线 ）</span></span><br><span class="line"><span class="comment"># neutron_external_interface: &quot;ens38&quot;      # flat 网络使用的物理网卡,若需要连接专网</span></span><br><span class="line">neutron_external_interface: <span class="string">&quot;bond2,vlan80&quot;</span>        <span class="comment"># workstdtion模拟桥接模式网卡 用于模拟外网可配置网络也可不配置 物理服务器需要接外网网线</span></span><br><span class="line">neutron_bridge_name: <span class="string">&quot;&#123;% for i in range(neutron_external_interface.split(&#x27;,&#x27;)|length) %&#125;br-ex&#123;&#123; loop.index0 + 1 &#125;&#125;&#123;% if not loop.last %&#125;,&#123;% endif %&#125;&#123;% endfor %&#125;&quot;</span></span><br><span class="line"><span class="comment"># 网桥名字, neutron_external_interface 有多少个接口就要指定多少个网桥名称</span></span><br><span class="line">enable_neutron_dns: <span class="string">&quot;no&quot;</span>                                  <span class="comment"># neutron 是否开启 dns, 如果开启 dns, 可能遭受 dns 反射型 ddos 攻击, 如果不开启, horizon 中创建子网时需要指定公共 dns, 如 223.5.5.5</span></span><br><span class="line">enable_neutron_mtu_1550: <span class="string">&quot;no&quot;</span>                             <span class="comment"># 不要修改该参数，否则可能会带来一些网络问题</span></span><br><span class="line">enable_neutron_ext_net: <span class="string">&quot;yes&quot;</span>                             <span class="comment"># 是否自动创建 flat 网络</span></span><br><span class="line">neutron_ext_net_cidr: <span class="string">&quot;192.168.1.0/24&quot;</span></span><br><span class="line">neutron_ext_net_range: <span class="string">&quot;start=192.168.1.70,end=192.168.1.120&quot;</span></span><br><span class="line">neutron_ext_net_gateway: <span class="string">&quot;192.168.1.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用时钟检查(可选)</span></span><br><span class="line"><span class="comment"># prechecks_enable_host_ntp_checks: &quot;false&quot;</span></span><br><span class="line"><span class="comment"># skyline可选</span></span><br><span class="line"><span class="comment"># enable_skyline: &quot;yes&quot;</span></span><br><span class="line"><span class="comment"># 其他配置</span></span><br><span class="line">enable_ceph: <span class="string">&quot;no&quot;</span></span><br><span class="line">enable_haproxy: <span class="string">&quot;yes&quot;</span></span><br><span class="line">enable_chrony: <span class="string">&quot;yes&quot;</span></span><br><span class="line"><span class="comment"># enable_mariabackup: &quot;no&quot;</span></span><br><span class="line"><span class="comment"># enable_ceph_rgw: &quot;yes&quot;</span></span><br><span class="line">enable_cinder: <span class="string">&quot;yes&quot;</span></span><br><span class="line">enable_manila_backend_cephfs_native: <span class="string">&quot;yes&quot;</span></span><br><span class="line"><span class="comment"># enable_neutron_qos: &quot;yes&quot;  </span></span><br><span class="line"><span class="comment"># enable_ceph_rgw_keystone: &quot;yes&quot;</span></span><br><span class="line">glance_backend_ceph: <span class="string">&quot;yes&quot;</span></span><br><span class="line">glance_enable_rolling_upgrade: <span class="string">&quot;no&quot;</span></span><br><span class="line">gnocchi_backend_storage: <span class="string">&quot;ceph&quot;</span></span><br><span class="line">cinder_backend_ceph: <span class="string">&quot;yes&quot;</span></span><br><span class="line">nova_backend_ceph: <span class="string">&quot;yes&quot;</span></span><br><span class="line">ironic_dnsmasq_dhcp_range:</span><br><span class="line">tempest_image_id:</span><br><span class="line">tempest_flavor_ref_id:</span><br><span class="line">tempest_public_network_id:</span><br><span class="line">tempest_floating_network_name:</span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------分割线--------------</span></span><br><span class="line"><span class="comment"># 2023.10.30新增(新增vpn qos 数据库) ---------------------&gt;&gt; 下方新增配置------------</span></span><br><span class="line">enable_neutron_dvr: <span class="string">&quot;yes&quot;</span>                <span class="comment"># 您启用了 OpenStack Neutron 的 DVR（Distributed Virtual Router）功能。DVR 是一项功能，它允许虚拟路由器（Virtual Router）的数据面功能在计算节点上分布式执行，而不是集中执行在网络节点上。这有助于提高网络性能和扩展性。</span></span><br><span class="line">enable_neutron_vpnaas: <span class="string">&quot;yes&quot;</span>             <span class="comment"># vpn</span></span><br><span class="line">enable_neutron_qos: <span class="string">&quot;yes&quot;</span>                <span class="comment"># qos</span></span><br><span class="line">enable_nova_ssh: <span class="string">&quot;yes&quot;</span>                   <span class="comment"># 这允许用户通过 SSH 协议访问虚拟机实例，以进行远程管理和操作。</span></span><br><span class="line"><span class="comment"># enable_neutron_provider_networks: &quot;yes&quot;  # 提供者网络是一种网络类型，允许 OpenStack 租户连接到外部网络，通常是物理网络或其他外部网络服务。</span></span><br><span class="line"><span class="comment"># enable_trove: &quot;yes&quot;                      # Trove 是 OpenStack 的数据库即服务 </span></span><br></pre></td></tr></table></figure><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>可以看到此种方式即使是测试环境ceph osd写入速度也可以达到<del>1M/s</del>以上</p><p>注：此种测试时发现浮动IP无法使用原因如下</p><p>文件：</p><ul><li>/etc/kolla/neutron-server/ml2_conf.ini</li><li>/etc/kolla/neutron-openvswitch-agent/openvswitch_agent.ini</li><li>bond2 vlan80 与浮动IP网段均不在一起 bond2 上<del>网卡网口需要接与浮动IP同网段的网线</del> <strong>并且不能配置 IP</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看配置文件</span></span><br><span class="line"><span class="built_in">cat</span> /etc/kolla/neutron-openvswitch-agent/openvswitch_agent.ini</span><br><span class="line"></span><br><span class="line">[agent]</span><br><span class="line">tunnel_types = vxlan</span><br><span class="line">l2_population = <span class="literal">true</span></span><br><span class="line">arp_responder = <span class="literal">true</span></span><br><span class="line">enable_distributed_routing = True</span><br><span class="line">extensions = qos</span><br><span class="line"></span><br><span class="line">[securitygroup]</span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver</span><br><span class="line"></span><br><span class="line">[ovs]</span><br><span class="line">bridge_mappings = physnet1:br-ex1,physnet2:br-ex2</span><br><span class="line">datapath_type = system</span><br><span class="line">ovsdb_connection = tcp:127.0.0.1:6640</span><br><span class="line">ovsdb_timeout = 10</span><br><span class="line">local_ip = 10.56.70.11     <span class="comment"># IP为56段IP但浮动IP为192.168段</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看交换机内部</span></span><br><span class="line">(venv3) root@ceph1:/etc/kolla/neutron-openvswitch-agent<span class="comment"># docker exec -it openvswitch_vswitchd bash</span></span><br><span class="line">(openvswitch-vswitchd)[root@ceph1 /]<span class="comment"># ovs-vsctl show</span></span><br><span class="line">0b40fa1b-d121-4e67-ae65-2a702169c162</span><br><span class="line">    Manager <span class="string">&quot;ptcp:6640:127.0.0.1&quot;</span></span><br><span class="line">        is_connected: <span class="literal">true</span></span><br><span class="line">    Bridge br-ex1</span><br><span class="line">        Controller <span class="string">&quot;tcp:127.0.0.1:6633&quot;</span></span><br><span class="line">            is_connected: <span class="literal">true</span></span><br><span class="line">        fail_mode: secure</span><br><span class="line">        datapath_type: system</span><br><span class="line">        Port br-ex1</span><br><span class="line">            Interface br-ex1</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port bond2                       <span class="comment"># 可以看到此处使用的外网网卡是bond2 但是此时bond2是</span></span><br><span class="line">            Interface bond2</span><br><span class="line">        Port phy-br-ex1</span><br><span class="line">            Interface phy-br-ex1</span><br><span class="line">                <span class="built_in">type</span>: patch</span><br><span class="line">                options: &#123;peer=int-br-ex1&#125;</span><br><span class="line">    Bridge br-ex2</span><br><span class="line">        Controller <span class="string">&quot;tcp:127.0.0.1:6633&quot;</span></span><br><span class="line">            is_connected: <span class="literal">true</span></span><br><span class="line">        fail_mode: secure</span><br><span class="line">        datapath_type: system</span><br><span class="line">        Port phy-br-ex2</span><br><span class="line">            Interface phy-br-ex2</span><br><span class="line">                <span class="built_in">type</span>: patch</span><br><span class="line">                options: &#123;peer=int-br-ex2&#125;</span><br><span class="line">        Port br-ex2</span><br><span class="line">            Interface br-ex2</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port vlan80</span><br><span class="line">            Interface vlan80</span><br><span class="line">    Bridge br-tun</span><br><span class="line">        Controller <span class="string">&quot;tcp:127.0.0.1:6633&quot;</span></span><br><span class="line">            is_connected: <span class="literal">true</span></span><br><span class="line">        fail_mode: secure</span><br><span class="line">        datapath_type: system</span><br><span class="line">        Port br-tun</span><br><span class="line">            Interface br-tun</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port patch-int</span><br><span class="line">            Interface patch-int</span><br><span class="line">                <span class="built_in">type</span>: patch</span><br><span class="line">                options: &#123;peer=patch-tun&#125;</span><br><span class="line">    Bridge br-int</span><br><span class="line">        Controller <span class="string">&quot;tcp:127.0.0.1:6633&quot;</span></span><br><span class="line">            is_connected: <span class="literal">true</span></span><br><span class="line">        fail_mode: secure</span><br><span class="line">        datapath_type: system</span><br><span class="line">        Port tapc4f556bc-44</span><br><span class="line">            tag: 3</span><br><span class="line">            Interface tapc4f556bc-44</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port patch-tun</span><br><span class="line">            Interface patch-tun</span><br><span class="line">                <span class="built_in">type</span>: patch</span><br><span class="line">                options: &#123;peer=patch-int&#125;</span><br><span class="line">        Port qvo0650711e-a1</span><br><span class="line">            tag: 2</span><br><span class="line">            Interface qvo0650711e-a1</span><br><span class="line">        Port int-br-ex1</span><br><span class="line">            Interface int-br-ex1</span><br><span class="line">                <span class="built_in">type</span>: patch</span><br><span class="line">                options: &#123;peer=phy-br-ex1&#125;</span><br><span class="line">        Port qg-97668e2d-78</span><br><span class="line">            tag: 3</span><br><span class="line">            Interface qg-97668e2d-78</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port int-br-ex2</span><br><span class="line">            Interface int-br-ex2</span><br><span class="line">                <span class="built_in">type</span>: patch</span><br><span class="line">                options: &#123;peer=phy-br-ex2&#125;</span><br><span class="line">        Port sg-02263924-70</span><br><span class="line">            tag: 2</span><br><span class="line">            Interface sg-02263924-70</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port tap823e4df9-c8</span><br><span class="line">            tag: 2</span><br><span class="line">            Interface tap823e4df9-c8</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port fg-69b4fc5a-cc</span><br><span class="line">            tag: 3</span><br><span class="line">            Interface fg-69b4fc5a-cc</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port br-int</span><br><span class="line">            Interface br-int</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br><span class="line">        Port qr-69d003b3-f2</span><br><span class="line">            tag: 2</span><br><span class="line">            Interface qr-69d003b3-f2</span><br><span class="line">                <span class="built_in">type</span>: internal</span><br></pre></td></tr></table></figure><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">(venv3)</span> <span class="string">root@ceph1:~#</span> <span class="string">cat</span> <span class="string">/etc/netplan/00-installer-config.yaml</span> </span><br><span class="line"><span class="comment"># This is the network config written by &#x27;subiquity&#x27;</span></span><br><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">ens33:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">ens37:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">ens38:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">ens39:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">ens40:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">ens41:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">ens42:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">ens43:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">bonds:</span></span><br><span class="line">    <span class="attr">bond0:</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.56.50.11/24&quot;</span>]  <span class="comment"># 此网口用万兆口 用于ceph osd间通信（--cluster-network）</span></span><br><span class="line">      <span class="attr">interfaces:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ens37</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">802.</span><span class="string">3ad</span></span><br><span class="line">        <span class="attr">mii-monitor-interval:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">lacp-rate:</span> <span class="string">fast</span></span><br><span class="line">        <span class="attr">transmit-hash-policy:</span> <span class="string">layer3+4</span></span><br><span class="line">    <span class="attr">bond1:</span></span><br><span class="line">      <span class="attr">interfaces:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="string">ens38</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">802.</span><span class="string">3ad</span></span><br><span class="line">        <span class="attr">mii-monitor-interval:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">lacp-rate:</span> <span class="string">fast</span></span><br><span class="line">        <span class="attr">transmit-hash-policy:</span> <span class="string">layer3+4</span></span><br><span class="line">    <span class="attr">bond2:</span></span><br><span class="line">      <span class="attr">interfaces:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ens39</span>   <span class="comment"># 接与浮动IP同网段的网线</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">802.</span><span class="string">3ad</span></span><br><span class="line">        <span class="attr">mii-monitor-interval:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">lacp-rate:</span> <span class="string">fast</span></span><br><span class="line">        <span class="attr">transmit-hash-policy:</span> <span class="string">layer3+4</span></span><br><span class="line">    <span class="attr">bond3:</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;192.168.1.10/24&quot;</span>]      <span class="comment"># 此网口用千兆口 &gt;&gt; 电口 用于远程连接 为浮动IP</span></span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">interfaces:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ens33</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">802.</span><span class="string">3ad</span></span><br><span class="line">        <span class="attr">mii-monitor-interval:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">lacp-rate:</span> <span class="string">fast</span></span><br><span class="line">        <span class="attr">transmit-hash-policy:</span> <span class="string">layer3+4</span></span><br><span class="line">  <span class="attr">vlans:</span></span><br><span class="line">    <span class="attr">vlan60:</span></span><br><span class="line">      <span class="attr">id:</span> <span class="number">60</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">bond1</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.56.60.11/24&quot;</span>]</span><br><span class="line">    <span class="attr">vlan70:</span></span><br><span class="line">      <span class="attr">id:</span> <span class="number">70</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">bond1</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.56.70.11/24&quot;</span>]</span><br><span class="line">    <span class="attr">vlan80:</span></span><br><span class="line">      <span class="attr">id:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">bond1</span></span><br><span class="line">      <span class="comment">#addresses: [&quot;10.56.80.11/24&quot;]  #浮动IP使用接口不配置IP</span></span><br><span class="line">    <span class="attr">vlan90:</span></span><br><span class="line">      <span class="attr">id:</span> <span class="number">90</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">bond1</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="string">&quot;10.56.90.11/24&quot;</span>]</span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p>此时问题解决。</p><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><h3 id="ceph状态"><a href="#ceph状态" class="headerlink" title="ceph状态"></a>ceph状态</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(venv3) root@ceph1:~# ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     dc7fa486-f1a0-11ee-a64f-c194d5eb9f2e</span><br><span class="line">    health: HEALTH_WARN</span><br><span class="line">            5 pool(s) have no replicas configured</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 1 daemons, quorum ceph1 (age 62m)</span><br><span class="line">    mgr: ceph1.phqsba(active, since 62m)</span><br><span class="line">    osd: 1 osds: 1 up (since 62m), 1 in (since 2h)</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   5 pools, 129 pgs</span><br><span class="line">    objects: 157 objects, 220 MiB</span><br><span class="line">    usage:   111 MiB used, 20 GiB / 20 GiB avail</span><br><span class="line">    pgs:     129 active+clean</span><br></pre></td></tr></table></figure><h3 id="openstack创建实例验证效果-gt-gt"><a href="#openstack创建实例验证效果-gt-gt" class="headerlink" title="openstack创建实例验证效果 &gt;&gt;"></a>openstack创建实例验证效果 &gt;&gt;</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ea5efea6d38310a022b2f7c573e3afcd.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_ea5efea6d38310a022b2f7c573e3afcd.png"></p><p>此时集群测试圆满完成。</p>]]></content>
      
      
      <categories>
          
          <category> openstack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openstack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>workstdtion模拟交换机划分vlan及网卡bond设置</title>
      <link href="/2024/04/02/workstdtion%E6%A8%A1%E6%8B%9F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%88%92%E5%88%86vlan%E5%8F%8A%E7%BD%91%E5%8D%A1bond%E8%AE%BE%E7%BD%AE/"/>
      <url>/2024/04/02/workstdtion%E6%A8%A1%E6%8B%9F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%88%92%E5%88%86vlan%E5%8F%8A%E7%BD%91%E5%8D%A1bond%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="workstdtion模拟交换机划分vlan及网卡bond设置"><a href="#workstdtion模拟交换机划分vlan及网卡bond设置" class="headerlink" title="workstdtion模拟交换机划分vlan及网卡bond设置"></a>workstdtion模拟交换机划分vlan及网卡bond设置</h1><h2 id="workstdtion设置"><a href="#workstdtion设置" class="headerlink" title="workstdtion设置"></a>workstdtion设置</h2><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c2444bc85394584e2798df97ef8b9549.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c2444bc85394584e2798df97ef8b9549.png"></p><h2 id="一-第一种ubuntu系统网卡配置"><a href="#一-第一种ubuntu系统网卡配置" class="headerlink" title="一. 第一种ubuntu系统网卡配置"></a>一. 第一种ubuntu系统网卡配置</h2><blockquote><p>查看端口速率：</p><ul><li><p>判断是千兆网卡还是百兆网卡 查看支持的速率 &gt; <strong>ethtool ens33</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Speed: 1000Mb/s</span><br><span class="line">Duplex: Full</span><br><span class="line">Port: Twisted Pair</span><br></pre></td></tr></table></figure></li></ul></blockquote><p>完整网卡配置如下：共接四根网线 <strong>bond0&gt;&gt;bond3</strong> 处网卡需要是<strong>up</strong>状态 物理服务器时只需要插入网线查看端口状态即可判断网口状态</p><ul><li><p>bond3 浮动IP 192.168.1.10/24 网口上 位于千兆口 接一根交换机上划分的一根同网段网线 用于远程连接</p></li><li><p>bond0 万兆口接一根交换机划分的 50 段网络 用于ceph osd 内部通信ceph（–cluster-network）网络</p></li><li><p>bond1 上面接交换机上对 该网口划分了vlan60 vlan70 vlan80 vlan90 的网线</p></li><li><p><code>bond2</code> 上面接交换机上对 <del>192.168.1.10/24 网段划分的浮动IP 池</del> 的网线 例如：<del>本文则需要为桥接模式模拟浮动</del>IP  并且此网口不配置IP（下方文件测试已配置了IP <del>实际过程中自行注释</del>）<code>实验中单节点vmware环境bond2下网卡ens39桥接模式 部署单节点stack一切正常 但是双节点bond2下网卡ens39 双节点ens39网卡均配置桥接模式时 只有一个节点可用 &gt;&gt; 此时 只需要将双节点上方均没有划分bond的任意网卡桥接如ens41 修改global文件用于浮动IP池使用的网卡为ens41 再重新部署 即 正常</code>。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_6e28aee0f289c98393d974c614fc09c3.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_6e28aee0f289c98393d974c614fc09c3.png"></p></li><li><p>三台服务器 此种配置完成后 是可以互通的无论<strong>ping</strong>那个网段都是通的<br>ubuntu网卡bond接线与ceph及start集成<strong>揽图</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_cea9571e22249bca02d6cb339ed3c060.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_cea9571e22249bca02d6cb339ed3c060.png"></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is the network config written by &#x27;subiquity&#x27;</span></span><br><span class="line">network:</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33: &#123;&#125;</span><br><span class="line">    ens37: &#123;&#125;</span><br><span class="line">    ens38: &#123;&#125;</span><br><span class="line">    ens39: &#123;&#125;</span><br><span class="line">    ens40: &#123;&#125;</span><br><span class="line">    ens41: &#123;&#125;</span><br><span class="line">    ens42: &#123;&#125;</span><br><span class="line">    ens43: &#123;&#125;</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      addresses: [<span class="string">&quot;10.56.50.11/24&quot;</span>]  <span class="comment"># 此网口用万兆口 用于ceph osd间通信（--cluster-network）</span></span><br><span class="line">      interfaces:</span><br><span class="line">        - ens37</span><br><span class="line">      parameters:</span><br><span class="line">        mode: 802.3ad</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">        lacp-rate: fast</span><br><span class="line">        transmit-hash-policy: layer3+4</span><br><span class="line">    bond1:</span><br><span class="line">      interfaces:  </span><br><span class="line">        - ens38</span><br><span class="line">      parameters:</span><br><span class="line">        mode: 802.3ad</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">        lacp-rate: fast</span><br><span class="line">        transmit-hash-policy: layer3+4</span><br><span class="line">    bond2:</span><br><span class="line">      interfaces:</span><br><span class="line">        - ens39</span><br><span class="line">      parameters:</span><br><span class="line">        mode: 802.3ad</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">        lacp-rate: fast</span><br><span class="line">        transmit-hash-policy: layer3+4</span><br><span class="line">    bond3:</span><br><span class="line">      addresses: [<span class="string">&quot;192.168.1.10/24&quot;</span>]      <span class="comment"># 此网口用千兆口 &gt;&gt; 电口 用于远程连接 及浮动IP使用</span></span><br><span class="line">      gateway4: 192.168.1.1</span><br><span class="line">      interfaces:</span><br><span class="line">        - ens33</span><br><span class="line">      parameters:</span><br><span class="line">        mode: 802.3ad</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">        lacp-rate: fast</span><br><span class="line">        transmit-hash-policy: layer3+4</span><br><span class="line">  vlans:</span><br><span class="line">    vlan60:</span><br><span class="line">      <span class="built_in">id</span>: 60</span><br><span class="line">      <span class="built_in">link</span>: bond1</span><br><span class="line">      addresses: [<span class="string">&quot;10.56.60.11/24&quot;</span>]</span><br><span class="line">    vlan70:</span><br><span class="line">      <span class="built_in">id</span>: 70</span><br><span class="line">      <span class="built_in">link</span>: bond1</span><br><span class="line">      addresses: [<span class="string">&quot;10.56.70.11/24&quot;</span>]</span><br><span class="line">    vlan80:</span><br><span class="line">      <span class="built_in">id</span>: 80</span><br><span class="line">      <span class="built_in">link</span>: bond1</span><br><span class="line">      addresses: [<span class="string">&quot;10.56.80.11/24&quot;</span>]</span><br><span class="line">    vlan90:</span><br><span class="line">      <span class="built_in">id</span>: 90</span><br><span class="line">      <span class="built_in">link</span>: bond1</span><br><span class="line">      addresses: [<span class="string">&quot;10.56.90.11/24&quot;</span>]</span><br><span class="line">  version: 2</span><br></pre></td></tr></table></figure><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">  System information as of Wed 03 Apr 2024 04:59:36 AM UTC</span><br><span class="line"></span><br><span class="line">  System load:              0.02</span><br><span class="line">  Usage of /:               26.9% of 39.07GB</span><br><span class="line">  Memory usage:             11%</span><br><span class="line">  Swap usage:               0%</span><br><span class="line">  Processes:                261</span><br><span class="line">  Users logged <span class="keyword">in</span>:          1</span><br><span class="line">  IPv4 address <span class="keyword">for</span> bond0:   10.56.50.11</span><br><span class="line">  IPv4 address <span class="keyword">for</span> bond3:   192.168.1.10</span><br><span class="line">  IPv6 address <span class="keyword">for</span> bond3:   240e:36f:151f:a000:e407:31ff:fee2:70f9</span><br><span class="line">  IPv4 address <span class="keyword">for</span> docker0: 172.17.0.1</span><br><span class="line">  IPv4 address <span class="keyword">for</span> vlan60:  10.56.60.11</span><br><span class="line">  IPv4 address <span class="keyword">for</span> vlan70:  10.56.70.11</span><br><span class="line">  IPv4 address <span class="keyword">for</span> vlan80:  10.56.80.11</span><br><span class="line">  IPv4 address <span class="keyword">for</span> vlan90:  10.56.90.11</span><br><span class="line"><span class="comment">#-----------------------------------------------------------------</span></span><br><span class="line">root@ceph1:~<span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master bond3 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e6:07:31:e2:70:f9 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: ens37: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master bond0 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 5a:c0:b2:8b:fe:e7 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">4: ens38: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master bond1 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e2:ce:28:a9:28:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: ens39: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master bond2 state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 76:88:82:b8:46:ba brd ff:ff:ff:ff:ff:ff</span><br><span class="line">6: ens40: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:45:8a:b0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::20c:29ff:fe45:8ab0/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: ens41: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:45:8a:ba brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::20c:29ff:fe45:8aba/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">8: ens42: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:45:8a:c4 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::20c:29ff:fe45:8ac4/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">9: ens43: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:45:8a:ce brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::20c:29ff:fe45:8ace/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">10: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 5a:c0:b2:8b:fe:e7 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.56.50.11/24 brd 10.56.50.255 scope global bond0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::58c0:b2ff:fe8b:fee7/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">11: bond1: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e2:ce:28:a9:28:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::e0ce:28ff:fea9:280d/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">12: bond2: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 76:88:82:b8:46:ba brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::7488:82ff:feb8:46ba/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">13: bond3: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e6:07:31:e2:70:f9 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.1.10/24 brd 192.168.1.255 scope global bond3</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 240e:36f:151f:a000:e407:31ff:fee2:70f9/64 scope global dynamic mngtmpaddr noprefixroute </span><br><span class="line">       valid_lft 198193sec preferred_lft 111793sec</span><br><span class="line">    inet6 fe80::e407:31ff:fee2:70f9/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">14: vlan90@bond1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e2:ce:28:a9:28:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.56.90.11/24 brd 10.56.90.255 scope global vlan90</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::e0ce:28ff:fea9:280d/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">15: vlan60@bond1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e2:ce:28:a9:28:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.56.60.11/24 brd 10.56.60.255 scope global vlan60</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::e0ce:28ff:fea9:280d/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">16: vlan70@bond1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e2:ce:28:a9:28:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.56.70.11/24 brd 10.56.70.255 scope global vlan70</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::e0ce:28ff:fea9:280d/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">17: vlan80@bond1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether e2:ce:28:a9:28:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.56.80.11/24 brd 10.56.80.255 scope global vlan80</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::e0ce:28ff:fea9:280d/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">18: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:98:b9:c1:30 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时便可配置openstack 与 ceph 见 &gt;&gt; | <a href="http://sunlight.zznnwn.cloudns.biz/2024/04/02/ubuntu%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1bond%E7%89%88%20openstack%E9%83%A8%E7%BD%B2/">bond版opesnatck</a> 。</p>]]></content>
      
      
      <categories>
          
          <category> ubuntu-bond </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu-bond </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kolla-ansible合并配置文件属性之新增glance等配置介绍文档</title>
      <link href="/2024/04/01/kolla-ansible%E5%90%88%E5%B9%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E4%B9%8B%E6%96%B0%E5%A2%9Eglance%E7%AD%89%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D%E6%96%87%E6%A1%A3/"/>
      <url>/2024/04/01/kolla-ansible%E5%90%88%E5%B9%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E4%B9%8B%E6%96%B0%E5%A2%9Eglance%E7%AD%89%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D%E6%96%87%E6%A1%A3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="kolla-ansible合并配置文件属性之新增glance等配置介绍文档"><a href="#kolla-ansible合并配置文件属性之新增glance等配置介绍文档" class="headerlink" title="kolla-ansible合并配置文件属性之新增glance等配置介绍文档"></a>kolla-ansible合并配置文件属性之新增glance等配置介绍文档</h1><h2 id="ceph密钥测试官网方式构建"><a href="#ceph密钥测试官网方式构建" class="headerlink" title="ceph密钥测试官网方式构建"></a>ceph密钥测试官网方式构建</h2><p>官网版本（测试此种版本）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ceph auth get-or-create client.glance mon <span class="string">&#x27;profile rbd&#x27;</span> osd <span class="string">&#x27;profile rbd pool=images&#x27;</span> mgr <span class="string">&#x27;profile rbd pool=images&#x27;</span> -o ceph.client.glance.keyring </span><br><span class="line">ceph auth get-or-create client.cinder mon <span class="string">&#x27;profile rbd&#x27;</span> osd <span class="string">&#x27;profile rbd pool=volumes, profile rbd pool=vms, profile rbd-read-only pool=images&#x27;</span> mgr <span class="string">&#x27;profile rbd pool=volumes, profile rbd pool=vms&#x27;</span> -o ceph.client.cinder.keyring</span><br><span class="line">ceph auth get-or-create client.cinder-backup mon <span class="string">&#x27;profile rbd&#x27;</span> osd <span class="string">&#x27;profile rbd pool=backups&#x27;</span> mgr <span class="string">&#x27;profile rbd pool=backups&#x27;</span> -o ceph.client.cinder-backup.keyring</span><br></pre></td></tr></table></figure><p>ZzNnwN.部署版本密钥创建如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/ceph</span><br><span class="line">ceph auth get-or-create client.cinder mon <span class="string">&#x27;allow r&#x27;</span> osd <span class="string">&#x27;allow class-read object_prefix rbd_children, allow rwx pool=volumes, allow rwx pool=vms, allow rx pool=images&#x27;</span> -o ceph.client.cinder.keyring</span><br><span class="line">ceph auth get-or-create client.glance mon <span class="string">&#x27;allow r&#x27;</span> osd <span class="string">&#x27;allow class-read object_prefix rbd_children, allow rwx pool=images&#x27;</span>  -o ceph.client.glance.keyring</span><br><span class="line">ceph auth get-or-create client.cinder-backup mon <span class="string">&#x27;allow r&#x27;</span> osd <span class="string">&#x27;allow class-read object_prefix rbd_children, allow rwx pool=backups, allow rwx pool=volumes&#x27;</span>  -o ceph.client.cinder-backup.keyring</span><br><span class="line">ceph auth get-or-create client.nova mon <span class="string">&#x27;allow r&#x27;</span> osd <span class="string">&#x27;allow class-read object_prefix rbd_children, allow rwx pool=vms, allow rwx pool=volumes, allow rx pool=images&#x27;</span>  -o ceph.client.nova.keyring</span><br></pre></td></tr></table></figure><h2 id="目前已验证合并配置文件生效配置"><a href="#目前已验证合并配置文件生效配置" class="headerlink" title="目前已验证合并配置文件生效配置"></a>目前已验证合并配置文件生效配置</h2><blockquote><p>下方内容来自 | ：</p><p><a href="https://wn-apple-teawine.fun/2023/06/02/ceph%E4%B8%8Eopenstack-yoga%E9%9B%86%E6%88%90">https://wn-apple-teawine.fun/2023/06/02/ceph与openstack-yoga集成</a></p><p>可参考官网：</p><p><a href="https://docs.ceph.com/en/reef/rbd/rbd-openstack/">https://docs.ceph.com/en/reef/rbd/rbd-openstack/</a></p><p><del><strong>volume</strong>与<strong>cinder-backup</strong>利用<strong>kolla-ansible</strong>合并配置文件属性后生成的配置文件分别位于</del></p><p>/etc/kolla/cinder-volume/cinder.conf<br>/etc/kolla/cinder-backup/cinder.conf</p><p><del><strong>glance</strong>与<strong>nova</strong>分别位于</del></p><p>/etc/kolla/glance-api/glance-api.conf<br>/etc/kolla/nova-compute/nova.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># glance的配置镜像存储</span></span><br><span class="line">vi /etc/kolla/config/glance/glance-api.conf</span><br><span class="line"><span class="comment"># 添加：</span></span><br><span class="line">[glance_store]</span><br><span class="line">stores=rbd</span><br><span class="line">default_store=rbd</span><br><span class="line">rbd_store_pool=images</span><br><span class="line">rbd_store_user=glance</span><br><span class="line">rbd_store_ceph_conf=/etc/ceph/ceph.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># cinder的配置卷存储</span></span><br><span class="line">vi /etc/kolla/config/cinder/cinder-volume.conf</span><br><span class="line"><span class="comment"># 添加:</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_backends=rbd-1</span><br><span class="line">[rbd-1]</span><br><span class="line">rbd_ceph_conf=/etc/ceph/ceph.conf</span><br><span class="line"><span class="comment"># rbd_flatten_volume_from_snapshot = true</span></span><br><span class="line">rbd_user=cinder  </span><br><span class="line">backend_host=rbd:volumes</span><br><span class="line">rbd_pool=volumes</span><br><span class="line">volume_backend_name=rbd-1</span><br><span class="line">volume_driver=cinder.volume.drivers.rbd.RBDDriver     <span class="comment"># 此为驱动</span></span><br><span class="line">rbd_secret_uuid=ea241bba-2031-4b0e-b750-c8356cbb46a8 </span><br><span class="line"></span><br><span class="line">新增：（ rbd_flatten_volume_from_snapshot = <span class="literal">true</span></span><br><span class="line">）</span><br><span class="line"><span class="comment"># 注意：rbd_secret_uuid在/etc/kolla/passwords.yml 文件中找</span></span><br><span class="line"><span class="comment"># cat /etc/kolla/passwords.yml | grep rbd_secret_uuid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cinder-backup的配置</span></span><br><span class="line">vi /etc/kolla/config/cinder/cinder-backup.conf</span><br><span class="line"><span class="comment"># 添加:</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">backup_ceph_conf=/etc/ceph/ceph.conf</span><br><span class="line">backup_ceph_user=cinder-backup   </span><br><span class="line">backup_ceph_chunk_size=134217728</span><br><span class="line">backup_ceph_pool=backups</span><br><span class="line"><span class="comment"># 本次使用cinder.backup.drivers.ceph.CephBackupDriver</span></span><br><span class="line">backup_driver=cinder.backup.drivers.ceph.CephBackupDriver    <span class="comment">#此为驱动可选cinder.backup.drivers.ceph</span></span><br><span class="line">backup_ceph_stripe_unit=0</span><br><span class="line">backup_ceph_stripe_count=0</span><br><span class="line">restore_discard_excess_bytes=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># nova的配置</span></span><br><span class="line">vi /etc/kolla/config/nova/nova-compute.conf</span><br><span class="line"><span class="comment"># 添加：   </span></span><br><span class="line">[libvirt]   </span><br><span class="line">virt_type=kvm  </span><br><span class="line">cpu_mode=none </span><br><span class="line">images_rbd_pool=vms</span><br><span class="line">images_type=rbd</span><br><span class="line">images_rbd_ceph_conf=/etc/ceph/ceph.conf</span><br><span class="line">rbd_user=nova</span><br><span class="line"><span class="comment"># disk_cachemodes= &quot;network=writeback&quot;</span></span><br><span class="line"><span class="comment"># inject_password=true</span></span><br><span class="line"><span class="comment"># 如果是在虚拟机上部署的话需要将virt_type 改为qemu，如果不改成qemu，在openstack之上在起虚机，这个虚机是起不来的 </span></span><br><span class="line">（实际环境参考</span><br><span class="line">新增: disk_cachemodes= <span class="string">&quot;network=writeback&quot;</span> inject_password=<span class="literal">true</span>,images_type=rbd </span><br><span class="line">删除: virt_type=kvm, cpu_mode = none :删除新增配置此种时成功 ）</span><br></pre></td></tr></table></figure></blockquote><h2 id="glance配置文件（glance-api-conf）"><a href="#glance配置文件（glance-api-conf）" class="headerlink" title="glance配置文件（glance-api.conf）"></a>glance配置文件（glance-api.conf）</h2><p>ZzNnwN.部署版本 kolla_ansible合并 配置文件路径：/etc/kolla/config/glance/glance-api.conf</p><blockquote><p>官网引用</p><h4 id="KILO-AND-AFTER-gt-gt"><a href="#KILO-AND-AFTER-gt-gt" class="headerlink" title="KILO AND AFTER&gt;&gt;"></a>KILO AND AFTER<a href="https://docs.ceph.com/en/reef/rbd/rbd-openstack/#kilo-and-after" title="Permalink to this heading">&gt;&gt;</a></h4><p>Edit <code>/etc/glance/glance-api.conf</code> and add under the <code>[glance_store]</code> section:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[glance_store]</span><br><span class="line">stores = rbd</span><br><span class="line">default_store = rbd</span><br><span class="line">rbd_store_pool = images</span><br><span class="line">rbd_store_user = glance</span><br><span class="line">rbd_store_ceph_conf = /etc/ceph/ceph.conf</span><br><span class="line">rbd_store_chunk_size = 8</span><br></pre></td></tr></table></figure><p>For more information about the configuration options available in Glance please refer to the OpenStack Configuration Reference: <a href="http://docs.openstack.org/">http://docs.openstack.org/</a>.</p><h4 id="ENABLE-COPY-ON-WRITE-CLONING-OF-IMAGES"><a href="#ENABLE-COPY-ON-WRITE-CLONING-OF-IMAGES" class="headerlink" title="ENABLE COPY-ON-WRITE CLONING OF IMAGES"></a>ENABLE COPY-ON-WRITE CLONING OF IMAGES<a href="https://docs.ceph.com/en/reef/rbd/rbd-openstack/#enable-copy-on-write-cloning-of-images" title="Permalink to this heading"></a></h4><p>Note that this exposes the back end location via Glance’s API, so the endpoint with this option enabled should not be publicly accessible.</p><h5 id="ANY-OPENSTACK-VERSION-EXCEPT-MITAKA"><a href="#ANY-OPENSTACK-VERSION-EXCEPT-MITAKA" class="headerlink" title="ANY OPENSTACK VERSION EXCEPT MITAKA"></a>ANY OPENSTACK VERSION EXCEPT MITAKA<a href="https://docs.ceph.com/en/reef/rbd/rbd-openstack/#any-openstack-version-except-mitaka" title="Permalink to this heading"></a></h5><p>If you want to enable copy-on-write cloning of images, also add under the <code>&lt;span class=&quot;pre&quot;&gt;[DEFAULT]&lt;/span&gt;</code> section:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_image_direct_url = True</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_image_direct_url = True</span><br></pre></td></tr></table></figure><blockquote><p>在OpenStack中，Glance是用于管理虚拟机镜像的组件，而Ceph则是一种分布式存储系统，常被用于OpenStack的后端存储。在你提到的配置中，<code>show_image_direct_url = True</code> 是用于配置 Glance 的 <code>glance-api.conf</code> 文件的一部分，它用于启用或禁用显示镜像直接URL的功能。当你设置 <code>show_image_direct_url = True</code> 时，Glance API 将包含一个名为 <code>direct_url</code> 的属性，该属性包含指向存储镜像直接URL的链接。这使得用户能够通过直接URL访问镜像，而不必通过 Glance API 服务。这在某些情况下可能是有用的，例如，如果你希望通过直接链接共享镜像给其他用户或系统，而无需通过 Glance API 。在 Ceph 和 OpenStack 集成的情况下，你需要确保 Glance 配置文件中的 <code>default_store</code> 设置为 <code>rbd</code>，以便将镜像存储在 Ceph RBD（块设备）后端。同时，你需要配置好 Ceph 的访问权限，确保 OpenStack 的各个组件可以正确地访问和使用 Ceph 存储。</p></blockquote><h2 id="ciner-官网参考"><a href="#ciner-官网参考" class="headerlink" title="ciner(官网参考)"></a>ciner(官网参考)</h2><p>ZzNnwN.部署版本 kolla_ansible合并 配置文件路径：/etc/kolla/config/cinder/cinder-volume.conf</p><blockquote><p>OpenStack requires a driver to interact with Ceph block devices. You must also specify the pool name for the block device. On your OpenStack node, edit <code>/etc/cinder/cinder.conf</code> by adding:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">...</span><br><span class="line">enabled_backends = ceph</span><br><span class="line">glance_api_version = 2</span><br><span class="line">...</span><br><span class="line">[ceph]</span><br><span class="line">volume_driver = cinder.volume.drivers.rbd.RBDDriver</span><br><span class="line">volume_backend_name = ceph</span><br><span class="line">rbd_pool = volumes</span><br><span class="line">rbd_ceph_conf = /etc/ceph/ceph.conf</span><br><span class="line">rbd_flatten_volume_from_snapshot = false</span><br><span class="line">rbd_max_clone_depth = 5</span><br><span class="line">rbd_store_chunk_size = 4</span><br><span class="line">rados_connect_timeout = -1</span><br></pre></td></tr></table></figure><p>If you are using <a href="https://docs.ceph.com/en/reef/rados/configuration/auth-config-ref/#enabling-disabling-cephx">cephx authentication</a>, also configure the user and uuid of the secret you added to <code> libvirt</code> as documented earlier:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[ceph]</span><br><span class="line">...</span><br><span class="line">rbd_user = cinder</span><br><span class="line">rbd_secret_uuid = 457eb676-33da-42ec-9a8c-9293d545c337</span><br></pre></td></tr></table></figure><p>Note that if you are configuring multiple cinder back ends, <code>&lt;span class=&quot;pre&quot;&gt;glance_api_version&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span class=&quot;pre&quot;&gt;=&lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span class=&quot;pre&quot;&gt;2&lt;/span&gt;</code> must be in the <code>&lt;span class=&quot;pre&quot;&gt;[DEFAULT]&lt;/span&gt;</code> section.</p></blockquote><p><strong>enabled_backends = ceph</strong>  此配置实际上后端手动操作为如下 实际上就是创建磁盘时选择的类型 新版本不需要手动创建 配置文件填写完成即可</p><p>比如 我手动创建rbd-1类型时则会报错：</p><p>执行 cinder type-key 1f90a0e1-3657-4d42-9965-4e9ab76ed635  set volume_backend_name=rbd-1 报错<br>ERROR: Volume Type is currently in use. (HTTP 400) (Request-ID: req-48ab8f51-d024-45e4-a9f8-376f7c71bf45)</p><blockquote><p>cinder type-create ceph</p><p>cinder type-key 8a8a69b6-ec9f-4a09-8126-a211fce34ef3 set  volume_backend_name=ceph</p><p>cinder type-list</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_081d10d51610d49db32c3074544340f6.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_081d10d51610d49db32c3074544340f6.png"></p></blockquote><h2 id="ciner-backup"><a href="#ciner-backup" class="headerlink" title="ciner-backup"></a>ciner-backup</h2><p>ZzNnwN.部署版本 kolla_ansible合并 配置文件路径：/etc/kolla/config/cinder/cinder-backup.conf</p><p>事实上默认使用的驱动是swift驱动 ZzNnWn.使用驱动为<strong>cinder.backup.drivers.ceph.CephBackupDriver</strong> 需要注意的是<strong>cinder.backup.drivers.ceph</strong>此驱动已弃用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">backup_driver= cinder.backup.drivers.swift.SwiftBackupDriver</span><br><span class="line">backup_driver=cinder.backup.drivers.swift.SwiftBackupDriver</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_0c901ca872c1b350140046935d9a97ad.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_0c901ca872c1b350140046935d9a97ad.png"></p><blockquote><p>官网引用</p><h3 id="CONFIGURING-CINDER-BACKUP"><a href="#CONFIGURING-CINDER-BACKUP" class="headerlink" title="CONFIGURING CINDER BACKUP"></a>CONFIGURING CINDER BACKUP<a href="https://docs.ceph.com/en/reef/rbd/rbd-openstack/#configuring-cinder-backup" title="Permalink to this heading"></a></h3><p>OpenStack Cinder Backup requires a specific daemon so don’t forget to install it. On your Cinder Backup node, edit <code>/etc/cinder/cinder.conf</code> and add:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">backup_driver = cinder.backup.drivers.ceph</span><br><span class="line">backup_ceph_conf = /etc/ceph/ceph.conf</span><br><span class="line">backup_ceph_user = cinder-backup</span><br><span class="line">backup_ceph_chunk_size = 134217728</span><br><span class="line">backup_ceph_pool = backups</span><br><span class="line">backup_ceph_stripe_unit = 0</span><br><span class="line">backup_ceph_stripe_count = 0</span><br><span class="line">restore_discard_excess_bytes = <span class="literal">true</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="nova与ceph"><a href="#nova与ceph" class="headerlink" title="nova与ceph"></a>nova与ceph</h2><p>ZzNnwN.部署版本 kolla_ansible合并 配置文件路径：/etc/kolla/config/nova/nova-compute.conf</p><p>此处应设置为如下</p><p>rbd_secret_uuid 通过如下两种方式皆可查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install libvirt-clients -y</span><br><span class="line">virsh secret-list  (此种为已与openstack集成才能使用)</span><br><span class="line"><span class="built_in">cat</span> /etc/kolla/passwords.yml |grep rbd_secret_uuid</span><br></pre></td></tr></table></figure><p>完整配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nova的配置</span></span><br><span class="line">vi /etc/kolla/config/nova/nova-compute.conf</span><br><span class="line"><span class="comment"># 添加：   </span></span><br><span class="line">[libvirt]   </span><br><span class="line">virt_type=kvm  </span><br><span class="line">cpu_mode=none </span><br><span class="line">images_rbd_pool=vms</span><br><span class="line">images_type=rbd</span><br><span class="line">images_rbd_ceph_conf=/etc/ceph/ceph.conf</span><br><span class="line">rbd_user=nova</span><br><span class="line"><span class="comment"># rbd_secret_uuid=ea241bba-2031-4b0e-b750-c8356cbb46a8 (可选不需要配置后端会自动生成)</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_5cdbe807c394a81c86e7f04b76d40922.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_5cdbe807c394a81c86e7f04b76d40922.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_4e38f71c5e42268c245ab6d95a5044b5.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_4e38f71c5e42268c245ab6d95a5044b5.png"></p><blockquote><p>官网引用</p><h3 id="CONFIGURING-NOVA-TO-ATTACH-CEPH-RBD-BLOCK-DEVICE"><a href="#CONFIGURING-NOVA-TO-ATTACH-CEPH-RBD-BLOCK-DEVICE" class="headerlink" title="CONFIGURING NOVA TO ATTACH CEPH RBD BLOCK DEVICE"></a>CONFIGURING NOVA TO ATTACH CEPH RBD BLOCK DEVICE<a href="https://docs.ceph.com/en/reef/rbd/rbd-openstack/#configuring-nova-to-attach-ceph-rbd-block-device" title="Permalink to this heading"></a></h3><p>In order to attach Cinder devices (either normal block or by issuing a boot from volume), you must tell Nova (and libvirt) which user and UUID to refer to when attaching the device. libvirt will refer to this user when connecting and authenticating with the Ceph cluster.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[libvirt]</span><br><span class="line">...</span><br><span class="line">rbd_user = cinder</span><br><span class="line">rbd_secret_uuid = 457eb676-33da-42ec-9a8c-9293d545c337</span><br></pre></td></tr></table></figure><p>These two flags are also used by the Nova ephemeral back end.</p><h3 id="CONFIGURING-NOVA"><a href="#CONFIGURING-NOVA" class="headerlink" title="CONFIGURING NOVA"></a>CONFIGURING NOVA<a href="https://docs.ceph.com/en/reef/rbd/rbd-openstack/#configuring-nova" title="Permalink to this heading"></a></h3><p>In order to boot virtual machines directly from Ceph volumes, you must configure the ephemeral backend for Nova.</p><p>It is recommended to enable the RBD cache in your Ceph configuration file; this has been enabled by default since the Giant release. Moreover, enabling the client admin socket allows the collection of metrics and can be invaluable for troubleshooting.</p><p>This socket can be accessed on the hypervisor (Nova compute) node:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph daemon /var/run/ceph/ceph-client.cinder.19195.32310016.asok help</span><br></pre></td></tr></table></figure><p>To enable RBD cache and admin sockets, ensure that on each hypervisor’s <code>&lt;span class=&quot;pre&quot;&gt;ceph.conf&lt;/span&gt;</code> contains:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">    rbd cache = true</span><br><span class="line">    rbd cache writethrough until flush = true</span><br><span class="line">    admin socket = /var/run/ceph/guests/$cluster-$type.$id.$pid.$cctid.asok</span><br><span class="line">    log file = /var/log/qemu/qemu-guest-$pid.log</span><br><span class="line">    rbd concurrent management ops = 20</span><br></pre></td></tr></table></figure><p>Configure permissions for these directories:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/run/ceph/guests/ /var/log/qemu/</span><br><span class="line">chown qemu:libvirtd /var/run/ceph/guests /var/log/qemu/</span><br></pre></td></tr></table></figure><p>Note that user <code>&lt;span class=&quot;pre&quot;&gt;qemu&lt;/span&gt;</code> and group <code>&lt;span class=&quot;pre&quot;&gt;libvirtd&lt;/span&gt;</code> can vary depending on your system. The provided example works for RedHat based systems.</p><p>Tip</p><p>If your virtual machine is already running you can simply restart it to enable the admin socket</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> openstack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openstack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openstack与ceph集成完成后功能测试</title>
      <link href="/2024/04/01/openstack%E4%B8%8Eceph%E9%9B%86%E6%88%90%E5%AE%8C%E6%88%90%E5%90%8E%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
      <url>/2024/04/01/openstack%E4%B8%8Eceph%E9%9B%86%E6%88%90%E5%AE%8C%E6%88%90%E5%90%8E%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="openstack与ceph集成完成后功能测试"><a href="#openstack与ceph集成完成后功能测试" class="headerlink" title="openstack与ceph集成完成后功能测试"></a>openstack与ceph集成完成后功能测试</h1><h2 id="一-glance对接功能测试"><a href="#一-glance对接功能测试" class="headerlink" title="一. glance对接功能测试"></a>一. glance对接功能测试</h2><h3 id="上传镜像【success-】"><a href="#上传镜像【success-】" class="headerlink" title="上传镜像【success!】"></a>上传镜像【success!】</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传镜像</span></span><br><span class="line">root@localhost:~<span class="comment"># openstack image create &quot;cirros-0.4.0-x86_64&quot; --file cirros-0.4.0-x86_64-disk.img --disk-format qcow2 --container-format bare --public</span></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">root@localhost:~<span class="comment"># glance image-list</span></span><br><span class="line">+--------------------------------------+---------------------+</span><br><span class="line">| ID                                   | Name                |</span><br><span class="line">+--------------------------------------+---------------------+</span><br><span class="line">| 73d31ccc-8eae-49e9-a0a7-2731e5a3806a | cirros-0.4.0-x86_64 |</span><br><span class="line">+--------------------------------------+---------------------+</span><br><span class="line">root@localhost:~<span class="comment"># rbd -p images ls</span></span><br><span class="line">73d31ccc-8eae-49e9-a0a7-2731e5a3806a</span><br><span class="line"><span class="comment"># 查看块设备(镜像)详情</span></span><br><span class="line">root@localhost:~<span class="comment"># rbd -p images info 73d31ccc-8eae-49e9-a0a7-2731e5a3806a</span></span><br><span class="line">rbd image <span class="string">&#x27;73d31ccc-8eae-49e9-a0a7-2731e5a3806a&#x27;</span>:</span><br><span class="line">        size 12 MiB <span class="keyword">in</span> 2 objects</span><br><span class="line">        order 23 (8 MiB objects)</span><br><span class="line">        snapshot_count: 1</span><br><span class="line">        <span class="built_in">id</span>: 1c4b9299cdad7</span><br><span class="line">        block_name_prefix: rbd_data.1c4b9299cdad7</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Tue Apr  2 05:43:02 2024</span><br><span class="line">        access_timestamp: Tue Apr  2 05:43:02 2024</span><br><span class="line">        modify_timestamp: Tue Apr  2 05:43:02 2024</span><br></pre></td></tr></table></figure><h3 id="查看是否存在快照【存在】"><a href="#查看是否存在快照【存在】" class="headerlink" title="查看是否存在快照【存在】"></a>查看是否存在快照【存在】</h3><p><strong>protected: True</strong>(此处–此标签表示被保护起来了 无法直接删除 后面集成nova后 使用此镜像创建虚拟机 他会针对此镜像快照 克隆一个出来)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~<span class="comment"># rbd snap ls images/73d31ccc-8eae-49e9-a0a7-2731e5a3806a</span></span><br><span class="line">SNAPID  NAME  SIZE    PROTECTED  TIMESTAMP   </span><br><span class="line">    13  snap  12 MiB  <span class="built_in">yes</span>        Tue Apr  2 05:43:04 2024</span><br><span class="line"><span class="comment"># 查看快照详情</span></span><br><span class="line">root@localhost:~<span class="comment"># rbd info images/73d31ccc-8eae-49e9-a0a7-2731e5a3806a@snap</span></span><br><span class="line">rbd image <span class="string">&#x27;73d31ccc-8eae-49e9-a0a7-2731e5a3806a&#x27;</span>:</span><br><span class="line">        size 12 MiB <span class="keyword">in</span> 2 objects</span><br><span class="line">        order 23 (8 MiB objects)</span><br><span class="line">        snapshot_count: 1</span><br><span class="line">        <span class="built_in">id</span>: 1c4b9299cdad7</span><br><span class="line">        block_name_prefix: rbd_data.1c4b9299cdad7</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Tue Apr  2 05:43:02 2024</span><br><span class="line">        access_timestamp: Tue Apr  2 05:43:02 2024</span><br><span class="line">        modify_timestamp: Tue Apr  2 05:43:02 2024</span><br><span class="line">        protected: True  (此处--此标签表示被保护起来了)</span><br></pre></td></tr></table></figure><h3 id="日志查看"><a href="#日志查看" class="headerlink" title="日志查看"></a>日志查看</h3><p>kolla-ansible部署的集群<strong>glance</strong>出现问题可在<code>/var/log/kolla/glance/glance-api.log</code>中查看<strong>此时glance对接完成。</strong></p><h2 id="二-ciner对接功能测试"><a href="#二-ciner对接功能测试" class="headerlink" title="二. ciner对接功能测试"></a>二. ciner对接功能测试</h2><h3 id="前端页面创建磁盘后端ceph查看是否成功【success-】"><a href="#前端页面创建磁盘后端ceph查看是否成功【success-】" class="headerlink" title="前端页面创建磁盘后端ceph查看是否成功【success!】"></a>前端页面创建磁盘后端ceph查看是否成功【success!】</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c52afb0c1b17c459ac6dc022eff72bf8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_c52afb0c1b17c459ac6dc022eff72bf8.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">oot@localhost:~<span class="comment"># rbd -p volumes ls |grep cdfce732-c69f-4ea6-9f95-181c19b932dd</span></span><br><span class="line">volume-cdfce732-c69f-4ea6-9f95-181c19b932dd</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="扩容云硬盘【success-】"><a href="#扩容云硬盘【success-】" class="headerlink" title="扩容云硬盘【success!】"></a>扩容云硬盘【success!】</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~<span class="comment"># rbd -p volumes info volume-cdfce732-c69f-4ea6-9f95-181c19b932dd</span></span><br><span class="line">rbd image <span class="string">&#x27;volume-cdfce732-c69f-4ea6-9f95-181c19b932dd&#x27;</span>:</span><br><span class="line">        size 5 GiB <span class="keyword">in</span> 1280 objects   【成功扩容到了5G】</span><br><span class="line">        order 22 (4 MiB objects)</span><br><span class="line">        snapshot_count: 0</span><br><span class="line">        <span class="built_in">id</span>: 1ce49280a276</span><br><span class="line">        block_name_prefix: rbd_data.1ce49280a276</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Tue Apr  2 07:01:15 2024</span><br><span class="line">        access_timestamp: Tue Apr  2 07:01:15 2024</span><br><span class="line">        modify_timestamp: Tue Apr  2 07:01:15 2024</span><br></pre></td></tr></table></figure><h3 id="创建快照【前端-后端-success-】"><a href="#创建快照【前端-后端-success-】" class="headerlink" title="创建快照【前端/后端 success!】"></a>创建快照【前端/后端 success!】</h3><p>查看后端快照及快照详情</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~<span class="comment"># rbd -p  volumes ls</span></span><br><span class="line">volume-0069c8f9-4f25-4233-91a9-a2f27006f208</span><br><span class="line">volume-0b204bfd-a83b-4d02-aa5c-b7894d710f07</span><br><span class="line">volume-69c5a7f6-fdc8-4c81-9a24-9ffc3aa413ce</span><br><span class="line">volume-ad6ee530-b73e-4605-b0aa-fc6813e10b8a</span><br><span class="line">volume-cdfce732-c69f-4ea6-9f95-181c19b932dd</span><br><span class="line">root@localhost:~<span class="comment"># rbd -p volumes snap ls  volume-cdfce732-c69f-4ea6-9f95-181c19b932dd</span></span><br><span class="line">SNAPID  NAME                                           SIZE   PROTECTED  TIMESTAMP             </span><br><span class="line">    10  snapshot-d8b94a76-c1b1-48c6-a5f7-d7a478b5cf8c  5 GiB  <span class="built_in">yes</span>        Tue Apr  2 07:23:35 2024</span><br><span class="line">root@localhost:~<span class="comment"># rbd info volumes/volume-cdfce732-c69f-4ea6-9f95-181c19b932dd@snapshot-d8b94a76-c1b1-48c6-a5f7-d7a478b5cf8c</span></span><br><span class="line">rbd image <span class="string">&#x27;volume-cdfce732-c69f-4ea6-9f95-181c19b932dd&#x27;</span>:</span><br><span class="line">        size 5 GiB <span class="keyword">in</span> 1280 objects</span><br><span class="line">        order 22 (4 MiB objects)</span><br><span class="line">        snapshot_count: 1</span><br><span class="line">        <span class="built_in">id</span>: 1ce49280a276</span><br><span class="line">        block_name_prefix: rbd_data.1ce49280a276</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Tue Apr  2 07:01:15 2024</span><br><span class="line">        access_timestamp: Tue Apr  2 07:01:15 2024</span><br><span class="line">        modify_timestamp: Tue Apr  2 07:01:15 2024</span><br><span class="line">        protected: True</span><br></pre></td></tr></table></figure><h3 id="日志查看-1"><a href="#日志查看-1" class="headerlink" title="日志查看"></a>日志查看</h3><p>报错查看ciner日志文件目录：/var/log/kolla/cinder/</p><p>cinder-api-access.log  cinder-api-error.log  cinder-api.log  cinder-backup.log  cinder-scheduler.log  cinder-volume.log</p><p><strong>ciner</strong>对接完成。</p><h2 id="三-ciner-backup对接功能测试【前端-后端success-】"><a href="#三-ciner-backup对接功能测试【前端-后端success-】" class="headerlink" title="三. ciner-backup对接功能测试【前端/后端success!】"></a>三. ciner-backup对接功能测试【前端/后端success!】</h2><h3 id="创建云硬盘备份"><a href="#创建云硬盘备份" class="headerlink" title="创建云硬盘备份"></a>创建云硬盘备份</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_baec65a01ef1848667e37913f18fb4a2.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_baec65a01ef1848667e37913f18fb4a2.png"></p><p>前端创建完成其实后端实现方式如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 帮助</span></span><br><span class="line">cinder -h |grep backup</span><br><span class="line">cinder <span class="built_in">help</span> backup-create</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看卷</span></span><br><span class="line">root@localhost:/var/log/kolla/cinder<span class="comment"># cinder list</span></span><br><span class="line">+--------------------------------------+-----------+-------------+------+----------------+-------------+----------+-------------+</span><br><span class="line">| ID                                   | Status    | Name        | Size | Consumes Quota | Volume Type | Bootable | Attached to |</span><br><span class="line">+--------------------------------------+-----------+-------------+------+----------------+-------------+----------+-------------+</span><br><span class="line">| cdfce732-c69f-4ea6-9f95-181c19b932dd | available | cinder-test | 5    | True           | __DEFAULT__ | <span class="literal">false</span>    |             |</span><br><span class="line">+--------------------------------------+-----------+-------------+------+----------------+-------------+----------+-------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对其进行备份</span></span><br><span class="line">root@localhost:/var/log/kolla/cinder<span class="comment"># cinder backup-create cdfce732-c69f-4ea6-9f95-181c19b932dd --name backup-demo</span></span><br><span class="line">+-----------+--------------------------------------+</span><br><span class="line">| Property  | Value                                |</span><br><span class="line">+-----------+--------------------------------------+</span><br><span class="line">| <span class="built_in">id</span>        | c9c3ef24-e310-4685-aa54-64cd6fa7d08b |</span><br><span class="line">| name      | backup-demo                          |</span><br><span class="line">| volume_id | cdfce732-c69f-4ea6-9f95-181c19b932dd |</span><br><span class="line">+-----------+--------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">root@localhost:/var/log/kolla/cinder<span class="comment"># cinder backup-list</span></span><br><span class="line">+--------------------------------------+--------------------------------------+-----------+-------------+------+--------------+-----------+----------------------------------+</span><br><span class="line">| ID                                   | Volume ID                            | Status    | Name        | Size | Object Count | Container | User ID                          |</span><br><span class="line">+--------------------------------------+--------------------------------------+-----------+-------------+------+--------------+-----------+----------------------------------+</span><br><span class="line">| 6774233c-007a-4d49-a8a7-38dc9993b440 | cdfce732-c69f-4ea6-9f95-181c19b932dd | available | <span class="built_in">test</span>        | 5    | 0            | backups   | d9737a89a5754af99610d37225abd070 |</span><br><span class="line">| c9c3ef24-e310-4685-aa54-64cd6fa7d08b | cdfce732-c69f-4ea6-9f95-181c19b932dd | available | backup-demo | 5    | 0            | backups   | d9737a89a5754af99610d37225abd070 |</span><br><span class="line">+--------------------------------------+--------------------------------------+-----------+-------------+------+--------------+-----------+----------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看卷详情</span></span><br><span class="line">root@localhost:/var/log/kolla/cinder<span class="comment"># cinder backup-show 6774233c-007a-4d49-a8a7-38dc9993b440</span></span><br><span class="line">+-----------------------------------+--------------------------------------+</span><br><span class="line">| Property                          | Value                                |</span><br><span class="line">+-----------------------------------+--------------------------------------+</span><br><span class="line">| availability_zone                 | None                                 |</span><br><span class="line">| container                         | backups                              |</span><br><span class="line">| created_at                        | 2024-04-02T07:48:41.000000           |</span><br><span class="line">| data_timestamp                    | 2024-04-02T07:48:41.000000           |</span><br><span class="line">| description                       | None                                 |</span><br><span class="line">| fail_reason                       | None                                 |</span><br><span class="line">| has_dependent_backups             | False                                |</span><br><span class="line">| <span class="built_in">id</span>                                | 6774233c-007a-4d49-a8a7-38dc9993b440 |</span><br><span class="line">| is_incremental                    | False                                |</span><br><span class="line">| metadata                          | &#123;&#125;                                   |</span><br><span class="line">| name                              | <span class="built_in">test</span>                                 |</span><br><span class="line">| object_count                      | 0                                    |</span><br><span class="line">| os-backup-project-attr:project_id | 2cb7b9ee85ab4d8a8257723a08c8a032     |</span><br><span class="line">| size                              | 5                                    |</span><br><span class="line">| snapshot_id                       | None                                 |</span><br><span class="line">| status                            | available                            |</span><br><span class="line">| updated_at                        | 2024-04-02T07:49:01.000000           |</span><br><span class="line">| user_id                           | d9737a89a5754af99610d37225abd070     |</span><br><span class="line">| volume_id                         | cdfce732-c69f-4ea6-9f95-181c19b932dd |</span><br><span class="line">+-----------------------------------+--------------------------------------+</span><br><span class="line"><span class="comment"># 查看卷实际上就是把卷拷贝过来一份</span></span><br><span class="line">root@localhost:/var/log/kolla/cinder<span class="comment"># rbd -p backups ls</span></span><br><span class="line">volume-cdfce732-c69f-4ea6-9f95-181c19b932dd.backup.6774233c-007a-4d49-a8a7-38dc9993b440</span><br><span class="line">volume-cdfce732-c69f-4ea6-9f95-181c19b932dd.backup.c9c3ef24-e310-4685-aa54-64cd6fa7d08b</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ciner-backup</strong>对接完成。</p><h2 id="四-nova-libvirt-与ceph对接功能测试【success！】"><a href="#四-nova-libvirt-与ceph对接功能测试【success！】" class="headerlink" title="四. nova(libvirt)与ceph对接功能测试【success！】"></a>四. nova(libvirt)与ceph对接功能测试【success！】</h2><h3 id="创建虚拟机测试-前端创建后端验证"><a href="#创建虚拟机测试-前端创建后端验证" class="headerlink" title="创建虚拟机测试 (前端创建后端验证)"></a>创建虚拟机测试 (前端创建后端验证)</h3><p><strong>查看系统盘</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(venv3) root@localhost:~<span class="comment"># rbd -p volumes ls |grep 39a0ae42-08b3-4885-850f-12536e3d2051</span></span><br><span class="line">volume-39a0ae42-08b3-4885-850f-12536e3d2051</span><br><span class="line">(venv3) root@localhost:~<span class="comment"># rbd device list</span></span><br><span class="line">(venv3) root@localhost:~<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_245c6b28748b4fb29da0f259cc4be37d.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_245c6b28748b4fb29da0f259cc4be37d.png"></p>]]></content>
      
      
      <categories>
          
          <category> openstack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openstack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix监控交换机配置报警及grafana面板设置</title>
      <link href="/2024/03/28/zabbix%E7%9B%91%E6%8E%A7%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AE%E6%8A%A5%E8%AD%A6%E5%8F%8Agrafana%E9%9D%A2%E6%9D%BF%E8%AE%BE%E7%BD%AE/"/>
      <url>/2024/03/28/zabbix%E7%9B%91%E6%8E%A7%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AE%E6%8A%A5%E8%AD%A6%E5%8F%8Agrafana%E9%9D%A2%E6%9D%BF%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="zabbix监控交换机配置报警"><a href="#zabbix监控交换机配置报警" class="headerlink" title="zabbix监控交换机配置报警"></a>zabbix监控交换机配置报警</h1><h2 id="一-企业微信报警"><a href="#一-企业微信报警" class="headerlink" title="一. 企业微信报警"></a>一. 企业微信报警</h2><p>后端配置<br>语言：<strong>shell</strong><br>脚本：/usr/lib/zabbix/alertscripts/weixin.sh<br>组名改为：<strong>zabbix:zabbix</strong><br><strong>chmod a+x weixin.sh</strong>  赋予执行权限<br><strong>weixin.sh</strong>脚本内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 脚本使用：zz=`ls -l`</span></span><br><span class="line"><span class="comment"># ./weixin.sh test  &#123;&quot;errcode&quot;:0,&quot;errmsg&quot;:&quot;$zz&quot;,&quot;invaliduser&quot;:&quot;&quot;&#125;</span></span><br><span class="line"><span class="comment"># ./weixin.sh test  &#123;&quot;errcode&quot;:0,&quot;GEGEWU-TEST&quot;:&quot;\n床前明月光\n疑是地上霜\n举头望明月\n低头思故乡&quot;,&quot;invaliduser&quot;:&quot;&quot;&#125;</span></span><br><span class="line">CorpID=<span class="string">&quot;ww83dd692579d&quot;</span>                             <span class="comment"># 你的企业id</span></span><br><span class="line">Secret=<span class="string">&quot;LSwoGzg-lXJFFkSztBptbgAfLrps&quot;</span>    <span class="comment"># 你的SecretID</span></span><br><span class="line">GURL=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=<span class="variable">$CorpID</span>&amp;corpsecret=<span class="variable">$Secret</span>&quot;</span></span><br><span class="line">Token=$(/usr/bin/curl -s -G <span class="variable">$GURL</span> |awk -F\&quot;: <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>|awk -F\&quot; <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"><span class="comment"># echo $Token</span></span><br><span class="line">PURL=<span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=<span class="variable">$Token</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">body</span></span>()&#123;</span><br><span class="line">        <span class="built_in">local</span> int agentid=1000002               <span class="comment"># 你的agentdid</span></span><br><span class="line">        <span class="built_in">local</span> UserID=<span class="string">&quot;@all&quot;</span>                     <span class="comment"># 发送的用户ID</span></span><br><span class="line">        <span class="built_in">local</span> PartyID=2                         <span class="comment"># 部门ID</span></span><br><span class="line">        <span class="built_in">local</span> Msg=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f3-) <span class="comment"># 发送给所有人</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;&#123;\n&#x27;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;\t&quot;touser&quot;: &quot;&#x27;</span><span class="string">&quot;<span class="variable">$UserID</span>&quot;</span>\&quot;<span class="string">&quot;,\n&quot;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;\t&quot;toparty&quot;: &quot;&#x27;</span><span class="string">&quot;<span class="variable">$PartyID</span>&quot;</span>\&quot;<span class="string">&quot;,\n&quot;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;\t&quot;msgtype&quot;: &quot;text&quot;,\n&#x27;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;\t&quot;agentid&quot;: &quot;&#x27;</span><span class="string">&quot;<span class="variable">$agentid</span>&quot;</span>\&quot;<span class="string">&quot;,\n&quot;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;\t&quot;text&quot;: &#123;\n&#x27;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;\t\t&quot;content&quot;: &quot;&#x27;</span><span class="string">&quot;<span class="variable">$Msg</span>&quot;</span>\&quot;<span class="string">&quot;\n&quot;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;\t&#125;,\n&#x27;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;\t&quot;safe&quot;:&quot;0&quot;\n&#x27;</span></span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&#x27;&#125;\n&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">/usr/bin/curl --data-ascii <span class="string">&quot;<span class="subst">$(body $1 $2 $3)</span>&quot;</span> <span class="variable">$PURL</span></span><br></pre></td></tr></table></figure><p>可用性测试</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_6423a1843860753100db9c0cb961464a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_6423a1843860753100db9c0cb961464a.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_e9eeec69992482f2c02585016a1a9ebc.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_e9eeec69992482f2c02585016a1a9ebc.png"></p><p>以上微信报警后端配置完毕！</p><h3 id="1-zabbix前端页面配置告警"><a href="#1-zabbix前端页面配置告警" class="headerlink" title="1. zabbix前端页面配置告警"></a>1. zabbix前端页面配置告警</h3><h4 id="1-0-管理-用户-配置报警时间-等级"><a href="#1-0-管理-用户-配置报警时间-等级" class="headerlink" title="1.0. 管理-用户 配置报警时间 等级"></a>1.0. 管理-用户 配置报警时间 等级</h4><p>特别说明：收件人-2   2 为报警<strong>机器人所在的b部门id</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_888125f3de45e9c9945bac3b5d692349.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_888125f3de45e9c9945bac3b5d692349.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_b6fa1a78467aa2bbbaad45ef6447659a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_b6fa1a78467aa2bbbaad45ef6447659a.png"></p><h4 id="1-1-报警媒介类型"><a href="#1-1-报警媒介类型" class="headerlink" title="1.1. 报警媒介类型"></a>1.1. 报警媒介类型</h4><p><strong>管理-报警媒介类型-创建媒体类型</strong></p><p><strong>脚本参数</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;ALERT.SENDTO&#125;</span><br><span class="line">&#123;ALERT.SUBJECT&#125;</span><br><span class="line">&#123;ALERT.MESSAGE&#125;</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_8c5386fe48f1b7a90f3c7ef75ed02192.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_8c5386fe48f1b7a90f3c7ef75ed02192.png"></p><p><strong>设置默认报警发送信息</strong></p><p>管理-报警媒介类型-创建媒体类型-message templates 3-点击添加-选择-问题</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">主题：</span><br><span class="line">故障&#123;TRIGGER.STATUS&#125;,机器:&#123;HOSTNAME1&#125;发生: &#123;TRIGGER.NAME&#125;故障!</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">消息：</span><br><span class="line"> </span><br><span class="line">告警机器:&#123;HOSTNAME1&#125;</span><br><span class="line">告警主机:&#123;HOST.NAME&#125;</span><br><span class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</span><br><span class="line">告警信息: &#123;TRIGGER.NAME&#125;</span><br><span class="line">告警项目:&#123;TRIGGER.KEY1&#125;</span><br><span class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</span><br><span class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</span><br><span class="line">事件ID:&#123;EVENT.ID&#125;</span><br></pre></td></tr></table></figure><p><strong>点击选择：problem recovery</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">主题：</span><br><span class="line">恢复&#123;TRIGGER.STATUS&#125;, 机器:&#123;HOSTNAME1&#125;: &#123;TRIGGER.NAME&#125;已恢复!</span><br><span class="line"> </span><br><span class="line">消息：</span><br><span class="line">告警机器:&#123;HOSTNAME1&#125;</span><br><span class="line">告警主机:&#123;HOST.NAME&#125;</span><br><span class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</span><br><span class="line">告警信息: &#123;TRIGGER.NAME&#125;</span><br><span class="line">告警项目:&#123;TRIGGER.KEY1&#125;</span><br><span class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</span><br><span class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</span><br><span class="line">事件ID:&#123;EVENT.ID&#125;</span><br></pre></td></tr></table></figure><p><strong>设置好后样式</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_5f6c7c481dd5a5e6f394abbc3edfbc91.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_5f6c7c481dd5a5e6f394abbc3edfbc91.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_7317fad2e7265063fc284c4657d37336.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_7317fad2e7265063fc284c4657d37336.png"></p><p><strong>配置-动作-Tigger actions-创建动作微信告警</strong></p><ul><li>名称 :  微信报警</li><li>计算方式 : 和（同时满足）(A and B) and C</li><li>条件</li></ul><table><thead><tr><th>标签</th><th>名称</th><th>动作</th></tr></thead><tbody><tr><td><strong>A</strong></td><td>触发器名称 不含<em>Dialer</em></td><td>移除</td></tr><tr><td><strong>B</strong></td><td>触发器名称 包含<em>down</em></td><td>移除</td></tr><tr><td><strong>C</strong></td><td>主机群组 不等于<em>张家口</em></td><td>移除</td></tr><tr><td>添加</td><td></td><td></td></tr></tbody></table><p>  <strong>本文使用此<br>  名称 :  微信报警</strong><br>  计算方式 : 与/或 （默认）</p><table><thead><tr><th>标签</th><th>名称</th><th>动作</th></tr></thead><tbody><tr><td><strong>A</strong></td><td>触发器示警度 大于等于 警告</td><td>移除</td></tr><tr><td><strong>B</strong></td><td>触发器示警度 大于等于 未分类</td><td>移除</td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p>  <img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_8beb0459a4e8371c8d40f0b0e0bba60b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_8beb0459a4e8371c8d40f0b0e0bba60b.png"></p><p>  <img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_3ea30163e5c0105262ced1c11bf11d7d.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_3ea30163e5c0105262ced1c11bf11d7d.png"></p><ul><li><p>已启用 [X]</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_30dad5e3e18fbd9afa4fd05d59d22ec8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_30dad5e3e18fbd9afa4fd05d59d22ec8.png"></p></li></ul><p><strong>设置操作</strong></p><p>告警细节</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">设备:&#123;HOST.NAME&#125;发生: &#123;TRIGGER.NAME&#125;告警!\n告警主机:&#123;HOST.NAME&#125;\n告警地址:&#123;HOST.IP&#125;\n告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br></pre></td></tr></table></figure><p>恢复细节</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">告警主机:&#123;HOST.NAME&#125;\n告警信息: &#123;TRIGGER.NAME&#125;已恢复！\n当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;\n告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;\n恢复时间:&#123;EVENT.RECOVERY.DATE&#125; &#123;EVENT.RECOVERY.TIME&#125;\n持续时间:&#123;EVENT.AGE&#125;</span><br></pre></td></tr></table></figure><p><strong>更新暂时不写</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_2c6085aabbe2423e90b8f16a44cd3b1e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_2c6085aabbe2423e90b8f16a44cd3b1e.png"></p><h4 id="1-2-或者设置如下冗长版本设置方式如下参考"><a href="#1-2-或者设置如下冗长版本设置方式如下参考" class="headerlink" title="1.2. 或者设置如下冗长版本设置方式如下参考"></a>1.2. 或者设置如下冗长版本设置方式如下参考</h4><p>操作 添加<br>步骤选择：1-1<br>步骤时间：0 （默认）<br>用户群组默认管理员群组 ：Zabbix administrators<br>仅发送到：微信告警<br>cus message ： [X]</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">主题：</span><br><span class="line">故障&#123;TRIGGER.STATUS&#125;,机器:&#123;HOSTNAME1&#125;发生: &#123;TRIGGER.NAME&#125;故障!</span><br><span class="line"> </span><br><span class="line">消息：</span><br><span class="line">告警机器:&#123;HOSTNAME1&#125;</span><br><span class="line">告警主机:&#123;HOST.NAME&#125;</span><br><span class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</span><br><span class="line">告警信息: &#123;TRIGGER.NAME&#125;</span><br><span class="line">告警项目:&#123;TRIGGER.KEY1&#125;</span><br><span class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</span><br><span class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</span><br><span class="line">事件ID:&#123;EVENT.ID&#125;</span><br><span class="line">————————————————</span><br></pre></td></tr></table></figure><p>恢复操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">主题：</span><br><span class="line">机器:&#123;HOST.NAME&#125;: &#123;TRIGGER.NAME&#125;已恢复!</span><br><span class="line"> </span><br><span class="line">消息：</span><br><span class="line">机器:&#123;HOST.NAME&#125;: &#123;TRIGGER.NAME&#125;已恢复!</span><br><span class="line">告警主机:&#123;HOST.NAME&#125;</span><br><span class="line">告警地址:&#123;HOST.IP&#125;</span><br><span class="line">监控取值:&#123;ITEM.LASTVALUE&#125;</span><br><span class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</span><br><span class="line">当前状态:&#123;TRIGGER.STATUS&#125;</span><br><span class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line">恢复时间:&#123;EVENT.RECOVERY.DATE&#125; &#123;EVENT.RECOVERY.TIME&#125;</span><br><span class="line">持续时间:&#123;EVENT.AGE&#125;</span><br><span class="line">事件ID:&#123;EVENT.ID&#125;</span><br></pre></td></tr></table></figure><p>注：更新操作暂时不写。<br>此时点击启用新创建的微信告警：即启用动作</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_3119571721f2605c8403618b944a5384.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_3119571721f2605c8403618b944a5384.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_82a0baf528dbe6863ab110882f7d84e8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_82a0baf528dbe6863ab110882f7d84e8.png"></p><h2 id="二-zabbix出图添加交换机设置"><a href="#二-zabbix出图添加交换机设置" class="headerlink" title="二. zabbix出图添加交换机设置"></a>二. zabbix出图添加交换机设置</h2><h3 id="2-1-添加设备"><a href="#2-1-添加设备" class="headerlink" title="2.1. 添加设备"></a>2.1. 添加设备</h3><p><strong>配置-群组-创建群组（如未来科技城）</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_c6fb86456c1f1b9eba430942b08b77ff.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_c6fb86456c1f1b9eba430942b08b77ff.png"></p><p><strong>监测-主机-添加主机（根据交换机厂商选择合适的监控模板如华为则选择华为）</strong></p><p>主机名称：10.0.0.10<br>可见名称：华为CE6851<br>模板： Huawei VRP by SNMP<br>群组：未来科技城<br>interfaces<br>类型：snmp<br>版本 snmpV2<br>snmp community（团体名）： passwd<br>连接到ip DNS 端口：161<br>由agent代理程序监测 (无agent代理程序)<br>已启用</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_e19dd19666176395dc07dfda08b59091.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_e19dd19666176395dc07dfda08b59091.png"></p><p><strong>模板选择（以华为交换机为例）</strong></p><p>模板-主机群组<code>-Templates/Network devices-HuaweiVRPbySNMP</code></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_6f42f938f9b0285953e4100811df34b7.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_6f42f938f9b0285953e4100811df34b7.png"></p><h3 id="2-2-华为CE系例特别说明"><a href="#2-2-华为CE系例特别说明" class="headerlink" title="2.2. 华为CE系例特别说明"></a>2.2. 华为CE系例特别说明</h3><p>见🔗链接 | <strong><a href="https://blog.csdn.net/m0_59586152/article/details/125200506">特别介绍关于huaweiCE系列的cpu监控(此处zabbix自带的监控有时候无法采集成功)</a></strong></p><h2 id="三-grafana面板配置（建议grafana版本为8-5-2）"><a href="#三-grafana面板配置（建议grafana版本为8-5-2）" class="headerlink" title="三. grafana面板配置（建议grafana版本为8.5.2）"></a>三. grafana面板配置（建议grafana版本为8.5.2）</h2><h3 id="3-1-安装zabbix插件"><a href="#3-1-安装zabbix插件" class="headerlink" title="3.1. 安装zabbix插件"></a>3.1. 安装zabbix插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@gegewu1:/opt/grafana-8.5.2/bin<span class="comment"># ./grafana-cli plugins install alexanderzobnin-zabbix-app</span></span><br><span class="line">✔ Downloaded alexanderzobnin-zabbix-app v4.2.8 zip successfully</span><br><span class="line"> </span><br><span class="line">Please restart Grafana after installing plugins. Refer to Grafana documentation <span class="keyword">for</span> instructions <span class="keyword">if</span> necessary.</span><br><span class="line"> </span><br><span class="line">root@gegewu1:/opt/grafana-8.5.2/bin<span class="comment">#</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>配置zabbix源时需要将80端口写出否则会添加失败即：<a href="http://10.0.0.10/zabbix/api_jsonrpc.php">http://10.0.0.10:80/zabbix/api_jsonrpc.php</a></p><p><strong>配置好前端zabbix组件后 选择合适需要监控的端口即可</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_a1cb215aaf904a7b1c6517dae8c43a38.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_a1cb215aaf904a7b1c6517dae8c43a38.png"></p><p><strong>效果</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_9e24dccc0ed9e1529e55edd526aef9ea.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_9e24dccc0ed9e1529e55edd526aef9ea.png"></p><p>本文参考 |<br><a href="https://blog.csdn.net/m0_59586152/article/details/125136342">https://blog.csdn.net/m0_59586152/article/details/125136342</a><br><a href="https://blog.csdn.net/m0_59586152/article/details/125200506">https://blog.csdn.net/m0_59586152/article/details/125200506</a></p>]]></content>
      
      
      <categories>
          
          <category> zabbix </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wordpress设置WP SMTP邮件提醒</title>
      <link href="/2024/03/27/wordpress%E8%AE%BE%E7%BD%AEWP%20SMTP%E9%82%AE%E4%BB%B6%E6%8F%90%E9%86%92/"/>
      <url>/2024/03/27/wordpress%E8%AE%BE%E7%BD%AEWP%20SMTP%E9%82%AE%E4%BB%B6%E6%8F%90%E9%86%92/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="wordpress设置WP-SMTP邮件提醒"><a href="#wordpress设置WP-SMTP邮件提醒" class="headerlink" title="wordpress设置WP SMTP邮件提醒"></a>wordpress设置WP SMTP邮件提醒</h2><blockquote><p>本文使用wordpress插件 &gt; <a href="https://wordpress.org/plugins/wp-smtp/">WP SMTP</a> 安装 &gt; <a href="https://wn-apple-teawine.fun/2023/10/08/wordpress%E5%8D%9A%E5%AE%A2-docker-compose%E6%9E%84%E5%BB%BA/?highlight=%E5%90%84%E7%A7%8D">wordpress安装链接</a></p><p>插件安装包留存地址 | <a href="https://drive.zznnwn.cloudns.biz/api/raw/?path=/boke/wordpress/WP-SMTP/wp-smtp.1.2.6.zip">传送门</a></p></blockquote><h3 id="wordpress安装WP-SMTP插件方法"><a href="#wordpress安装WP-SMTP插件方法" class="headerlink" title="wordpress安装WP SMTP插件方法"></a>wordpress安装WP SMTP插件方法</h3><p>插件 &gt; 添加插件 &gt; 上传插件 &gt; 选择文件 | 此时平台会自动安装此插件</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_c6dc16744541929c15f31c5105b4877d.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_c6dc16744541929c15f31c5105b4877d.png"></p><h3 id="配置smtp服务"><a href="#配置smtp服务" class="headerlink" title="配置smtp服务"></a>配置smtp服务</h3><p>主要配置邮箱授权码 设置 &gt; 讨论 &gt; 开启评论提醒</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_8079623496c957fa91390f39150ee7e8.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_8079623496c957fa91390f39150ee7e8.png"></p><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_d8ba9af400a0c44fca7a8b7aa6bd50bd.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_d8ba9af400a0c44fca7a8b7aa6bd50bd.png"></p><p><strong>本文参考</strong></p><p><a href="https://blog.naibabiji.com/tutorial/wordpress-smtp-cha-jian.html#wp_smtp">https://blog.naibabiji.com/tutorial/wordpress-smtp-cha-jian.html#wp_smtp</a></p>]]></content>
      
      
      <categories>
          
          <category> wordpress </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux命令筛选出ipv4地址并去重计算出现次数</title>
      <link href="/2024/03/25/linux%E5%91%BD%E4%BB%A4%E7%AD%9B%E9%80%89%E5%87%BAipv4%E5%9C%B0%E5%9D%80%E5%B9%B6%E5%8E%BB%E9%87%8D%E8%AE%A1%E7%AE%97%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0/"/>
      <url>/2024/03/25/linux%E5%91%BD%E4%BB%A4%E7%AD%9B%E9%80%89%E5%87%BAipv4%E5%9C%B0%E5%9D%80%E5%B9%B6%E5%8E%BB%E9%87%8D%E8%AE%A1%E7%AE%97%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>linux命令筛选出ipv4地址并去重计算出现次数<a href>                                              </a></strong></p><p>代码如下：</p><ul><li><strong>grep -oE “\b([0-9]{1,3}.){3}[0-9]{1,3}\b” 1.txt |sort -nr |uniq -c</strong></li><li><strong>ss -ant |grep ESTAB |awk -F ‘[ :]+’  ‘{print $4}’ |grep -v ‘[‘ |sort -rn |uniq -c</strong></li><li><strong>cat 1.txt  |awk -F ‘[ :]+’  ‘/^ip/{print $2}’ |sort -nr |uniq -c</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@k8s:~<span class="comment"># cat 1.txt </span></span><br><span class="line">ip: 10.10.10.1:1080</span><br><span class="line">ip: 10.10.10.2:1080</span><br><span class="line">ip: 10.10.10.4:2050</span><br><span class="line">ip: 10.10.10.2:1020</span><br><span class="line">root@k8s:~<span class="comment"># ss -ant |grep -oE &quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot; 1.txt</span></span><br><span class="line">10.10.10.1</span><br><span class="line">10.10.10.2</span><br><span class="line">10.10.10.4</span><br><span class="line">10.10.10.2</span><br><span class="line">root@k8s:~<span class="comment"># grep -oE &quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot; 1.txt |sort -nr |uniq -c</span></span><br><span class="line">      1 10.10.10.4</span><br><span class="line">      2 10.10.10.2</span><br><span class="line">      1 10.10.10.1</span><br><span class="line">root@k8s:~<span class="comment"># ss -ant |grep ESTAB |awk -F &#x27;[ :]+&#x27;  &#x27;&#123;print $4&#125;&#x27; |grep -v &#x27;\[&#x27; |sort -rn |uniq -c</span></span><br><span class="line">      1 172.16.0.1</span><br><span class="line">    124 127.0.0.1</span><br><span class="line">     10 10.0.0.240</span><br><span class="line">root@k8s:~<span class="comment"># cat 1.txt  |awk -F &#x27;[ :]+&#x27;  &#x27;/^ip/&#123;print $2&#125;&#x27; |sort -nr |uniq -c</span></span><br><span class="line">      1 10.10.10.4</span><br><span class="line">      2 10.10.10.2</span><br><span class="line">      1 10.10.10.1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell实现计算斐波那契数列</title>
      <link href="/2024/03/24/Shell%E5%AE%9E%E7%8E%B0%E8%AE%A1%E7%AE%97%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/"/>
      <url>/2024/03/24/Shell%E5%AE%9E%E7%8E%B0%E8%AE%A1%E7%AE%97%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Shell实现斐波那契数列计算"><a href="#Shell实现斐波那契数列计算" class="headerlink" title="Shell实现斐波那契数列计算"></a>Shell实现斐波那契数列计算</h3><p><a href="https://zh.numberempire.com/fibonaccinumbers.php">斐波那契数计算器 (numberempire.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">fibonacci</span></span>() &#123;</span><br><span class="line">    n=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$n</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> 0</span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$n</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        a=0</span><br><span class="line">        b=1</span><br><span class="line">        i=2</span><br><span class="line">        <span class="keyword">while</span> [ <span class="variable">$i</span> -le <span class="variable">$n</span> ]; <span class="keyword">do</span></span><br><span class="line">            c=$((a + b))</span><br><span class="line">            a=<span class="variable">$b</span></span><br><span class="line">            b=<span class="variable">$c</span></span><br><span class="line">            i=$((i + <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$b</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入N值（N &lt; 50）: &quot;</span> N</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$N</span> -ge 0 ] &amp;&amp; [ <span class="variable">$N</span> -lt 50 ]; <span class="keyword">then</span></span><br><span class="line">    result=$(fibonacci <span class="variable">$N</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;斐波那契数列的第 <span class="variable">$N</span> 项为: <span class="variable">$result</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;输入的N值不在有效范围内！&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_caa7837e83fa0efebe83bac133122bd4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_caa7837e83fa0efebe83bac133122bd4.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_e9d599e5ba7c00c4a861753f0f01a4cb.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_e9d599e5ba7c00c4a861753f0f01a4cb.png"></p>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph集群扩容与缩容节点</title>
      <link href="/2024/03/23/ceph%E9%9B%86%E7%BE%A4%E6%89%A9%E5%AE%B9%E4%B8%8E%E7%BC%A9%E5%AE%B9%E8%8A%82%E7%82%B9/"/>
      <url>/2024/03/23/ceph%E9%9B%86%E7%BE%A4%E6%89%A9%E5%AE%B9%E4%B8%8E%E7%BC%A9%E5%AE%B9%E8%8A%82%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ceph集群扩容与缩容节点"><a href="#ceph集群扩容与缩容节点" class="headerlink" title="ceph集群扩容与缩容节点"></a>ceph集群扩容与缩容节点</h3><p><a href="https://wn-apple-teawine.fun/2023/08/29/cephadm%E9%83%A8%E7%BD%B2ceph-quincy%E7%89%88%E6%9C%AC/"><strong>一. 扩容常规添加节点即可</strong></a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭自动添加osd</span></span><br><span class="line">ceph orch apply osd --all-available-devices --unmanaged=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 添加ceph-4为新节点</span></span><br><span class="line">ssh-copy-id ceph-4</span><br><span class="line">ssh-copy-id -f -i /etc/ceph/ceph.pub root@ceph-4</span><br><span class="line"><span class="comment"># ceph-4 换源 </span></span><br><span class="line"><span class="comment"># 设置ceph quincy源 </span></span><br><span class="line"><span class="comment"># 设置docker镜像加速 &gt;&gt; 略 (ceph-4操作)</span></span><br><span class="line">hostnamectl set-hostname ceph-4</span><br><span class="line">apt install -y python3 systemd lvm2 ceph-common</span><br><span class="line">curl -sSL https://get.daocloud.io/docker | sh</span><br><span class="line"><span class="comment"># 主节点执行添加节点</span></span><br><span class="line">ceph orch host add ceph-4</span><br></pre></td></tr></table></figure><p><strong>二. 节点缩容( 注意顺序 )–暂未测试</strong></p><blockquote><p>此处需要注意副本数  比如集群为三副本三台服务器缩减为两台时 此时集群缺失一节点就变成了 两副本 移除节点需要调整副本数 副本数不能小于<code>2</code>即最小能支持的缩减为3节点 &gt;&gt; 2节点</p></blockquote><p><a href="https://gegewu-cloud.github.io/2023/09/01/ceph%E9%9B%86%E7%BE%A4%E4%B9%8Bosd%E5%9D%8F%E7%9B%98%E5%89%94%E9%99%A4/">osd坏盘剔除参考此处链接即可</a></p><p><a href="https://wn-apple-teawine.fun/2023/10/29/ceph%E9%9B%86%E7%BE%A4%E4%B9%8Bceph-quincy%E7%89%88%E6%9C%ACcephadm%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F%E4%BF%AE%E6%94%B9ceph%E9%85%8D%E7%BD%AE/">cephadm部署方式更改配置参考此处含ceph-deploy方式更改副本数</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先设置不迁移数据</span></span><br><span class="line">ceph osd <span class="built_in">set</span> noout</span><br><span class="line"><span class="comment"># 若节点为3节点锁容为2节点则需要 更改副本数为2 ceph的crashmap默认以主机为单位 (副本数不能小于2)</span></span><br><span class="line">ceph config <span class="built_in">help</span> osd_pool_default_size                     <span class="comment"># 查看当前副本数配置</span></span><br><span class="line">ceph config-key <span class="built_in">set</span> config/global/osd_pool_default_size 2  <span class="comment"># 设置副本数为2</span></span><br><span class="line">systemctl restart ceph.target                              <span class="comment"># 重启生效</span></span><br><span class="line"><span class="comment"># 已经存在的pool需要手动设置副本数 (副本数不能小于2)</span></span><br><span class="line">ceph osd pool  <span class="built_in">set</span> ceph-demo size  2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他如mds mgr mon等节点数量也要对应缩减</span></span><br><span class="line">ceph orch apply mon --placement=<span class="string">&quot;2 ceph-1 ceph-2&quot;</span>   </span><br><span class="line">ceph orch apply mgr --placement=<span class="string">&quot;2 ceph-1 ceph-2&quot;</span></span><br><span class="line">ceph orch apply rgw  foo --placement=<span class="string">&quot;2 ceph-1 ceph-2&quot;</span> --port=8000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从集群中删除关于该ceph-3主机的所有守护进程</span></span><br><span class="line">ceph orch host drain ceph-3</span><br><span class="line"><span class="comment"># 将_no_schedule标签应用于主机至于维护模式</span></span><br><span class="line">ceph orch host label add ceph-3 _no_schedule</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭自动添加osd</span></span><br><span class="line">ceph orch apply osd --all-available-devices --unmanaged=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 移除osd</span></span><br><span class="line">ceph osd out osd.1</span><br><span class="line">ceph osd purge osd.1 --yes-i-really-mean-it</span><br><span class="line">ceph osd <span class="built_in">rm</span> osd.1</span><br><span class="line">ceph orch daemon <span class="built_in">rm</span> osd.1 --force</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ceph </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cephfs搭建及权限管理</title>
      <link href="/2024/03/23/cephfs%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
      <url>/2024/03/23/cephfs%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="cephfs搭建及权限管理-本文单节点测试"><a href="#cephfs搭建及权限管理-本文单节点测试" class="headerlink" title="cephfs搭建及权限管理(本文单节点测试)"></a>cephfs搭建及权限管理(本文单节点测试)</h3><p><strong>拖布图</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_3e7fad3ed82c19ee8bc03e153c89c81f.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_3e7fad3ed82c19ee8bc03e153c89c81f.png"></p><p><strong>架构</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_c33ff0f84010148834f8b19aae653197.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_c33ff0f84010148834f8b19aae653197.png"></p><p><strong>cephFS简介</strong></p><p>每个CephFS文件系统至少需要一个MDS（metadata server），一般是三个。CephFS 是个与 POSIX 标准兼容的文件系统，文件目录和其他元数据存储在RADOS中，MDS缓存元信息和文件目录信息。</p><p>cephfs的核心组件有：MDS、Clients、RADOS。</p><p>参考：<a href="https://cloud.tencent.com/developer/article/1664666">CephFS 介绍及使用经验分享</a>。</p><blockquote><p>各个组件之间的依赖关系如下：</p><ul><li>client 《==》 MDS：元数据操作和capalities。</li><li>Client 《==》 OSD： 数据IO。</li><li>MDS 《==》 OSD：元数据IO。</li></ul></blockquote><p>cephfs支持用户级别和内核级别的挂载使用，可扩展性高，并且可以共享文件系统，多个clients可以同时读写。MDS支持高可用性，默认采用的是主备模式（也可以通过配置改为多主），并且cephfs支持文件系统的配额限制。</p><blockquote><p>cephfs中MDS多主的优势及特点如下：</p><ul><li>当元数据默认的单个 MDS 成为瓶颈时，配置多个活跃的 MDS 守护进程，提升集群性能。</li><li>多个活跃的 MDS 有利于性能提升。</li><li>多个活跃的MDS 可以实现MDS负载均衡。</li><li>多个活跃的MDS 可以实现多租户资源隔离。</li><li>它能够将文件系统树分割成子树，每个子树可以交给特定的MDS进行权威管理，从而达到了随着元数据服务器数量的增加，集群性能线性地扩展。</li><li>每个子树都是基于元数据在给定目录树中的热动态创建的。</li><li>一旦创建了子树，它的元数据就被迁移到一个未加载的MDS。</li><li>后续客户端对先前授权的MDS的请求被转发。</li></ul></blockquote><h3 id="一-创建mds"><a href="#一-创建mds" class="headerlink" title="一. 创建mds"></a>一. <strong>创建</strong>mds</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先开启mds组件，cephfs：文件系统名称；–placement：指定集群内需要几个mds，后面跟主机名（等待一分钟完成创建）</span></span><br><span class="line">ceph orch apply mds cephfs --placement=<span class="string">&quot;2 ceph1 ceph2&quot;</span></span><br><span class="line"><span class="comment"># 返回</span></span><br><span class="line">Scheduled mds.cephfs update...</span><br><span class="line"><span class="comment"># 创建cephfs，ceph q版不指定pg的话，默认自动调整 不能使用 rbd init 初始化</span></span><br><span class="line">ceph osd pool create cephfs_data 8 8</span><br><span class="line">ceph osd pool create cephfs_metadata 8 8</span><br><span class="line"><span class="comment"># 返回</span></span><br><span class="line">pool <span class="string">&#x27;cephfs_metadata&#x27;</span> created</span><br><span class="line"><span class="comment"># 将两个pool关联起来</span></span><br><span class="line">ceph fs new cephfsdemo cephfs_metadata cephfs_data</span><br><span class="line"><span class="comment"># 返回</span></span><br><span class="line">new fs with metadata pool 3 and data pool 2</span><br><span class="line"><span class="comment"># 查看各节点是否已启动mds容器；还可以使用ceph orch ps 查看某一节点运行的容器</span></span><br><span class="line">ceph orch ps --daemon-type mds</span><br></pre></td></tr></table></figure><p><strong>查看mds信息</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看cephfs信息</span></span><br><span class="line">ceph fs <span class="built_in">ls</span></span><br><span class="line">name: cephfs, metadata pool: cephfs_metadata, data pools: [cephfs_data ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看mds状态</span></span><br><span class="line">ceph mds <span class="built_in">stat</span></span><br><span class="line">cephfs:1 &#123;0=cephfs.ceph-1.uuemyr=up:active&#125; 1 up:standby</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看mds详细信息</span></span><br><span class="line">ceph fs status </span><br><span class="line"></span><br><span class="line">RANK  STATE           MDS              ACTIVITY     DNS    INOS   DIRS   CAPS  </span><br><span class="line"> 0    active  cephfs.ceph-2.iuvxfu  Reqs:    0 /s    16     19     13      1</span><br></pre></td></tr></table></figure><p>删除<code>cephfs</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph fs <span class="built_in">rm</span> &lt;fs-name&gt; --yes-i-really-mean-it </span><br></pre></td></tr></table></figure><h3 id="二-挂载cephfs"><a href="#二-挂载cephfs" class="headerlink" title="二. 挂载cephfs"></a>二. 挂载<code>cephfs</code></h3><p><strong>临时挂载</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用内核级别挂载：</span></span><br><span class="line"> <span class="built_in">mkdir</span> -p /mnt/cephfs/</span><br><span class="line"> mount -t ceph 10.0.0.124:6789:/ /mnt/cephfs/ -o name=admin  （自动识别admin key）</span><br><span class="line"> 或</span><br><span class="line"> mount -t ceph 10.0.0.124:6789:/ /mnt/cephfs -o name=admin,secret=AQCeoO1j+e+lMhAAP2izu6rTQSGz0oyJkLw9UQ==</span><br><span class="line"> 或</span><br><span class="line"> <span class="comment"># 文件密钥挂载：</span></span><br><span class="line"> <span class="built_in">echo</span> AQDqOnNf7tGvHhAAZoXbhXRbETxRLBTl5DT1MQ== &gt;&gt; admin.key</span><br><span class="line"> mount -t ceph 192.168.229.114:6789:/ /cephfs/ -o name=admin,secretfile=admin.key</span><br><span class="line"><span class="comment"># 扩展查看key:  </span></span><br><span class="line">ceph auth <span class="built_in">ls</span></span><br><span class="line">指定用户挂载 需要先建立cephx认证用户内核级别配置永久挂载</span><br></pre></td></tr></table></figure><p><strong>用户态挂载（例子）</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install ceph-fuse     <span class="comment"># 安装客户端</span></span><br><span class="line">$ apt -y install ceph-fuse</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mkdir</span> /ceph-fuse   <span class="comment"># 创建挂载点并挂载使用</span></span><br><span class="line"></span><br><span class="line">$ ceph-fuse -n client.admin -m 192.168.99.11:6789,192.168.99.12:6789,192.168.99.13:6789 /ceph-fuse</span><br><span class="line"><span class="comment"># monitor地址可以可以指定一个或多个（如果其中一个宕机不影响使用）</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">df</span> -hT /ceph-fuse       <span class="comment"># 查看确认</span></span><br><span class="line">文件系统       类型            容量  已用  可用 已用% 挂载点</span><br><span class="line">ceph-fuse      fuse.ceph-fuse   94G     0   94G    0% /ceph-fuse</span><br></pre></td></tr></table></figure><p><strong>永久挂载</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入配置文件：/etc/fstab </span></span><br><span class="line"><span class="comment"># 密钥文件</span></span><br><span class="line">  10.0.0.124:6789:/ /mnt/cephfs ceph name=admin,secretfile=/root/adminkey,noatime 0 0</span><br><span class="line"><span class="comment"># 直接指定密钥</span></span><br><span class="line">  10.0.0.124:6789:/ /mnt/cephfs ceph name=admin,secret=AQCeoO1j+e+lMhAAP2izu6rTQSGz0oyJkLw9UQ==,noatime,_netdev 0 0</span><br><span class="line"></span><br><span class="line">关机验证：正常挂载 / monut -a 即可验证</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_7a032c8de07240c963b4846f8b971faf.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_7a032c8de07240c963b4846f8b971faf.png"></p><h3 id="三-ceph权限控制"><a href="#三-ceph权限控制" class="headerlink" title="三. ceph权限控制"></a>三. <a href="https://www.cnblogs.com/lvzhenjiang/p/14907610.html#35-%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E6%8C%82%E8%BD%BD%E4%BD%BF%E7%94%A8"><strong>ceph权限控制</strong></a></h3><h4 id="3-6-不同用户挂载不同目录"><a href="#3-6-不同用户挂载不同目录" class="headerlink" title="3.6 不同用户挂载不同目录"></a>3.6 不同用户挂载不同目录</h4><h5 id="3-6-1-添加新的pool到cephfs"><a href="#3-6-1-添加新的pool到cephfs" class="headerlink" title="3.6.1 添加新的pool到cephfs"></a>3.6.1 添加新的pool到cephfs</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cephfs中增加新的pool</span></span><br><span class="line">ceph osd pool create cephfs_data1 4 4           # 创建pool</span><br><span class="line">ceph fs add_data_pool cephfsdemo cephfs_data1  # 加到cephfs中  </span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-6-2-创建bruce的用户，这个用户只能访问目录-bruce，数据存储在-pool-cephfs-data1-中"><a href="#3-6-2-创建bruce的用户，这个用户只能访问目录-bruce，数据存储在-pool-cephfs-data1-中" class="headerlink" title="3.6.2 创建bruce的用户，这个用户只能访问目录/bruce，数据存储在 pool cephfs_data1 中"></a>3.6.2 创建bruce的用户，这个用户只能访问目录/bruce，数据存储在 <code>pool cephfs_data1</code> 中</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建bruce的用户，这个用户只能访问目录/bruce，数据存储在 `pool cephfs_data1` 中</span></span><br><span class="line">ceph auth get-or-create client.bruce mon &#x27;allow r&#x27; mds &#x27;allow r, allow rw path=/bruce&#x27; osd &#x27;allow rw pool=cephfs_data1&#x27; -o ceph.client.bruce.keyring</span><br><span class="line">// 返回</span><br><span class="line">[client.bruce]</span><br><span class="line">key = AQCtFc9g/CmyERAAzi7ORpEWIxlMiiFC1GK7nA==</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_85fe5cb0da273b96eb63b2ca004dc93c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_85fe5cb0da273b96eb63b2ca004dc93c.png"></p><h5 id="3-6-3-客户端挂载"><a href="#3-6-3-客户端挂载" class="headerlink" title="3.6.3 客户端挂载"></a>3.6.3 客户端挂载</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">客户端挂载</span></span><br><span class="line">mkdir /data1</span><br><span class="line">mount -t ceph 192.168.99.11:6789,192.168.99.12:6789,192.168.99.13:6789:/ /data1/ -o name=bruce,secret=AQCtFc9g/CmyERAAzi7ORpEWIxlMiiFC1GK7nA==</span><br></pre></td></tr></table></figure><h3 id="四、cephfs权限与访问控制"><a href="#四、cephfs权限与访问控制" class="headerlink" title="四、cephfs权限与访问控制"></a>四、cephfs权限与访问控制</h3><h4 id="4-1-添加用户"><a href="#4-1-添加用户" class="headerlink" title="4.1 添加用户"></a>4.1 添加用户</h4><p>添加用户<code>jerry，jerry</code>只有对<code>/jerry</code>路径下的文件具有读写权限，对其他路径下的文件只有读的权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建权限密钥</span></span><br><span class="line">ceph auth get-or-create client.jerry mon &#x27;allow r&#x27; mds &#x27;allow rw,allow rw path=/jerry&#x27; osd &#x27;allow rw pool=cephfs_data2&#x27; -o ceph.client.jerry.keyring</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用jerry用户挂载</span></span><br><span class="line">mount -t ceph 10.0.0.10:6789:/ /data -o name=jerry,secret=AQAo0/9lI2g7KRAA8AqwdIUhGQcS4tJgltSlzw==</span><br></pre></td></tr></table></figure><h4 id="4-2-获取权限列表"><a href="#4-2-获取权限列表" class="headerlink" title="4.2 获取权限列表"></a>4.2 获取权限列表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ceph auth list</span></span><br></pre></td></tr></table></figure><h4 id="4-3-删除用户"><a href="#4-3-删除用户" class="headerlink" title="4.3 删除用户"></a>4.3 删除用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ceph auth del client.jerry</span></span><br></pre></td></tr></table></figure><h4 id="4-4-获取某个用户的key"><a href="#4-4-获取某个用户的key" class="headerlink" title="4.4 获取某个用户的key"></a>4.4 获取某个用户的key</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ceph auth get-key client.bruce</span></span><br></pre></td></tr></table></figure><h4 id="4-5-修改用户权限"><a href="#4-5-修改用户权限" class="headerlink" title="4.5 修改用户权限"></a>4.5 修改用户权限</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ceph auth caps client.jerry mon <span class="string">&#x27;allow r&#x27;</span> mds <span class="string">&#x27;allow r, allow rw path=/jerry, allow rw path=/test&#x27;</span> osd <span class="string">&#x27;allow rw&#x27;</span></span></span><br></pre></td></tr></table></figure><h4 id="4-6-注意事项"><a href="#4-6-注意事项" class="headerlink" title="4.6 注意事项"></a>4.6 注意事项</h4><blockquote><ul><li>当用java api操作cephfs时，api无法指定新建文件or目录的所属用户or所属组，这两个属性取决于运行java程序时的当前用户(uid)及其所属的用户组(gid)</li><li>经过测试发现，cephfs文件or目录的权限是linux本身用户权限和cephfs用户权限的交集</li><li>修改用户权限后，在本地需要重新挂载才可生效</li><li>建目录，设置权限无需前后顺序</li></ul></blockquote><p><strong>本文参考：</strong></p><p>官网：<br><a href="https://docs.ceph.com/en/quincy/cephfs/#ceph-file-system">https://docs.ceph.com/en/quincy/cephfs/#ceph-file-system</a><br>挂载：<br><a href="https://docs.ceph.com/en/quincy/cephfs/mount-using-kernel-driver/">https://docs.ceph.com/en/quincy/cephfs/mount-using-kernel-driver/</a><br>cephfs介绍+各种测试：<br><a href="http://www.yangguanjun.com/2017/07/16/cephfs-test-method-lite/">http://www.yangguanjun.com/2017/07/16/cephfs-test-method-lite/</a></p>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ceph </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ceph rbd数据写入流程</title>
      <link href="/2024/03/20/ceph%20rbd%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5%E6%B5%81%E7%A8%8B/"/>
      <url>/2024/03/20/ceph%20rbd%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ceph-rbd数据写入流程"><a href="#ceph-rbd数据写入流程" class="headerlink" title="ceph rbd数据写入流程"></a>ceph rbd数据写入流程</h3><p><strong>拓补图：</strong></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_14d0de28111417c8dc2aa9088c5b6136.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_14d0de28111417c8dc2aa9088c5b6136.png"></p><p><strong>图片解析：</strong><br><code>存储过程：</code>一个文件切割为很多部分 比如一个100M的文件最终会切割成25个4M（默认4M）的文件<br><code>切割之后：</code>每个<code>object</code>都会有一个<code>object id  object id</code> 需要存储到pg里面去 此处进行一个运算把<code>object id 作为一个哈希   &gt;&gt; 对其进行掩码运算 &gt;&gt; 得到pgid </code>pg上面：<code> 存储多个object</code> &gt;&gt; 通过<code>crush</code>算法把<code>pg</code>做一次运算分配到 集群中对应的<code>osd</code>节点上(根据<code>crush</code>层次的不同<code>osd</code>也会落到不同的地方 )<br>比如<code>crush</code>算法定义的是以机架为单位的 此时便会落到不同的机架上的<code>osd</code>上从而确保数据的高可用性</p><p><strong>实际操作演示：</strong></p><p>文件切割大小验证 演示文件 id: rbd_data.38074c091b82.0000000000000200</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rbd info ceph-demo/rbd-demo.img   或    rbd -p ceph-demo info rbd-demo.img （查看命令）</span><br><span class="line">rbd image <span class="string">&#x27;rbd-demo.img&#x27;</span>:</span><br><span class="line">        size 11 GiB <span class="keyword">in</span> 2816 objects</span><br><span class="line">        order 22 (4 MiB objects)</span><br><span class="line">        snapshot_count: 0</span><br><span class="line">        <span class="built_in">id</span>: 38074c091b82</span><br><span class="line">        block_name_prefix: rbd_data.38074c091b82</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Sat Nov  5 21:41:38 2022</span><br><span class="line">        access_timestamp: Sat Nov  5 21:41:38 2022</span><br><span class="line">        modify_timestamp: Sat Nov  5 21:41:38 2022</span><br></pre></td></tr></table></figure><p>解析：</p><p>共：11G  分为：2816个文件  每个文件：4M<br>object的前缀都是以： rbd_data.38074c091b82 开头<br>查看验证：<code>rados -p ceph-demo ls |grep rbd\_data.38074c091b82</code>   (查看所有文件)<br>查看大小：<code>rados -p ceph-demo stat rbd\_data.38074c091b82.0000000000000200</code>  （每个都是4M）</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_6f53063cda709eabdb71f3cd486276b4.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_6f53063cda709eabdb71f3cd486276b4.png"></p><p><strong>查看文件最终落在的地方：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ceph osd map ceph-demo rbd_data.38074c091b82.0000000000000200     (查看文件最终落于)</span><br><span class="line">//返回</span><br><span class="line">osdmap e49 pool <span class="string">&#x27;ceph-demo&#x27;</span> (1) object <span class="string">&#x27;rbd_data.38074c091b82.0000000000000200&#x27;</span> -&gt; pg 1.7811abdf (1.5f) -&gt; up ([0,1], p0) acting ([0,1], p0)</span><br><span class="line"></span><br><span class="line">ceph osd tree</span><br><span class="line">ID CLASS WEIGHT  TYPE NAME       STATUS REWEIGHT PRI-AFF </span><br><span class="line">-1       0.01178 root default          </span><br><span class="line">-3       0.00589     host node-1       </span><br><span class="line"> 0   hdd 0.00589         osd.0       up  1.00000 1.00000 </span><br><span class="line">-5       0.00589     host node-2       </span><br><span class="line"> 1   hdd 0.00589         osd.1       up  1.00000 1.00000 </span><br><span class="line"></span><br><span class="line">解析： 文件pool池deph-demo &gt;&gt; 落在pgid为：1.7811abdf 上面 &gt;&gt; 解析掩码哈希分配于 &gt;&gt; osd.0 osd.1上面</span><br><span class="line">一个文件拆分为多个object这些object都会落在不同的pg上  pg最终落在不同的osd上 </span><br><span class="line">验证：</span><br><span class="line"><span class="keyword">for</span>循环验证</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `rados -p ceph-demo <span class="built_in">ls</span> |grep rbd_data.38074c091b82` ; <span class="keyword">do</span> ceph osd map ceph-demo <span class="variable">$i</span>;  <span class="keyword">done</span></span><br><span class="line">落于不同的pg上</span><br></pre></td></tr></table></figure><p>解析： 文件pool池deph-demo &gt;&gt; 落在pgid为：1.7811abdf 上面 &gt;&gt; 解析掩码哈希分配于 &gt;&gt; osd.0 osd.1上面一个文件拆分为多个object这些object都会落在不同的pg上  pg最终落在不同的osd上</p><p>验证：for循环验证</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> \`rados -p ceph-demo <span class="built_in">ls</span> |grep rbd\_data.38074c091b82\` ; <span class="keyword">do</span> ceph osd map ceph-demo \<span class="variable">$i</span>;  <span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>落于不同的pg上</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_29628694717b3300ec37f4ed88d5abbb.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_29628694717b3300ec37f4ed88d5abbb.png"></p><p><strong>rbd是瘦分配的会根据使用情况去自动的扩这些空间</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rados -p ceph-demo <span class="built_in">ls</span> |grep rbd_data.38074c091b82 |<span class="built_in">wc</span> -l        <span class="comment"># 当前这个块有五十多个object</span></span><br><span class="line">//返回 </span><br><span class="line">56 </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当前这个块有五十多个object  每个4M 实际分配了也就二百多M的空间  当前只用了40多M 使用增长的话会动态的去扩容object的数量 满足 我们需要的空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n 1 <span class="string">&#x27;rados -p ceph-demo ls |grep rbd_data.38074c091b82 |wc -l &#x27;</span>    （动态监视object文件变化）</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_7c31491c234c587d7d0cc391e7fce3d6.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_7c31491c234c587d7d0cc391e7fce3d6.png"></p><p>往挂载的目录写入数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /mnt/rbd-demo</span><br><span class="line"></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=test.img bs=1M count=1024       (往目录写入1G数据)</span><br><span class="line"><span class="comment"># 写入真实数据</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/urandom of=file bs=100M count=9000 iflag=fullblock status=progress</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到最终object增加到313个</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_cc6f5bd1aac93adf5cc215f62178f499.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_cc6f5bd1aac93adf5cc215f62178f499.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_64fcc6f1de8cc79e192aa157631a06d9.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_64fcc6f1de8cc79e192aa157631a06d9.png"></p>]]></content>
      
      
      <categories>
          
          <category> ceph </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ceph </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>音乐</title>
      <link href="/2024/03/16/%E9%9F%B3%E4%B9%90/"/>
      <url>/2024/03/16/%E9%9F%B3%E4%B9%90/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>音乐</strong></p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=557584888&auto=1&height=66"> </iframe><hr><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="https://music.163.com/outchain/player?type=2&id=523250334&auto=1&height=66"> </iframe>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> default </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>onedrive-vercel-index部署</title>
      <link href="/2024/03/15/onedrive-vercel-index%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/03/15/onedrive-vercel-index%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="onedrive-vercel-index-部署"><a href="#onedrive-vercel-index-部署" class="headerlink" title="onedrive-vercel-index 部署"></a>onedrive-vercel-index 部署</h3><p>概览：参考下方官网即可 部署相对简单</p><h3 id="注册一个应用程序"><a href="#注册一个应用程序" class="headerlink" title="注册一个应用程序"></a><a href="https://ovi.swo.moe/zh/docs/advanced#%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">注册一个应用程序</a></h3><p>打开以下链接：</p><ul><li><a href="https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade">Microsoft Azure App registrations</a> （OneDrive 国际版企业版与教育版E5 订阅专用本文使用此版本）</li><li><a href="https://portal.azure.cn/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade">Microsoft Azure.cn App registrations</a>（OneDrive 世纪互联专用）</li></ul><h3 id="serrect需要加密链接见参考链接"><a href="#serrect需要加密链接见参考链接" class="headerlink" title="serrect需要加密链接见参考链接"></a>serrect需要加密链接见参考链接</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_e934dc8c7a9ad014792319e375d506ab.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_e934dc8c7a9ad014792319e375d506ab.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_32138b6f42071fff75dbd218321a5a77.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_32138b6f42071fff75dbd218321a5a77.png"></p><h3 id="本文参考："><a href="#本文参考：" class="headerlink" title="本文参考："></a>本文参考：</h3><p><a href="https://ovi.swo.moe/zh/docs/advanced">https://ovi.swo.moe/zh/docs/advanced</a><br><a href="https://ovi.swo.moe/zh/docs/getting-started">https://ovi.swo.moe/zh/docs/getting-started</a></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s仪表盘部署</title>
      <link href="/2024/03/12/k8s%E4%BB%AA%E8%A1%A8%E7%9B%98%E9%83%A8%E7%BD%B2/"/>
      <url>/2024/03/12/k8s%E4%BB%AA%E8%A1%A8%E7%9B%98%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="k8s仪表盘部署"><a href="#k8s仪表盘部署" class="headerlink" title="k8s仪表盘部署"></a>k8s仪表盘部署</h2><p><strong>仪表盘文件下载链接</strong><br><a href="https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml">https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml</a><br><a href="https://drive.zznnwn.cloudns.biz/onedrive/k8s%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%8Acni/%E4%BD%BF%E7%94%A8container%E4%BD%9C%E4%B8%BA%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6/recommended_v270.yaml">https://drive.zznnwn.cloudns.biz/onedrive/k8s部署配置文件及cni/使用container作为容器运行时/recommended_v270.yaml</a></p><h3 id="部署仪表盘"><a href="#部署仪表盘" class="headerlink" title="部署仪表盘"></a>部署仪表盘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f &quot;https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml&quot;</span><br><span class="line">kubectl apply -f &quot;https://drive.zznnwn.cloudns.biz/onedrive/k8s部署配置文件及cni/使用container作为容器运行时/recommended_v270.yaml&quot;</span><br></pre></td></tr></table></figure><p><strong>命名空间中的名称创建服务帐户(admin-user.yml)</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br></pre></td></tr></table></figure><p><strong>部署admin-user.yml</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f admin-user.yml </span><br><span class="line">kubectl apply -f <span class="string">&quot;https://drive.zznnwn.cloudns.biz/onedrive/k8s部署配置文件及cni/使用container作为容器运行时/admin-user.yml&quot;</span></span><br></pre></td></tr></table></figure><p>创建 ClusterRoleBinding(<code>ClusterRoleBinding.yml</code>)</p><p>在大多数情况下，在使用 或任何其他常用工具预配集群后，集群中已存在。我们可以使用它并只为我们的 . 如果它不存在，则需要先创建此角色并手动授予所需的权限。<code>kops kubeadm ClusterRole cluster-admin ClusterRoleBinding ServiceAccount</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br></pre></td></tr></table></figure><p><strong>部署ClusterRoleBinding.yml</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ClusterRoleBinding.yml </span><br><span class="line">kubectl apply -f <span class="string">&quot;https://drive.zznnwn.cloudns.biz/onedrive/k8s部署配置文件及cni/使用container作为容器运行时/ClusterRoleBinding.yml&quot;</span></span><br></pre></td></tr></table></figure><p><strong>获取 ServiceAccount 的持有者令牌</strong></p><p>现在我们需要找到可用于登录的令牌。执行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubernetes-dashboard create token admin-user</span><br></pre></td></tr></table></figure><p><strong>它应该打印如下内容：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLXY1N253Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIwMzAzMjQzYy00MDQwLTRhNTgtOGE0Ny04NDllZTliYTc5YzEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.Z2JrQlitASVwWbc-s6deLRFVk5DWD3P_vjUFXsqVSY10pbjFLG4njoZwh8p3tLxnX_VBsr7_6bwxhWSYChp9hwxznemD5x5HLtjb16kI9Z7yFWLtohzkTwuFbqmQaMoget_nYcQBUC5fDmBHRfFvNKePh_vSSb2h_aYXa8GV5AcfPQpY7r461itme1EXHQJqv-SN-zUnguDguCTjD80pFZ_CmnSE1z9QdMHPB8hoB4V68gtswR1VLa6mSYdgPwCHauuOobojALSaMc3RH7MmFUumAgguhqAkX3Omqd3rJbYOMRuMjhANqd08piDC3aIabINX6gP5-Tuuw2svnV6NYQ</span><br></pre></td></tr></table></figure><p>查看 <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#manually-create-an-api-token-for-a-serviceaccount">Kubernetes 文档</a>，了解有关 ServiceAccount 的 API 令牌的更多信息。</p><h4 id="获取-ServiceAccount-的长期持有者令牌-建议使用此种"><a href="#获取-ServiceAccount-的长期持有者令牌-建议使用此种" class="headerlink" title="获取 ServiceAccount 的长期持有者令牌(建议使用此种)"></a>获取 ServiceAccount 的长期持有者令牌(建议使用此种)</h4><p>我们还可以创建一个带有 secret 的令牌，该令牌绑定了服务帐户，令牌将保存在 Secret 中文件(<code>secret_token.yml</code>)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/service-account.name:</span> <span class="string">&quot;admin-user&quot;</span>   </span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/service-account-token</span>  </span><br></pre></td></tr></table></figure><p><strong>部署</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f secret_token.yml</span><br><span class="line">kubectl apply -f <span class="string">&quot;https://drive.zznnwn.cloudns.biz/onedrive/k8s部署配置文件及cni/使用container作为容器运行时/secret_token.yml&quot;</span></span><br></pre></td></tr></table></figure><p>创建 Secret 后，我们可以执行以下命令来获取保存在 Secret 中的 Token：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath=&#123;&quot;.data.token&quot;&#125; | base64 -d</span><br></pre></td></tr></table></figure><p>查看 <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#manually-create-a-long-lived-api-token-for-a-serviceaccount">Kubernetes 文档</a>，了解有关 ServiceAccount 的长期 API 令牌的更多信息。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_451018f8aaf9cdda00b42a1da75d3b46.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_451018f8aaf9cdda00b42a1da75d3b46.png"></p><h3 id="最后将dashboard端口暴露在外用于访问"><a href="#最后将dashboard端口暴露在外用于访问" class="headerlink" title="最后将dashboard端口暴露在外用于访问"></a>最后将<code>dashboard</code>端口暴露在外用于访问</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl  patch svc kubernetes-dashboard -n kubernetes-dashboard \</span><br><span class="line">-p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;type&quot;:&quot;NodePort&quot;,&quot;ports&quot;:[&#123;&quot;port&quot;:443,&quot;targetPort&quot;:8443,&quot;nodePort&quot;:30443&#125;]&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_57bf21fb0b0a561b21cf24556ecc01a5.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_57bf21fb0b0a561b21cf24556ecc01a5.png"></p><h3 id="扩展一键部署"><a href="#扩展一键部署" class="headerlink" title="扩展一键部署"></a>扩展一键部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://drive.zznnwn.cloudns.biz/onedrive/脚本/k8s一键部署脚本/k8s-dashboard.sh | bash</span><br></pre></td></tr></table></figure><h3 id="登陆仪表盘"><a href="#登陆仪表盘" class="headerlink" title="登陆仪表盘"></a>登陆仪表盘</h3><p>访问：<a href="https://localhost:8443/#/login">https://localhost:8443/#/login</a></p><h3 id="清理和后续步骤"><a href="#清理和后续步骤" class="headerlink" title="清理和后续步骤"></a>清理和后续步骤</h3><p>删除 admin 和 .<code>ServiceAccount ClusterRoleBinding</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kubernetes-dashboard delete serviceaccount admin-user</span><br><span class="line">kubectl -n kubernetes-dashboard delete clusterrolebinding admin-user</span><br></pre></td></tr></table></figure><p>要了解有关如何在 Kubernetes 中授予/拒绝权限的更多信息，请阅读官方<a href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/">身份验证</a>和<a href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/">授权</a>文档。</p><h4 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h4><p><a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/">https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/web-ui-dashboard/</a><br><a href="https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md">https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md</a></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s去除污点节点</title>
      <link href="/2024/03/12/k8s%E5%8E%BB%E9%99%A4%E6%B1%A1%E7%82%B9%E8%8A%82%E7%82%B9/"/>
      <url>/2024/03/12/k8s%E5%8E%BB%E9%99%A4%E6%B1%A1%E7%82%B9%E8%8A%82%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="k8s去除污点节点"><a href="#k8s去除污点节点" class="headerlink" title="k8s去除污点节点"></a>k8s去除污点节点</h3><p><strong>现象</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看节点详情</span></span><br><span class="line">kubectl describe pods nginx-7b7485646b-n9f8g  -n default  </span><br><span class="line"></span><br><span class="line"><span class="comment">################报错信息##############</span></span><br><span class="line"></span><br><span class="line">Node-Selectors:                                                                                                          </span><br><span class="line">Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists <span class="keyword">for</span> 300s                                         </span><br><span class="line">                             node.kubernetes.io/unreachable:NoExecute op=Exists <span class="keyword">for</span> 300s                                       </span><br><span class="line">Events:                                                                                                                        </span><br><span class="line">  Type     Reason            Age    From               Message                                                                 </span><br><span class="line">  ----     ------            ----   ----               -------                                                                 </span><br><span class="line">  Warning  FailedScheduling  2m54s  default-scheduler  0/1 nodes are available: 1 node(s) had untolerated taint &#123;node-role.kubernetes.io/control-plane: &#125;. </span><br><span class="line">preemption: 0/1 nodes are available: 1 Preemption is not helpful <span class="keyword">for</span> scheduling.. </span><br></pre></td></tr></table></figure><p><strong>解决</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@k8s:~<span class="comment"># kubectl describe nodes |grep Taints                                                                                                      </span></span><br><span class="line">Taints:             node-role.kubernetes.io/control-plane:NoSchedule                                                                                 </span><br><span class="line">                                                                                                                                                                                        </span><br><span class="line">root@k8s:~<span class="comment"># kubectl get node                                                                                                                         </span></span><br><span class="line">NAME   STATUS   ROLES           AGE     VERSION                                                                                                      </span><br><span class="line">k8s    Ready    control-plane   4h22m   v1.26.5                                                                                                      </span><br><span class="line">root@k8s:~<span class="comment"># kubectl taint nodes k8s  node-role.kubernetes.io/control-plane-</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_169b466f0666661a0ccb13ce6795653b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/3/image_169b466f0666661a0ccb13ce6795653b.png"></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s常用命令</title>
      <link href="/2024/03/12/k8s%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2024/03/12/k8s%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="k8s常用命令"><a href="#k8s常用命令" class="headerlink" title="k8s常用命令"></a>k8s常用命令</h3><p>这是一个用于管理 Kubernetes 集群的 kubectl 命令。让我们解释一下这个命令的各个部分：</p><ul><li><strong>kubectl</strong>: 这是 Kubernetes 命令行工具，用于与 Kubernetes 集群进行交互，例如创建、管理和监视资源。</li><li><strong>get</strong>: 这是 kubectl 命令的一个子命令，用于检索（获取）Kubernetes 集群中的资源的信息。</li><li><strong>svc</strong>: 这是 “service” 的缩写，表示你希望获取服务（Service）的相关信息。</li><li><strong>deploy</strong>: 这是 “deployment” 的缩写，表示你希望获取部署（Deployment）的相关信息。</li><li><strong>-n kube-system</strong>: 这是一个标志（flag），用于指定要检索资源所在的命名空间（namespace）。在这种情况下，”-n kube-system” 表示你希望获取位于 kube-system 命名空间中的服务的信息。</li></ul><p><strong>通过yml创建删除应用</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply  -f kuboard-offline.yml</span><br><span class="line">kubectl delete -f kuboard-offline.yml</span><br><span class="line">kubectl apply  -f nginx-deployment.yml</span><br></pre></td></tr></table></figure><p><strong>通过命令行创建应用</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看帮助命令</span></span><br><span class="line">kubectl create deployment --<span class="built_in">help</span></span><br><span class="line"><span class="comment"># 开始发布应用 指定名称是demo 镜像是nginx:1.7.9 副本数是3</span></span><br><span class="line">kubectl create deployment demo --image=nginx:1.7.9 --replicas=3</span><br><span class="line"><span class="comment">#创建service暴露端口使用vip访问</span></span><br><span class="line">kubectl expose deployment demo --port=80 --target-port=80 </span><br><span class="line"></span><br><span class="line">kubectl create deployment nginx --image=registry.cn-hangzhou.aliyuncs.com/xiaohh-docker/nginx:latest</span><br><span class="line">kubectl expose deployment nginx --port=80 --<span class="built_in">type</span>=LoadBalancer</span><br><span class="line">kubectl delete deployment nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建service </span></span><br><span class="line">kubectl create -f nginx-service.yaml</span><br><span class="line"><span class="comment"># 查看暴露在外部的端口</span></span><br><span class="line">kubectl get service/nginx-service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除pod</span></span><br><span class="line">kubectl delete deployment demo </span><br></pre></td></tr></table></figure><p><strong>暴露外部端口用于访问</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl  patch svc kubernetes-dashboard -n kubernetes-dashboard \</span><br><span class="line">-p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;type&quot;:&quot;NodePort&quot;,&quot;ports&quot;:[&#123;&quot;port&quot;:443,&quot;targetPort&quot;:8443,&quot;nodePort&quot;:30443&#125;]&#125;&#125;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>查看pod详情</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看命名空间为kube-system的pod详情</span></span><br><span class="line">kubectl get pods -n kube-system</span><br><span class="line">kubectl get pods -n kube-system -o wide</span><br><span class="line">kubectl describe pod kubernetes-dashboard-7bdfc744fc-hmhh2 -n kube-system</span><br><span class="line"><span class="comment"># 获取位于 kube-system/kubernetes-dashboard 命名空间中的所有服务（Service）的信息。这将列出 kube-system 命名空间中所有服务的详细信息，包括服务的名称、类型、集群IP等。</span></span><br><span class="line">kubectl get svc -n kube-system</span><br><span class="line">kubectl get svc -n kubernetes-dashboard </span><br><span class="line"><span class="comment"># 查看系统pod以外的pod详情/查看自己部署的应用</span></span><br><span class="line">kubectl get pods -o wide</span><br><span class="line">kubectl get deployments.apps</span><br><span class="line">kubectl describe pods nginx-deployment-57c68fcd95-sgd25</span><br><span class="line"><span class="comment"># 查看demo应用（容器）service(svc)详细</span></span><br><span class="line">kubectl describe service demo</span><br><span class="line"><span class="comment"># 查看节点状态</span></span><br><span class="line">kubectl get nodes</span><br><span class="line">kubectl get cs</span><br><span class="line"><span class="comment"># coredns组件用于做名称解析 主要是通过daemonsets.apps的形式在里面部署两个daemonset分别是kube-flannel-ds 和 kube-proxy</span></span><br><span class="line">kubectl get daemonsets.apps -n kube-system</span><br></pre></td></tr></table></figure><p><strong>登陆进入pod相当于docker exec</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录容器查看volumes详情</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it volume-rbd-demo /bin/bash</span><br><span class="line">kubectl <span class="built_in">exec</span> -it volume-rbd-demo -- <span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure><p><strong>部分命令完整写法</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get deployment --namespace=kubernetes-dashboard kubernetes-dashboard</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">$ kubectl describe deployment --namespace=kubernetes-dashboard kubernetes-dashboard</span><br><span class="line"><span class="comment"># 查看service</span></span><br><span class="line">$ kubectl get service --namespace=kubernetes-dashboard kubernetes-dashboard </span><br><span class="line">返回</span><br><span class="line">NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes-dashboard   ClusterIP   10.108.163.102   &lt;none&gt;        443/TCP   5m15s</span><br><span class="line"><span class="comment"># 另外查看pod状态 (此时说明安装完成</span></span><br><span class="line">$ kubectl --namespace=kubernetes-dashboard get pod -o wide | grep dashboard</span><br><span class="line">返回</span><br><span class="line">dashboard-metrics-scraper-79459f84f-5g8h6   1/1     Running   0          5m34s   172.16.0.9   ceph1   &lt;none&gt;   </span><br><span class="line">kubernetes-dashboard-76dc96b85f-nhwjd       1/1     Running   0          5m34s   172.16.0.8   ceph1   &lt;none&gt;</span><br><span class="line"><span class="comment"># 查看svc</span></span><br><span class="line">kubectl -n kubernetes-dashboard get svc</span><br><span class="line">NAME                        TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">dashboard-metrics-scraper   ClusterIP   10.104.31.122    &lt;none&gt;        8000/TCP   32m</span><br><span class="line">kubernetes-dashboard        ClusterIP   10.108.163.102   &lt;none&gt;        443/TCP    32m</span><br><span class="line"><span class="comment"># 如果状态一直创建中, 使用describe查看具体过程 （如下回显则需要设置拉取镜像方法）</span></span><br><span class="line">$ kubectl describe pod --namespace=kubernetes-dashboard</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一键部署k8s脚本</title>
      <link href="/2024/03/11/%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%8D%95%E8%8A%82%E7%82%B9k8s%E8%84%9A%E6%9C%AC/"/>
      <url>/2024/03/11/%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E5%8D%95%E8%8A%82%E7%82%B9k8s%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>使用container作为k8s容器运行时服务器不需要安装cni<br><strong>kube-flannel.yml配置原链接</strong><br><a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a></p></blockquote><h2 id="项目链接-gt-gt-gt-gt-gt-gt-gt-gt-gt-gt-gt"><a href="#项目链接-gt-gt-gt-gt-gt-gt-gt-gt-gt-gt-gt" class="headerlink" title="项目链接 | &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"></a>项目链接 | &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</h2><p><a href="https://gitee.com/apple-Teawine/k8s/tree/master/deploy-k8s-container%E7%89%88">项目链接</a></p><h2 id="部署完成后测试集群状态"><a href="#部署完成后测试集群状态" class="headerlink" title="部署完成后测试集群状态"></a>部署完成后测试集群状态</h2><h3 id="部署一个NGNINX"><a href="#部署一个NGNINX" class="headerlink" title="部署一个NGNINX"></a>部署一个<code>NGNINX</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment nginx  --image=nginx:1.14-alpine</span><br></pre></td></tr></table></figure><h3 id="暴露端口-type-NodePort集群之外访问"><a href="#暴露端口-type-NodePort集群之外访问" class="headerlink" title="暴露端口--type=NodePort集群之外访问"></a>暴露端口<code>--type=NodePort</code>集群之外访问</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose deploy nginx  --port=80 --target-port=80  --<span class="built_in">type</span>=NodePort</span><br></pre></td></tr></table></figure><h3 id="查看外部访问端口【三条命令都能使用】"><a href="#查看外部访问端口【三条命令都能使用】" class="headerlink" title="查看外部访问端口【三条命令都能使用】"></a>查看外部访问端口【三条命令都能使用】</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubecet get svc </span><br><span class="line">kubecet get svc -n deauflt</span><br><span class="line">kubectl get pod,svc</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_a3f218144218f3b84fc841c95cfa40e7.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/4/image_a3f218144218f3b84fc841c95cfa40e7.png"></p><p>本文参考：</p><p><a href="https://blog.csdn.net/weixin_58648684/article/details/130699568">https://blog.csdn.net/weixin_58648684/article/details/130699568</a><br><a href="https://cn.linux-console.net/?p=3508">https://cn.linux-console.net/?p=3508</a>  container安装参考<br><a href="https://wn-apple-teawine.fun/2023/06/04/ubuntu%E9%83%A8%E7%BD%B2kubernetes">https://wn-apple-teawine.fun/2023/06/04/ubuntu部署kubernetes</a><br><a href="https://www.cnblogs.com/way2backend/p/16970506.html#3-%E5%AE%89%E8%A3%85containerd">https://www.cnblogs.com/way2backend/p/16970506.html#3-%E5%AE%89%E8%A3%85containerd</a><br><a href="https://blog.csdn.net/IOT_AI/article/details/131916926">[Ubuntu 22.04] 安装containerd_ubuntu22.04 安装containerd-CSDN博客</a></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在Linux上以All-in-One模式安装KubeSphere</title>
      <link href="/2024/03/10/%E5%9C%A8Linux%E4%B8%8A%E4%BB%A5All-in-One%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85KubeSphere/"/>
      <url>/2024/03/10/%E5%9C%A8Linux%E4%B8%8A%E4%BB%A5All-in-One%E6%A8%A1%E5%BC%8F%E5%AE%89%E8%A3%85KubeSphere/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>首先服务器执行初始化脚本 安装docker</p><p>本文参考：<a href="https://kubesphere.io/zh/docs/v3.4/quick-start/all-in-one-on-linux/">https://kubesphere.io/zh/docs/v3.4/quick-start/all-in-one-on-linux/</a></p><h3 id="节点要求"><a href="#节点要求" class="headerlink" title="节点要求"></a>节点要求</h3><ul><li>节点必须能够通过 <code>SSH</code> 连接。</li><li>节点上可以使用 <code>sudo</code>/<code>curl</code>/<code>openssl</code>/<code>tar</code> 命令。</li></ul><h3 id="容器运行时"><a href="#容器运行时" class="headerlink" title="容器运行时"></a>容器运行时</h3><p>您的集群必须有一个可用的容器运行时。如果您使用 KubeKey 搭建集群，KubeKey 会默认安装最新版本的 Docker。或者，您也可以在创建集群前手动安装 Docker 或其他容器运行时。</p><table><thead><tr><th>支持的容器运行时</th><th>版本</th></tr></thead><tbody><tr><td>Docker</td><td>19.3.8 +</td></tr><tr><td>containerd</td><td>最新版</td></tr><tr><td>CRI-O（试验版，未经充分测试）</td><td>最新版</td></tr><tr><td>iSula（试验版，未经充分测试）</td><td>最新版</td></tr></tbody></table><h3 id="依赖项要求"><a href="#依赖项要求" class="headerlink" title="依赖项要求"></a>依赖项要求</h3><p>KubeKey 可以将 Kubernetes 和 KubeSphere 一同安装。针对不同的 Kubernetes 版本，需要安装的依赖项可能有所不同。您可以参考以下列表，查看是否需要提前在节点上安装相关的依赖项。</p><table><thead><tr><th>依赖项</th><th>Kubernetes 版本 ≥ 1.18</th><th>Kubernetes 版本 &lt; 1.18</th></tr></thead><tbody><tr><td><code>socat</code></td><td>必须</td><td>可选但建议</td></tr><tr><td><code>conntrack</code></td><td>必须</td><td>可选但建议</td></tr><tr><td><code>ebtables</code></td><td>可选但建议</td><td>可选但建议</td></tr><tr><td><code>ipset</code></td><td>可选但建议</td><td>可选但建议</td></tr></tbody></table><p>KubeKey 是用 Go 语言开发的一款全新的安装工具，代替了以前基于 ansible 的安装程序。KubeKey 为用户提供了灵活的安装选择，可以分别安装 KubeSphere 和 Kubernetes 或二者同时安装，既方便又高效。</p><h3 id="网络和-DNS-要求"><a href="#网络和-DNS-要求" class="headerlink" title="网络和 DNS 要求"></a>网络和 DNS 要求</h3><ul><li>请确保 <code>/etc/resolv.conf</code> 中的 DNS 地址可用，否则，可能会导致集群中的 DNS 出现问题。</li><li>如果您的网络配置使用防火墙规则或安全组，请务必确保基础设施组件可以通过特定端口相互通信。建议您关闭防火墙。有关更多信息，请参见<a href="https://kubesphere.io/zh/docs/v3.3/installing-on-linux/introduction/port-firewall/">端口要求</a>。</li><li>支持的 CNI 插件：Calico 和 Flannel。其他插件也适用（例如 Cilium 和 Kube-OVN 等），但请注意它们未经充分测试。</li></ul><p>提示</p><ul><li>建议您的操作系统处于干净状态（不安装任何其他软件），否则可能会发生冲突。</li><li>如果您无法从 <code>dockerhub.io</code> 下载容器镜像，建议提前准备仓库的镜像地址（即加速器）。有关更多信息，请参见<a href="https://kubesphere.io/zh/docs/v3.4/faq/installation/configure-booster/">为安装配置加速器</a>。</li></ul><p>硬件推荐配置</p><table><thead><tr><th>操作系统</th><th>最低配置</th></tr></thead><tbody><tr><td><strong>Ubuntu</strong> <em>16.04</em>, <em>18.04</em>, <em>20.04</em>, <em>22.04</em></td><td>2 核 CPU，4 GB 内存，40 GB 磁盘空间</td></tr><tr><td><strong>Debian</strong> <em>Buster</em>, <em>Stretch</em></td><td>2 核 CPU，4 GB 内存，40 GB 磁盘空间</td></tr><tr><td><strong>CentOS</strong> <em>7.x</em></td><td>2 核 CPU，4 GB 内存，40 GB 磁盘空间</td></tr><tr><td><strong>Red Hat Enterprise Linux 7</strong></td><td>2 核 CPU，4 GB 内存，40 GB 磁盘空间</td></tr><tr><td><strong>SUSE Linux Enterprise Server 15/openSUSE Leap 15.2</strong></td><td>2 核 CPU，4 GB 内存，40 GB 磁盘空间</td></tr></tbody></table></blockquote><p><strong>一. 安装依赖</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y socat conntrack ipset</span><br></pre></td></tr></table></figure><p><strong>二. 执行部署k8s</strong></p><blockquote><p>此步骤部署很可能因为网络原因导致失败</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若此命令失败则使用下方先下载软件包解压后执行</span></span><br><span class="line">curl -sfL https://get-kk.kubesphere.io | VERSION=v3.0.13 sh -</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载软件包</span></span><br><span class="line">cd /opt &amp;&amp; curl -flO https://kubernetes.pek3b.qingstor.com/kubekey/releases/download/v3.0.13/kubekey-v3.0.13-linux-amd64.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压</span></span><br><span class="line">tar -xvf kubekey-v3.0.13-linux-amd64.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本文使用</span></span><br><span class="line">./kk create cluster --with-kubernetes v1.26.5 --container-manager containerd --with-kubesphere v3.4.1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可选</span></span><br><span class="line">./kk create cluster --with-kubernetes v1.26.5 --container-manager containerd --with-local-storage</span><br></pre></td></tr></table></figure><p>k8s版本号参考：<a href="https://kubernetes.io/zh-cn/releases/">发行版本 | Kubernetes</a></p><p><strong>三. 最后：验证安装结果</strong></p><p>输入以下命令以检查安装结果。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l &#x27;app in (ks-install, ks-installer)&#x27; -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;) -f</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出信息会显示 Web 控制台的 IP 地址和端口号，默认的 NodePort 是 <code>30880</code>。现在，您可以使用默认的帐户和密码 (<code>admin/P@88w0rd</code>) 通过 <code>&lt;NodeIP&gt;:30880</code> 访问控制台。</p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>服务器遭受SYN洪水攻击</title>
      <link href="/2024/03/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%81%AD%E5%8F%97SYN%E6%B4%AA%E6%B0%B4%E6%94%BB%E5%87%BB/"/>
      <url>/2024/03/05/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%81%AD%E5%8F%97SYN%E6%B4%AA%E6%B0%B4%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>引用GPT3.5回答：</p><p>SYN 洪水攻击（SYN flooding）的情况。SYN 洪水攻击是一种常见的网络攻击方式，攻击者发送大量伪造的 TCP 连接请求（SYN 包），导致服务器资源耗尽或网络拥塞。</p><p>内核检测到可能的 SYN 洪水攻击后，会采取一些措施来应对，其中之一是发送 cookies。TCP SYN cookies 是一种用于防止 SYN 洪水攻击的技术，它允许服务器在遭受 SYN 洪水攻击时继续处理连接请求，而无需维护半开连接的状态。</p><p>它是一种常见的网络攻击类型，旨在使服务器不可用。在这种攻击中，攻击者发送大量伪造的 SYN 数据包到服务器上，使服务器无法处理所有这些连接请求，从而耗尽其资源。</p></blockquote><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p><strong>现象：</strong></p><p><code>Mar  5 18:04:28 ybh83aa9pnppbp kernel: TCP: request_sock_TCP: Possible SYN flooding on port 22. Sending cookies.  Check SNMP counters.</code></p><p>这个是遭受到了 SYN 洪水攻击（SYN flooding）<br>您对22端口做个白名单限制就行了<br>或者使用这个工具进行防御这种攻击<br><a href="https://github.com/fail2ban/fail2ban">https://github.com/fail2ban/fail2ban</a></p><blockquote><p>引用GPT3.5回答：</p><p>这个错误表明你的Linux服务器可能受到了 SYN 洪水攻击，它是一种常见的网络攻击类型，旨在使服务器不可用。在这种攻击中，攻击者发送大量伪造的 SYN 数据包到服务器上，使服务器无法处理所有这些连接请求，从而耗尽其资源。</p><p>要解决这个问题，你可以采取以下措施：</p><ol><li><p><strong>增加 SYN 收队列的大小</strong>：通过调整内核参数，增加服务器上 SYN 收队列的大小，使其能够处理更多的连接请求。你可以通过修改 <code>/proc/sys/net/ipv4/tcp_max_syn_backlog</code> 参数来实现。例如，可以使用以下命令将队列大小增加到 1024：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.tcp_max_syn_backlog=1024</span><br></pre></td></tr></table></figure></li><li><p><strong>配置防火墙</strong>：使用防火墙来过滤来自外部网络的恶意流量。可以配置防火墙规则，限制每个 IP 地址对 SSH 端口的连接速率，或者使用工具如 Fail2Ban 来自动检测并封锁恶意 IP 地址。</p></li><li><p><strong>使用 SYN Cookie</strong>：启用 SYN Cookie 可以防止服务器被 SYN 洪水攻击所拒绝服务。这个选项会在服务器端在收到 SYN 请求时不分配资源，而是使用一个加密的 Cookie 发送给客户端。只有当客户端返回带有正确 Cookie 的 ACK 请求时，服务器才会分配资源并完成 TCP 握手。你可以通过以下命令启用 SYN Cookie：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.tcp_syncookies=1</span><br></pre></td></tr></table></figure></li><li><p><strong>更新系统和软件</strong>：确保你的系统和所有安全相关的软件都是最新的版本，因为厂商通常会修复已知的漏洞和安全问题。</p></li><li><p><strong>监控网络流量</strong>：定期监控服务器上的网络流量，并在检测到异常流量时及时采取行动。</p></li><li><p><strong>限制 SSH 访问</strong>：如果可能，尝试限制 SSH 访问只允许来自特定 IP 地址范围的连接，以减少服务器受到攻击的风险。</p></li></ol><p>如果以上措施都不能解决问题，你可能需要进一步的调查和分析，可能需要与网络安全专家合作，以找出更深层次的解决方案。</p></blockquote><h4 id="fail2ban安装及使用参考"><a href="#fail2ban安装及使用参考" class="headerlink" title="fail2ban安装及使用参考"></a>fail2ban安装及使用参考</h4><p><a href="https://blog.csdn.net/dudu1225/article/details/121242917">Fail2ban安装及配置</a><br><a href="https://blog.csdn.net/qq_46229380/article/details/109802360">Fail2ban安装及配置压缩包方式安装</a><br><a href="https://www.jianshu.com/p/4fdec5794d08">CentOS7下安装和使用Fail2ban - 简书 (jianshu.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> default </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows或Linux SSH连接或者服务偶发性断开问题处理</title>
      <link href="/2024/02/19/Windows%E6%88%96Linux%20SSH%E8%BF%9E%E6%8E%A5%E6%88%96%E8%80%85%E6%9C%8D%E5%8A%A1%E5%81%B6%E5%8F%91%E6%80%A7%E6%96%AD%E5%BC%80%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/"/>
      <url>/2024/02/19/Windows%E6%88%96Linux%20SSH%E8%BF%9E%E6%8E%A5%E6%88%96%E8%80%85%E6%9C%8D%E5%8A%A1%E5%81%B6%E5%8F%91%E6%80%A7%E6%96%AD%E5%BC%80%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Windows或Linux-SSH连接或者服务偶发性断开问题处理"><a href="#Windows或Linux-SSH连接或者服务偶发性断开问题处理" class="headerlink" title="Windows或Linux SSH连接或者服务偶发性断开问题处理"></a>Windows或Linux SSH连接或者服务偶发性断开问题处理</h3><p><a href="https://support.huaweicloud.com/trouble-ecs/ecs-trouble.pdf">查看PDF</a></p><p><a href>分享</a></p><h4 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h4><p>该文档适用于在SSH连接Linux云服务器或者访问该服务器上的应用时偶现连接断开。</p><h4 id="约束与限制"><a href="#约束与限制" class="headerlink" title="约束与限制"></a>约束与限制</h4><ol><li>修改系统内核参数可能产生内核不稳定，请评估风险后进行操作。</li><li>为了确保系统稳定运行，修改内核参数后建议在合理的时间重启系统。</li></ol><h4 id="根因分析"><a href="#根因分析" class="headerlink" title="根因分析"></a>根因分析</h4><ol><li><p>执行以下命令，查看系统内核是否开启了TIME_WAIT快速回收和重利用策略</p><p><strong>sysctl -a |grep tcp_tw</strong></p><p>如<a href="https://support.huaweicloud.com/trouble-ecs/ecs_trouble_0317.html#ecs_trouble_0317__fig258143323916">图1</a>所示，确认已开启该策略。</p><p><strong>图1</strong> TIME_WAIT<br><img src="https://support.huaweicloud.com/trouble-ecs/zh-cn_image_0174991741.png"></p></li><li><p>由于服务端开启了TIME_WAIT快速回收和重利用策略导致，即启用了net.ipv4.tcp_tw_recycle或者net.ipv4.tcp_tw_reuse。系统默认是不启用该功能。<br><img src="https://res-static.hc-cdn.cn/aem/content/dam/cloudbu-site/archive/china/zh-cn/support/resource/framework/v3/images/support-doc-new-note.svg">说明：客户端通常在NAT环境下，多台终端使用同一个公网ip，无法实现服务端与客户端的一对一连接。如果开启此参数服务端会回收处于TIME_WAIT状态的TCP连接，导致连接断开。</p></li></ol><h4 id="操作方法："><a href="#操作方法：" class="headerlink" title="操作方法："></a>操作方法：</h4><p>关闭上述两个内核参数，打开/etc/sysctl.conf，添加或者修改下列两行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_tw_recycle = 0</span><br><span class="line">net.ipv4.tcp_tw_reuse = 0</span><br></pre></td></tr></table></figure><p>执行以下命令，使修改的配置生效。<br><strong># sysctl -p</strong></p><p><img src="https://res-static.hc-cdn.cn/aem/content/dam/cloudbu-site/archive/china/zh-cn/support/resource/framework/v3/images/support-doc-new-note.svg">说明：启动中修改内核参数可能存在内核加载该参数不稳定的情况，建议在合适的时间进行重启。</p><p>上文参考：<a href="https://support.huaweicloud.com/trouble-ecs/ecs_trouble_0317.html">SSH连接或者服务偶发性断开问题处理_弹性云服务器 ECS_故障排除_SSH连接 (huaweicloud.com)</a></p><h4 id="windows服务偶发性断连解决"><a href="#windows服务偶发性断连解决" class="headerlink" title="windows服务偶发性断连解决"></a>windows服务偶发性断连解决</h4><p>此文参考：</p><p><a href="https://zhuanlan.zhihu.com/p/604394878">https://zhuanlan.zhihu.com/p/604394878</a><br><a href="https://blog.csdn.net/boonya/article/details/105700988">https://blog.csdn.net/boonya/article/details/105700988</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzkzNzI1MzE2Mw==&mid=2247484249&idx=1&sn=d522df8c29cdc5c2bb1c466403c0d737&chksm=c293031df5e48a0b7856b9a553dbf1df27015afe09c939f114ad35ad486a30737dd4b258f4e5&scene=21#wechat_redirect">运维排查篇 | 服务器产生大量的TIME_WAIT的原因你知道吗？</a></p>]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> default </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>openstack上使用windows镜像制作</title>
      <link href="/2024/02/19/openstack%E4%B8%8A%E4%BD%BF%E7%94%A8windows%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/"/>
      <url>/2024/02/19/openstack%E4%B8%8A%E4%BD%BF%E7%94%A8windows%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一-workstdtion-vsphere-制作openstack镜像"><a href="#一-workstdtion-vsphere-制作openstack镜像" class="headerlink" title="一.  workstdtion/ vsphere 制作openstack镜像"></a>一.  <code>workstdtion</code>/ vsphere 制作<code>openstack</code>镜像</h2><h3 id="note"><a href="#note" class="headerlink" title="note:"></a>note:</h3><h4 id="演示windows-server2016版本-配置时需要至少给C盘50G空间"><a href="#演示windows-server2016版本-配置时需要至少给C盘50G空间" class="headerlink" title="演示windows-server2016版本 / 配置时需要至少给C盘50G空间"></a>演示<code>windows-server2016</code>版本 / 配置时需要至少给C盘<code>50G</code>空间</h4><h3 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h3><blockquote><p><strong>因为 windows 默认不支持 virtio 驱动，而通过 openstack 管理的虚拟机是需要 virtio 驱动的，所以需要给 windows 安装驱动，包括硬盘驱动和网卡驱动另外还需要安装CloudbaseInitSetup和qemu-ga (qemu-guest-agent)</strong> <a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/</a> <strong>以上地址可下载最新稳定版的 virtio-win-x.x.xxx.iso 文件，该文件包含了硬盘驱动和网卡驱动以及</strong></p></blockquote><h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><ul><li><a href="https://www.jianshu.com/p/60caf1c2f10a">https://www.jianshu.com/p/60caf1c2f10a</a>                                                                 （简书）</li><li><a href="https://support.huaweicloud.com/usermanual-ims/zh-cn_topic_0030730602.html">https://support.huaweicloud.com/usermanual-ims/zh-cn_topic_0030730602.html</a>   （华为云 could-init使用）</li><li><a href="https://cloud.tencent.com/document/product/213/30000">https://cloud.tencent.com/document/product/213/30000</a>                                             (腾讯云  could-init配置)</li><li><a href="https://blog.51cto.com/readshlinux/1902888">https://blog.51cto.com/readshlinux/1902888</a>                                                                (51cto修改密码脚本)</li></ul><h3 id="命令参考："><a href="#命令参考：" class="headerlink" title="命令参考："></a>命令参考：</h3><ul><li><a href="http://linuxcoming.com/blog/2019/09/03/linux_basic_tools_virt_install_os_variant.html">http://linuxcoming.com/blog/2019/09/03/linux_basic_tools_virt_install_os_variant.html</a></li><li><strong>驱动无法安装参考：</strong></li><li><a href="https://zhidao.baidu.com/question/2207933972086796788.html">https://zhidao.baidu.com/question/2207933972086796788.html</a></li></ul><h4 id="安装必备软件"><a href="#安装必备软件" class="headerlink" title="安装必备软件"></a>安装必备软件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 安装必备软件</span><br><span class="line">yum install -y qemu-kvm libvirt virt-install bridge-utils</span><br></pre></td></tr></table></figure><h3 id="1-下载Cloudbase-Init工具-下载Cloudbase-Init工具安装包。"><a href="#1-下载Cloudbase-Init工具-下载Cloudbase-Init工具安装包。" class="headerlink" title="1.下载Cloudbase-Init工具  下载Cloudbase-Init工具安装包。"></a><code>1</code>.下载<code>Cloudbase-Init</code>工具  下载<code>Cloudbase-Init</code>工具安装包。</h3><p><strong>根据Windows操作系统的不同位数，您需要下载不同版本的Cloudbase-Init工具安装包。</strong></p><p><strong>Cloudbase官网：</strong></p><p><a href="https://links.jianshu.com/go?to=http://www.cloudbase.it/cloud-init-for-windows-instances/">http://www.cloudbase.it/cloud-init-for-windows-instances/</a>。</p><p><strong>Cloudbase-Init分为稳定版本和Beta版本两种。</strong> <strong>稳定版本获取路径：</strong></p><p><strong>64位：</strong></p><p><a href="https://links.jianshu.com/go?to=https://www.cloudbase.it/downloads/CloudbaseInitSetup_Stable_x64.msi">https://www.cloudbase.it/downloads/CloudbaseInitSetup_Stable_x64.msi</a><br><a href="https://cloudbase.it/downloads/CloudbaseInitSetup_0_9_11_x64.msi">https://cloudbase.it/downloads/CloudbaseInitSetup_0_9_11_x64.msi</a><br><a href="https://cloudbase.it/downloads/CloudbaseInitSetup_0_9_9_x64.msi">https://cloudbase.it/downloads/CloudbaseInitSetup_0_9_9_x64.msi</a></p><p><strong>32位：</strong></p><p><a href="https://links.jianshu.com/go?to=https://www.cloudbase.it/downloads/CloudbaseInitSetup_Stable_x86.msi">https://www.cloudbase.it/downloads/CloudbaseInitSetup_Stable_x86.msi</a></p><p><strong>Beta版本获取路径：</strong></p><p><strong>64位：</strong><a href="https://links.jianshu.com/go?to=https://www.cloudbase.it/downloads/CloudbaseInitSetup_x64.msi">https://www.cloudbase.it/downloads/CloudbaseInitSetup_x64.msi</a></p><p><strong>32位：</strong><a href="https://links.jianshu.com/go?to=https://www.cloudbase.it/downloads/CloudbaseInitSetup_x86.msi">https://www.cloudbase.it/downloads/CloudbaseInitSetup_x86.msi</a></p><p><strong>virtio-win驱动下载:</strong></p><p><strong><a href="https://links.jianshu.com/go?to=https://github.com/virtio-win/kvm-guest-drivers-windows">https://github.com/virtio-win/kvm-guest-drivers-windows</a></strong></p><p><strong>或</strong></p><p><a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/</a></p><h4 id="windows-iso镜像下载地址："><a href="#windows-iso镜像下载地址：" class="headerlink" title="windows-iso镜像下载地址："></a>windows-iso镜像下载地址：</h4><p><a href="https://msdn.itellyou.cn/">https://msdn.itellyou.cn/</a></p><hr><h4 id="首先开启vcenter-vmware虚拟化："><a href="#首先开启vcenter-vmware虚拟化：" class="headerlink" title="首先开启vcenter/vmware虚拟化："></a>首先开启vcenter/vmware虚拟化：</h4><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_c7a56db15460c4c9ec3337ba89289ef2.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_c7a56db15460c4c9ec3337ba89289ef2.png"></p><h5 id="注意事项：-目录建议根目录下创建一个新目录-不能在-root目录执行创建工作目录-会报错-权限错误"><a href="#注意事项：-目录建议根目录下创建一个新目录-不能在-root目录执行创建工作目录-会报错-权限错误" class="headerlink" title="注意事项：  目录建议根目录下创建一个新目录 不能在/root目录执行创建工作目录 会报错 权限错误"></a>注意事项：  目录建议根目录下创建一个新目录 不能在/root目录执行创建工作目录 会报错 权限错误</h5><h4 id="下载完成截图：共3软件"><a href="#下载完成截图：共3软件" class="headerlink" title="下载完成截图：共3软件"></a>下载完成截图：共<code>3</code>软件</h4><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_29087c9168c1688bc91ff2c661a017a6.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_29087c9168c1688bc91ff2c661a017a6.png"></p><h3 id="2-网卡配置（物理机-vmware-vcenter创建）"><a href="#2-网卡配置（物理机-vmware-vcenter创建）" class="headerlink" title="2. 网卡配置（物理机/ vmware / vcenter创建）"></a><code>2</code>. 网卡配置（物理机<code>/ vmware / vcenter</code>创建）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 备份网卡</span><br><span class="line">cp ifcfg-ens33 ifcfg-br0</span><br></pre></td></tr></table></figure><h5 id="修改ifcfg-ens33"><a href="#修改ifcfg-ens33" class="headerlink" title="修改ifcfg-ens33"></a>修改<code>ifcfg-ens33</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">2、BOOTPROTO=&quot;dhcp&quot; # 改为 BOOTPROTO=&quot;static&quot;</span><br><span class="line">3、BRIDGE=br0       # 调整为网桥模式 其他不做更改</span><br><span class="line"># 保留如下配置其他配置通通删除</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">BRIDGE=br0</span><br><span class="line">UUID=01d75770-3b87-47e3-bbc3-bebaed2293e3</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_6372d21fbb18fb333f61a84f13eed939.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_6372d21fbb18fb333f61a84f13eed939.png"></p><h4 id="修改ifcfg-br0"><a href="#修改ifcfg-br0" class="headerlink" title="修改ifcfg-br0"></a>修改<code>ifcfg-br0</code></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1、TYPE=&quot;Ethernet&quot;   # 修改为TYPE=&quot;Bridge&quot;</span><br><span class="line">2、BOOTPROTO=&quot;dhcp&quot;  # 改为 BOOTPROTO=&quot;static&quot;</span><br><span class="line">3、NAME=&quot;ens33&quot;      # 修改为 NAME=&quot;br0&quot;  及 DEVICE=&quot;ens33&quot;  修改为 DEVICE=&quot;br0&quot;</span><br><span class="line">4、注释 UUID         # UUID=&quot;a8d78ec6-485c-4d14-aae1-1908bc6b9a61&quot;</span><br><span class="line">5、配置静态IP</span><br><span class="line">IPADDR=10.0.0.20</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=10.0.0.220</span><br><span class="line">DNS1=223.5.5.5</span><br><span class="line"># 完整网卡配置 -------------------------------</span><br><span class="line">TYPE=Bridge</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=br0</span><br><span class="line"># UUID=01d75770-3b87-47e3-bbc3-bebaed2293e3</span><br><span class="line">DEVICE=br0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=10.0.0.20</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=10.0.0.220</span><br><span class="line">DNS1=223.5.5.5</span><br><span class="line"># 重启网卡</span><br><span class="line">systemctl restart network.service</span><br></pre></td></tr></table></figure><h4 id="如果采用（云主机）创建需要修改网卡（-强烈建议不要使用云主机可能会出现各种抽风现象-）配置-如下配置-如下："><a href="#如果采用（云主机）创建需要修改网卡（-强烈建议不要使用云主机可能会出现各种抽风现象-）配置-如下配置-如下：" class="headerlink" title="如果采用（云主机）创建需要修改网卡（ 强烈建议不要使用云主机可能会出现各种抽风现象 ）配置 如下配置 如下："></a>如果采用（云主机）创建需要修改网卡（ 强烈建议不要使用云主机可能会出现各种抽风现象 ）配置 如下配置 如下：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@images network-scripts]# cat ifcfg-br0</span><br><span class="line"># Created by cloud-init on instance boot automatically, do not edit.</span><br><span class="line">#</span><br><span class="line">BOOTPROTO=static      # 改</span><br><span class="line">DEVICE=br0            # 改</span><br><span class="line">HWADDR=fa:16:3e:90:a8:67</span><br><span class="line">MTU=1500</span><br><span class="line">ONBOOT=yes</span><br><span class="line">STARTMODE=auto</span><br><span class="line">TYPE=Bridge           # 改</span><br><span class="line">USERCTL=no            </span><br><span class="line">IPADDR=10.0.0.76      # 改</span><br><span class="line">PREFIX=24             # 改</span><br><span class="line">GATEWAY=10.0.0.1      # 改</span><br><span class="line">DNS1=223.5.5.5        # 改</span><br><span class="line">#-------------------------------------------------------------------------</span><br><span class="line">[root@images network-scripts]# cat ifcfg-eth0</span><br><span class="line"># Created by cloud-init on instance boot automatically, do not edit.</span><br><span class="line">#</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEVICE=eth0</span><br><span class="line">#HWADDR=fa:16:3e:90:a8:67     # 改</span><br><span class="line">MTU=1500</span><br><span class="line">ONBOOT=yes</span><br><span class="line">STARTMODE=auto</span><br><span class="line">TYPE=Ethernet                 # 改</span><br><span class="line">USERCTL=no</span><br><span class="line">BRIDGE=br0                    # 改</span><br></pre></td></tr></table></figure><h4 id="3-查看是否支持虚拟化-（支持）"><a href="#3-查看是否支持虚拟化-（支持）" class="headerlink" title="3. 查看是否支持虚拟化 （支持）"></a><code>3</code>. 查看是否支持虚拟化 （支持）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看是否支持虚拟化</span><br><span class="line">grep -E &#x27;(vmx|svm)&#x27; /proc/cpuinfo</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_a37f9f1aa2fc3773a217aed3042a7fdf.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_a37f9f1aa2fc3773a217aed3042a7fdf.png"></p><h3 id="4-创建镜像文件包"><a href="#4-创建镜像文件包" class="headerlink" title="4. 创建镜像文件包"></a><code>4</code>. 创建镜像文件包</h3><p><strong>文件存放目录必须为根目录下新建一个目录 切记不能在</strong><code>root</code>目录否则会报错</p><h4 id="各个目录存放文件概览："><a href="#各个目录存放文件概览：" class="headerlink" title="各个目录存放文件概览："></a>各个目录存放文件概览：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 关于文件存放目录必须为根目录下新建一个目录 此处如下：</span><br><span class="line">mkdir -p /data/windows/data</span><br><span class="line">mkdir -p /data/windows/CloudbaseInitSetup</span><br><span class="line"></span><br><span class="line"># /data/windows目录存放：</span><br><span class="line">[root@cpe-172-100-70-251 windows]# ls -lh</span><br><span class="line">总用量 101M</span><br><span class="line">-rw-r--r--. 1 root root 101M 3月  22 13:52 CloudbaseInitSetup.iso</span><br><span class="line">drwxr-xr-x. 2 root root  124 3月  22 13:49 data</span><br><span class="line">-rw-r--r--. 1 root root 193K 3月  22 13:51 windows_server_2016_x64.qcow2</span><br><span class="line"></span><br><span class="line">#/data/windows/data</span><br><span class="line">[root@cpe-172-100-70-251 data]# ll</span><br><span class="line">总用量 6801916</span><br><span class="line">-rw-r--r--. 1 qemu qemu 6302720000 3月  22 10:43 cn_windows_server_2016_vl_x64_dvd_11636695.iso</span><br><span class="line">-rw-r--r--. 1 qemu qemu  534818816 3月  22 09:18 virtio-win-0.1.229.iso</span><br><span class="line"></span><br><span class="line"># /data/windows/CloudbaseInitSetup目录存放 </span><br><span class="line">-rw-r--r--. 1 root root 40M 3月  20 2017 CloudbaseInitSetup_0_9_11_x64.msi   （本教程使用版本）</span><br><span class="line">-rw-r--r--. 1 qemu qemu 61M 3月  22 09:18 CloudbaseInitSetup_1_1_4_x64.msi   （稳定版）</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="执行创建镜像文件包："><a href="#执行创建镜像文件包：" class="headerlink" title="执行创建镜像文件包："></a>执行创建镜像文件包：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 创建镜像文件包 ：/data/windows/ 目录执行</span><br><span class="line">qemu-img create -f qcow2 windows_server_2016_x64.qcow2 50G</span><br><span class="line"># 将CloudbaseInitSetup_1_1_4_x64.msi 配置放在CloudbaseInitSetup.iso中 （执行目录：/data/windows/）</span><br><span class="line">note: 此步骤不执行通过vnc细化配置时将无法找到win2k16目录下网卡驱动</span><br><span class="line"># 基于目录CloudbaseInitSetup制作iso镜像命名为CloudbaseInitSetup.iso</span><br><span class="line">mkisofs -o CloudbaseInitSetup.iso CloudbaseInitSetup/       </span><br><span class="line"># 查看镜像文件包</span><br><span class="line">qemu-img  info  windows_server_2016_x64.qcow2</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_57235b7e44eacb3280aa8ad3117a09f1.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_57235b7e44eacb3280aa8ad3117a09f1.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_6594c419f60291d68cc7c6093c655a86.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_6594c419f60291d68cc7c6093c655a86.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_8dc76fd0808704d1163b1a63b168b02d.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_8dc76fd0808704d1163b1a63b168b02d.png"></p><h3 id="创建镜像虚拟机"><a href="#创建镜像虚拟机" class="headerlink" title="创建镜像虚拟机"></a>创建镜像虚拟机</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"># 参数</span><br><span class="line">--name windows_server_2016_x64                     #系统命名</span><br><span class="line">--ram 4096 \                                       #内存大默认M</span><br><span class="line">--vcpu=4 \                                         #CPU核数</span><br><span class="line">--os-type=windows \                                 #系统类型</span><br><span class="line">--os-variant=win2k16 \                             #系统版本</span><br><span class="line">--disk windows_server_2016_x64.qcow2,bus=virtio \  #创建系统盘镜像   格式qcow2  总成</span><br><span class="line"> # windows ISO镜像路径 类型为CDROM sata盘</span><br><span class="line">--disk path=/data/cn_windows_server_2016_x64_dvd_9327743.iso,device=cdrom,bus=sata \   </span><br><span class="line"> # windows 驱动 ISO镜像 路径 类型</span><br><span class="line">--disk path=/data/virtio-win-0.1.190.iso,device=cdrom,bus=sata \             </span><br><span class="line">--bridge=br0,model=virtio \                        #网络桥接模式</span><br><span class="line">--graphics vnc,listen=0.0.0.0 \                    #vnc </span><br><span class="line">--noautoconsole</span><br><span class="line"># 云主机创建</span><br><span class="line"># --(需要至少60G空间)--------------------------------------------------------------------------------------------</span><br><span class="line"># 执行创建windows镜像 (windows2016)</span><br><span class="line"># workstdtion / 云主机 创建方式均可采用 （方式1）</span><br><span class="line">virt-install --connect qemu:///system --name windows_server_2016_x64 --vcpus=2 --memory 1024 --os-type=windows --os-variant=win2k16 \</span><br><span class="line">--disk windows_server_2016_x64.qcow2,bus=virtio --disk size=50 \</span><br><span class="line">--disk path=./data/cn_windows_server_2016_x64_dvd_9718765.iso,device=cdrom,size=5   \</span><br><span class="line">--disk path=./data/virtio-win-0.1.229.iso,device=cdrom,bus=sata \</span><br><span class="line">--bridge=br0,model=virtio --graphics vnc,listen=0.0.0.0 --noautoconsole  --check all=off</span><br><span class="line"></span><br><span class="line"># 云主机 创建（参考）（方式2）</span><br><span class="line">sudo virt-install --connect qemu:///system --name windows_server_2016_x64 --vcpus=2 --memory 1024 --os-type=windows --os-variant=win2k16 \</span><br><span class="line">--disk windows_server_2016_x64.qcow2,bus=virtio --disk size=50 \</span><br><span class="line">--disk path=./data/cn_windows_server_2016_x64_dvd_9718765.iso,device=cdrom,size=5  \</span><br><span class="line">--disk path=./data/virtio-win-0.1.229.iso,device=cdrom,bus=sata \</span><br><span class="line">--network network=default,model=virtio --graphics vnc,listen=0.0.0.0 --noautoconsole </span><br><span class="line"># -----------------------------------------------------------------------------------------------------------</span><br><span class="line"># vsphere创建</span><br><span class="line"># -----------------------------------------------------------------------------------------------------------</span><br><span class="line"># windows2016新增驱动（本教程执行命令）</span><br><span class="line">参数：bus=stat &gt;&gt; bus=ide</span><br><span class="line">virt-install --connect qemu:///system --name windows_server_2016_x64 --vcpus=2 --memory 2048 --os-type=windows --os-variant=win2k16 \</span><br><span class="line">--disk windows_server_2016_x64.qcow2,bus=virtio --disk size=50 \</span><br><span class="line">--disk path=./data/cn_windows_server_2016_vl_x64_dvd_11636695.iso,device=cdrom,size=5,bus=ide  \</span><br><span class="line">--disk path=./data/virtio-win-0.1.229.iso,device=cdrom,bus=ide \</span><br><span class="line">--disk path=./CloudbaseInitSetup.iso,device=cdrom,bus=ide \   # 新增驱动</span><br><span class="line">--bridge=br0,model=virtio --graphics vnc,listen=0.0.0.0 --noautoconsole  --check all=off  </span><br><span class="line"></span><br><span class="line"># windows2012r2</span><br><span class="line">qemu-img create -f qcow2 windows_server_2012r2_x64.qcow2 30G</span><br><span class="line"></span><br><span class="line">mkisofs -o CloudbaseInitSetup.iso CloudbaseInitSetup/  </span><br><span class="line"></span><br><span class="line">virt-install --connect qemu:///system --name windows_server_2012r2_x64 --vcpus=2 --memory 4096 --os-type=windows --os-variant=win2k12r2 \</span><br><span class="line">--disk windows_server_2012r2_x64.qcow2,bus=virtio --disk size=30 \</span><br><span class="line">--disk path=./data/cn_windows_server_2012_r2_vl_x64_dvd_2979220.iso,device=cdrom,size=5,bus=ide  \</span><br><span class="line">--disk path=./data/virtio-win-0.1.229.iso,device=cdrom,bus=ide \</span><br><span class="line">--disk path=./CloudbaseInitSetup.iso,device=cdrom,bus=ide --bridge=br0,model=virtio --graphics vnc,listen=0.0.0.0 --noautoconsole  --check all=off  </span><br><span class="line"></span><br><span class="line"># windows2019</span><br><span class="line">virt-install --connect qemu:///system --name windows_server_2019_x64 --vcpus=2 --memory 2048 --os-type=windows --os-variant=win2k19 \</span><br><span class="line">--disk windows_server_2019_x64.qcow2,bus=virtio --disk size=50 \</span><br><span class="line">--disk path=./data/cn_windows_server_2019_x64_dvd_4de40f33.iso,device=cdrom,size=5,bus=ide  \</span><br><span class="line">--disk path=./data/virtio-win-0.1.229.iso,device=cdrom,bus=ide \</span><br><span class="line">--disk path=./CloudbaseInitSetup.iso,device=cdrom,bus=ide \</span><br><span class="line">--bridge=br0,model=virtio --graphics vnc,listen=0.0.0.0 --noautoconsole  --check all=off </span><br><span class="line"></span><br><span class="line"># -----------------------------------------------------------------------------------------------------------</span><br><span class="line"># 查看刚通过镜像启动的虚拟机虚拟机 / 查看--os-variant支持的类型</span><br><span class="line">virsh list --all       # 列出所有虚机</span><br><span class="line">osinfo-query os        # 查看支持的类型</span><br><span class="line">virsh shutdown ubuntu  # 正常关闭虚拟机</span><br><span class="line">virsh undefine name    # 删除虚机</span><br><span class="line">virsh start name       # 启动指定虚机</span><br><span class="line">virsh reboot name      # 重启指定虚机</span><br><span class="line"></span><br><span class="line">[root@localhost windows]# osinfo-query os</span><br><span class="line"> Short ID             | Name                                               | Version  | ID                            </span><br><span class="line">----------------------+----------------------------------------------------+----------+---</span><br><span class="line"> alpinelinux3.5       | Alpine Linux 3.5                                   | 3.5      |  </span><br><span class="line"> alpinelinux3.6       | Alpine Linux 3.6                                   | 3.6      | </span><br><span class="line"> alpinelinux3.7       | Alpine Linux 3.7                                   | 3.7      | </span><br><span class="line"> alpinelinux3.8       | Alpine Linux 3.8                                   | 3.8      | </span><br><span class="line"> alt.p8               | ALT p8 StarterKits                                 | p8       | </span><br><span class="line"> alt.p9               | ALT p9 StarterKits                                 | p9       |</span><br></pre></td></tr></table></figure><h5 id="参考：-1"><a href="#参考：-1" class="headerlink" title="参考："></a>参考：</h5><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_66220ca6a8e52c12bfe4526cba82dbb3.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_66220ca6a8e52c12bfe4526cba82dbb3.png"></p><h4 id="出现下方回显则说明windows镜像创建成功："><a href="#出现下方回显则说明windows镜像创建成功：" class="headerlink" title="出现下方回显则说明windows镜像创建成功："></a>出现下方回显则说明windows镜像创建成功：</h4><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_d46cb89118adb196c752bfeefb854b09.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_d46cb89118adb196c752bfeefb854b09.png"></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_49e8c464d4892bd3ca53f4cc2a3e94d9.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_49e8c464d4892bd3ca53f4cc2a3e94d9.png"></p><h3 id="5-virt-install常用命令："><a href="#5-virt-install常用命令：" class="headerlink" title="5. virt-install常用命令："></a><code>5. virt-install</code>常用命令：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># 查看刚通过镜像启动的虚拟机虚拟机 / 查看--os-variant支持的类型</span><br><span class="line">virsh list             # 列出正在运行的虚拟机</span><br><span class="line">osinfo-query os        # 查看支持的类型</span><br><span class="line"># virt-install常用命令</span><br><span class="line">virsh list --all       # 列出所有虚机</span><br><span class="line">virsh start  web01     # 启动指定虚机</span><br><span class="line">virsh reboot web01     # 重启指定虚机（关闭状态无法重启）</span><br><span class="line">virsh console name     # 连接虚拟机</span><br><span class="line">virsh destroy name     # 拔掉电源（很少用）</span><br><span class="line"></span><br><span class="line">virsh undefine web01   # 删除虚机文件即删除虚拟机（不会删除磁盘文件）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">virsh domblklist web01             # 查看虚拟机磁盘信息</span><br><span class="line">virsh dominfo    web01             # 查看虚拟机配置信息</span><br><span class="line">virsh domiflist  web01             # 查看虚拟网卡信息</span><br><span class="line">virsh dumpxml    web01             # 以 xml格式查看虚拟机</span><br><span class="line">virsh define     file-name         # 导入虚拟机</span><br><span class="line">virsh edit       name              # 编辑虚拟机配置（一般是在刚定义完虚拟机之后）自带语法检测</span><br><span class="line">virsh domrename  old-name  new-name   # 虚拟机重命名</span><br><span class="line">virsh vncdisplay web01                # 查看vnc端口</span><br><span class="line">virsh autostart  name                 # 虚拟机随机重启</span><br><span class="line">virsh autostart --disable name        # 取消虚拟机随机重启</span><br><span class="line"></span><br><span class="line"># 图形界面：</span><br><span class="line">通过执行名virt-manager，启动libvirt的图形界面，在图形界面下可以一步一步的创建虚拟机，管理虚拟机，还可以直接控制虚拟机的桌面。</span><br><span class="line"># 命令行：</span><br><span class="line">virsh list                              # 显示本地活动虚拟机</span><br><span class="line">virsh list –all                         # 显示本地所有的虚拟机（活动的+不活动的）</span><br><span class="line">virsh define ubuntu.xml                 # 通过配置文件定义一个虚拟机（这个虚拟机还不是活动的）</span><br><span class="line">virsh start ubuntu                      # 启动名字为ubuntu的非活动虚拟机</span><br><span class="line">virsh create ubuntu.xml                 # 创建虚拟机（创建后，虚拟机立即执行，成为活动主机）</span><br><span class="line">virsh suspend ubuntu                    # 暂停虚拟机</span><br><span class="line">virsh resume ubuntu                     # 启动暂停的虚拟机</span><br><span class="line">virsh shutdown web01          # 正常关闭虚拟机</span><br><span class="line">virsh destroy ubuntu          # 强制拔掉电源关闭虚拟机（很少使用）</span><br><span class="line"></span><br><span class="line">virsh domname 2                         # 显示id号为2的虚拟机名                      </span><br><span class="line">virsh domid ubuntu                      # 显示虚拟机id号                     </span><br><span class="line">virsh domuuid ubuntu                    # 显示虚拟机的uuid   </span><br><span class="line">virsh domstate ubuntu                   # 显示虚拟机的当前状态  </span><br><span class="line">virsh dumpxml ubuntu                    # 显示虚拟机的当前配置文件（可能和定义虚拟机时的配置不同，因为当虚拟机启动时，需要给# 虚拟机分配id号、uuid、vnc端口号等等）  </span><br><span class="line">virsh setmem ubuntu 512000              # 给不活动虚拟机设置内存大小  </span><br><span class="line">virsh setvcpus ubuntu 4                 # 给不活动虚拟机设置cpu个数  </span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="配置snat使镜像可以访问internet-在宿主机执行"><a href="#配置snat使镜像可以访问internet-在宿主机执行" class="headerlink" title="配置snat使镜像可以访问internet( 在宿主机执行 )"></a>配置<code>snat</code>使镜像可以访问<code>internet</code>( 在宿主机执行 )</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 开启</span><br><span class="line">--参数：</span><br><span class="line">-s 172.100.70.241           # 镜像ip  （或 其他虚拟机）</span><br><span class="line">--to-source 172.100.70.251  # 宿主机ip（或 本虚拟机）</span><br><span class="line">sysctl net.ipv4.ip_forward=1</span><br><span class="line">sysctl -p</span><br><span class="line">iptables -t nat -A POSTROUTING -s 172.100.70.241  -j SNAT --to-source 172.100.70.251</span><br></pre></td></tr></table></figure><h2 id="二-vnc细化配置-qemu-img-见下章"><a href="#二-vnc细化配置-qemu-img-见下章" class="headerlink" title="二. vnc细化配置 qemu-img ( 见下章 )"></a>二. <code>vnc</code>细化配置 <code>qemu-img</code> ( 见下章 )</h2><h4 id="qemu-img命令参考："><a href="#qemu-img命令参考：" class="headerlink" title="qemu-img命令参考："></a><code>qemu-img</code>命令参考：</h4><p><a href="https://zhuanlan.zhihu.com/p/623104229">https://zhuanlan.zhihu.com/p/623104229</a></p><p><a href="https://support.huaweicloud.com/bestpractice-ims/ims_bp_0030.html">https://support.huaweicloud.com/bestpractice-ims/ims_bp_0030.html</a></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_e552b52db5a6700f7e86be4d1ee01215.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_e552b52db5a6700f7e86be4d1ee01215.png"></p><h4 id="11-配置完成后处理镜像（压缩镜像）"><a href="#11-配置完成后处理镜像（压缩镜像）" class="headerlink" title="11.配置完成后处理镜像（压缩镜像）"></a><code>11</code>.配置完成后处理镜像（压缩镜像）</h4><h3 id="参考：-2"><a href="#参考：-2" class="headerlink" title="参考："></a>参考：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 参数</span><br><span class="line">-c，表示必须压缩目标镜像（仅限qcow格式）。</span><br><span class="line">-f，第一种镜像格式。</span><br><span class="line">-o, options：选项，是以逗号分隔的格式特定选项列表，格式为name=value格式。使用“-o？”有关使用的格式支持的选项的概述，或参阅下面的格式说明了解详细信息。</span><br><span class="line">++++++++++++++++++++++++++++++++++</span><br><span class="line">#--sparse=always稀疏拷贝，忽略全0数据</span><br><span class="line">cp --sparse=always ws2012r2.qcow2 ws2012r2-new.qcow2 #--sparse=always稀疏拷贝，忽略全0数据</span><br><span class="line"># raw和qcow2需要转换，这里原本用的qcow2，所以未转换。</span><br><span class="line"># 案例：</span><br><span class="line">qemu-img convert -c -f raw -O qcow2 centos7-new.raw centos7-new.qcow2</span><br><span class="line">qemu-img convert -c -O qcow2 centos7-new.qcow2 centos7-mini.qcow2</span><br><span class="line"># 实际操作</span><br><span class="line">qemu-img convert -c -O qcow2 windows_server_2016_x64_new.qcow2 windows_server_2016_x64_min.qcow2</span><br><span class="line">++++++++++++++++++++++++++++++++++</span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_ea53daa63d24ff564cde1f936d3d4e0f.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_ea53daa63d24ff564cde1f936d3d4e0f.png"></p><h4 id="实际操作"><a href="#实际操作" class="headerlink" title="实际操作:"></a>实际操作:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># raw和qcow2需要转换，这里原本用的qcow2，所以未转换。</span><br><span class="line"># 案例：</span><br><span class="line">qemu-img convert -c -f raw -O qcow2 centos7-new.raw centos7-new.qcow2</span><br><span class="line">qemu-img convert -c -f qcow2 -o  raw centos7-new.qcow2 centos7-mini.raw</span><br><span class="line"># 实际操作</span><br><span class="line">qemu-img convert -c -f raw -O qcow2 windows_server_2016_x64_new.raw windows_server_2016_x64_min.qcow2</span><br></pre></td></tr></table></figure><h4 id="上传到openstack—skyline"><a href="#上传到openstack—skyline" class="headerlink" title="上传到openstack—skyline:"></a>上传到<code>openstack—skyline</code>:</h4><p><strong>参数：</strong><code>--property os_distro=windows --property os_version=2012 --property os_admin_user=Administrator</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># qcm2格式</span><br><span class="line">openstack image create --disk-format qcow2 --public --property hw_qemu_guest_agent=yes --property os_distro=windows --property os_version=2012 --property os_admin_user=Administrator --file  windows_server_2016_x64.qcow2 windows_server_2016_x64.qcow2</span><br><span class="line"># raw格式</span><br><span class="line">openstack image create --disk-format raw --public --property hw_qemu_guest_agent=yes --property os_distro=windows --property os_version=2012 --property os_admin_user=Administrator --file windows_server_2019_x64.raw windows_server_2019_x64.raw </span><br></pre></td></tr></table></figure><h4 id="使用命令行创建云主机："><a href="#使用命令行创建云主机：" class="headerlink" title="使用命令行创建云主机："></a>使用命令行创建云主机：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 此命令必须要先将镜像上传到openstack</span><br><span class="line">openstack server create --config-drive true --image windows2016min.qcow2 --flavor 9 --password ******20! --network demo-net windows2016_test</span><br></pre></td></tr></table></figure><h4 id="注：-此时配置完成-集成可修改密码"><a href="#注：-此时配置完成-集成可修改密码" class="headerlink" title="注： 此时配置完成  集成可修改密码"></a>注： 此时配置完成  集成可修改密码</h4><h4 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h4><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_d0e78dd049d08305a4192234429c341d.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_d0e78dd049d08305a4192234429c341d.png"></p><h4 id="扩展：-旧面板-windows-重置密码"><a href="#扩展：-旧面板-windows-重置密码" class="headerlink" title="扩展： 旧面板 windows 重置密码:"></a>扩展： 旧面板 windows 重置密码:</h4><p>更新云主机元数据，添加<code>change_passwd=True</code>, 软重启云主机。重启完之后，虚机密码为 <code>admin_pass</code> 指定的密码。密码重置后再将元数据 <code>change_passwd</code> 删掉，或者改为其他值</p><p><strong>添加后 &gt;&gt; 软重启   ||  软重启之后 &gt;&gt; 删除change_passwd=True    此时密码变为创建云主机时设置的密码即</strong><code>****023!</code>。</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_65022b246096b0295461a22397c72313.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_65022b246096b0295461a22397c72313.png"></p><p><strong>教程结束。</strong></p>]]></content>
      
      
      <categories>
          
          <category> openstack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openstack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>赞助墙</title>
      <link href="/2024/02/01/%E8%B5%9E%E5%8A%A9%E5%A2%99/"/>
      <url>/2024/02/01/%E8%B5%9E%E5%8A%A9%E5%A2%99/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>网站建设与维护实属不易，如果我的文章帮助到了您，或者您想支持我的网站，可以扫描下方二维码进行赞助（赞助时请备注自己的 化名/昵称 ，打赏后将在此页面展示），非常感谢您的支持~ 🌹</p></blockquote><h2 id="赞助墙🌹"><a href="#赞助墙🌹" class="headerlink" title="赞助墙🌹"></a>赞助墙🌹</h2><p>打赏方式  微信  支付宝🌙 </p><div class="gallery">    <div class="fj-gallery  data" data-rowheight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://wn-apple-teawine.fun/img/wechatpayqr.webp","alt":"微信"},{"url":"https://wn-apple-teawine.fun/img/alipayqr.webp","alt":"支付宝"}]</span>    </div>    <button class="gallery-load-more"><span>Load More</span><i class="fa-solid fa-arrow-down"></i></button>    </div><table><thead><tr><th>ZzNnWn.</th><th>晒在深海里.</th><th>粘人的鸭嘴兽</th></tr></thead><tbody><tr><td>￥100</td><td>￥50</td><td>￥1000</td></tr><tr><td></td><td></td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简历</title>
      <link href="/2024/02/01/%E7%AE%80%E5%8E%86/"/>
      <url>/2024/02/01/%E7%AE%80%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="简历"><a href="#简历" class="headerlink" title="简历"></a>简历</h2><h4 id="基本信息-教育背景-求职意向"><a href="#基本信息-教育背景-求职意向" class="headerlink" title="基本信息 教育背景 求职意向"></a><strong>基本信息</strong> <strong>教育背景</strong> <strong>求职意向</strong></h4><p>姓名：<br>邮箱：<a href="mailto:&#56;&#x37;&#x38;&#56;&#x39;&#x31;&#x36;&#x31;&#x31;&#64;&#x71;&#x71;&#46;&#99;&#x6f;&#109;">&#56;&#x37;&#x38;&#56;&#x39;&#x31;&#x36;&#x31;&#x31;&#64;&#x71;&#x71;&#46;&#99;&#x6f;&#109;</a><br>证书：阿里云ACP<br>期望薪资：15k<br>岗位：云计算工程师</p><h4 id="专业技能概览"><a href="#专业技能概览" class="headerlink" title="专业技能概览"></a><strong>专业技能概览</strong></h4><p>· 精通各类<strong>linux</strong>系统各项配置性能调优安全优化<strong>shell</strong>脚本操作系统包括但不限于<strong>（ubuntu centos debain 华为欧拉 阿里龙蜥</strong>等）<br>· 精通云计算<strong>iaas paas</strong>层<br>· 精通ceph分布式存储,<br>· 精通openstack集群 nova cinder neutoen glance的运维<br>· 精通grafana开源日志监控<strong>loki</strong><br>· 精通云迁移技术<strong>DTS SMC OSS迁移（阿里云）</strong><br>· 精通冷迁移技术<strong>V2V Qemu-img dd  disk2vhd</strong>等 （使用于任何适配的平台）<br>· 精通<strong>ansible</strong>自动化运维工具<br>· 精通<strong>docker docker-compose Dockerfile。</strong><br>· 精通各种开源时序数据库<strong>influxdb promethus-tsdb</strong>等<br>· 精通各种监控系统<strong>prometheus zabbix telegraf nightingale cacti smartping uptime-Kuma</strong>等<br>· 精通各种关系数据库<strong>mysql postgreSQL mariadb</strong>掌握<strong>Mysql</strong>以及<strong>mariadb</strong>数据库安全策略如（密码安全 登录安全 审计等）<br>· 精通<strong>keepalived+nginx</strong>高可用.掌握<strong>mysql</strong>主从复制 <strong>redis</strong>集群。<br>· 精通部署<strong>openstack</strong>云平台 <strong>管理OpenStack云平台，包括虚拟机实例、网络和存储资源的配置。</strong><br>· 精通<strong>Ceph分布式存储系统，负责Ceph集群的部署、监控和性能调优。</strong><br>· 精通<strong>tcp udp http https snmp ftp vrrp</strong>等各种协议<br>· 精通<strong>nginx</strong> 负载均衡，动静分离，反向代理 熟练掌握开源<strong>openvpn l2tp frp</strong>技术<br>· 精通<strong>nas</strong>存储多副本<strong>cephfs</strong>（单副本<strong>NFS iscsi</strong>） 对象存储 负载均衡 <strong>nat</strong>网关** rds** 等<br>· 精通使用<strong>kubeadm</strong>部署<strong>k8s</strong>以及实现与<strong>ceph</strong>集成（StorageClass）<br>· 熟练掌握<strong>python</strong>脚本（网络爬虫方向）。</p><h4 id="工作经验1"><a href="#工作经验1" class="headerlink" title="工作经验1"></a><strong>工作经验1</strong></h4><p>公司经营范围：主要经营物联网产品 软件开发等</p><h4 id="项目经验："><a href="#项目经验：" class="headerlink" title="项目经验："></a><strong>项目经验：</strong></h4><p>2020.11——2021.04<br>· 维护设计及部署苏州市国家电网各套系统如隧道子系统 精益化管控平台等。<br>2021.04——2021.05<br>· 部署维护优化公司边缘计算箱产品，编写<strong>dockerfile</strong>制作一键启动私有化镜像 并实地测试其功能。<br>2021.05——2021.07<br>· 设计部署公司<strong>vmware vcenter esxi</strong> 私有云平台<br>· 搭建<strong>openvpn</strong>实现企业员工在家访问公司内网<br>· 对需要暴露外网没有<strong>外网IP</strong>的<strong>web</strong>服务做内网穿透。<br>· 对<strong>vcenter</strong>其中一台虚拟机配置外网IP对外服务<br>2021.07——2022.02<br>· 日常维护<strong>mysql</strong>数据库 公司各套系统如禅道 精益化管控平台 <strong>nacos</strong>  虚拟化平台<strong>vcenter</strong>等<br>· 检查系统运行情况排错等<br>· 编写运维技术文档<br>· 利用<strong>ansible</strong>给多台服务器配置环境，编写剧本部署程序环境等。</p><h4 id="工作经验2"><a href="#工作经验2" class="headerlink" title="工作经验2"></a><strong>工作经验2</strong></h4><p><strong>公司介绍：</strong></p><p>华中地区最大的分布式云服务商 阿里云华中地区最大代理商 公司有自己的云计算平台MSC-Stack对外帮助上千家客户上云 对上千家企业提供服务 客户包括小米 华为 英伟达 斗鱼 字节跳动等<br><strong>主要产品：</strong></p><p><strong>MSC-Stack：</strong>基于openstack与ceph分布式存储开发的一套云计算平台。<br>K8s 堡垒机 主机入侵 云主机负载均衡器 nat网关等功能 目前拥有武汉 福州 北京 成都 四节点。<br>原生OpenStack部分：一套openstack n版外网环境 一套openstack zed版内网环境。</p><h4 id="项目经验"><a href="#项目经验" class="headerlink" title="项目经验"></a><strong>项目经验</strong></h4><p><strong>原生OpenStack，MCS-Stack与ceph云计算部分</strong><br>2022.05——2022.06<br>· 部署公司<strong>openstac-zed</strong>版本系统 后端存储采用<strong>ceph</strong>分布式存储 编写<strong>shell</strong>脚本部署九州云开源前端skyline（openstack-ui）<strong>阶段：<br><strong>调研:</strong>  openstack与ceph版本适配 测试搭配情况。<br><strong>制作镜像：</strong>制作</strong>openstack<strong>所需镜像 先搭建</strong>all-in-one<strong>环境</strong>openstack<strong>与</strong>ceph<strong>再制作其镜像 并推送到公司内网harbor镜像平台。<br><strong>搭建：</strong>最后搭建集群版</strong>openstack**<br>· 部署完成后 mariadb passwd等数据备份<br>· 云主机安装docker无法访问外网设置MTU解决<br>· <strong>cephadm</strong>的方式部署后端<strong>ceph</strong>集群。**<br>2023.05—2023.06<br>· 计算节点故障时恢复云主机<br>· 删除云主机卡死，卡在deleting状态<br>2022.07—2022.08<br>· 云盘手动扩容<br>· cinder 云盘无法删除<br>· windows云主机设置密码永不过期<br>· 制作openstack云上使用的镜像（linux(ubuntu16.04-22.04) centos(7.4-8.3) rocky9.2  debain11 windows server 2012r2 —2019）<br>2023.08—2023.08<br>· openstack集群缩减计算节点。</p><p><strong>云计算-云迁移部分</strong><br>2023.06-2023.07<br>· 使用<strong>v2v</strong>，将客户<strong>vmware</strong>数台虚拟机迁移到<strong>MCS-Stack</strong>云平台包括<strong>Linux</strong>与<strong>windows</strong>。<br>· 使用<strong>disk2vhd</strong>技术将客户<strong>OpenStack</strong>云平台<strong>windows server</strong>迁移到<strong>MCS-Stack</strong>云平台。<br>2023.09-2023.09<br>· 阿里云龙蜥镜像ECS，使用<strong>qemu-img</strong>冷迁移技术迁移到<strong>MCS-Stack</strong>云平台 并修改脚本适配<strong>could-init</strong><br>· 客户华为云八台centos7.9，云资源迁移到<strong>MCS-Stack</strong>云平台 使用<strong>qemu-img</strong>冷迁移技术 并安装cloud-init等适配<strong>MCS-Stack</strong>云平台<br>2023.10-2023.11<br>· 将某客户国科云多台centos及rds,ubuntu阿里云<strong>DTS SMC 热</strong>迁移等方式 迁移到阿里云。<br>· 使用共享镜像方式将某客户<strong>A</strong>账号ECS资源迁移到<strong>B</strong>账户及将客户oss迁移到B账号</p><p><strong>客户服务下方为部分例子(2022.04——至今)</strong><br>· 解决rds产品<strong>sql-mode</strong>报错，部署<strong>mysql</strong>主从，部署<strong>redis</strong>集群<br>· 部署<strong>nginx+keepalived</strong>高可用实现一个外网IP两服务器公用 以及一个内网VIP两服务器公用<br>· 客户在mcs-stack上云主机<strong>遭遇xmrig挖矿病毒 pnscan病毒</strong>攻击解决。<br>· 云主机使用lvm卷使数据盘扩容到系统盘后进入<strong>grub rescue</strong>救援模式解决等。<br>· 解决客户使用docker构建nacos遇到的一系列问题包括数据持久化 使用外部数据库等。</p><p><strong>脚本部分</strong><br>· 编写shell脚本监控后端<strong>ceph</strong>集群健康状况（openstack 集成了prometheus实时监控ceph集群状况）。        （告警推送到钉钉），编写清空zabbix表shell脚本。<br>· 编写<strong>zabbix</strong>告警脚本  （企业微信告警），编写lvm自动扩容脚本（人机交互）。<br>· 编写编译安装nginx keepalivedmysql redis，<br>· 监控vcenter exsi python脚本 告警推送到钉钉<br>· 编写部署openstack初始化脚本 以及<strong>all-in-one</strong>环境一键部署openstack脚本<br>· 编写一键清理ceph集群以及一键安装ceph集群脚本，二次开发kalla-ansible集成公司前端面板。<br>· 编写监控oracle python脚本 对某大神的项目二次开发 增加python脚本oracle监控项目<br>· 编写冷迁移v2v半自动迁移脚本，<br>· 编写适用于centos ubuntu 的服务器初始化脚本包括自己设置时区 源 limit docker pip等<br>· 编写mysql pg数据库自动备份脚本，编写ansible剧本实现skyline与openstack集成</p><p><strong>监控部分</strong><br>2022.04-2022.05<br>· 按客户需求设计部署监控某医院七台服务器<strong>telegraf+prometheus+grafana</strong>的方式监控<strong>linux各项指标</strong><br>· <strong>搭建采用telegraf+prometheus架构</strong>监控交换机等数通设备 （后期性能不足替换为zabbix）。<br>· 搭建zabbix监控公司<strong>上百台交换机</strong>实现交换机各种监控不限于（进出口流量 cpu 内存 温度等）搭配脚本实现告警推送到企业微信。<br>2022.07-2022.08<br>· 搭建<strong>telegraf+influxdb+grafana</strong>监控<strong>某客户代运维vcenter</strong>项目 实现对整个集群的监控 包括每一台虚拟机 每一台exsi宿主机 完全满足业务需求 <strong>该vmware项目包含500多台虚拟机</strong>十个<strong>esxi</strong>节点。<br>· 构建<strong>telegraf+influxdb+python</strong>脚本+<strong>grafana</strong>监控<strong>某客户代运维vcenter</strong>项目中五台<strong>oracle</strong>数据库（此项目为对某大神项目二次开发  修改<strong>python</strong>脚本制作<strong>telegraf-py</strong>版镜像实现对<strong>oracle</strong>完全监控）。<br>2023.07-2023.07<br>· 编译<strong>nginx-module-vts</strong>模块进<strong>nginx</strong>使用<strong>prometheus+grafana</strong>实现对<strong>nginx</strong>的监控，部署<strong>uptime-Kuma</strong>监控公司各套系统<br>· 部署<strong>grafana</strong>开源<strong>loki</strong>监控公司各台物理服务器系统日志。</p><p><strong>代运维客户及公司内部系统部署及维护部分（2023.07-至今）</strong><br>· 使用<strong>vercel函数计算</strong>搭建公司<strong>chagpt问答系统实现</strong>跨境访问<strong>openai chatgpt</strong>服务。<br>· 部署<strong>k8s与ceph</strong>集成（<strong>storeglass</strong>）。<br>· 部署<strong>wiki</strong>公司内部知识库系统<br>· 部署<strong>cacti</strong>监控交换机平台<br>· <strong>smartping</strong> 监控网络状况系统并制作<strong>smartping docker</strong>镜像实现快捷部署。<br>· 部署<strong>webstack</strong>网站导航系统。<br>· <strong>ferry万能</strong>工单系统。<br>· <strong>cloudreve</strong>公司云盘系统。<br>· 调研<strong>kanboard</strong>与<strong>禅道</strong>项目管理系统 <strong>因kanboard功能多样但前端简陋</strong>最终选型使用<strong>禅道系统</strong>。<br>· 部署公司<strong>esxi集群使用vcenter</strong>管理平台控制。<br>· 培训公司各种运维人员，研发部署云箱维护<br>· 集群<strong>cronsun</strong>定时任务管理系统，<strong>bitwarden</strong>密码管理平台。<br>· 帮助某云平台客户将<strong>nacos</strong>制作成为镜像实现<strong>docker</strong>一键快捷部署实现数据持久化<br>· 日常维护openstack集群  维护后端存储ceph集群<br>例： 云主机 无法删除 前端卡死 ，10 pgs not deep-scrubbed in time，ceph集群容量告警 osd换盘更换<br>· 公司云平台上千家客户云资源的日常运维服务制作云上环境使用的各种<strong>windows</strong>系统<strong>linux</strong>系统的镜像<br>· 搭建某客户nginx+keepalived高可用 实现主挂<strong>外网IP</strong>及<strong>内网VIP</strong>自动切换到备服务器（该项目只有一个外网IP）<br>· 搭建某客户<strong>mysql</strong>主从复制项目后期替换为<strong>MariaDB Galera****Cluster</strong>实现主备自动切换。</p><h4 id="其他-自有项目"><a href="#其他-自有项目" class="headerlink" title="其他/自有项目"></a>其他/自有项目</h4><p>· 两站点个人博客系统 （编写技术博客180余篇 加上onenote累计三十万字）<br>· <strong>Discuss Twikoo</strong>评论系统<br><strong>OneManager</strong> 网盘管理系统（所有网盘通过此<strong>web</strong>管理<strong>onedrive</strong> 阿里云盘等实现不限格式任意可共享）<br>· <strong>Blazeb2</strong>图床管理系统兼容<strong>s3</strong>协议。<br>· 搭建NextChat访问openai  ChatGpt服务<br>NOTE：上述各种系统均采用<strong>cloudns</strong>提供域名 <strong>cloudfare</strong>提供域名解析及<strong>CDN</strong>缓存等 除博客外其余系统均使用<strong>vercel</strong>函数计算（faas）部署。</p><h4 id="自我评价-兴趣爱好"><a href="#自我评价-兴趣爱好" class="headerlink" title="自我评价/兴趣爱好"></a>自我评价/兴趣爱好</h4><p>自我评价<br>· 强执行力（执行的意愿+执行的能力）<br>· 强学习力（对新技术的渴望+刻苦的钻研精神）<br>· 较强的团队合作意识、乐于并善于分享。<br>兴趣爱好<br>· 篮球 足球 羽毛球 散步 登山 等各种运动及对技术有浓厚的兴趣爱好瞎折腾 。<br>· 热爱中国古诗词文化 及明代历史。</p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用vercel及docker构建chatgpt-nex-web实现国内访问</title>
      <link href="/2024/01/31/%E4%BD%BF%E7%94%A8vercel%E5%8F%8Adocker%E6%9E%84%E5%BB%BAchatgpt-nex-web%E5%AE%9E%E7%8E%B0%E5%9B%BD%E5%86%85%E8%AE%BF%E9%97%AE/"/>
      <url>/2024/01/31/%E4%BD%BF%E7%94%A8vercel%E5%8F%8Adocker%E6%9E%84%E5%BB%BAchatgpt-nex-web%E5%AE%9E%E7%8E%B0%E5%9B%BD%E5%86%85%E8%AE%BF%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="使用vercel及docker构建chatgpt-nex-web实现国内访问"><a href="#使用vercel及docker构建chatgpt-nex-web实现国内访问" class="headerlink" title="使用vercel及docker构建chatgpt-nex-web实现国内访问"></a>使用vercel及docker构建chatgpt-nex-web实现国内访问</h2><p>概览：</p><ul><li>需要在某宝购买openai-key</li><li>可购买直连key或中转key 如果购买的为中转key则需要填写中转服务地址</li><li><a href="https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web">chatgpt-nex-web项目地址</a> 先fork到自己仓库</li><li><a href="https://vercel.com/new/clone?repository-url=https://github.com/Yidadaa/ChatGPT-Next-Web&env=OPENAI_API_KEY&env=CODE&env=GOOGLE_API_KEY&project-name=chatgpt-next-web&repository-name=ChatGPT-Next-Web">vercel部署地址</a></li></ul><p>其他类似开源项目：</p><ul><li><a href="https://lobehub.com/zh/docs/self-hosting/platform/vercel">Lobe Chat</a></li><li><a href="https://github.com/lobehub/lobe-chat">lobe chat代码仓库</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzkzODY1MTQzOQ==&mid=2247483908&idx=1&sn=b2080d845ce5f0bc0c62373876763fa9&chksm=c2fdb844f58a3152a8164dd750c28d213fbd10d27ab83afd4af88e6105e054935e8c1f095f7d&mpshare=1&scene=24&srcid=050689k9Z1fsXTKMRvZ99D8j&sharer_shareinfo=7581c54658eeb1539b7febee12f3c196&sharer_shareinfo_first=7581c54658eeb1539b7febee12f3c196#rd">lobe Chat部署教程</a></li></ul><h4 id="一-构建"><a href="#一-构建" class="headerlink" title="一. 构建"></a>一. 构建</h4><p>添加如下环境变量即可</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CODE: passwd</span><br><span class="line">BASE<span class="emphasis">_URL: https://chatapi<span class="strong">***</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">OPENAI_API_KEY: sk-wD6Ha8FsvZfbpH7AD53**</span><span class="strong">****</span><span class="strong">****</span>*</span></span><br></pre></td></tr></table></figure><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_c4148f2652bb4fe1369077b9bafea30c.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_c4148f2652bb4fe1369077b9bafea30c.png"></p><p>此时构建完成。</p><h4 id="二-docker部署"><a href="#二-docker部署" class="headerlink" title="二. docker部署"></a>二. docker部署</h4><p>镜像可选</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yidadaa/chatgpt-next-web</span><br><span class="line">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:chatgpt-next-web-v2.11.3</span><br></pre></td></tr></table></figure><p>docker-compose部署</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">chatgpt-next-web:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">yidadaa/chatgpt-next-web</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">chatgpt-next-web_container</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3001:3000&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">OPENAI_API_KEY=sk-En7SyGK0zljZWKlT98836aD3B2Dc420c900021D943Ac41F4</span> <span class="comment"># oneapi key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CODE=Jkl123456</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PROXY_URL=http://192.168.31.163:3002</span>   <span class="comment"># oneapi地址</span></span><br></pre></td></tr></table></figure><h4 id="三-使用"><a href="#三-使用" class="headerlink" title="三. 使用"></a>三. 使用</h4><ul><li><p>若key额度不够则需要充值, 其他key使用此平台访问chatgpt需要如下操作</p></li><li><p>直连key直接填写后即可使用 自定义接口处 接口地址保留默认“/api/openai”</p></li><li><p>中转key则自定义接口处 接口地址需要填写中转服务地址</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_6f3a9535578411a50e84c4b23940099b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/2/image_6f3a9535578411a50e84c4b23940099b.png"></p></li></ul><p>lobechat效果</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_83095fcea8d81d4ab7cfba1b69f2bd33.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/5/image_83095fcea8d81d4ab7cfba1b69f2bd33.png"></p><p>建议使用cloudfare给vercel绑定域名访问。</p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>公有云私有云对象桶信息配置</title>
      <link href="/2024/01/29/%E5%85%AC%E6%9C%89%E4%BA%91%E7%A7%81%E6%9C%89%E4%BA%91%E5%AF%B9%E8%B1%A1%E6%A1%B6%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE/"/>
      <url>/2024/01/29/%E5%85%AC%E6%9C%89%E4%BA%91%E7%A7%81%E6%9C%89%E4%BA%91%E5%AF%B9%E8%B1%A1%E6%A1%B6%E4%BF%A1%E6%81%AF%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="公有云私有云对象桶信息配置"><a href="#公有云私有云对象桶信息配置" class="headerlink" title="公有云私有云对象桶信息配置"></a>公有云私有云对象桶信息配置</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>公有云与私有云配置对象桶信息是有差异的</p><h3 id="一-公有云-阿里云为例"><a href="#一-公有云-阿里云为例" class="headerlink" title="一. 公有云-阿里云为例"></a>一. 公有云-阿里云为例</h3><p>使用软件<strong>s3cmd</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装s3cmd</span></span><br><span class="line">yum install -y epel-release &amp;&amp; yum install -y s3cmd</span><br><span class="line"><span class="comment"># 安装qemu</span></span><br><span class="line">yum install qemu-kvm libvirt virt-install bridge-utils  -y</span><br></pre></td></tr></table></figure><p>其他安装方式（ubuntu）</p><p><a href="https://developer.aliyun.com/article/356106">https://developer.aliyun.com/article/356106</a><br><a href="https://www.s3express.com/download.htm">https://www.s3express.com/download.htm</a>    （s3软件下载链接）</p><p>简介：<br><a href="https://wangyan.org/blog/s3cmd-how-to-use.html">https://wangyan.org/blog/s3cmd-how-to-use.html</a></p><p>s3cmd 安装使用指南<br>s3cmd 是一款 Amazon S3 命令行工具。它不仅能上传、下载、同步，还能设置权限，下面是完整的安装使用指南。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">一、安装方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法一：（Debian/Ubuntu ）</span></span><br><span class="line"><span class="string">wget</span> <span class="string">-O-</span> <span class="string">-q</span> <span class="string">http://s3tools.org/repo/deb-all/stable/s3tools.key</span> <span class="string">|</span> <span class="string">sudo</span> <span class="string">apt-key</span> <span class="string">add</span> <span class="bullet">-</span></span><br><span class="line"><span class="string">wget</span> <span class="string">-O/etc/apt/sources.list.d/s3tools.list</span> <span class="string">http://s3tools.org/repo/deb-all/stable/s3tools.list</span></span><br><span class="line"><span class="string">apt-get</span> <span class="string">update</span> <span class="string">&amp;&amp;</span> <span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">s3cmd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二：</span></span><br><span class="line"><span class="string">wget</span> <span class="string">http://nchc.dl.sourceforge.net/project/s3tools/s3cmd/1.0.0/s3cmd-1.0.0.tar.gz</span></span><br><span class="line"><span class="string">tar</span> <span class="string">-zxf</span> <span class="string">s3cmd-1.0.0.tar.gz</span> <span class="string">-C</span> <span class="string">/usr/local/</span></span><br><span class="line"><span class="string">mv</span> <span class="string">/usr/local/s3cmd-1.0.0/</span> <span class="string">/usr/local/s3cmd/</span></span><br><span class="line"><span class="string">ln</span> <span class="string">-s</span> <span class="string">/usr/local/s3cmd/s3cmd</span> <span class="string">/usr/bin/s3cmd</span></span><br></pre></td></tr></table></figure><p>阿里云配置如下</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_896f06a76b5634cec9f24ce6f7ec5119.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_896f06a76b5634cec9f24ce6f7ec5119.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化s3cmd</span></span><br><span class="line">s3cmd --configure</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行</span></span><br><span class="line">[root@3z6to251zh02kg system]# s3cmd --configure</span><br><span class="line"></span><br><span class="line">Enter new values or accept defaults in brackets with Enter.</span><br><span class="line">Refer to user manual for detailed description of all options.</span><br><span class="line"></span><br><span class="line">Access key and Secret key are your identifiers for Amazon S3. Leave them empty for using the env variables.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Access Key: LTAI5t9</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Secret Key: XD0f6iyM0nY8oUJZz</span></span><br><span class="line">Default Region [US]:  # hangzhou</span><br><span class="line"></span><br><span class="line">Use &quot;s3.amazonaws.com&quot; for S3 Endpoint and not modify it to the target Amazon S3.</span><br><span class="line">S3 Endpoint [s3.amazonaws.com]: # oss-cn-hangzhou.aliyuncs.com （buckets域名在阿里云oss概览中查看）</span><br><span class="line"></span><br><span class="line">Use &quot;%(bucket)s.s3.amazonaws.com&quot; to the target Amazon S3. &quot;%(bucket)s&quot; and &quot;%(location)s&quot; vars can be used</span><br><span class="line">if the target S3 system supports dns based buckets.</span><br><span class="line">DNS-style bucket+hostname:port template for accessing a bucket [%(bucket)s.s3.amazonaws.com]: # %(bucket)s.oss-cn-hangzhou.aliyuncs.com</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">%(bucket)s.oss-cn-hangzhou.aliyuncs.com</span></span><br><span class="line">Encryption password is used to protect your files from reading</span><br><span class="line">by unauthorized persons while in transfer to S3</span><br><span class="line">Encryption password: </span><br><span class="line">Path to GPG program [/bin/gpg]: </span><br><span class="line"></span><br><span class="line">When using secure HTTPS protocol all communication with Amazon S3</span><br><span class="line">servers is protected from 3rd party eavesdropping. This method is</span><br><span class="line">slower than plain HTTP, and can only be proxied with Python 2.7 or newer</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use HTTPS protocol [Yes]: Yes</span></span><br><span class="line"></span><br><span class="line">On some networks all internet access must go through a HTTP proxy.</span><br><span class="line">Try setting it here if you can&#x27;t connect to S3 directly</span><br><span class="line">HTTP Proxy server name: </span><br><span class="line"></span><br><span class="line">New settings:</span><br><span class="line">  Access Key: LTAI5t9EwR</span><br><span class="line">  Secret Key: XD0f6iyM0nJZz1</span><br><span class="line">  Default Region: hangzhou</span><br><span class="line">  S3 Endpoint: oss-cn-hangzhou.aliyuncs.com</span><br><span class="line">  DNS-style bucket+hostname:port template for accessing a bucket: %(bucket)s.oss-cn-hangzhou.aliyuncs.com</span><br><span class="line">  Encryption password: </span><br><span class="line">  Path to GPG program: /bin/gpg</span><br><span class="line">  Use HTTPS protocol: True</span><br><span class="line">  HTTP Proxy server name: </span><br><span class="line">  HTTP Proxy server port: 0</span><br><span class="line"></span><br><span class="line">Test access with supplied credentials? [Y/n] y</span><br><span class="line">Please wait, attempting to list all buckets...</span><br><span class="line">Success. Your access key and secret key worked fine :-)</span><br><span class="line"></span><br><span class="line">Now verifying that encryption works...</span><br><span class="line">Not configured. Never mind.</span><br><span class="line"></span><br><span class="line">Save settings? [y/N] y</span><br><span class="line">Configuration saved to &#x27;/root/.s3cfg&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时设置完成</span></span><br></pre></td></tr></table></figure><p>客户端连接软件配置</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_69abbafcc46e7ce35928521f13a67e58.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_69abbafcc46e7ce35928521f13a67e58.png"></p><p>此时即可访问阿里云对象存储。</p><h3 id="二-私有云-某云配置"><a href="#二-私有云-某云配置" class="headerlink" title="二. 私有云 某云配置"></a>二. 私有云 某云配置</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 创建buckets报错：原因版本不一致 需要将v2启用</span></span><br><span class="line">解决：</span><br><span class="line">vim /root/.s3cfg</span><br><span class="line">signature<span class="emphasis">_v2 = True </span></span><br><span class="line"><span class="emphasis"># 或新建文件输入：</span></span><br><span class="line"><span class="emphasis">vim ~/.s3cfg</span></span><br><span class="line"><span class="emphasis">[default]</span></span><br><span class="line"><span class="emphasis">access_</span>key = 914c4</span><br><span class="line">secret<span class="emphasis">_key = qk45WMQg5VP4MBeAYE</span></span><br><span class="line"><span class="emphasis">host_</span>base = http://111.111.87.99:7480</span><br><span class="line">host<span class="emphasis">_bucket = http://111.111.87.99:7480/914c48814</span></span><br><span class="line"><span class="emphasis">use_</span>https = False</span><br><span class="line">signature<span class="emphasis">_v2 = True </span></span><br></pre></td></tr></table></figure><h3 id="三-扩展s3cmd命令使用"><a href="#三-扩展s3cmd命令使用" class="headerlink" title="三. 扩展s3cmd命令使用"></a>三. 扩展<code>s3cmd</code>命令使用</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 命令使用</span></span><br><span class="line"><span class="section">#创建bucket名称为s3://cem-demo</span></span><br><span class="line">s3cmd -h                                            # 查看命令详情</span><br><span class="line">s3cmd put /etc/fstab  s3://s3cmd-demo/fstab-demo    # 上传文件将/etc目录下文件fstab上传</span><br><span class="line">s3cmd ls s3://ceph-s3-bucket                        # 查看bucket里面有什么查看具体内容后面接目录</span><br><span class="line">s3cmd put /etc s3://ceph-s3-bucket/fstab-demo/etc/ --recursive # 上传目录（递归的方式记得&quot;/&quot;）</span><br><span class="line">s3cmd get s3://ceph-s3-bucket/s3browser-6-4-1.rar              # 下载命令</span><br><span class="line"></span><br><span class="line">s3cmd rm s3://ceph-s3-bucket/fstab-demo                        # 删除文件命令</span><br><span class="line">s3cmd rm s3://ceph-s3-bucket/fstab-demo/ --recursive           # 删除目录命令</span><br><span class="line">s3cmd mb s3://cmd-demo                                         # 创建目录</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos设置登陆密码验证错误自动锁定</title>
      <link href="/2024/01/28/centos%E8%AE%BE%E7%BD%AE%E7%99%BB%E9%99%86%E5%AF%86%E7%A0%81%E9%AA%8C%E8%AF%81%E9%94%99%E8%AF%AF%E8%87%AA%E5%8A%A8%E9%94%81%E5%AE%9A/"/>
      <url>/2024/01/28/centos%E8%AE%BE%E7%BD%AE%E7%99%BB%E9%99%86%E5%AF%86%E7%A0%81%E9%AA%8C%E8%AF%81%E9%94%99%E8%AF%AF%E8%87%AA%E5%8A%A8%E9%94%81%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>centos设置登陆密码验证错误自动锁定</strong></p><p>参考：</p><p><a href="https://blog.csdn.net/weixin_43822878/article/details/93018223">Linux限制远程登录尝试密码次数及锁定时间_linux ssh连接5次封ip1小时-CSDN博客</a></p><p>CentOS中有一个pam_tally2.so的PAM模块，来限定用户的登录失败次数，如果次数达到设置的阈值，则锁定用户。</p><h3 id="一-system-auth设置登陆错误锁定（本教程使用此优化配置）"><a href="#一-system-auth设置登陆错误锁定（本教程使用此优化配置）" class="headerlink" title="一. system-auth设置登陆错误锁定（本教程使用此优化配置）"></a>一. system-auth设置登陆错误锁定（本教程使用此优化配置）</h3><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_7a31d3176074dee91ac4da1d3a07e168.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_7a31d3176074dee91ac4da1d3a07e168.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/pam.d/system-auth</span><br><span class="line"><span class="comment"># 配置如下</span></span><br><span class="line"><span class="comment">#%PAM-1.0</span></span><br><span class="line"><span class="comment"># This file is auto-generated.</span></span><br><span class="line"><span class="comment"># User changes will be destroyed the next time authconfig is run.</span></span><br><span class="line">auth       required       pam_tally2.so    deny=3    unlock_time=10 even_deny_root root_unlock_time=10</span><br><span class="line">auth        required      pam_env.so</span><br><span class="line">auth        required      pam_faildelay.so delay=2000000</span><br><span class="line">auth        sufficient    pam_unix.so nullok try_first_pass</span><br><span class="line">auth        requisite     pam_succeed_if.so uid &gt;= 1000 quiet_success</span><br><span class="line">auth        required      pam_deny.so</span><br><span class="line"></span><br><span class="line">account     required      pam_unix.so</span><br><span class="line">account     sufficient    pam_localuser.so</span><br><span class="line">account     sufficient    pam_succeed_if.so uid &lt; 1000 quiet</span><br><span class="line">account     required      pam_permit.so</span><br><span class="line"></span><br><span class="line">password    requisite     pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=</span><br><span class="line">password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok</span><br><span class="line">password    required      pam_deny.so</span><br><span class="line"></span><br><span class="line">session     optional      pam_keyinit.so revoke</span><br><span class="line">session     required      pam_limits.so</span><br><span class="line">-session     optional      pam_systemd.so</span><br><span class="line">session     [success=1 default=ignore] pam_succeed_if.so service <span class="keyword">in</span> crond quiet use_uid</span><br><span class="line">session     required      pam_unix.so</span><br></pre></td></tr></table></figure><p>参数解释：</p><p>添加参数介绍：设置密码尝试错误三次，普通用户和root用户都进行锁定，普通用户锁定10秒，root用户锁定10秒</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth       required       pam_tally2.so    deny=3    unlock_time=10 even_deny_root root_unlock_time=10</span><br></pre></td></tr></table></figure><h3 id="二-下方为其他配置项内容"><a href="#二-下方为其他配置项内容" class="headerlink" title="二. 下方为其他配置项内容"></a>二. 下方为其他配置项内容</h3><h4 id="1、编译PAM的配置文件"><a href="#1、编译PAM的配置文件" class="headerlink" title="1、编译PAM的配置文件"></a>1、编译PAM的配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~ ]<span class="comment"># vim /etc/pam.d/login</span></span><br><span class="line"><span class="comment">#%PAM-1.0</span></span><br><span class="line">auth    required    pam_tally2.so    deny=3    unlock_time=100 even_deny_root root_unlock_time=200</span><br><span class="line">auth [user_unknown=ignore success=ok ignore=ignore default=bad] pam_securetty.so</span><br><span class="line">auth       substack     system-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line">account    required     pam_nologin.so</span><br><span class="line">account    include      system-auth</span><br><span class="line">password   include      system-auth</span><br><span class="line"><span class="comment"># pam_selinux.so close should be the first session rule</span></span><br><span class="line">session    required     pam_selinux.so close</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line">session    optional     pam_console.so</span><br><span class="line"><span class="comment"># pam_selinux.so open should only be followed by sessions to be executed in the user context</span></span><br><span class="line">session    required     pam_selinux.so open</span><br><span class="line">session    required     pam_namespace.so</span><br><span class="line">session    optional     pam_keyinit.so force revoke</span><br><span class="line">session    include      system-auth</span><br><span class="line">session    include      postlogin</span><br><span class="line">-session   optional     pam_ck_connector.so</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>各参数介绍：</p><blockquote><p>even_deny_root     也限制root用户；<br>deny                      设置普通用户和root用户连续错误登陆的最大次数，超过最大次数，则锁定该用户<br>unlock_time          设定普通用户锁定后，多少时间后解锁，单位是秒；<br>root_unlock_time  设定root用户锁定后，多少时间后解锁，单位是秒；<br>此处使用的是 pam_tally2 模块，如果不支持 pam_tally2 可以使用 pam_tally 模块。另外，不同的pam版本，设置可能有所不同，具体使用方法，可以参照相关模块的使用规则。</p></blockquote><p>在#%PAM-1.0的下面，即第二行，添加内容，一定要写在前面，如果写在后面，虽然用户被锁定，但是只要用户输入正确的密码，还是可以登录的！</p><p>添加参数介绍：设置密码尝试错误三次，普通用户和root用户都进行锁定，普通用户锁定100秒，root用户锁定200秒</p><p><strong>/etc/pam.d/login</strong> —最终配置图：</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_b79029648b226f7ff2cca46a85548223.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_b79029648b226f7ff2cca46a85548223.png"></p><h4 id="2、这个只是限制了用户从tty登录，而没有限制远程登录，如果想限制远程登录，需要改sshd文件"><a href="#2、这个只是限制了用户从tty登录，而没有限制远程登录，如果想限制远程登录，需要改sshd文件" class="headerlink" title="2、这个只是限制了用户从tty登录，而没有限制远程登录，如果想限制远程登录，需要改sshd文件"></a>2、这个只是限制了用户从tty登录，而没有限制远程登录，如果想限制远程登录，需要改sshd文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~ ]<span class="comment"># vim /etc/pam.d/sshd</span></span><br><span class="line"><span class="comment">#%PAM-1.0</span></span><br><span class="line">auth    required    pam_tally2.so    deny=3    unlock_time=100 even_deny_root root_unlock_time=200</span><br><span class="line">auth       required     pam_sepermit.so</span><br><span class="line">auth       substack     password-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line"><span class="comment"># Used with polkit to reauthorize users in remote sessions</span></span><br><span class="line">-auth      optional     pam_reauthorize.so prepare</span><br><span class="line">account    required     pam_nologin.so</span><br><span class="line">account    include      password-auth</span><br><span class="line">password   include      password-auth</span><br><span class="line"><span class="comment"># pam_selinux.so close should be the first session rule</span></span><br><span class="line">session    required     pam_selinux.so close</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line"><span class="comment"># pam_selinux.so open should only be followed by sessions to be executed in the user context</span></span><br><span class="line">session    required     pam_selinux.so open env_params</span><br><span class="line">session    required     pam_namespace.so</span><br><span class="line">session    optional     pam_keyinit.so force revoke</span><br><span class="line">session    include      password-auth</span><br><span class="line">session    include      postlogin</span><br><span class="line"><span class="comment"># Used with polkit to reauthorize users in remote sessions</span></span><br><span class="line">-session   optional     pam_reauthorize.so prepare</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>同样是增加在第2行！</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_5dbaaaaf8233e87db4cc63de60cab88b.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_5dbaaaaf8233e87db4cc63de60cab88b.png"></p><p>查看用户登录失败的次数:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~ ]<span class="comment"># pam_tally2 --user</span></span><br><span class="line">Login           Failures Latest failure     From</span><br><span class="line">aihuidi             6    06/20/19 10:11:07  192.168.200.186    在186这个ip上有个普通用户aihuidi登录失败</span><br></pre></td></tr></table></figure><p>解锁指定用户:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~ ]<span class="comment"># pam_tally2 -r -u aihuidi    解锁aihuidi用户</span></span><br><span class="line">Login           Failures Latest failure     From</span><br><span class="line">aihuidi             6    06/20/19 10:11:07  192.168.200.186</span><br><span class="line">[root@node2 ~ ]<span class="comment"># pam_tally2 --user     在进行查看用户登录失败次数</span></span><br><span class="line">[root@node2 ~ ]<span class="comment"># </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ps：这个远程ssh的时候，输入密码错误超过三次但是没有提示，我用的是Xshell，不知道其它终端有没有提示，但是只要超过设定的值，输入正确的密码也是登陆不了的！，还是要等到设定的时间在重新尝试输入正确密码进行登录认证</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo小猫咪与漫画导航</title>
      <link href="/2024/01/26/hexo%E5%B0%8F%E7%8C%AB%E5%92%AA%E4%B8%8E%E6%BC%AB%E7%94%BB%E5%AF%BC%E8%88%AA/"/>
      <url>/2024/01/26/hexo%E5%B0%8F%E7%8C%AB%E5%92%AA%E4%B8%8E%E6%BC%AB%E7%94%BB%E5%AF%BC%E8%88%AA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="hexo小猫咪与漫画导航"><a href="#hexo小猫咪与漫画导航" class="headerlink" title="hexo小猫咪与漫画导航"></a>hexo小猫咪与漫画导航</h4><p>详见：<a href="https://tzy1997.com/articles/hexo1613/">请收下这只可爱的猫咪吧</a><br>详见：<a href="https://www.fomal.cc/posts/5389e93f.html">漫画导航</a></p><h3 id="一-小猫咪"><a href="#一-小猫咪" class="headerlink" title="一. 小猫咪"></a>一. 小猫咪</h3><p>制作一个盛放内容的盒子，在<code>[BlogRoot]/node_modules/hexo-theme-butterfly/layout/includes/head.pug</code>(如果是<code>git clone</code> 安装在<code>[BlogRoot]/themes/butterfly/layout/includes/head.pug</code>)最后一行加入如下代码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">#myscoll</span></span><br></pre></td></tr></table></figure><p>其实随便放在哪里都行，只要能加载出来就行</p><p>在<code>[BlogRoot]/node_modules/hexo-theme-butterfly/source/js</code>文件夹下新建一个<code>cat.js</code>，将以下代码复制到文件中。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span> &gt; <span class="number">992</span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getBasicInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">/* 窗口高度 */</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">ViewH</span> = $(<span class="variable language_">window</span>).<span class="title function_">height</span>();</span><br><span class="line">        <span class="comment">/* document高度 */</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">DocH</span> = $(<span class="string">&quot;body&quot;</span>)[<span class="number">0</span>].<span class="property">scrollHeight</span>;</span><br><span class="line">        <span class="comment">/* 滚动的高度 */</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">ScrollTop</span> = $(<span class="variable language_">window</span>).<span class="title function_">scrollTop</span>();</span><br><span class="line">        <span class="comment">/* 可滚动的高度 */</span></span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">S_V</span> = <span class="title class_">DocH</span> - <span class="title class_">ViewH</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Band</span>_H = <span class="title class_">ScrollTop</span> / (<span class="title class_">DocH</span> - <span class="title class_">ViewH</span>) * <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="title class_">ViewH</span>: <span class="title class_">ViewH</span>,</span><br><span class="line">            <span class="title class_">DocH</span>: <span class="title class_">DocH</span>,</span><br><span class="line">            <span class="title class_">ScrollTop</span>: <span class="title class_">ScrollTop</span>,</span><br><span class="line">            <span class="title class_">Band</span><span class="attr">_H</span>: <span class="title class_">Band</span>_H,</span><br><span class="line">            <span class="attr">S_V</span>: <span class="variable constant_">S_V</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">show</span>(<span class="params">basicInfo</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (basicInfo.<span class="property">ScrollTop</span> &gt; <span class="number">0.001</span>) &#123;</span><br><span class="line">            $(<span class="string">&quot;.neko&quot;</span>).<span class="title function_">css</span>(<span class="string">&#x27;display&#x27;</span>, <span class="string">&#x27;block&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $(<span class="string">&quot;.neko&quot;</span>).<span class="title function_">css</span>(<span class="string">&#x27;display&#x27;</span>, <span class="string">&#x27;none&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    (<span class="keyword">function</span> (<span class="params">$</span>) &#123;</span><br><span class="line">        $.fn.<span class="property">nekoScroll</span> = <span class="keyword">function</span> (<span class="params">option</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> defaultSetting = &#123;</span><br><span class="line">                <span class="attr">top</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">                <span class="attr">scroWidth</span>: <span class="number">6</span> + <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">                <span class="attr">z_index</span>: <span class="number">9999</span>,</span><br><span class="line">                <span class="attr">zoom</span>: <span class="number">0.9</span>,</span><br><span class="line">                <span class="attr">borderRadius</span>: <span class="number">5</span> + <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">                <span class="attr">right</span>: <span class="number">60</span> + <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">                <span class="comment">// 这里可以换为你喜欢的图片，例如我就换为了雪人，但是要抠图</span></span><br><span class="line">                <span class="attr">nekoImg</span>: <span class="string">&quot;https://bu.dusays.com/2022/07/20/62d812db74be9.png&quot;</span>,</span><br><span class="line">                <span class="attr">hoverMsg</span>: <span class="string">&quot;喵喵喵~&quot;</span>,</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&quot;#6f42c1&quot;</span>,</span><br><span class="line">                <span class="attr">during</span>: <span class="number">500</span>,</span><br><span class="line">                <span class="attr">blog_body</span>: <span class="string">&quot;body&quot;</span>,</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">var</span> setting = $.<span class="title function_">extend</span>(defaultSetting, option);</span><br><span class="line">            <span class="keyword">var</span> getThis = <span class="variable language_">this</span>.<span class="title function_">prop</span>(<span class="string">&quot;className&quot;</span>) !== <span class="string">&quot;&quot;</span> ? <span class="string">&quot;.&quot;</span> + <span class="variable language_">this</span>.<span class="title function_">prop</span>(<span class="string">&quot;className&quot;</span>) : <span class="variable language_">this</span>.<span class="title function_">prop</span>(<span class="string">&quot;id&quot;</span>) !== <span class="string">&quot;&quot;</span> ? <span class="string">&quot;#&quot;</span> +</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">prop</span>(<span class="string">&quot;id&quot;</span>) : <span class="variable language_">this</span>.<span class="title function_">prop</span>(<span class="string">&quot;nodeName&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> ($(<span class="string">&quot;.neko&quot;</span>).<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">after</span>(<span class="string">&quot;&lt;div class=\&quot;neko\&quot; id=&quot;</span> + setting.<span class="property">nekoname</span> + <span class="string">&quot; data-msg=\&quot;&quot;</span> + setting.<span class="property">hoverMsg</span> + <span class="string">&quot;\&quot;&gt;&lt;/div&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> basicInfo = <span class="title function_">getBasicInfo</span>();</span><br><span class="line">            $(getThis)</span><br><span class="line">                .<span class="title function_">css</span>(&#123;</span><br><span class="line">                    <span class="string">&#x27;position&#x27;</span>: <span class="string">&#x27;fixed&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;width&#x27;</span>: setting.<span class="property">scroWidth</span>,</span><br><span class="line">                    <span class="string">&#x27;top&#x27;</span>: setting.<span class="property">top</span>,</span><br><span class="line">                    <span class="string">&#x27;height&#x27;</span>: basicInfo.<span class="property">Band_H</span> * setting.<span class="property">zoom</span> * basicInfo.<span class="property">ViewH</span> * <span class="number">0.01</span> + <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;z-index&#x27;</span>: setting.<span class="property">z_index</span>,</span><br><span class="line">                    <span class="string">&#x27;background-color&#x27;</span>: setting.<span class="property">bgcolor</span>,</span><br><span class="line">                    <span class="string">&quot;border-radius&quot;</span>: setting.<span class="property">borderRadius</span>,</span><br><span class="line">                    <span class="string">&#x27;right&#x27;</span>: setting.<span class="property">right</span>,</span><br><span class="line">                    <span class="string">&#x27;background-image&#x27;</span>: <span class="string">&#x27;url(&#x27;</span> + setting.<span class="property">scImg</span> + <span class="string">&#x27;)&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;background-image&#x27;</span>: <span class="string">&#x27;-webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent)&#x27;</span>, <span class="string">&#x27;border-radius&#x27;</span>: <span class="string">&#x27;2em&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;background-size&#x27;</span>: <span class="string">&#x27;contain&#x27;</span></span><br><span class="line">                &#125;);</span><br><span class="line">            $(<span class="string">&quot;#&quot;</span> + setting.<span class="property">nekoname</span>)</span><br><span class="line">                .<span class="title function_">css</span>(&#123;</span><br><span class="line">                    <span class="string">&#x27;position&#x27;</span>: <span class="string">&#x27;fixed&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;top&#x27;</span>: basicInfo.<span class="property">Band_H</span> * setting.<span class="property">zoom</span> * basicInfo.<span class="property">ViewH</span> * <span class="number">0.01</span> - <span class="number">50</span> + <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;z-index&#x27;</span>: setting.<span class="property">z_index</span> * <span class="number">10</span>,</span><br><span class="line">                    <span class="string">&#x27;right&#x27;</span>: setting.<span class="property">right</span>,</span><br><span class="line">                    <span class="string">&#x27;background-image&#x27;</span>: <span class="string">&#x27;url(&#x27;</span> + setting.<span class="property">nekoImg</span> + <span class="string">&#x27;)&#x27;</span>,</span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="title function_">show</span>(<span class="title function_">getBasicInfo</span>());</span><br><span class="line">            $(<span class="variable language_">window</span>)</span><br><span class="line">                .<span class="title function_">scroll</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">let</span> basicInfo = <span class="title function_">getBasicInfo</span>();</span><br><span class="line">                    <span class="title function_">show</span>(basicInfo);</span><br><span class="line">                    $(getThis)</span><br><span class="line">                        .<span class="title function_">css</span>(&#123;</span><br><span class="line">                            <span class="string">&#x27;position&#x27;</span>: <span class="string">&#x27;fixed&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;width&#x27;</span>: setting.<span class="property">scroWidth</span>,</span><br><span class="line">                            <span class="string">&#x27;top&#x27;</span>: setting.<span class="property">top</span>,</span><br><span class="line">                            <span class="string">&#x27;height&#x27;</span>: basicInfo.<span class="property">Band_H</span> * setting.<span class="property">zoom</span> * basicInfo.<span class="property">ViewH</span> * <span class="number">0.01</span> + <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;z-index&#x27;</span>: setting.<span class="property">z_index</span>,</span><br><span class="line">                            <span class="string">&#x27;background-color&#x27;</span>: setting.<span class="property">bgcolor</span>,</span><br><span class="line">                            <span class="string">&quot;border-radius&quot;</span>: setting.<span class="property">borderRadius</span>,</span><br><span class="line">                            <span class="string">&#x27;right&#x27;</span>: setting.<span class="property">right</span>,</span><br><span class="line">                            <span class="string">&#x27;background-image&#x27;</span>: <span class="string">&#x27;url(&#x27;</span> + setting.<span class="property">scImg</span> + <span class="string">&#x27;)&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;background-image&#x27;</span>: <span class="string">&#x27;-webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent)&#x27;</span>, <span class="string">&#x27;border-radius&#x27;</span>: <span class="string">&#x27;2em&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;background-size&#x27;</span>: <span class="string">&#x27;contain&#x27;</span></span><br><span class="line">                        &#125;);</span><br><span class="line">                    $(<span class="string">&quot;#&quot;</span> + setting.<span class="property">nekoname</span>)</span><br><span class="line">                        .<span class="title function_">css</span>(&#123;</span><br><span class="line">                            <span class="string">&#x27;position&#x27;</span>: <span class="string">&#x27;fixed&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;top&#x27;</span>: basicInfo.<span class="property">Band_H</span> * setting.<span class="property">zoom</span> * basicInfo.<span class="property">ViewH</span> * <span class="number">0.01</span> - <span class="number">50</span> + <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;z-index&#x27;</span>: setting.<span class="property">z_index</span> * <span class="number">10</span>,</span><br><span class="line">                            <span class="string">&#x27;right&#x27;</span>: setting.<span class="property">right</span>,</span><br><span class="line">                            <span class="string">&#x27;background-image&#x27;</span>: <span class="string">&#x27;url(&#x27;</span> + setting.<span class="property">nekoImg</span> + <span class="string">&#x27;)&#x27;</span>,</span><br><span class="line">                        &#125;);</span><br><span class="line">                    <span class="keyword">if</span> (basicInfo.<span class="property">ScrollTop</span> == basicInfo.<span class="property">S_V</span>) &#123;</span><br><span class="line">                        $(<span class="string">&quot;#&quot;</span> + setting.<span class="property">nekoname</span>)</span><br><span class="line">                            .<span class="title function_">addClass</span>(<span class="string">&quot;showMsg&quot;</span>)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        $(<span class="string">&quot;#&quot;</span> + setting.<span class="property">nekoname</span>)</span><br><span class="line">                            .<span class="title function_">removeClass</span>(<span class="string">&quot;showMsg&quot;</span>);</span><br><span class="line">                        $(<span class="string">&quot;#&quot;</span> + setting.<span class="property">nekoname</span>)</span><br><span class="line">                            .<span class="title function_">attr</span>(<span class="string">&quot;data-msg&quot;</span>, setting.<span class="property">hoverMsg</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">                btf.<span class="title function_">scrollToDest</span>(<span class="number">0</span>, <span class="number">500</span>)</span><br><span class="line">            &#125;);</span><br><span class="line">            $(<span class="string">&quot;#&quot;</span> + setting.<span class="property">nekoname</span>)</span><br><span class="line">                .<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    btf.<span class="title function_">scrollToDest</span>(<span class="number">0</span>, <span class="number">500</span>)</span><br><span class="line">                &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)(jQuery);</span><br><span class="line"></span><br><span class="line">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//部分自定义</span></span><br><span class="line">        $(<span class="string">&quot;#myscoll&quot;</span>).<span class="title function_">nekoScroll</span>(&#123;</span><br><span class="line">            <span class="attr">bgcolor</span>: <span class="string">&#x27;rgb(0 0 0 / .5)&#x27;</span>, <span class="comment">//背景颜色，没有绳子背景图片时有效</span></span><br><span class="line">            <span class="attr">borderRadius</span>: <span class="string">&#x27;2em&#x27;</span>,</span><br><span class="line">            <span class="attr">zoom</span>: <span class="number">0.9</span></span><br><span class="line">        &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">//自定义（去掉以下注释，并注释掉其他的查看效果）</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        $(&quot;#myscoll&quot;).nekoScroll(&#123;</span></span><br><span class="line"><span class="comment">            nekoname:&#x27;neko1&#x27;, //nekoname，相当于id</span></span><br><span class="line"><span class="comment">            nekoImg:&#x27;img/猫咪.png&#x27;, //neko的背景图片</span></span><br><span class="line"><span class="comment">            scImg:&quot;img/绳1.png&quot;, //绳子的背景图片</span></span><br><span class="line"><span class="comment">            bgcolor:&#x27;#1e90ff&#x27;, //背景颜色，没有绳子背景图片时有效</span></span><br><span class="line"><span class="comment">            zoom:0.9, //绳子长度的缩放值</span></span><br><span class="line"><span class="comment">            hoverMsg:&#x27;你好~喵&#x27;, //鼠标浮动到neko上方的对话框信息</span></span><br><span class="line"><span class="comment">            right:&#x27;100px&#x27;, //距离页面右边的距离</span></span><br><span class="line"><span class="comment">            fontFamily:&#x27;楷体&#x27;, //对话框字体</span></span><br><span class="line"><span class="comment">            fontSize:&#x27;14px&#x27;, //对话框字体的大小</span></span><br><span class="line"><span class="comment">            color:&#x27;#1e90ff&#x27;, //对话框字体颜色</span></span><br><span class="line"><span class="comment">            scroWidth:&#x27;8px&#x27;, //绳子的宽度</span></span><br><span class="line"><span class="comment">            z_index:100, //不用解释了吧</span></span><br><span class="line"><span class="comment">            during:1200, //从顶部到底部滑动的时长</span></span><br><span class="line"><span class="comment">        &#125;);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>[BlogRoot]/node_modules/hexo-theme-butterfly/source/css</code>文件夹下新建一个<code>cat.css</code>，将以下代码复制到文件中。当然你也可以选择不新建 css 文件，复制代码到<code>custom.css</code>也行，总之有地方引入就行。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-tag">body</span>::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.neko</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">64px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">64px</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;https://bu.dusays.com/2022/07/20/62d812db74be9.png&quot;</span>);</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">32px</span>;</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">    <span class="attribute">background-size</span>: contain;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">font-family</span>: tzy;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#6f42c1</span>;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.neko</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;https://bu.dusays.com/2022/07/20/62d812d95e6f5.png&quot;</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: contain;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">9999</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">115%</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.neko</span><span class="selector-class">.showMsg</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">attr</span>(data-msg);</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.neko</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">attr</span>(data-msg);</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.neko</span><span class="selector-class">.fontColor</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description: 滚动条样式  跟猫二选一</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">992px</span>) &#123;</span><br><span class="line">    ::-webkit-scrollbar &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">8px</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">8px</span> <span class="meta">!important</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ::-webkit-scrollbar-track &#123;</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">2em</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ::-webkit-scrollbar-thumb &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">255</span> <span class="number">255</span> <span class="number">255</span> / .<span class="number">3</span>);</span><br><span class="line">        <span class="attribute">background-image</span>: <span class="built_in">-webkit-linear-gradient</span>(<span class="number">45deg</span>, <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.1</span>) <span class="number">25%</span>, transparent <span class="number">25%</span>, transparent <span class="number">50%</span>, <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.1</span>) <span class="number">50%</span>, <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.1</span>) <span class="number">75%</span>, transparent <span class="number">75%</span>, transparent);</span><br><span class="line">        <span class="attribute">border-radius</span>: <span class="number">2em</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ::-webkit-scrollbar-corner &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: transparent</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在主题配置文件<code>_config.butterfly.yml</code>中引入<code>cat.js</code>和<code>cat.css</code>，当然还有在bottom的最前面引入<code>jQuery</code>，因为<code>cat.js</code>的语法依赖<code>jQuery</code>。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/cat.css&quot;&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">data-pjax</span> <span class="string">src=&quot;/js/cat.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>最后重新编译运行即可看见效果。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo cl; hexo s</span><br></pre></td></tr></table></figure><h3 id="二-漫画导航"><a href="#二-漫画导航" class="headerlink" title="二. 漫画导航"></a>二. 漫画导航</h3><p>选择喜欢的图标 添加到项目 在<a href="https://www.iconfont.cn/">阿里云图标库</a></p><p>在<code>[BlogRoot]\themes\butterfly\source\css\custom.css</code>中填写如下内容，引入Unicode和Font-class的线上资源：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">@import</span> <span class="string">&quot;//at.alicdn.com/t/c/font_4426032_sy4sytzuoj9.css&quot;</span><span class="string">;</span></span><br></pre></td></tr></table></figure><p>更推荐在在主题配置文件<code>inject</code>配置项进行全局引入：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;//at.alicdn.com/t/c/font_4426032_sy4sytzuoj9.css&quot;</span> <span class="string">media=&quot;defer&quot;</span> <span class="string">onload=&quot;this.media=&#x27;all&#x27;&quot;&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">async</span> <span class="string">src=&quot;//at.alicdn.com/t/c/font_4426032_sy4sytzuoj9.js&quot;&gt;&lt;/script&gt;</span> </span><br></pre></td></tr></table></figure><p>同时可以在自定义<code>CSS</code>中添加如下样式来控制图标默认大小和颜色等属性（<strong>若已经在项目设置中勾选了彩色选项，则无需再定义图标颜色</strong>），写法与字体样式类似，这恐怕也是它被称为<code>iconfont</code>（图标字体）的原因:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.iconfont</span> &#123;</span><br><span class="line">  <span class="attr">font-family:</span> <span class="string">&quot;iconfont&quot;</span> <span class="type">!important;</span></span><br><span class="line">  <span class="string">/*</span> <span class="string">这里可以自定义图标大小</span> <span class="string">*/</span></span><br><span class="line">  <span class="attr">font-size:</span> <span class="string">3em;</span></span><br><span class="line">  <span class="attr">font-style:</span> <span class="string">normal;</span></span><br><span class="line">  <span class="string">-webkit-font-smoothing:</span> <span class="string">antialiased;</span></span><br><span class="line">  <span class="string">-moz-osx-font-smoothing:</span> <span class="string">grayscale;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后定义导航栏</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="string">主页:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">iconfont</span> <span class="string">icon-shouye</span>              <span class="comment">#fas fa-home</span></span><br><span class="line">  <span class="string">分类:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">iconfont</span> <span class="string">icon-fenlei</span> <span class="comment">#fa fa-archive</span></span><br><span class="line">  <span class="string">标签:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">iconfont</span> <span class="string">icon-biaoqian</span>     <span class="comment">#fa fa-tags</span></span><br><span class="line">  <span class="string">归档:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">iconfont</span> <span class="string">icon-guidang</span>  <span class="comment">#fa fa-folder-open</span></span><br><span class="line">  <span class="string">友链:</span> <span class="string">/link/</span>    <span class="string">||</span> <span class="string">iconfont</span> <span class="string">icon-kafei</span>  <span class="comment"># fa fa-link</span></span><br><span class="line">  <span class="string">留言板:</span> <span class="string">https://gegewu-cloud.github.io/2023/05/23/留言板/</span> <span class="string">||</span> <span class="string">iconfont</span> <span class="string">icon-lishiliuyan</span> <span class="comment">#fa fa-paper-plane</span></span><br><span class="line">  <span class="string">关于:</span> <span class="string">https://gegewu-cloud.github.io/2023/05/22/关于/</span> <span class="string">||</span> <span class="string">iconfont</span> <span class="string">icon-xing</span> <span class="comment">#fas fa-heart </span></span><br></pre></td></tr></table></figure><p>效果</p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_4b90daa3afa9713b09d6c5b78cbb6671.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_4b90daa3afa9713b09d6c5b78cbb6671.png"></p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>清理systemd日志之journalctl</title>
      <link href="/2024/01/25/%E6%B8%85%E7%90%86systemd%E6%97%A5%E5%BF%97%E4%B9%8Bjournalctl/"/>
      <url>/2024/01/25/%E6%B8%85%E7%90%86systemd%E6%97%A5%E5%BF%97%E4%B9%8Bjournalctl/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="清理systemd日志之journalctl"><a href="#清理systemd日志之journalctl" class="headerlink" title="清理systemd日志之journalctl"></a>清理systemd日志之journalctl</h2><p>参考文献</p><p><a href="https://itlanyan.com/clear-systemd-journal-logs/">https://itlanyan.com/clear-systemd-journal-logs/</a></p><p><strong>systemd journal</strong>之于<code>systemd</code>犹如<strong>syslog</strong>之于<code>init</code>，其日志文件保存在 <strong>/var/log/journal</strong> 目录下。随着时间的流逝，该目录下会积累大量日志文件，占用不少的磁盘空间。如果硬盘容量较小或可用空间紧张，可以考虑清理过期日志释放占用的空间。</p><p>本文介绍清理<a href="https://itlanyan.com/tag/systemd/">systemd</a>日志的方法。</p><h3 id="清理systemd日志"><a href="#清理systemd日志" class="headerlink" title="清理systemd日志"></a>清理systemd日志</h3><p><a href="https://itlanyan.com/clear-systemd-journal-logs/#bnp_indexs">返回目录</a></p><p>清理之前，可查看一下systemd日志所占用的磁盘空间。既可以用常用的 <code>&lt;span class=&quot;pln&quot;&gt;du&lt;/span&gt;</code> 命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo du -sh /var/log/journal/</span><br><span class="line"># 示例输出</span><br><span class="line"># 3.9G /var/log/journal/</span><br></pre></td></tr></table></figure><p>但更推荐使用systemd日志管理专用命令 <code>&lt;span class=&quot;pln&quot;&gt;journalctl&lt;/span&gt;</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">journalctl --disk-usage</span><br><span class="line"># 示例输出</span><br><span class="line"># Archived and active journals take up 3.9G on disk.</span><br></pre></td></tr></table></figure><p>知道了日志占用的磁盘空间，接下来便可以清理过期日志。开始之前，建议 <code>&lt;span class=&quot;pln&quot;&gt;rotate&lt;/span&gt;</code> 当前日志(rotate是日志操作中的一个术语，其归档旧日志，后续日志写入新创建的日志文件中)：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl --rotate</span><br></pre></td></tr></table></figure><p><code>&lt;span class=&quot;pln&quot;&gt;journalctl&lt;/span&gt;</code>提供了三种清理systemd日志的方式。第一种是清理指定时间之前的日志：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 清理7天之前的日志</span><br><span class="line">sudo journalctl --vacuum-time=7d</span><br><span class="line"># 清理2小时之前的日志</span><br><span class="line">sudo journactl --vacuum-time=2h</span><br><span class="line"># 清理10秒之前的日志</span><br><span class="line">sudo journalctl --vacuum-time=10s</span><br><span class="line"># 上述命令示例输出：</span><br><span class="line"># Vacuuming done, freed 3.7G of archived journals on disk.</span><br></pre></td></tr></table></figure><p>第二种是限制日志占用的空间大小：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 限制systemd日志占用不超过1G空间</span><br><span class="line">sudo journalctl --vacuum-size=1G</span><br><span class="line"># 限制systemd日志占用不超过100M</span><br><span class="line">sudo journalctl --vacuum-size=100M</span><br><span class="line"># 输出与第一种类似</span><br></pre></td></tr></table></figure><p>第三种是保留日志文件个数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 保留最近的5个日志文件</span><br><span class="line">sudo journalctl --vacuum-files=5</span><br><span class="line"># 输出与第一种类似</span><br></pre></td></tr></table></figure><p>不知道 <code>journalctl</code> 管理日志功能之前，本人用过 <code>find 配合 </code><span class="kwd">exec</span><code> (或者管道加</code><span class="pln">xargs</span>`)的土办法清理过期日志：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 删除7天前的日志</span><br><span class="line">find /var/log/journal -mtime +7 -exec rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure><h3 id="一劳永逸的办法"><a href="#一劳永逸的办法" class="headerlink" title="一劳永逸的办法"></a>一劳永逸的办法</h3><p><a href="https://itlanyan.com/clear-systemd-journal-logs/#bnp_indexs">返回目录</a></p><p>上文介绍的清理systemd日志方法适合一次性手动管理，重复做就没意思了。一劳永逸的办法是配置systemd journal，让其自动管理日志，不占用过多磁盘空间。</p><p>方法是编辑 <strong>/etc/systemd/journald.conf</strong> 文件，对其中的参数进行设置。例如限制日志最大占用1G空间：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Journal]</span><br><span class="line">#Storage=auto</span><br><span class="line">#Compress=yes</span><br><span class="line">#Seal=yes</span><br><span class="line">#SplitMode=uid</span><br><span class="line">#SyncIntervalSec=5m</span><br><span class="line">#RateLimitInterval=30s</span><br><span class="line">#RateLimitBurst=1000</span><br><span class="line">SystemMaxUse=1G</span><br><span class="line">#SystemKeepFree=</span><br><span class="line">#SystemMaxFileSize=</span><br><span class="line">#RuntimeMaxUse=</span><br><span class="line">#RuntimeKeepFree=</span><br><span class="line">#RuntimeMaxFileSize=</span><br></pre></td></tr></table></figure><p>保存配置文件后记得重新加载：<code>sudo systemctl restart systemd-journald</code></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://itlanyan.com/clear-systemd-journal-logs/#bnp_indexs">返回目录</a></p><ol><li><a href="https://linuxhandbook.com/clear-systemd-journal-logs/">How to Clear Systemd Journal Logs</a></li><li><a href="https://itlanyan.com/find-files-in-linux/">Linux文件查找</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker方式部署qexo</title>
      <link href="/2024/01/24/docker%E6%96%B9%E5%BC%8F%E9%83%A8%E7%BD%B2qexo/"/>
      <url>/2024/01/24/docker%E6%96%B9%E5%BC%8F%E9%83%A8%E7%BD%B2qexo/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="docker方式部署qexo😘"><a href="#docker方式部署qexo😘" class="headerlink" title="docker方式部署qexo😘"></a>docker方式部署qexo😘</h2><h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><p><a href="https://github.com/Qexo/Qexo.git">https://github.com/Qexo/Qexo.git</a>                   (源码文件)<br><a href="https://www.yyds.space/posts/3dfeb390abb4">https://www.yyds.space/posts/3dfeb390abb4</a></p><h4 id="概览："><a href="#概览：" class="headerlink" title="概览："></a>概览：</h4><ul><li><p>使用Dockerfile文件构建镜像</p></li><li><p>启动容器</p></li><li><p>推送到阿里云镜像栈</p></li><li><p>创建所需目录及文件</p></li><li><p>如不想了解镜像制作过程可直接使用此docker-compose.yml文件启动qexo服务<br>镜像可选“<strong>registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:qexo-3.0.2</strong>”<br>docker-compose.yml文件(需要修改<strong>config.py</strong>文件将自己的机器<strong>IP</strong>或<strong>域名</strong>加入  |  关于<strong>db.sqlite3</strong>只需要在当前目录创建一个名为<strong>db.sqlite3</strong>的空文件即可😎 )</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">qexo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/zznn/mycentos:qexo-3.0.2</span> </span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">qexo</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./db.sqlite3:/app/db/db.sqlite3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./blog:/app/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./configs.py:/app/configs.py</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="1-创建配置文件目录及空数据库文件"><a href="#1-创建配置文件目录及空数据库文件" class="headerlink" title="1. 创建配置文件目录及空数据库文件"></a>1. 创建配置文件目录及空数据库文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建配置文件目录及空数据库文件</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /app/db /app/data</span><br><span class="line"><span class="built_in">touch</span>    /app/db/db.sqlite3</span><br><span class="line"><span class="comment"># 创建Dockerfile工作目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /data/qexo</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/qexo/db</span><br><span class="line"><span class="built_in">cd</span> /data/qexo/db &amp;&amp; <span class="built_in">touch</span> db.sqlite3</span><br><span class="line"><span class="comment"># 将Qexo源码文件上传至工作目录 并打包为tar.gz格式文件</span></span><br><span class="line"><span class="built_in">cd</span> /data/qexo &amp;&amp; rz</span><br><span class="line"><span class="comment"># 配置编排文件</span></span><br><span class="line">vim Dockerfile</span><br></pre></td></tr></table></figure><p><strong>2. Dockerfile文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">FROM python:3.11.3-alpine</span><br><span class="line"><span class="comment"># 维护者信息</span></span><br><span class="line">LABEL maintainer=<span class="string">&quot;xwgegewu@gmail.com&quot;</span></span><br><span class="line"><span class="comment"># 设置生产模式环境变量 </span></span><br><span class="line"><span class="comment"># ENV APP_ENV production</span></span><br><span class="line"><span class="comment"># pipy源设置</span></span><br><span class="line">RUN pip config <span class="built_in">set</span> global.index-url https://mirrors.cloud.tencent.com/pypi/simple/</span><br><span class="line"><span class="comment"># 设置时区</span></span><br><span class="line">RUN sed -i <span class="string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> /etc/apk/repositories &amp;&amp; \</span><br><span class="line">    apk --no-cache add tzdata &amp;&amp; \</span><br><span class="line">    <span class="built_in">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</span><br><span class="line">    apk --no-cache del tzdata &amp;&amp; \</span><br><span class="line">    apk --no-cache add git &amp;&amp; \</span><br><span class="line">    <span class="built_in">mkdir</span> /app</span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line">WORKDIR /app</span><br><span class="line"><span class="comment"># 拷贝数据</span></span><br><span class="line"><span class="comment"># RUN git clone https://github.com/Qexo/Qexo.git /app</span></span><br><span class="line">ADD ./Qexo.tar.gz /app/</span><br><span class="line">RUN <span class="built_in">mv</span> /app/Qexo/* /app/</span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line">RUN pip install --upgrade pip </span><br><span class="line">RUN apk --no-cache add build-base python3-dev libffi-dev</span><br><span class="line">RUN pip install Django==3.2.18</span><br><span class="line">RUN pip install PyMySQL==1.0.2</span><br><span class="line">RUN pip install boto3==1.26.94</span><br><span class="line">RUN pip install requests==2.28.2</span><br><span class="line">RUN pip install PyGithub==1.58.1</span><br><span class="line">RUN pip install python-gitlab==3.13.0</span><br><span class="line">RUN pip install html2text==2020.1.16</span><br><span class="line">RUN pip install PyYAML</span><br><span class="line">RUN pip install urllib3==1.26.15</span><br><span class="line">RUN pip install Markdown==3.4.1</span><br><span class="line">RUN pip install djongo==1.3.6</span><br><span class="line">RUN pip install django-cors-headers==3.14.0</span><br><span class="line">RUN pip install pymongo==3.13.0</span><br><span class="line">RUN pip install dnspython==2.2.1</span><br><span class="line">RUN pip install sqlparse==0.2.4</span><br><span class="line">RUN pip install psycopg2-binary==2.9.5</span><br><span class="line">RUN pip install cryptography==39.0.2</span><br><span class="line">RUN pip install pyopenssl==23.0.0</span><br><span class="line">RUN pip install oss2==2.17.0</span><br><span class="line">RUN pip install beautifulsoup4==4.11.2</span><br><span class="line"><span class="comment"># 拷贝启动脚本</span></span><br><span class="line">COPY . /app/</span><br><span class="line">RUN <span class="built_in">chmod</span> +x /app/run.sh</span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line">EXPOSE 8000</span><br><span class="line"><span class="comment"># 挂载目录</span></span><br><span class="line">VOLUME [<span class="string">&quot;/app/db&quot;</span>, <span class="string">&quot;/app/data&quot;</span>]</span><br><span class="line"><span class="comment"># 启动django</span></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;/app/run.sh&quot;</span>]</span><br></pre></td></tr></table></figure><h4 id="3-在-data-qexo创建配置文件"><a href="#3-在-data-qexo创建配置文件" class="headerlink" title="3. 在/data/qexo创建配置文件"></a>3. 在/data/qexo创建配置文件</h4><h5 id="configs-py"><a href="#configs-py" class="headerlink" title="configs.py"></a>configs.py</h5><p><strong>DOMAINS</strong>处需要加上自己的本机<strong>IP</strong>或者<strong>域名</strong> 相当于设置白名单</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd /data/qexo &amp;&amp; vim configs.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库配置</span></span><br><span class="line"><span class="keyword">import</span> pymysql,os</span><br><span class="line"></span><br><span class="line">DOMAINS = [<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;10.0.0.10&quot;</span>]</span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: os.path.join(<span class="string">&#x27;/app/db&#x27;</span> , <span class="string">&#x27;db.sqlite3&#x27;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="run-sh"><a href="#run-sh" class="headerlink" title="run.sh"></a>run.sh</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">python3 manage.py makemigrations</span><br><span class="line">python3 manage.py migrate</span><br><span class="line">python3 manage.py runserver 0.0.0.0:8000 --noreload</span><br></pre></td></tr></table></figure><h5 id="构建docker镜像-启动容器"><a href="#构建docker镜像-启动容器" class="headerlink" title="构建docker镜像 启动容器"></a>构建docker镜像 启动容器</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建</span></span><br><span class="line">docker build -t qexo:3.0.2 .</span><br><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line">docker run -d --name qexo -p 8000:8000 -v /data/qexo/db:/app/db -v /data/blog:/app/data qexo:3.0.2</span><br></pre></td></tr></table></figure><h5 id="查看docker日志是否成功运行"><a href="#查看docker日志是否成功运行" class="headerlink" title="查看docker日志是否成功运行"></a>查看docker日志是否成功运行</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">docker logs qexo</span><br><span class="line"></span><br><span class="line">获取本地配置文件成功, 使用本地数据库配置</span><br><span class="line">           _               _ </span><br><span class="line">     /\   | |             | |</span><br><span class="line">    /  \  | |__  _   _  __| |_   _ </span><br><span class="line">   / /\ \ | |_ \| | | |/ _| | | | |</span><br><span class="line">  / ____ \| |_) | |_| | (_| | |_| |</span><br><span class="line"> /_/    \_\____/ \____|\____|\____|</span><br><span class="line">当前环境: 本地</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: auth, contenttypes, hexoweb, sessions</span><br><span class="line">Running migrations:</span><br><span class="line">  No migrations to apply.</span><br><span class="line">[25/Jan/2024 07:11:16] ERROR: Provider获取失败, 跳过(functions.py.&lt;module&gt;[line:55])</span><br><span class="line">[25/Jan/2024 07:11:40] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 302 0</span><br><span class="line">[25/Jan/2024 07:11:40] INFO: 未检测到初始化配置, 转跳到初始化页面(views.py.login_view[line:40])</span><br><span class="line">[25/Jan/2024 07:11:40] <span class="string">&quot;GET /login/?next=/ HTTP/1.1&quot;</span> 302 0</span><br><span class="line">[25/Jan/2024 07:11:40] INFO: 保存设置CDN_PREV =&gt; https://unpkg.com/(functions.py.save_setting[line:259])</span><br><span class="line">[25/Jan/2024 07:11:40] INFO: 保存设置QEXO_NAME =&gt; Hexo管理面板(functions.py.save_setting[line:259])</span><br></pre></td></tr></table></figure><p>浏览器访问: http://本机IP:8000 完成各项初始化等配置。</p><h4 id="4-最后推送到阿里云镜像栈-略-并使用阿里云镜像构建容器"><a href="#4-最后推送到阿里云镜像栈-略-并使用阿里云镜像构建容器" class="headerlink" title="4. 最后推送到阿里云镜像栈(略)并使用阿里云镜像构建容器"></a>4. 最后推送到阿里云镜像栈(略)并使用阿里云镜像构建容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login ....</span><br><span class="line">docker tag .....</span><br><span class="line">docker push .....</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> qexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> qexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>centos7重置密码</title>
      <link href="/2024/01/24/centos7%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81/"/>
      <url>/2024/01/24/centos7%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>centos7重置密码</strong></p><h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><p><a href="https://blog.csdn.net/gnail_oug/article/details/94721777">https://blog.csdn.net/gnail_oug/article/details/94721777</a></p><h4 id="环境："><a href="#环境：" class="headerlink" title="环境："></a>环境：</h4><p>centos7.6 / 7.9 重置密码</p><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><p>当<strong>root</strong>密码忘了之后，可以通过重启系统，在开机时重新设置密码。注：测试版本为**CentOS Linux release 7.6.1810 (Core)**，其他版本可能有些区别。</p><h4 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h4><h5 id="1、重启系统，在开机过程中，出现以下界面时按e键，进入编辑界面"><a href="#1、重启系统，在开机过程中，出现以下界面时按e键，进入编辑界面" class="headerlink" title="1、重启系统，在开机过程中，出现以下界面时按e键，进入编辑界面"></a>1、重启系统，在开机过程中，出现以下界面时按e键，进入编辑界面</h5><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_56eb784c63c8b82f62e62f1b5752d680.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_56eb784c63c8b82f62e62f1b5752d680.png"></p><h5 id="2、修改配置修改密码"><a href="#2、修改配置修改密码" class="headerlink" title="2、修改配置修改密码"></a>2、修改配置修改密码</h5><ul><li>按方向键下键↓，找到设置语言的地方，如<strong>LANG=en_US.UTF-8</strong> 在后面追加<strong>rw single init=/bin/bash,<strong>然后按</strong>ctrl+x</strong>重启系统</li><li>进入<strong>bash</strong>界面后，可以输入<strong>passwd</strong>命令重新设置<strong>root</strong>密码</li><li>如果开启了<strong>SELinux</strong>，执行命令<strong>touch /.autorelabel</strong>命令</li><li>输入<strong>exec /sbin/init</strong>命令重启系统 使用新设置的密码进入系统之后，为了安全起见，可以输入<strong>reboot</strong>重新启动一次系统。</li></ul><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_5f98f5afcf72816ec0aeff6ad4f81deb.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_5f98f5afcf72816ec0aeff6ad4f81deb.png"></p><p>此时成功！</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux带宽网卡流量监控工具nethogs使用</title>
      <link href="/2024/01/22/linux%E5%B8%A6%E5%AE%BD%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7nethogs%E4%BD%BF%E7%94%A8/"/>
      <url>/2024/01/22/linux%E5%B8%A6%E5%AE%BD%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7nethogs%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>linux带宽网卡流量监控工具nethogs使用</strong></p><p>前言：</p><p>此前在另外一篇博客里面介绍了另一测速工具<a href="https://gegewu-cloud.github.io/2023/07/14/speedtest-%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E5%B8%A6%E5%AE%BD/?highlight=speed">speedtest</a>不少小伙伴反馈说测速不准确 本次介绍另一工具<a href="%5BLinux%E5%B7%A5%E5%85%B7%E4%B9%8Bnethogs%E5%91%BD%E4%BB%A4-CSDN%E5%8D%9A%E5%AE%A2%5D(https://blog.csdn.net/carefree2005/article/details/124199604)">nethogs</a>  各种网络流量监控工具 &gt; <a href="https://gegewu-cloud.github.io/2023/11/23/linux%E6%8E%92%E6%9F%A5%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98%E5%B8%B8%E7%94%A8CMD%E6%80%BB%E7%BB%93/">传送</a></p><h3 id="一-安装"><a href="#一-安装" class="headerlink" title="一. 安装"></a>一. 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install - y nethogs</span><br></pre></td></tr></table></figure><h3 id="二-使用"><a href="#二-使用" class="headerlink" title="二. 使用"></a>二. 使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看帮助</span></span><br><span class="line">nethogs -h</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看版本</span></span><br><span class="line">nethogs -v</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nethogs命令默认监控所有物理网卡，可以后面接口网卡名称方式指定监控某网卡流量，可以接多个网卡名称，网卡之间空格隔开</span></span><br><span class="line">nethogs eth0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监控时刷新频率3秒总计2次</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认刷新频率间隔1秒，刷新次数不限制直到主动结束进程或者退出。</span></span><br><span class="line">nethogs -d 3 -c 2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按照MB流量格式显示模式显示</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定网卡流量显示单位，默认KB，(0 = KB/s, 1 = total KB, 2 = total B, 3 = total MB)</span></span><br><span class="line">nethogs -v 3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监控所有网卡流量</span></span><br><span class="line">nethogs -a</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-t表示启用追踪模式，可以记录每一次的值，也可以结合其他参数一起使用。</span></span><br><span class="line">nethogs -t -d 10 -c 5</span><br></pre></td></tr></table></figure><h3 id="三-使用语法及参数说明"><a href="#三-使用语法及参数说明" class="headerlink" title="三. 使用语法及参数说明"></a>三. 使用语法及参数说明</h3><p>使用语法<br>用法：nethogs [参数] [device]</p><p>参数    参数说明<br>-V    打印命令版本<br>-h    打印帮助<br>-b    bughunt模式<br>-d    指定显示刷新频率，单位秒，默认1秒<br>-v    指定流量单位模式(0 = KB/s, 1 = total KB, 2 = total B, 3 = total MB)<br>-c    设置刷新更新次数<br>-t    tracemode模式，可以记录下每一次刷新的流量值<br>-p    混杂模式下监听流量（不建议使用）<br>-s    按照发送流量排序输出<br>-a    监控所有网卡端口，包括环回接口<br>运行模式下按键说明<br>按键    按键说明<br>q    退出<br>s    按照发送流量排序<br>r    按照接受流量排序<br>m    切换端口流量单位显示模式在B,KB,MB之间流量切换</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>物理服务器结构图</title>
      <link href="/2024/01/17/%E7%89%A9%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%93%E6%9E%84%E5%9B%BE/"/>
      <url>/2024/01/17/%E7%89%A9%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%93%E6%9E%84%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>物理服务器结构图</strong></p><p><strong>概览🍉 ：</strong></p><p>外观接口</p><p>产品内部结构</p><div class="gallery">    <div class="fj-gallery  data" data-rowheight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_e55ad4914ecc2115cae8f66c70a4d2ce.png","alt":""},{"url":"https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_0719498ab66e6038ecc45c5d21398f75.png","alt":""},{"url":"https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_30518c76a3cbacc8c7bfb54189ee5695.png","alt":""}]</span>    </div>    <button class="gallery-load-more"><span>Load More</span><i class="fa-solid fa-arrow-down"></i></button>    </div>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>本站说明</title>
      <link href="/2024/01/17/%E6%9C%AC%E7%AB%99%E8%AF%B4%E6%98%8E/"/>
      <url>/2024/01/17/%E6%9C%AC%E7%AB%99%E8%AF%B4%E6%98%8E/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>本站说明</strong>💗</p><p>本站为<a href="https://gegewu-cloud.github.io/">ZzNnWn.</a>博主新开博客 本站使用图床Blazeb2及Github图床</p><p>之前一直使用<del>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</del>的方式写作管理博客 不是很方便有时候会出现<strong>hexo d</strong>报错的现象  加之博客篇数太多后导致 每次执行损耗时间过长 一直在寻找解决此问题的方法 中途差点放弃使用hexo  一次偶然的机会 了解到<a href="http://sunlight.zznnwn.cloudns.biz/2024/01/16/hexo-butterfly-Qexo%E5%90%8E%E7%AB%AFgithub%E8%87%AA%E5%8A%A8%E5%8C%96.md/">Qexo</a>这个极其好用的管理hexo的工具几番尝试后决定新开一博客<a href="http://sunlight.zznnwn.cloudns.biz/">粘人的鸭嘴兽. </a> 初衷 用于记录日常 本站技术类文章较少 技术类文章在博主另一小站<a href="https://gegewu-cloud.github.io/">ZzNnWn.</a></p><p>站点初始链接：<a href="http://sunlight.zznnwn.cloudns.biz/">zznn-cloud博客</a><br>托管域名地址：<a href="http://sunlight.zznnwn.cloudns.biz/">http://sunlight.zznnwn.cloudns.biz/</a></p><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_436d9740fba555d84165cf30cad9603a.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_436d9740fba555d84165cf30cad9603a.png"></p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日常 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-alias方式防止根目录误删</title>
      <link href="/2024/01/16/linux-alias%E6%96%B9%E5%BC%8F%E9%98%B2%E6%AD%A2%E6%A0%B9%E7%9B%AE%E5%BD%95%E8%AF%AF%E5%88%A0/"/>
      <url>/2024/01/16/linux-alias%E6%96%B9%E5%BC%8F%E9%98%B2%E6%AD%A2%E6%A0%B9%E7%9B%AE%E5%BD%95%E8%AF%AF%E5%88%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>linux-alias方式防止根目录误删（本文档未测试）</strong></p><p>参考：</p><ul><li><a href="http://www.opstool.com/article/179">http://www.opstool.com/article/179</a></li><li><a href="https://steemit.com/cn/@oflyhigh/sudo-rm-rf">https://steemit.com/cn/@oflyhigh/sudo-rm-rf</a></li><li><a href="https://zhuanlan.zhihu.com/p/106066854">https://zhuanlan.zhihu.com/p/106066854</a></li></ul><p>rm是一个危险的命令，为了防止rm /这样的操作发生。我们可以在用户的家目录的.bashrc里将rm alisa一下，加上–preserve-root这个参数。其实除了rm外，另外几个命令也需要谨慎，如chgrp、chown、chmod总结一下，我们可以在.bashrc里加入如下alias：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> <span class="built_in">chgrp</span>=<span class="string">&#x27;chgrp --preserve-root&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">chown</span>=<span class="string">&#x27;chown --preserve-root&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">chmod</span>=<span class="string">&#x27;chmod --preserve-root&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=<span class="string">&#x27;rm -i --preserve-root&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>详细解释之根目录保护</strong></p><p>有一定经验的系统管理员可能这个时候会想起来，<code>rm</code> 命令有一对专门针对根目录的选项 <code>--preserve-root</code> 和 <code>--no-preserve-root</code> 。这对选项的意思是：</p><ul><li><code>--preserve-root</code>：保护根目录，这是默认行为。</li><li><code>--no-preserve-root</code>：不保护根目录。</li></ul><p>这对选项是后来添加到 <code>rm</code> 命令的。可能几乎每个系统管理员都犯过操作错误，而这其中删除过根目录的比比皆是（我就是一个）。出现这种情况的原因有几种：</p><ul><li>输入手误：比如本来想输入 <code>rm /tmp/test.txt</code>，结果不小心键盘打的飞起，多输入了一个空格变成： <code>rm / tmp/test.txt</code> 。看到根目录（<code>/</code>）后面的空格了么？！——这就是我当前自己亲手犯过的错误，而且是在生产服务器上。</li><li>未正确初始化或命名错误的 shell 脚本变量：比如在脚本中，<code>rm -rf /$&#123;tmp_dir&#125;</code>，如果无论是 <code>tmp_dir</code> 变量没有正确赋值还是输入错误（原本或许是 <code>tmpdir</code> ？），那会导致什么？当然是删除根目录咯~</li></ul><p>鉴于这种情况层出不穷，在 Linux 圈子几乎和“初学者如何退出 vi” 一样成为经典笑话了。所以，在 POSIX 第七版规范中，<code>rm</code> 命令<a href="https://link.zhihu.com/?target=http://pubs.opengroup.org/onlinepubs/9699919799/utilities/rm.html">添加</a>了 <code>--preserve-root</code> 选项，并将其作为默认行为，以降低出现这种错误的可能。</p><p>但是，这个选项不能防范本文中所述的清除根目录下所有文件（<code>/*</code>）的操作。</p><p>有的同学可能要问，那为什么还会专门出现 <code>--no-preserve-root</code> 选项呢？这可能主要是出于 UNIX 哲学的考虑，给予你想要的一切权力，犯傻是你的事情，而不是操作系统的事情。万一，你真的想删除根目录下的所有文件呢？</p><p>你还别说，真有这种需求：比如你要清除一个 chroot 环境下的所有文件。 chroot 我们这里不多讲，它就是以一个目录作为“监狱”，该目录在逻辑上形成了新的“根目录”，在该监狱内的文件操作不能跨出该目录范畴。近些年流行的 Docker、LXC/LXD 之类的容器技术，都是一种 chroot 技术。</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-butterfly-Qexo后端github自动化</title>
      <link href="/2024/01/16/hexo-butterfly-Qexo%E5%90%8E%E7%AB%AFgithub%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
      <url>/2024/01/16/hexo-butterfly-Qexo%E5%90%8E%E7%AB%AFgithub%E8%87%AA%E5%8A%A8%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>hexo+butterfly+Qexo后端+github自动化</strong>👍</p><p>参考：</p><p><a href="https://www.oplog.cn/qexo/">https://www.oplog.cn/qexo/</a>                      （官网）<br><a href="https://blog.kwxos.top/posts/18807.html">https://blog.kwxos.top/posts/18807.html</a> （只此一篇即可👍 ）</p><p>概览：</p><ul><li>新建两个仓库一个放博客源文件 一个存放静态文件<br>存放源文件仓库：<a href="https://github.com/zznn-cloud/qexo-blog-source">qexo-blog-source</a>此仓库需设置为私有<br>存放静态文件仓库：zznn-cloud.github.io 此仓库公开</li><li>常规部署方式hexo clean &amp;&amp; hexo g &amp;&amp; hexo d将静态文件推送到仓库zznn-cloud.github.io</li><li>使用Git或者vscode等工具将博客源文件推送到仓库qexo-blog-source</li><li>源文件仓库qexo-blog-source <strong>.github</strong>下新建Github Action配置文件</li><li>使用Vercel部署qexo管理博客</li><li>浏览器访问zznn-cloud.github.io 此时部署完成</li></ul><blockquote><p><del>note: 关于博客如何搭建及Github pages如何使用相对简单本文不做介绍</del></p></blockquote><h2 id="一-两个仓库配置"><a href="#一-两个仓库配置" class="headerlink" title="一. 两个仓库配置"></a>一. 两个仓库配置</h2><ol><li><p><a href="https://wn-apple-teawine.fun/2023/08/12/hexo%E4%B8%8Egithub%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/#%E5%8D%81-butterfly%E4%B8%BB%E9%A2%98%E8%AE%BE%E7%BD%AE">公开仓库zznn-cloud.github.io静态文件推送较为简单此处略</a></p></li><li><p><strong>github-token</strong>生成此<code>token</code>填入下方<code>action</code>配置文件(配置永不过期以及下方权限)</p><p><img src="https://f005.backblazeb2.com/file/boke-images/znn-cloud-boke/86b145ca-5730-4187-836e-00aad670b76d.png"></p></li><li><p>私有仓库<strong>qexo-blog-source</strong>只需要<strong>push</strong>下方文件即可</p><p><img src="https://f005.backblazeb2.com/file/boke-images/znn-cloud-boke/5ff789ab-8d59-4a54-b2a2-aeec9ba423b4.png"></p></li><li><p>私有仓库.github目录新建配置文件如下</p><p><img src="https://f005.backblazeb2.com/file/boke-images/znn-cloud-boke/6eb998ca-bee5-4b26-9286-86d3ba8ea862.png"></p><p>配置如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">自动部署</span></span><br><span class="line"><span class="comment"># 当有改动推送到main分支时，启动Action</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line">      <span class="comment">#2020年10月后github新建仓库默认分支改为main，注意更改</span></span><br><span class="line">  <span class="attr">release:</span></span><br><span class="line">    <span class="attr">types:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">published</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">检查分支</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">main</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装</span> <span class="string">Node</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&quot;16.x&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装</span> <span class="string">Hexo</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          export TZ=&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="string">          npm install hexo-cli -g</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">缓存</span> <span class="string">Hexo</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">cache-npm</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/cache@v3</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">cache-name:</span> <span class="string">cache-node-modules</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-build-$&#123;&#123;</span> <span class="string">env.cache-name</span> <span class="string">&#125;&#125;-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/package-lock.json&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            $&#123;&#123; runner.os &#125;&#125;-build-$&#123;&#123; env.cache-name &#125;&#125;-</span></span><br><span class="line"><span class="string">            $&#123;&#123; runner.os &#125;&#125;-build-</span></span><br><span class="line"><span class="string">            $&#123;&#123; runner.os &#125;&#125;-</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="comment"># Install pandoc for mathjax (Optional)</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">pandoc</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          cd /tmp</span></span><br><span class="line"><span class="string">          wget -c https://github.com/jgm/pandoc/releases/download/2.14.0.3/pandoc-2.14.0.3-1-amd64.deb</span></span><br><span class="line"><span class="string">          sudo dpkg -i pandoc-2.14.0.3-1-amd64.deb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装依赖</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.cache-npm.outputs.cache-hit</span> <span class="type">!=</span> <span class="string">&#x27;true&#x27;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          # npm install gulp-cli -g #全局安装gulp</span></span><br><span class="line"><span class="string">          npm install --save</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">     <span class="comment"># - name: 修改双栏插件的CDN</span></span><br><span class="line">     <span class="comment">#   run: |</span></span><br><span class="line">     <span class="comment">#     sed -i &quot;s/cdn.jsdelivr.net/blogresource.sqwdream.top\/cdn.jsdelivr.net/g&quot; node_modules/hexo-butterfly-article-double-row/index.js</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">生成静态文件</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          hexo clean</span></span><br><span class="line"><span class="string">          hexo bangumi -u #bilibili番剧更新</span></span><br><span class="line"><span class="string">          hexo generate</span></span><br><span class="line"><span class="string">          # gulp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">部署到Github</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">github-token</span>  <span class="comment"># github高权限token</span></span><br><span class="line">          <span class="attr">repository-name:</span> <span class="string">zznn-cloud/zznn-cloud.github.io</span></span><br><span class="line">          <span class="attr">branch:</span> <span class="string">main</span></span><br><span class="line">          <span class="attr">folder:</span> <span class="string">public</span></span><br><span class="line">          <span class="attr">commit-message:</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; github.event.head_commit.message &#125;&#125;</span> Updated By Github Actions&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="二-Qexo部署及配置"><a href="#二-Qexo部署及配置" class="headerlink" title="二. Qexo部署及配置"></a>二. Qexo部署及配置</h2><ol><li><p>此处申请vercel免费的数据库作为存储数据使用</p></li><li><p>使用vercel函数计算部署Qexo前端</p><p><del>Note：上方两步骤较为简单本文不做介绍</del></p></li><li><p>一键部署Qexo传送门(<a href="https://vercel.com/new/clone?repository-url=https://github.com/am-abudu/Qexo">New Project – Vercel</a></p><p><img src="https://f005.backblazeb2.com/file/boke-images/znn-cloud-boke/bc9f1111-b88d-49be-a0dd-a61f94e46078.png"></p></li><li><p>Qexo写博客参数留存</p><p><img src="https://f005.backblazeb2.com/file/boke-images/znn-cloud-boke/655e81e0-1d98-40ee-9fbe-20f0f9ceea2e.png"></p><p><img src="https://f005.backblazeb2.com/file/boke-images/znn-cloud-boke/04073e0c-4649-4ea8-8e83-5ab25e43507d.png"></p></li></ol><h1 id="三-扩展😘"><a href="#三-扩展😘" class="headerlink" title="三. 扩展😘"></a>三. 扩展😘</h1><p><strong>Qexo logo等信息</strong></p><ul><li><a href="https://unpkg.com/qexo-static@2.2.3/qexo/images/qexo.png">https://unpkg.com/qexo-static@2.2.3/qexo/images/qexo.png</a></li><li><a href="https://unpkg.com/qexo-static@2.2.3/qexo/images/icon.png">https://unpkg.com/qexo-static@2.2.3/qexo/images/icon.png</a></li><li><a href="https://unpkg.com/qexo-static@2.2.3/qexo/images/qexo-dark.png">https://unpkg.com/qexo-static@2.2.3/qexo/images/qexo-dark.png</a></li></ul><p><strong>Github图床设置</strong>✌</p><p><a href="https://github.com/Qexo/Qexo/wiki/%E5%9B%BE%E5%BA%8A%E9%85%8D%E7%BD%AE">https://github.com/Qexo/Qexo/wiki/%E5%9B%BE%E5%BA%8A%E9%85%8D%E7%BD%AE</a></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 仓库</span></span><br><span class="line">zznn-cloud/zznn-cloud-blog-images</span><br><span class="line"><span class="section"># 分支</span></span><br><span class="line">main</span><br><span class="line"><span class="section"># 高权限token</span></span><br><span class="line">ghp<span class="emphasis">_Qknm...................</span></span><br><span class="line"><span class="emphasis"># 保存路径</span></span><br><span class="line"><span class="emphasis">Qexo/&#123;year&#125;/&#123;month&#125;/&#123;filename&#125;_</span>&#123;md5&#125;.&#123;extName&#125;</span><br><span class="line"><span class="section"># 自定义域名</span></span><br><span class="line">https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/&#123;year&#125;/&#123;month&#125;/&#123;filename&#125;<span class="emphasis">_&#123;md5&#125;.&#123;extName&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><img src="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_3292d63d8f8d8a13d3e5c4da5693056e.png" alt="https://github.com/zznn-cloud/zznn-cloud-blog-images/raw/main/Qexo/24/1/image_3292d63d8f8d8a13d3e5c4da5693056e.png"></p></blockquote><p>结语：Qexo是一个极其好用的hexo管理平台感谢维护此项目大佬们的贡献👍 。</p>]]></content>
      
      
      <categories>
          
          <category> qexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> qexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>qexo</title>
      <link href="/2023/12/15/test%E6%96%87%E6%A1%A3/"/>
      <url>/2023/12/15/test%E6%96%87%E6%A1%A3/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh,这是一个无效的密码。请检查并重试。" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="1e36074e6806db3b794944b334a845b30ee4a44008c0f95412e8164b226bd2f7">a81b18b76326989181327cf554748c52da21cc33c0731b37b224ba7b570727d3b6d5ddf5cf3c517190be31f0da481a7c1ae1ccf60fc7eaceeb9cc5892e16592bedd0fa34da4e1fbebcabbc85c61b51dc15b4dd5c653dd684e603438464111c4758ada5701ed225dfbd33a33cab2ad7f5093655aeb5eaca0232ba36211d5fc9ff44db582730bf5c727b33bccadb8cb8b77cae0b827153cec6695bba5dd664156870a40827582da63c9bb736da2a1bfc98df7330236d44a7d2f8b10dfdfcd122bd5e2c4b11abfa2950fbe9241cf3f70397f4fefef6014cbf3accc24f189e4e0a0c3b4ec4f45e9219defb3827e97c491cc502d47705a211f980292e5d94782afb28e13979fec10f387caf7a4b98b79a86fe4e7ad3f9160a17314f34ae7dc9de9657330c39bdb079565dd9b9028e55be707459664d80e94aaa904db0f7625599f5d554d2eb884008a91dba287ef5a9e3b8d7f9be0e0cb510ed2de19caaef0d93f43f3fab92059dcb4ae3117d38f5f8569e2599dba450684e50ae2cafed01af668acaccbfd559639df872095f921c09511ba9aa98eaa60ff40792ef9de59eaf803fa0385e164e13c46a17baba7df1020fff0da0f5966c893838d94d1acb2cdefc0c668136b567139a3ccdb81c79fe589a04e4c29f588bc4970922e347038b5255e2073adf5a6f7b1b3da9766823e784de618db79c4e9c7fa9bcb8d349420c1caec932caf6fec3f006905a4da03a87acbb2a0c976d6aa75713e4ac4f627cfdf081140629c8e64f4a4f530949bef04038eb8a5f5bda930b8e4f90f00b0054e7424e220988a14706065271315d9cc90efbea5a21e6b2ab3b97950791af32fea88dc1b4997e0f745f4ee19c3ea33ef460bf37f91a0915fef7997f1476766e49003ee3b4a68b8b45b1fa6c2a9819837b731413ac89ca44f96ed6e06fdde14d31aafd7f10be7182781fcc2f07c927aa8a9b3e18889648d59b4731c1118ab551e3eace4c6cbdcec0dafc9ea2038503b1bf4ce5d78f51c6357e483f7ecd9082168c55ef6208c20227a5499cf042252ea5444d6d925806a4834d574b220e8e14e1ee686f2a699360a0fcedebe1c4b8b0ec701509bb99b96bf2bd69b73b8fd4db9ee9adf0bece84ccfef7bb6759ce3d88f32b8d6f5a4c48f33cc5576c609bf4b89b88fec3a9e95657ff7f1a71f8c2c08068bd8f32c9e0e6adae824595277425c51c9342210ea2ddbd0c468a56e49a07dd603b6c077294df30fd2d37ef48c85b28495a7fba0fdceb2f82d630deea7f8de307fb911599f5c6cb732ffa0c94511fb928a2ea94df54502f6e4ee0a1ec2287b6f0ab5d8cb8a71da9f5cd4fe2f3e86440dfef0c5f538f1fa794b49d86b24907d5ab7bef455fce7a1f5f0f8df94c6b4778617a040daa6e38feff24023cdc7d58888534dac1a361c5</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请输入访问密码</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> default </category>
          
      </categories>
      
      
        <tags>
            
            <tag> default </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
